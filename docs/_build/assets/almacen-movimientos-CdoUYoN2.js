import{a as p,g as y,c as n,d as D,i as o,b as S,t as v,e as F}from"./web-B5q02dNy.js";import{D as C}from"./Datepicker-Bs1uMk93.js";import{Q as k}from"./QTable-BOTD2X_R.js";import{c as T,w as N,S as O,t as U,f as L,z as $,P as j,L as g}from"./app-BWK4gxn2.js";import{u as q,m as B,q as E}from"./productos-B36PFsTO.js";import{u as H}from"./sedes-almacenes-D6o03K97.js";var R=v('<div class="flex a-center"><div class=mr-08></div><div class="ff-mono c-blue">(</div><div class=ff-mono></div><div class="ff-mono c-blue">)'),V=v('<div class="flex ai-center jc-between mb-06"><div class="flex ai-center w100-10"><button class="bn1 b-blue ml-10"><i class=icon-search></i></button></div><div class="search-c4 mr-16 w14rem ml-auto"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text>'),K=v("<div>");function Y(){q();const[l]=H(),h=N.getFechaUnix(),x=h-7,[s,A]=p({fechaFin:h,fechaInicio:x,almacenID:0}),[w,P]=p([]);y(()=>{const e=(l().Almacenes||[])[0]?.ID;e&&e!==s().almacenID&&A({...s(),almacenID:e})});const m=new Map,d=new Map,I=T(B,"id"),M=async()=>{g.standard("Consultando registros...");let e;try{e=await E(s())}catch{g.remove();return}console.log("registros obtenidos: ",e);for(let t of e.Productos)d.set(t.ID,t);for(let t of e.Usuarios)m.set(t.id,t);P(e.Movimientos),g.remove()},[u,_]=p(""),b=(e,t)=>{if(!e)return"";const a=l().AlmacenesMap.get(e)?.Nombre||`Almacen-${e}`;return(()=>{var c=R(),i=c.firstChild,f=i.nextSibling,r=f.nextSibling;return o(i,a),o(r,t),c})()};return n(j,{title:"Almacén Stock",get children(){return[(()=>{var e=V(),t=e.firstChild,a=t.firstChild,c=t.nextSibling,i=c.firstChild,f=i.nextSibling;return t.style.setProperty("max-width","64rem"),o(t,n(O,{get saveOn(){return s()},save:"almacenID",css:"w-08x mb-02 mr-12",label:"Almacén",keys:"ID.Nombre",get options(){return l()?.Almacenes||[]},placeholder:"",required:!0,onChange:r=>{}}),a),o(t,n(C,{label:"Fecha Inicio",css:"w-045x",save:"fechaInicio",get saveOn(){return s()}}),a),o(t,n(C,{label:"Fecha Fin",css:"w-045x",save:"fechaFin",get saveOn(){return s()}}),a),a.$$click=r=>{r.stopPropagation(),M()},f.$$keyup=r=>{r.stopPropagation(),U(()=>{_((r.target.value||"").toLowerCase().trim())},150)},e})(),n(k,{get data(){return w()},css:"w100",tableCss:"w-page-t w100",maxHeight:"calc(100vh - 8rem - 12px)",makeFilter:e=>{const t=d.get(e.ProductoID)?.Nombre||"",a=m.get(e.CreatedBy||1)?.usuario||"";return[t,a].join(" ")},get filterText(){return u()},columns:[{header:"Fecha Hora",css:"ff-mono",getValue:e=>L(e.Created,"d-M h:n")},{header:"Producto",css:"",render:e=>{const t=d.get(e.ProductoID)?.Nombre||`Producto-${e.ProductoID}`;return $(t,u())}},{header:"Lote",css:"c-purple t-c",getValue:e=>e.Lote},{header:"SKU",css:"c-purple t-c",getValue:e=>e.SKU},{header:"Movimiento",css:"t-c",render:e=>I.get(e.Tipo)?.name||"-"},{header:"Cantidad",css:"t-r ff-mono",render:e=>(()=>{var t=K();return o(t,()=>e.Cantidad),S(()=>F(t,"flex jc-end "+(e.Cantidad<0?"c-red":"c-blue"))),t})()},{header:"Almacén Origen",css:"",render:e=>b(e.AlmacenOrigenID,e.AlmacenOrigenCantidad)},{header:"Almacén Destino",css:"",render:e=>b(e.AlmacenID,e.AlmacenCantidad)},{header:"Usuario",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",render:e=>{const t=m.get(e.CreatedBy||1)?.usuario||`Usuario-${e.CreatedBy}`;return $(t,u())}}]})]}})}D(["click","keyup"]);export{Y as default};
