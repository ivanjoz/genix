import"./DsnmJJEf.js";import{a as de}from"./BP6gtoFE.js";import{p as ve,e as G,g as J,l as K,h as v,i as t,f as g,c as b,s as u,r as p,t as x,b as m,d as fe,av as ue}from"./DsnVzSLI.js";import{s as Q}from"./00GtM8hT.js";import{i as h}from"./tZVUs-sg.js";import{b as P,d as V,s as M}from"./Dfx1yjcr.js";import{d as me,e as ge}from"./BzG9rrjb.js";import{p as o}from"./Dgo9tfmS.js";import{E as N,i as T,d as _e}from"./Bz9XdVJx.js";import{N as j,a as be}from"./CAaV5v2W.js";var pe=g('<div class="w-full h-full relative flex flex-col items-center justify-center card_input_layer svelte-ilfl9z"><input type="file" accept="image/png, image/jpeg, image/webp" class="svelte-ilfl9z"/> <div style="font-size: 2.4rem"><i class="icon-upload"></i></div> <div class="h5">Subir Imagen</div></div>'),he=g('<source type="image/avif"/>'),ye=g('<source type="image/webp"/>'),xe=g('<picture class="contents"><!> <!> <img class="w-full h-full absolute card_image_img1 svelte-ilfl9z" alt="Upload preview"/></picture>'),we=g('<textarea class="w-full card_image_textarea svelte-ilfl9z" placeholder="Nombre..."></textarea>'),ze=g('<div class="absolute w-full card_image_upload_text svelte-ilfl9z"> </div>'),Ue=g('<button class="bnr-1 _5 card_image_btn svelte-ilfl9z" aria-label="Subir imagen"><i class="icon-ok"></i></button>'),Se=g('<div><!> <!> <div class="w-full absolute flex items-center justify-center card_image_layer_botton svelte-ilfl9z"><button aria-label="Eliminar imagen"><i class="icon-cancel"></i></button> <!></div></div>'),Ce=g('<div class="w-full h-full absolute flex flex-col items-center justify-center card_image_layer_loading svelte-ilfl9z"><div class="c-white h3 ff-bold">Loading...</div> <div class="flex relative items-center justify-center h-22 lh-10 w-[calc(100%-16px)] left-0 right-0 mt-8 _8 mr-8 ml-9 p-2 svelte-ilfl9z"><div class="absolute _9 left-2 h-18 svelte-ilfl9z"></div> <div class="absolute fs14 ff-bold text-white"> </div></div></div>'),Ie=g("<div><!> <!> <!> <!></div>");function Le(W,r){ve(r,!0);let U=o(r,"src",3,""),E=o(r,"types",19,()=>[]),Y=o(r,"saveAPI",3,"images");o(r,"refreshIndexDBCache",3,"");let B=o(r,"onUploaded",3,void 0),L=o(r,"setDataToSend",3,void 0),Z=o(r,"clearOnUpload",3,!1),O=o(r,"description",3,""),$=o(r,"cardStyle",3,""),A=o(r,"onDelete",3,void 0),ee=o(r,"cardCss",3,""),k=o(r,"hideFormUseMessage",3,""),ae=o(r,"hideForm",3,!1),te=o(r,"hideUploadButton",3,!1),ie=o(r,"id",3,void 0),e=G(J({src:U(),types:E(),description:O()})),d=G(J(U()?-1:0));N.imageCounter++;const D=ie()||N.imageCounter;K(()=>{U(),v(e,{src:U(),base64:"",types:E(),description:O()},!0)});const F=i=>{if(t(e).base64)return t(e).base64;if(!t(e).src)return"";let a=t(e).src||"";return a.substring(0,8)!=="https://"&&a.substring(0,7)!=="http://"&&(r.folder&&(a=r.folder+"/"+a),r.size&&(a=`${a}-x${r.size}`),a=N.S3_URL+a),i&&(a=a+"."+i),a},re=async i=>{const s=i.target.files;if(!s||s.length===0)return;const _=s[0];console.log("imagefile::",_);try{const c=await be(_,1.2);v(d,-1),v(e,{src:"",base64:c,types:[],description:t(e).description},!0),r.onChange?.(t(e))}catch(c){j.failure("Error procesando la imagen: "+String(c)),v(d,0)}},R=async()=>{let i={};if(!t(e).base64)return j.failure("No hay nada que enviar."),Promise.resolve(i);v(d,.001);const a={Content:t(e).base64,Description:t(e).description};L()&&L()(a);try{i=await _e({data:a,route:Y()||"images",onUploadProgress:s=>{s.total&&(v(d,Math.round(s.loaded*100/s.total),!0),console.log("progress:: ",t(d)))}})}catch(s){return j.failure("Error guardando la imagen: "+String(s)),i}return i.id=D,i.description=t(e).description,Z()?v(e,{src:"",base64:"",types:[],description:""},!0):v(e,{src:`${i.imageName}-x2`,base64:"",types:["webp","avif"],description:t(e).description},!0),v(d,-1),B()&&B()(i.imageName,i.description),i};K(()=>{t(e).base64?T.set(D,R):T.delete(D)}),de(()=>{T.delete(D)});var S=Ie(),q=b(S);{var se=i=>{var a=pe(),s=b(a);s.__change=re,ue(4),p(a),m(i,a)};h(q,i=>{(t(e)?.src||"").length===0&&i(se)})}var H=u(q,2);{var le=i=>{var a=xe(),s=b(a);{var _=l=>{var y=he();x(I=>P(y,"srcset",I),[()=>F("avif")]),m(l,y)};h(s,l=>{t(e).types?.includes("avif")&&l(_)})}var c=u(s,2);{var C=l=>{var y=ye();x(I=>P(y,"srcset",I),[()=>F("webp")]),m(l,y)};h(c,l=>{t(e).types?.includes("webp")&&l(C)})}var w=u(c,2);p(a),x(l=>P(w,"src",l),[()=>F(t(e)?.types?.[0])]),m(i,a)};h(H,i=>{(t(e).src||t(e).base64||"").length>0&&i(le)})}var X=u(H,2);{var oe=i=>{var a=Se(),s=b(a);{var _=n=>{var f=we();P(f,"rows",3),ge("blur",f,z=>{z.stopPropagation(),t(e).description=z.currentTarget.value||"",r.onChange?.(t(e))}),m(n,f)};h(s,n=>{t(e).base64&&!k()&&!ae()&&n(_)})}var c=u(s,2);{var C=n=>{var f=ze(),z=b(f,!0);p(f),x(()=>Q(z,k())),m(n,f)};h(c,n=>{t(e).base64&&k()&&n(C)})}var w=u(c,2),l=b(w);l.__click=n=>{if(n.stopPropagation(),A()){A()(U());return}v(e,{src:"",base64:"",types:[],description:""},!0),r.onChange?.(t(e)),v(d,0)};var y=u(l,2);{var I=n=>{var f=Ue();f.__click=z=>{z.stopPropagation(),R()},m(n,f)};h(y,n=>{t(e).base64&&!te()&&n(I)})}p(w),p(a),x(()=>{M(a,1,`w-full h-full absolute card_image_layer${t(e).base64?" s1":""}`,"svelte-ilfl9z"),M(l,1,`bnr-1 _4 mr-12 ${t(e).base64?"":"card_image_layer_bn_close2"} card_image_btn`,"svelte-ilfl9z")}),m(i,a)};h(X,i=>{t(d)===-1&&i(oe)})}var ne=u(X,2);{var ce=i=>{var a=Ce(),s=u(b(a),2),_=b(s),c=u(_,2),C=b(c);p(c),p(s),p(a),x((w,l)=>{V(_,`width: calc(${w??""}% - 4px);`),Q(C,`${l??""} %`)},[()=>Math.round(t(d)),()=>Math.round(t(d))]),m(i,a)};h(ne,i=>{t(d)>0&&i(ce)})}p(S),x(()=>{M(S,1,`relative ${ee()??""} card_image_1 ${t(e)?.src?"":"card_input"}`,"svelte-ilfl9z"),V(S,$())}),m(W,S),fe()}me(["change","click"]);export{Le as I};
