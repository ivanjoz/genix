(function(){"use strict";console.log("ðŸ”§ Image worker loaded and ready"),self.onmessage=async e=>{console.log("ðŸ“¨ Worker received message:",{hasBitmap:!!e.data.bitmap,hasBlob:!!e.data.blob,resolution:e.data.resolution,useJpeg:e.data.useJpeg});try{if(e.data.bitmap){console.log("ðŸ–¼ï¸ Processing bitmap...");const o=e.data.bitmap,a=e.data.resolution||1,{width:t,height:s}=d(o.width,o.height,a);console.log("ðŸ“ Calculated dimensions:",{width:t,height:s});const n=new OffscreenCanvas(t,s);n.getContext("2d").drawImage(o,0,0,t,s);const c=e.data.useJpeg?"image/jpeg":"image/webp",i=await n.convertToBlob({type:c,quality:.8});console.log("ðŸŽ¨ Blob created:",i.size,"bytes");const r=await g(i);console.log("âœ… Data URL created, length:",r.length),self.postMessage({dataUrl:r}),console.log("ðŸ“¤ Response sent to main thread")}else if(e.data.blob){console.log("ðŸ–¼ï¸ Processing blob...");const o=e.data.blob,a=e.data.resolution||1;console.log("ðŸ”„ Creating ImageBitmap from blob...");const t=await createImageBitmap(o);console.log("âœ… ImageBitmap created:",t.width,"x",t.height);const{width:s,height:n}=d(t.width,t.height,a);console.log("ðŸ“ Calculated dimensions:",{width:s,height:n});const l=new OffscreenCanvas(s,n);l.getContext("2d").drawImage(t,0,0,s,n);const i=e.data.useJpeg?"image/jpeg":"image/webp",r=await l.convertToBlob({type:i,quality:.8});console.log("ðŸŽ¨ Resized blob created:",r.size,"bytes");const b=await g(r);console.log("âœ… Data URL created, length:",b.length),self.postMessage({dataUrl:b}),console.log("ðŸ“¤ Response sent to main thread")}else console.error("âŒ No bitmap or blob provided in message")}catch(o){console.error("âŒ Error in worker:",o),self.postMessage({error:String(o)})}};const d=(e,o,a)=>{const t=e/o,s=e*o,n=a*1e6;if(n>s)return{width:e,height:o};let l=Math.sqrt(n*t),c=l/t;return l>e&&(l=e,c=o),{width:Math.round(l),height:Math.round(c)}};function g(e){return new Promise(o=>{const a=new FileReader;a.onloadend=()=>o(a.result),a.readAsDataURL(e)})}})();
