import"../chunks/DsnmJJEf.js";import{p as Pe,e as V,g as A,l as xe,i as e,h as n,d as Le,f as I,a as R,c as i,s as r,r as l,u as P,b as C,t as U,x as B}from"../chunks/Bf0lWsRu.js";import{s as z}from"../chunks/WwA8pLij.js";import{i as $}from"../chunks/D7jGWfSg.js";import{d as qe}from"../chunks/Cu2BEfFs.js";import{s as be}from"../chunks/C7iUW-It.js";import{I as J}from"../chunks/C61KEcBC.js";import{M as ie}from"../chunks/03-DSbml.js";import{O as He}from"../chunks/Ce7DcdGj.js";import{P as Ue}from"../chunks/Cjl-14FK.js";import{S as K}from"../chunks/CgTtmJH3.js";import{C as ze}from"../chunks/EAyZqkAB.js";import{V as le}from"../chunks/9nVZToYO.js";import{N as Q,t as Ee,f as ne,L as E}from"../chunks/B0A7VF9y.js";import{C as L,f as T}from"../chunks/CUNP7WoD.js";import{A as Ge}from"../chunks/BNeOhMyC.js";import{c as he,C as Ae,g as Be,a as Je,b as de,p as Ke,d as Qe,e as We}from"../chunks/DB7WRjTq.js";var Xe=I('<div class="flex justify-center items-center py-40"><div class="text-slate-400">Cargando...</div></div>'),Ye=I('<div class="bg-red-100 text-red-700 p-8 mt-8 rounded">Seleccione una Caja</div>'),Ze=I('<div class="flex w-full justify-between mt-8"><div class="flex items-center"><div class="text-[1.1rem] ff-bold mr-8"> </div> <button class="bx-yellow" aria-label="edit"><i class="icon-pencil"></i></button></div> <div class="flex items-center"><button class="bx-green" aria-label="add"><i class="icon-plus"></i></button></div></div> <!>',1),ea=I('<div class="flex justify-center items-center py-40"><div class="text-slate-400">Cargando...</div></div>'),aa=I('<div class="bg-red-100 text-red-700 p-8 mt-8 rounded">Seleccione una Caja</div>'),ta=I('<div class="flex w-full justify-between mt-8"><div></div> <div class="flex items-center"><button class="bx-green" aria-label="add"><i class="icon-plus"></i></button></div></div> <!>',1),ra=I('<div class="grid grid-cols-24 gap-10"><!> <!> <!> <!> <div class="col-span-24 flex justify-between items-center"><div></div> <!></div></div>'),sa=I("<span> </span>"),oa=I('<div class="col-span-24 text-red-600 ff-bold"><i class="icon-attention"></i> </div>'),ia=I('<div class="flex items-start w-full p-16"><div class="w-260 mr-16"><div class="w-full mb-12"><div class="text-sm mb-4 text-slate-600">Saldo Sistema</div> <div class="text-[1.1rem] ff-mono text-center bg-slate-100 py-8 rounded"> </div></div> <!> <div class="mb-12"></div> <div class="w-full"><div class="text-sm mb-4 text-slate-600">Diferencia</div> <div class="text-[1.1rem] min-h-32 ff-mono text-center bg-slate-100 py-8 rounded"><!></div></div></div> <div class="flex items-end"><button class="bx-purple w-full mt-24"><i class="text-[0.875rem] icon-arrows-cw"></i> Recalcular</button></div> <!></div>'),la=I("<span> </span>"),na=I('<div class="grid grid-cols-24 gap-10"><!> <!> <!> <div class="col-span-24 md:col-span-12"></div> <div class="col-span-24 md:col-span-12"><div class="text-sm mb-4 text-slate-600">Saldo Inicial</div> <div class="text-[1.1rem] ff-mono text-center bg-slate-100 py-8 rounded"> </div></div> <div class="col-span-24 md:col-span-12"><div class="text-sm mb-4 text-slate-600">Saldo Final</div> <div class="text-[1.1rem] ff-mono text-center bg-slate-100 py-8 rounded"><!></div></div></div>'),da=I('<div class="flex flex-col md:flex-row justify-between mb-6 gap-10"><div class="w-full md:w-[36%]"><div class="flex justify-between items-center w-full mb-10"><div class="i-search mr-16 w-256"><div><i class="icon-search"></i></div> <input class="w-full" autocomplete="off" type="text"/></div> <div class="flex items-center"><button class="bx-green" aria-label="agregar"><i class="icon-plus"></i></button></div></div> <!></div> <div class="w-full md:w-[calc(64%-22px)] bg-white rounded-md shadow-sm p-12"><!> <!> <!></div></div> <!> <!> <!>',1);function Ia(Se,je){Pe(je,!0);const ce=new Map(he.map(a=>[a.id,a])),we=new Ge,M=new Ae;let W=V(""),q=V(1),t=V(A({})),j=V(A({})),x=V(A({})),X=V(A([])),Y=V(A([])),Z=V(!1),ee=V(!1);const ye=[{header:"ID",headerCss:"w-32",cellCss:"text-center text-purple-600 px-6",getValue:a=>a.ID},{header:"Nombre",cellCss:"px-6 py-2",getValue:a=>a.Nombre,render:a=>{const b=de.find(v=>v.id===a.Tipo)?.name||"-";return`<div class="leading-tight">
          <div class="ff-bold leading-[1.1] h3">${a.Nombre}</div>
          <div class="fs15 text-slate-500">${b}</div>
        </div>`}},{header:"Cuadre",getValue:a=>a.CuadreFecha?String(a.CuadreFecha):"",render:a=>{if(!a.CuadreFecha)return"";const b=T(a.CuadreSaldo/100,2),v=ne(a.CuadreFecha,"d-M h:n");return`<div class="leading-tight text-right">
          <div class="ff-mono text-[0.875rem]">${b}</div>
          <div class="text-[0.875rem] text-slate-500">${v}</div>
        </div>`}},{header:"Saldo",cellCss:"text-right ff-mono px-6",getValue:a=>T(a.SaldoCurrent/100,2)}],De=async()=>{const a=e(t);if(!a.Nombre||!a.Tipo||!a.SedeID){Q.failure("Los inputs Nombre, Tipo y Sede son obligatorios");return}E.standard("Guardando caja...");try{var b=await Ke(a)}catch(S){console.warn(S);return}E.remove(),a.SaldoCurrent=a.SaldoCurrent||0;const v=M.CajasMap.get(a.ID);v?Object.assign(v,a):(a.ID=b.ID,M.Cajas.push(a)),M.Cajas=[...M.Cajas],L.closeModal(1)},Ie=async()=>{const a=e(j);a.SaldoSistema=e(t).SaldoCurrent,E.standard("Guardando caja...");let b;try{b=await Qe(a)}catch(S){console.warn(S);return}E.remove();const v=M.CajasMap.get(a.CajaID);if(v)if(typeof b?.NeedUpdateSaldo=="number"){v.SaldoCurrent=b.NeedUpdateSaldo,n(t,{...v},!0);const S={...e(j)};S._error=`Hubo una actualización en el saldo de la caja. El saldo actual es "${T(v.SaldoCurrent/100,2)}". Intente nuevamente con el cálculo actualizado.`,S.SaldoDiferencia=S.SaldoReal-v.SaldoCurrent,n(j,S,!0)}else v.SaldoCurrent=a.SaldoReal,M.Cajas=[...M.Cajas],Object.assign(e(t),v),L.closeModal(2),e(Y).unshift(b)},Me=async()=>{const a=e(x);if(!a.Tipo||!a.Monto){Q.failure("Se necesita seleccionar un monto y un tipo.");return}E.standard("Guardando Movimiento...");let b;try{b=await We(a)}catch(S){console.warn(S);return}E.remove();const v=M.CajasMap.get(a.CajaID);v&&(v.SaldoCurrent=a.SaldoFinal,M.Cajas=[...M.Cajas],Object.assign(e(t),v),e(X).unshift(b),L.closeModal(3))},ve=P(()=>[3].includes(e(x).Tipo));xe(()=>{e(q)===1&&e(t).ID&&(n(Z,!0),Be({CajaID:e(t).ID,lastRegistros:200}).then(a=>{n(X,a,!0)}).catch(a=>{Q.failure(a)}).finally(()=>{n(Z,!1)}))}),xe(()=>{e(q)===2&&e(t).ID&&(n(ee,!0),Je({CajaID:e(t).ID,lastRegistros:200}).then(a=>{n(Y,a,!0)}).catch(a=>{console.log("Error:",a),Q.failure(a)}).finally(()=>{n(ee,!1)}))});const Ne=P(()=>{if(!e(W))return M.Cajas;const a=e(W).toLowerCase();return M.Cajas.filter(b=>b.Nombre?.toLowerCase().includes(a))});Ue(Se,{title:"Cajas & Bancos",children:(a,b)=>{var v=da(),S=R(v),ae=i(S),te=i(ae),re=i(te),Oe=r(i(re),2);Oe.__keyup=d=>{d.stopPropagation(),Ee(()=>{n(W,(d.target.value||"").toLowerCase().trim(),!0)},150)},l(re);var ue=r(re,2),Te=i(ue);Te.__click=d=>{d.stopPropagation(),n(t,{ID:-1,ss:1},!0),L.openModal(1)},l(ue),l(te);var ke=r(te,2);le(ke,{css:"w-full",get columns(){return ye},maxHeight:"calc(100vh - 8rem - 16px)",get data(){return e(Ne)},get selected(){return e(t).ID},isSelected:(d,N)=>d?.ID===N,tableCss:"cursor-pointer",onRowClick:d=>{const N=e(t).ID===d.ID?{}:{...d};n(t,N,!0)}}),l(ae);var me=r(ae,2),pe=i(me);He(pe,{get selected(){return e(q)},options:[[1,"Movimientos"],[2,"Cuadres"]],buttonCss:"ff-bold",onSelect:d=>{n(q,d[0],!0)}});var fe=r(pe,2);{var Fe=d=>{var N=B(),h=R(N);{var w=c=>{var f=Xe();C(c,f)},y=c=>{var f=B(),O=R(f);{var F=g=>{var D=Ye();C(g,D)},p=g=>{var D=Ze(),k=R(D),s=i(k),o=i(s),_=i(o,!0);l(o);var u=r(o,2);u.__click=m=>{m.stopPropagation(),L.openModal(1)},l(s);var H=r(s,2),se=i(H);se.__click=m=>{m.stopPropagation(),L.openModal(3),n(x,{CajaID:e(t).ID,SaldoFinal:e(t).SaldoCurrent},!0)},l(H),l(k);var G=r(k,2);le(G,{css:"w-full mt-8",maxHeight:"calc(100vh - 8rem - 16px)",get data(){return e(X)},columns:[{header:"Fecha Hora",getValue:m=>ne(m.Created,"d-M h:n")},{header:"Tipo Mov.",getValue:m=>ce.get(m.Tipo)?.name||""},{header:"Monto",cellCss:"ff-mono text-right px-6",render:m=>{const oe=T(m.Monto/100,2);return`<span class="${m.Monto<0?"text-red-600":""}">${oe}</span>`}},{header:"Saldo Final",cellCss:"ff-mono text-right px-6",getValue:m=>T(m.SaldoFinal/100,2)},{header:"Nº Documento",getValue:m=>""},{header:"Usuario",cellCss:"text-center px-6",getValue:m=>m.Usuario?.usuario||""}]}),U(()=>z(_,e(t)?.Nombre||"")),C(g,D)};$(O,g=>{e(t).ID?g(p,!1):g(F)},!0)}C(c,f)};$(h,c=>{e(Z)?c(w):c(y,!1)})}C(d,N)};$(fe,d=>{e(q)===1&&d(Fe)})}var $e=r(fe,2);{var Ve=d=>{var N=B(),h=R(N);{var w=c=>{var f=ea();C(c,f)},y=c=>{var f=B(),O=R(f);{var F=g=>{var D=aa();C(g,D)},p=g=>{var D=ta(),k=R(D),s=r(i(k),2),o=i(s);o.__click=u=>{u.stopPropagation(),L.openModal(2),n(j,{CajaID:e(t).ID},!0)},l(s),l(k);var _=r(k,2);le(_,{css:"w-full mt-8",maxHeight:"calc(100vh - 8rem - 16px)",get data(){return e(Y)},columns:[{header:"Fecha Hora",getValue:u=>ne(u.Created,"d-M h:n")},{header:"Saldo Sistema",cellCss:"ff-mono text-right px-6",getValue:u=>T((u.SaldoSistema||0)/100,2)},{header:"Diferencia",cellCss:"ff-mono text-right px-6",getValue:u=>T((u.SaldoDiferencia||0)/100,2)},{header:"Saldo Real",cellCss:"ff-mono text-right px-6",getValue:u=>T((u.SaldoReal||0)/100,2)},{header:"Usuario",cellCss:"text-center px-6",getValue:u=>u.Usuario?.usuario||""}]}),C(g,D)};$(O,g=>{e(t).ID?g(p,!1):g(F)},!0)}C(c,f)};$(h,c=>{e(ee)?c(w):c(y,!1)})}C(d,N)};$($e,d=>{e(q)===2&&d(Ve)})}l(me),l(S);var ge=r(S,2);ie(ge,{id:1,title:"Cajas",size:6,bodyCss:"px-16 py-14",onSave:()=>{De()},onDelete:()=>{},children:(d,N)=>{var h=ra(),w=i(h);K(w,{save:"Tipo",css:"col-span-24 md:col-span-10",label:"Tipo",keyId:"id",keyName:"name",get options(){return de},placeholder:"",required:!0,get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var y=r(w,2);J(y,{save:"Nombre",css:"col-span-24 md:col-span-14",label:"Nombre",required:!0,get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var c=r(y,2);J(c,{save:"Descripcion",css:"col-span-24",label:"Descripcion",get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var f=r(c,2);K(f,{save:"SedeID",css:"col-span-24 md:col-span-10",label:"Sede",required:!0,get options(){return we.Sedes},keyId:"ID",keyName:"Nombre",get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var O=r(f,2),F=r(i(O),2);ze(F,{label:"Saldo Negativo",save:"Nombre",get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}}),l(O),l(h),C(d,h)},$$slots:{default:!0}});var _e=r(ge,2);ie(_e,{id:2,title:"Cuadre de Caja",size:6,onSave:()=>{Ie()},children:(d,N)=>{var h=ia(),w=i(h),y=i(w),c=r(i(y),2),f=i(c,!0);l(c),l(y);var O=r(y,2);J(O,{save:"SaldoReal",type:"number",inputCss:"text-[1.1rem] ff-mono text-center",baseDecimals:2,css:"w-full mb-12",label:"Saldo Encontrado",required:!0,onChange:()=>{console.log("caja cuadre::",e(j)),n(j,{...e(j)},!0)},get saveOn(){return e(j)},set saveOn(o){n(j,o,!0)}});var F=r(O,4),p=r(i(F),2),g=i(p);{var D=o=>{const _=P(()=>(e(j).SaldoReal||0)-e(t).SaldoCurrent);var u=B(),H=R(u);{var se=G=>{var m=sa(),oe=i(m,!0);l(m),U(Ce=>{be(m,1,e(_)>0?"text-blue-600":"text-red-600"),z(oe,Ce)},[()=>T(e(_)/100,2)]),C(G,m)};$(H,G=>{e(_)&&G(se)})}C(o,u)};$(g,o=>{e(j).SaldoReal&&o(D)})}l(p),l(F),l(w);var k=r(w,4);{var s=o=>{var _=oa(),u=r(i(_),1,!0);l(_),U(()=>z(u,e(j)._error)),C(o,_)};$(k,o=>{e(j)._error&&o(s)})}l(h),U(o=>z(f,o),[()=>T((e(t).SaldoCurrent||0)/100,2)]),C(d,h)},$$slots:{default:!0}});var Re=r(_e,2);ie(Re,{id:3,title:"Movimiento de Caja",size:6,onSave:()=>{Me()},children:(d,N)=>{var h=na(),w=i(h);{let s=P(()=>he.filter(o=>o.group===2));K(w,{save:"Tipo",css:"col-span-24 md:col-span-12",label:"Tipo",keyId:"id",keyName:"name",get options(){return e(s)},placeholder:"",required:!0,onChange:()=>{e(x).CajaRefID=0,n(x,{...e(x)},!0)},get saveOn(){return e(x)},set saveOn(o){n(x,o,!0)}})}var y=r(w,2);{let s=P(()=>!e(ve)),o=P(()=>e(ve)?"seleccione":"no aplica");K(y,{save:"CajaRefID",css:"col-span-24 md:col-span-12",label:"Caja Destino",keyId:"id",keyName:"name",get options(){return de},get disabled(){return e(s)},get placeholder(){return e(o)},required:!0,get saveOn(){return e(x)},set saveOn(_){n(x,_,!0)}})}var c=r(y,2);J(c,{save:"Monto",inputCss:"ff-mono text-[1.1rem] text-center",css:"col-span-24 md:col-span-12",label:"Monto",baseDecimals:2,required:!0,type:"number",transform:s=>{const o=ce.get(e(x).Tipo);return console.log("movimiento tipo::",o),o?.isNegative&&typeof s=="number"&&s>0&&(s=s*-1),s},onChange:()=>{const s={...e(x)};s.SaldoFinal=e(t).SaldoCurrent+(s.Monto||0),n(x,s,!0)},get saveOn(){return e(x)},set saveOn(s){n(x,s,!0)}});var f=r(c,4),O=r(i(f),2),F=i(O,!0);l(O),l(f);var p=r(f,2),g=r(i(p),2),D=i(g);{var k=s=>{const o=P(()=>e(x).SaldoFinal);var _=la(),u=i(_,!0);l(_),U(H=>{be(_,1,e(o)>=0?"":"text-red-600"),z(u,H)},[()=>T(e(o)/100,2)]),C(s,_)};$(D,s=>{e(x).SaldoFinal!==void 0&&s(k)})}l(g),l(p),l(h),U(s=>z(F,s),[()=>T(e(t).SaldoCurrent/100,2)]),C(d,h)},$$slots:{default:!0}}),C(a,v)},$$slots:{default:!0}}),Le()}qe(["keyup","click"]);export{Ia as component};
