import{d as B,a as x,g as j,i as o,f as R,c as s,t as m,S as _}from"./web-B5q02dNy.js";import{m as q,c as H,b as G,N as k,L as C,l as E,t as z,a as L,D as K,I as h,S as M,H as V,h as Q,J as W,C as J,P as X}from"./app-BWK4gxn2.js";import{m as Y}from"./simple-statistics-CHr0eFhd.js";import{C as T,a as Z}from"./Editables-BusTbSKR.js";import{a as O,o as ee,S as re}from"./Modals-DvNFUCP8.js";import{Q as U}from"./QTable-BOTD2X_R.js";import{u as te,a as se}from"./productos-B36PFsTO.js";import{u as ae}from"./sedes-almacenes-D6o03K97.js";import{I as F}from"./Uploaders-Cw7zkMMx.js";const ne=v=>{const d=v.sort().join(",");return q({route:"listas-compartidas",errorMessage:"Hubo un error al obtener las listas compartidas.",cacheSyncTime:1,mergeRequest:!0,partition:{key:"pk",value:d,param:"ids"},useIndexDBCache:"listas_compartidas",makeTransform:f=>{f.pk=d}},f=>{const i=f;return i.RecordsMap=H(i.Records,"ID"),i.Records=i.Records.filter($=>$.ss),i})},oe=v=>G({data:v,route:"listas-compartidas",refreshIndexDBCache:"listas_compartidas"});var le=m('<i class="c-red icon-arrows-cw">'),ie=m('<button class="bnr2 d-red b-card-1"><i class=icon-trash>'),ce=m('<div class=w100><div class="flex jc-between ai-center w100 mb-08"><div><h3>Categorías</h3></div><div class="flex a-center"><button class="bn1 b-green"><i class=icon-plus>'),de=m('<button class="bn1 b-blue mr-12">Guardar<i class=icon-floppy>');const ue=v=>{const[d,f]=x([]),[i,$]=x(new Map);let t=-1;j(()=>{const a=(v.listas?.Records||[]).filter(g=>g.ListaID===v.listaID);f(a),$(new Map)});const p=a=>{i().set(a.ID,a),$(new Map(i()))},P=[{header:"ID",headerStyle:{width:"2.6rem"},render:a=>a.ID<0?le():a.ID},{header:"Nombre",render:a=>s(T,{saveOn:a,save:"Nombre",contentClass:"flex ai-center",required:!0,onChange:()=>{p(a)}})},{header:"Descripción",render:a=>s(T,{saveOn:a,save:"Descripcion",contentClass:"flex ai-center",onChange:()=>{p(a)}})},{header:"...",headerStyle:{width:"2.6rem"},css:"t-c",cardColumn:[1,2],render:a=>{const g=w=>{w.stopPropagation();const u=d().filter(e=>e.ID!==a.ID);a.ID<0?i().delete(a.ID):(a.ss=0,i().set(a.ID,a)),f(u),$(new Map(i()))};return(()=>{var w=ie();return w.$$click=g,w})()}}],N=()=>{const a={ListaID:v.listaID,ID:t,Nombre:"",ss:1};d().push(a),t--,f([...d()])},S=async()=>{const a=[...i().values()];if(a.length==0){k.failure("No hay registros creados / actualizados");return}C.standard("Guardando...");let g;try{g=await oe(a)}catch(u){console.warn(u)}if(C.remove(),!g)return;const w=H(g||[],"TempID");for(let u of d())u.ID<0&&(u.ID=w.get(u.ID)?.NewID||0);console.log("resultado obtenido::",g),f([...d()]),$(new Map(i()))};return(()=>{var a=ce(),g=a.firstChild,w=g.firstChild,u=w.nextSibling,e=u.firstChild;return o(u,(()=>{var r=R(()=>i().size>0);return()=>r()&&(()=>{var n=de();return n.$$click=l=>{l.stopPropagation(),S()},n})()})(),e),e.$$click=r=>{r.stopPropagation(),N()},o(a,s(U,{get data(){return d()},css:"",tableCss:"w-page-t",maxHeight:"calc(80vh - 13rem)",columns:P}),null),a})()};B(["click"]);var me=m('<div class="flex ai-center jc-between mb-06"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus>'),pe=m("<div>"),ge=m('<div class="flex-wrap w100 mt-12"><div class="flex-wrap ac-baseline w100 p-rel"><div class="w-05x p-rel"></div><div class="w-05x p-rel"></div></div><div class="w-24x mb-02 flex jc-end"></div><div class="w100 mb-10"></div><div class="ff-bold h3 mb-06"><div class=ml-08>Sub-Unidades</div></div><div class="flex w100">'),be=m('<div class="w100 py-04 px-04">'),ve=m('<div class="w100 px-02 py-08">'),he=m('<div class="flex ai-center jc-between mb-06">'),A=m('<div class="p-abs pos-v c-steel1">%'),fe=m('<div><button class="bn1 s2 b-green"><i class=icon-plus>'),we=m('<button class="bnr2 b-red b-card-1"><i class=icon-trash>');function Oe(){ae();const[v]=ne([1]),[d,f]=te(),[i,$]=x(""),[t,p]=x({}),[P,N]=x(1),S=.48;j(()=>{console.log("listas compartidas::",v())});const a=R(()=>v()?.Records?.filter(e=>e.ListaID===1)||[]),g=async e=>{const r=t();if((r.Nombre?.length||0)<4){k.failure("El nombre debe tener al menos 4 caracteres.");return}C.standard("Creando /Actualizando Producto...");try{var n=await se([r])}catch(c){k.failure(c),C.remove();return}let l=[...d().productos];if(r.ID){const c=d().productos.find(I=>I.ID===r.ID);c&&Object.assign(c,r)}else r.ID=n[0].ID,l.unshift(r);f({...d(),productos:l}),p({}),O([]),C.remove()},w=async e=>{try{await G({data:{ProductoID:t().ID,ImageToDelete:e},route:"producto-image",refreshIndexDBCache:"productos"})}catch(r){k.failure(`Error al guardar el producto: ${r}`);return}t().Images=t().Images.filter(r=>r.n!==e),p({...t()})};let u=-1;return s(X,{title:"Productos",views:[[1,"Productos"],[2,"Parámetros"]],get children(){return[s(_,{get when(){return E()===1},get children(){return[(()=>{var e=me(),r=e.firstChild,n=r.firstChild,l=n.nextSibling,c=r.nextSibling,I=c.firstChild;return l.$$keyup=D=>{D.stopPropagation(),z(()=>{$((D.target.value||"").toLowerCase().trim())},150)},I.$$click=D=>{D.stopPropagation(),O([1]),p({ss:1,Propiedades:[]})},e})(),s(U,{get data(){return d().productos||[]},css:"selectable",tableCss:"w-page-t",isSelected:(e,r)=>e.ID===r,get selected(){return t().ID},get filterText(){return i()},filterKeys:["Nombre"],get style(){return{width:ee().length>0?`calc(var(--page-width) * ${1-S})`:void 0}},maxHeight:"calc(80vh - 13rem)",columns:[{header:"ID",headerStyle:{width:"3rem"},css:"t-c c-purple",getValue:e=>e.ID},{header:"Nombre",cardColumn:[3,2],field:"Nombre",getValue:e=>e.Nombre,cardCss:"h5 c-steel"},{header:"Precio",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",getValue:e=>e.Precio?L(e.Precio/100,2):""},{header:"Descuento",cardColumn:[3,2],css:"t-c",getValue:e=>e.Descuento?L(e.Descuento,1)+"%":""},{header:"Precio Final",cardColumn:[3,2],css:"t-c",getValue:e=>e.PrecioFinal?L(e.PrecioFinal/100,2):""},{header:"Sub-Unidades",cardColumn:[3,2],getValue:e=>e.SbnUnidad?`${e.SbnCantidad} x ${e.SbnUnidad}`:""},{header:"Grupos",cardColumn:[3,2],css:"t-c",getValue:e=>""}],onRowCLick:e=>{e.ID===t().ID?(p({}),O([])):(p({...e}),O([1]))}}),s(re,{id:1,style:{width:`calc(var(--page-width) * ${S})`},get title(){return"Producto "+(t()?.Nombre||"(Nuevo)")},onClose:()=>{p({})},onSave:()=>{g()},get children(){return[pe(),s(K,{get selectedID(){return P()},class:"w100",options:[[1,"Información"],[2,"Ficha"],[3,"Fotos"]],buttonStyle:{"min-height":"2.1rem"},buttonClass:"ff-bold",onSelect:e=>{N(e)}}),s(_,{get when(){return P()===1},get children(){return[(()=>{var e=ge(),r=e.firstChild,n=r.firstChild,l=n.nextSibling,c=r.nextSibling,I=c.nextSibling,D=I.nextSibling,y=D.nextSibling;return o(e,s(h,{get saveOn(){return t()},save:"Nombre",required:!0,css:"w-24x mb-10",label:"Nombre"}),r),r.style.setProperty("min-height","calc(14vh + 1rem)"),o(n,s(F,{cardStyle:{width:"100%",position:"absolute",top:"0","z-index":12},types:["avif","webp"],get src(){return R(()=>!!t().Image)()?`img-productos/${t().Image.n}-x2`:""}})),o(r,s(h,{get saveOn(){return t()},save:"Peso",css:"w-055x mb-10",label:"Peso",type:"number"}),l),o(r,s(M,{get saveOn(){return t()},save:"PesoT",placeholder:" ",label:"-",keys:"i.v",css:"w-04x mb-10",options:[{i:1,v:"Kg"},{i:2,v:"g"},{i:3,v:"Libras"}]}),l),o(r,s(h,{get saveOn(){return t()},save:"Volumen",css:"w-055x mb-10",label:"Volumen",type:"number"}),l),o(r,s(M,{get saveOn(){return t()},save:"VolumenT",placeholder:" ",label:"-",keys:"i.v",css:"w-04x mb-10",options:[{i:1,v:"Kg"},{i:2,v:"g"},{i:3,v:"Libras"}]}),l),o(r,s(h,{get saveOn(){return t()},save:"Precio",id:1,css:"w-055x mb-10",label:"Precio Base",type:"number",baseDecimals:2,onChange:()=>{const b=t();b.PrecioFinal=Math.floor(b.Precio*(1-(b.Descuento||0)/100)),V([3])}}),null),o(r,s(h,{get saveOn(){return t()},save:"Descuento",css:"w-04x mb-10",label:"Desc.",type:"number",get postValue(){return A()},onChange:()=>{const b=t();b.PrecioFinal=Math.floor(b.Precio*(1-(b.Descuento||0)/100)),V([3]),console.log("form::",b)}}),null),o(r,s(h,{get saveOn(){return t()},save:"PrecioFinal",id:3,css:"w-055x mb-10",label:"Precio Final",type:"number",baseDecimals:2,onChange:()=>{const b=t();b.Precio=Math.floor(b.PrecioFinal/(1-(b.Descuento||0)/100)),V([1])}}),null),o(r,s(M,{get saveOn(){return t()},save:"Moneda",placeholder:" ",css:"w-04x mb-10",label:"Moneda",keys:"i.v",options:[{i:1,v:"PEN (S/.)"},{i:2,v:"g"},{i:3,v:"Libras"}]}),null),o(c,s(Q,{options:[{v:1,n:"SKU Individual"}],keys:"v.n",get saveOn(){return t()},save:"Params"})),o(I,s(W,{label:"Categorías",get options(){return a()},keys:"ID.Nombre",css:"w-145x",get saveOn(){return t()},save:"CategoriasIDs"})),o(y,s(h,{get saveOn(){return t()},save:"SbnUnidad",css:"w-05x mb-10",label:"Nombre"}),null),o(y,s(h,{get saveOn(){return t()},save:"SbnPrecio",baseDecimals:2,css:"w-055x mb-10",label:"Precio Base",type:"number"}),null),o(y,s(h,{get saveOn(){return t()},save:"SbnDescuento",get postValue(){return A()},css:"w-04x mb-10",label:"Descuento",type:"number"}),null),o(y,s(h,{get saveOn(){return t()},save:"SbnPreciFinal",baseDecimals:2,css:"w-055x mb-10",label:"Precio Final",type:"number"}),null),o(y,s(h,{get saveOn(){return t()},save:"SbnCantidad",css:"w-04x mb-10",label:"Cantidad",type:"number"}),null),e})(),(()=>{var e=be();return o(e,s(U,{get data(){return(t().Propiedades||[]).filter(r=>r.Status)},maxHeight:"40rem",tableCss:"single-color",get columns(){return[{header:"Propiedad",headerStyle:{width:"8rem"},render:r=>s(T,{save:"Nombre",saveOn:r,contentClass:"flex ai-center nowrap",required:!0})},{header:"Opciones",cardColumn:[3,2],render:r=>s(Z,{saveOn:r,save:"Options",getValue:n=>n.nm,skipt:n=>!n.ss,setValue:(n,l)=>(n.nm=l,n.ss=1,n.id||(n.id=u,u--),n)})},{header:(()=>{var r=fe(),n=r.firstChild;return n.$$click=l=>{l.stopPropagation();const c=[...t().Propiedades],I=c.length>0?Y(c.map(D=>D.ID)):0;c.push({ID:I+1,Status:1,Options:[]}),t().Propiedades=c,p({...t()})},r})(),headerStyle:{width:"2.6rem"},css:"t-c",cardColumn:[1,2],render:r=>(()=>{var n=we();return n.$$click=l=>{l.stopPropagation();const c=t().Propiedades.filter(I=>I!==r);t().Propiedades=c,p({...t()})},n})()}]}})),e})()]}}),s(_,{get when(){return P()===3},get children(){var e=ve();return e.style.setProperty("display","grid"),e.style.setProperty("grid-template-columns","1fr 1fr 1fr 1fr"),e.style.setProperty("grid-gap","8px"),o(e,s(F,{saveAPI:"producto-image",refreshIndexDBCache:"productos",clearOnUpload:!0,cardStyle:{width:"100%"},setDataToSend:r=>{r.ProductoID=t().ID},onUploaded:r=>{const n=r.split("/")[1],l=t().Images||[];l.push({n}),t().Images=l,p({...t()})}}),null),o(e,()=>(t().Images||[]).map(r=>s(F,{get src(){return"img-productos/"+r.n+"-x2"},cardStyle:{width:"100%"},types:["avif","webp"],onDelete:()=>{J("ELIMINAR IMAGEN",`Eliminar la imagen ${r.d?`"${r.d}"`:"seleccionada"}`,"SI","NO",()=>{w(r.n)})}})),null),e}})]}})]}}),s(_,{get when(){return E()===2},get children(){var e=he();return o(e,s(ue,{listaID:1,get listas(){return v()}})),e}})]}})}B(["keyup","click"]);export{Oe as default};
