import{a2 as w,E as A,b8 as b,k as h,a3 as f,aO as d,at as M}from"./xxzRbNoF.js";import{g as U}from"./CYLvasGs.js";import{N as v,t as E}from"./VsnTSXou.js";const L=!0,C=L,J=t=>{let e="";for(;e.length<t;)e+=(Math.random()+1).toString(36).substring(2);return e.substring(0,t)},N=async(t,e)=>{e=e.substring(0,32);const s=Uint8Array.from(atob(t),a=>a.charCodeAt(0));console.log("encrypted len::",s.length);const n=await crypto.subtle.importKey("raw",new TextEncoder().encode(e),{name:"AES-GCM"},!1,["decrypt"]);if(s.length<12)throw new Error("Invalid encrypted data");const r=s.slice(0,12);console.log("nonce:: ",new TextDecoder().decode(r));const i=s.slice(12);console.log("desencriptando:: ",r.length,e.length,i.length);let u;try{u=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},n,i)}catch(a){return console.log("Error desencriptando:: ",a),""}return console.log("decripted data:: ",u),new TextDecoder().decode(u)},q=(t,e,s,n)=>{if(e=e||0,typeof t!="number")return t?"-":"";e===-1&&(t<1?t=Math.round(t*1e4)/1e4:t<10?t=Math.round(t*1e3)/1e3:t>=10&&(t=Math.round(t*100)/100));let r;if(typeof e=="number"&&e>=0)if(e===0)r=Math.round(t).toString();else{const i=Math.pow(10,e);r=(Math.round(t*i)/i).toFixed(e)}else r=t.toString();return t>=100&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,",")),r},O=()=>C;let S="https://dnh72xkkh3junf57p3vexemlvm0emgys.lambda-url.us-east-1.on.aws/api/";{const t=window.location.host;(t.includes("localhost")||t.includes("127.0.0.1"))&&t!=="localhost:8000"&&(S="http://localhost:3589/")}const o={appId:"genix",S3_URL:"https://d16qwm950j0pjf.cloudfront.net/",serviceWorker:"/sw.js",apiRoute:S,enviroment:"dev",counterID:1,sideLayerSize:0,fetchID:1e3,imageWorker:null,zoneOffset:new Date().getTimezoneOffset()*60,dexieVersion:1,cache:{},params:{fetchID:1001,fetchProcesses:new Map},pendingRequests:[],API_ROUTES:{MAIN:S},screen:window.screen,language:window.navigator?.language||"",deviceMemory:window.navigator?.deviceMemory||0,throttleTimer:null,hostname:"",pathname:"",empresaID:0,empresa:{},imageCounter:1e4,clearAccesos:null,navigate:U,history:{pushState:(t,e,s)=>{console.log("Es server!!",t,e,s)}},getPathname:()=>window.location.pathname,getEmpresaID:()=>{if(!o.empresaID){const t=localStorage.getItem(o.appId+"EmpresaID");if(t)return o.empresaID=parseInt(t),o.empresaID;let e="";e=document.head.querySelector('meta[name="loc"]')?.getAttribute("content")||"",e||(e=o.getPathname()),e=e.replace(".html","");const s=e.split("/").filter(n=>n);if(s[1]&&s[1].includes("-")){let n=s[1].split("-")[0];isNaN(n)||(o.empresaID=parseInt(n))}else if(!isNaN(s[1]))return o.empresaID=parseInt(s[1])}return o.empresaID},loadEmpresaConfig:()=>{if(o.empresa.id)return;const t=o.getEmpresaID();t?fetch(o.S3_URL+`empresas/e-${t}.json`).then(e=>e.json()).then(e=>{o.empresa=e}):console.warn("No se encontró la empresa-id:",t)}},l=typeof window<"u"?window.localStorage:{getItem:t=>"",setItem:(t,e)=>"",removeItem:t=>""},R=t=>{const e=l.getItem(o.appId+"UserToken"),s=parseInt(l.getItem(o.appId+"TokenExpTime")||"0"),n=Math.floor(Date.now()/1e3);if(e){if(!s||n>s)return t||(v.failure("La sesión ha expirado, vuelva a iniciar sesión."),o.clearAccesos?.()),""}else return console.error("No se encontró la data del usuario. ¿Está logeado?:",o.appId),"";return s-n<900?E(()=>{v.warning("La sesión expirará en 15 minutos")},20):s-n<300&&E(()=>{v.warning("La sesión expirará en 5 minutos")},20),e||""},B=()=>R(!0)?2:3;o.clearAccesos=()=>{O&&(l.removeItem(o.appId+"Accesos"),l.removeItem(o.appId+"UserInfo"),l.removeItem(o.appId+"UserToken"),l.removeItem(o.appId+"TokenExpTime"),o.navigate("/login"))};class x{constructor(){const e=[];for(let s=32;s<36;s++)e.push(s.toString(36));this.#e=e,this.#s=e.join(","),this.#a()}#e=[];#s="";#t=!1;#n="";#r=new Map;#o=null;#a(){const e=l?.getItem(o.appId+"UserInfo");e&&(this.#o=JSON.parse(e))}clearAccesos=o.clearAccesos;getUserInfo(){return this.#o}async parseAccesos(e,s){const n=await N(e.UserInfo,s),r=JSON.parse(n);let i=[...r.a||[]];i=i.concat((r.r||[]).map(I=>I*10+8));const u={id:r.d,user:r.u,email:e.UserEmail,names:e.UserNames};l.setItem(o.appId+"UserInfo",JSON.stringify(u)),l.setItem(o.appId+"UserToken",e.UserToken),l.setItem(o.appId+"TokenExpTime",String(e.TokenExpTime)),l.setItem(o.appId+"EmpresaID",String(e.EmpresaID)),this.#a();const c=this.#e;let a=c[c.length-1],p=0;for(let I of i.map(k=>k.toString(32)))p>3&&(p=0),a+=I,a+=c[p],p++;const g=T(a),D=`${g.substring(0,2)}${a}${g.substring(2,4)}`;l.setItem(o.appId+"Accesos",D)}checkAcceso(e,s){s=s||1;const n=this.#s;if(this.#n===""&&(this.#n=l.getItem(o.appId+"Accesos")||""),!this.#n)return!1;if(!this.#t){if(!this.#i())return console.warn("Los accesos han sido modificados."),!1;this.#t=!0,setTimeout(()=>{this.#t=!1},50)}const r=i=>{for(let u of i){const c=(e*10+u).toString(32);if(!this.#r.has(c)){const p=new RegExp(`[${n}]${c}[${n}]`).test(this.#n);this.#r.set(c,p)}const a=this.#r.get(c);if(a)return a}return!1};return r(!s||s===1?[1,7]:s===2?[2,7]:s===3?[3,7]:s===4?[4,7]:s===8?[8]:[7])}checkRol(e){return this.checkAcceso(e,8)}#i(){const e=this.#n,s=e.substring(2,e.length-2);return e.substring(0,2)+e.substring(e.length-2)===T(s)}}const T=t=>{let e=888888;for(let r=0;r<t.length;r++){const i=r%1e3,c=t[r].charCodeAt(0),a=Math.abs(e-c+i)%10;a>6?e+=(c+i)*a+a:a>3?e-=(c-i)*a-i:(e+=Math.abs((c-i)*(a+1))-a*(r%10),e>=1e6&&(e=Math.abs(e)%1e5))}const s=String(e%1e3);for(let r=0;r<s.length;r++)e+=Math.pow(parseInt(s[0]),6-r);let n=e.toString(32).split("").reverse().join("");if(n.length>4)n=n.substring(0,4);else if(n.length<4)for(let r=n.length;r<4;r++)n+=String(4-r);return n},F=new x;class z extends Map{#e=new Map;#s=w(0);#t=w(0);#n=b||-1;constructor(e){if(super(),e){for(var[s,n]of e)super.set(s,n);this.#t.v=super.size}}#r(e){return b===this.#n?w(e):A(e)}has(e){var s=this.#e,n=s.get(e);if(n===void 0){var r=super.get(e);if(r!==void 0)n=this.#r(0),s.set(e,n);else return h(this.#s),!1}return h(n),!0}forEach(e,s){this.#o(),super.forEach(e,s)}get(e){var s=this.#e,n=s.get(e);if(n===void 0){var r=super.get(e);if(r!==void 0)n=this.#r(0),s.set(e,n);else{h(this.#s);return}}return h(n),super.get(e)}set(e,s){var n=this.#e,r=n.get(e),i=super.get(e),u=super.set(e,s),c=this.#s;if(r===void 0)r=this.#r(0),n.set(e,r),f(this.#t,super.size),d(c);else if(i!==s){d(r);var a=c.reactions===null?null:new Set(c.reactions),p=a===null||!r.reactions?.every(g=>a.has(g));p&&d(c)}return u}delete(e){var s=this.#e,n=s.get(e),r=super.delete(e);return n!==void 0&&(s.delete(e),f(this.#t,super.size),f(n,-1),d(this.#s)),r}clear(){if(super.size!==0){super.clear();var e=this.#e;f(this.#t,0);for(var s of e.values())f(s,-1);d(this.#s),e.clear()}}#o(){h(this.#s);var e=this.#e;if(this.#t.v!==e.size){for(var s of super.keys())if(!e.has(s)){var n=this.#r(0);e.set(s,n)}}for([,n]of this.#e)h(n)}keys(){return h(this.#s),super.keys()}values(){return this.#o(),super.values()}entries(){return this.#o(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return h(this.#t),super.size}}const j=()=>{let t=1;return window.innerWidth<740?t=3:window.innerWidth<1140&&(t=2),t},W=M({module:{menus:[]},openSearchLayer:0,deviceType:j(),mobileMenuOpen:0,popoverShowID:0,showSideLayer:0,isLoading:1,pageTitle:"",pageOptions:[],toggleMobileMenu:()=>{},setSideLayer:t=>{W.showSideLayer=t},showMobileSearchLayer:null}),G=new WeakMap,y=M(new z),H=(t,e)=>{if(t===0)return o.fetchID++,o.fetchID;e===0?y.delete(t):y.set(t,e)},m=M([]),K=t=>{m.includes(t)||m.push(t)},V=t=>{const e=m.indexOf(t);e>-1&&m.splice(e,1)},Q=()=>{m.length=0},X=new Map;export{W as C,o as E,G as W,F as a,V as b,B as c,Q as d,K as e,y as f,j as g,q as h,X as i,R as j,H as k,J as m,m as o};
