import"./DsnmJJEf.js";import{o as de}from"./BHthWC4L.js";import{p as ve,a2 as G,at as J,g as K,a3 as v,k as t,f as g,s as u,d as b,t as x,b as m,c as fe,r as p,as as ue}from"./Du-3VwLa.js";import{s as Q}from"./DnqKjY9W.js";import{i as h}from"./QNJoOfXk.js";import{s as M,a as V,b as D}from"./DDksb93E.js";import{d as me,e as ge}from"./1RyHG_68.js";import{p as o}from"./DeYnh8U8.js";import{P as _e}from"./CIgzKi8q.js";import{N,f as be}from"./BkuoQr4R.js";import{E as T,i as j}from"./uY9SMk4J.js";var pe=g('<div class="w-full h-full relative flex flex-col items-center justify-center card_input_layer svelte-ilfl9z"><input type="file" accept="image/png, image/jpeg, image/webp" class="svelte-ilfl9z"/> <div style="font-size: 2.4rem"><i class="icon-upload"></i></div> <div class="h5">Subir Imagen</div></div>'),he=g('<source type="image/avif"/>'),ye=g('<source type="image/webp"/>'),xe=g('<picture class="contents"><!> <!> <img class="w-full h-full absolute card_image_img1 svelte-ilfl9z" alt="Upload preview"/></picture>'),we=g('<textarea class="w-full card_image_textarea svelte-ilfl9z" placeholder="Nombre..."></textarea>'),ze=g('<div class="absolute w-full card_image_upload_text svelte-ilfl9z"> </div>'),Ue=g('<button class="bnr-1 _5 card_image_btn svelte-ilfl9z" aria-label="Subir imagen"><i class="icon-ok"></i></button>'),Se=g('<div><!> <!> <div class="w-full absolute flex items-center justify-center card_image_layer_botton svelte-ilfl9z"><button aria-label="Eliminar imagen"><i class="icon-cancel"></i></button> <!></div></div>'),Ce=g('<div class="w-full h-full absolute flex flex-col items-center justify-center card_image_layer_loading svelte-ilfl9z"><div class="c-white h3 ff-bold">Loading...</div> <div class="flex relative items-center justify-center h-22 lh-10 w-[calc(100%-16px)] left-0 right-0 mt-8 _8 mr-8 ml-9 p-2 svelte-ilfl9z"><div class="absolute _9 left-2 h-18 svelte-ilfl9z"></div> <div class="absolute fs14 ff-bold text-white"> </div></div></div>'),Ie=g("<div><!> <!> <!> <!></div>");function Oe(W,i){ve(i,!0);let U=o(i,"src",3,""),E=o(i,"types",19,()=>[]),Y=o(i,"saveAPI",3,"images");o(i,"refreshIndexDBCache",3,"");let B=o(i,"onUploaded",3,void 0),L=o(i,"setDataToSend",3,void 0),Z=o(i,"clearOnUpload",3,!1),O=o(i,"description",3,""),$=o(i,"cardStyle",3,""),A=o(i,"onDelete",3,void 0),ee=o(i,"cardCss",3,""),k=o(i,"hideFormUseMessage",3,""),ae=o(i,"hideForm",3,!1),te=o(i,"hideUploadButton",3,!1),re=o(i,"id",3,void 0),e=G(J({src:U(),types:E(),description:O()})),d=G(J(U()?-1:0));T.imageCounter++;const P=re()||T.imageCounter;K(()=>{U(),v(e,{src:U(),base64:"",types:E(),description:O()},!0)});const F=r=>{if(t(e).base64)return t(e).base64;if(!t(e).src)return"";let a=t(e).src||"";return a.substring(0,8)!=="https://"&&a.substring(0,7)!=="http://"&&(i.folder&&(a=i.folder+"/"+a),i.size&&(a=`${a}-x${i.size}`),a=T.S3_URL+a),r&&(a=a+"."+r),a},ie=async r=>{const s=r.target.files;if(!s||s.length===0)return;const _=s[0];console.log("imagefile::",_);try{const c=await be(_,1.2);v(d,-1),v(e,{src:"",base64:c,types:[],description:t(e).description},!0),i.onChange?.(t(e))}catch(c){N.failure("Error procesando la imagen: "+String(c)),v(d,0)}},R=async()=>{let r={};if(!t(e).base64)return N.failure("No hay nada que enviar."),Promise.resolve(r);v(d,.001);const a={Content:t(e).base64,Description:t(e).description};L()&&L()(a);try{r=await _e({data:a,route:Y()||"images",onUploadProgress:s=>{s.total&&(v(d,Math.round(s.loaded*100/s.total),!0),console.log("progress:: ",t(d)))}})}catch(s){return N.failure("Error guardando la imagen: "+String(s)),r}return r.id=P,r.description=t(e).description,Z()?v(e,{src:"",base64:"",types:[],description:""},!0):v(e,{src:`${r.imageName}-x2`,base64:"",types:["webp","avif"],description:t(e).description},!0),v(d,-1),B()&&B()(r.imageName,r.description),r};K(()=>{t(e).base64?j.set(P,R):j.delete(P)}),de(()=>{j.delete(P)});var S=Ie(),q=b(S);{var se=r=>{var a=pe(),s=b(a);s.__change=ie,ue(4),p(a),m(r,a)};h(q,r=>{(t(e)?.src||"").length===0&&r(se)})}var H=u(q,2);{var le=r=>{var a=xe(),s=b(a);{var _=l=>{var y=he();x(I=>D(y,"srcset",I),[()=>F("avif")]),m(l,y)};h(s,l=>{t(e).types?.includes("avif")&&l(_)})}var c=u(s,2);{var C=l=>{var y=ye();x(I=>D(y,"srcset",I),[()=>F("webp")]),m(l,y)};h(c,l=>{t(e).types?.includes("webp")&&l(C)})}var w=u(c,2);p(a),x(l=>D(w,"src",l),[()=>F(t(e)?.types?.[0])]),m(r,a)};h(H,r=>{(t(e).src||t(e).base64||"").length>0&&r(le)})}var X=u(H,2);{var oe=r=>{var a=Se(),s=b(a);{var _=n=>{var f=we();D(f,"rows",3),ge("blur",f,z=>{z.stopPropagation(),t(e).description=z.currentTarget.value||"",i.onChange?.(t(e))}),m(n,f)};h(s,n=>{t(e).base64&&!k()&&!ae()&&n(_)})}var c=u(s,2);{var C=n=>{var f=ze(),z=b(f,!0);p(f),x(()=>Q(z,k())),m(n,f)};h(c,n=>{t(e).base64&&k()&&n(C)})}var w=u(c,2),l=b(w);l.__click=n=>{if(n.stopPropagation(),A()){A()(U());return}v(e,{src:"",base64:"",types:[],description:""},!0),i.onChange?.(t(e)),v(d,0)};var y=u(l,2);{var I=n=>{var f=Ue();f.__click=z=>{z.stopPropagation(),R()},m(n,f)};h(y,n=>{t(e).base64&&!te()&&n(I)})}p(w),p(a),x(()=>{M(a,1,`w-full h-full absolute card_image_layer${t(e).base64?" s1":""}`,"svelte-ilfl9z"),M(l,1,`bnr-1 _4 mr-12 ${t(e).base64?"":"card_image_layer_bn_close2"} card_image_btn`,"svelte-ilfl9z")}),m(r,a)};h(X,r=>{t(d)===-1&&r(oe)})}var ne=u(X,2);{var ce=r=>{var a=Ce(),s=u(b(a),2),_=b(s),c=u(_,2),C=b(c);p(c),p(s),p(a),x((w,l)=>{V(_,`width: calc(${w??""}% - 4px);`),Q(C,`${l??""} %`)},[()=>Math.round(t(d)),()=>Math.round(t(d))]),m(r,a)};h(ne,r=>{t(d)>0&&r(ce)})}p(S),x(()=>{M(S,1,`relative ${ee()??""} card_image_1 ${t(e)?.src?"":"card_input"}`,"svelte-ilfl9z"),V(S,$())}),m(W,S),fe()}me(["change","click"]);export{Oe as I};
