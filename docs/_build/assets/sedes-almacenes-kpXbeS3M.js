import{d as G,t as d,i as l}from"./web-B9EQUxsk.js";import{t as z,f as T,N as P,L as I}from"./main-wawJI9OC.js";import{a as V,e as E,c as s,S as q,f as K,b as U,F as Z}from"./solid-DoXAfIeo.js";import{C as ee}from"./Editables-BTYsjkzG.js";import{I as y}from"./Input-BqvI6aOu.js";import{s as N,o as te,a as re,M as R,S as ae}from"./Modals-C7oBgtQ4.js";import{Q as J}from"./QTable-XC_BfQM2.js";import{p as M,S as B,P as se}from"./app-B5TM_Vz_.js";import{u as le,a as ne,p as ie,b as ce}from"./sedes-almacenes-Hi_XM9WT.js";import{a as H,m as oe}from"./simple-statistics-CHr0eFhd.js";import"./http-C6Eur1sL.js";import"./store-DHPf-lLy.js";import"./main-B_drbOPO.js";var de=d('<div class="flex ai-center jc-between mb-06"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus>'),ue=d('<div class=w100><div class="flex ai-center jc-between mb-06"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus>'),Q=d('<div class="flex-wrap ai-start w100-10">'),Y=d('<button class="bnr2 b-blue b-card-1"><i class=icon-pencil>'),F=d('<div class="ff-bold h3">'),me=d("<i class=icon-folder-empty>"),W=d('<div class="mr-04 ml-04 h6 c-steel">X'),pe=d("<i class=icon-buffer>"),he=d("<i class=icon-cube>"),ge=d('<div class="w100 flex ai-center jc-between"><div class="flex ai-center"></div><button class="bnr2 b-blue b-card-1"><i class=icon-pencil>'),fe=d("<div class=box-error-ms>No hay espacios en al almacén. Agregue uno pulsando en (+)"),be=d('<div class="w100 h100 p-rel"><div class="flex jc-between w100 mb-08"><div></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button></div></div><div class="overflow-auto pad-sr6">'),ve=d('<div class="card-c12p w100 mb-12"><div class="w100 flex ai-center jc-between px-08 py-08"><div class="flex ai-center"><span class="ff-bold c-steel">Filas</span><span class="ff-bold c-steel">Niveles</span></div><button class="bnr4 b-red"><i class=icon-trash></i></button></div><table class=w100><thead><tr><th>-</th></tr></thead><tbody>'),$e=d("<th>"),_e=d("<tr><td class=t-c>"),ye=d('<td class="p-rel py-02 px-02">');function je(){const[O,h]=V(""),[u,C]=V({}),[o,$]=V({}),[g,L]=le(),[x]=ne(),m=.48;E(()=>{for(let e of x()?.distritos||[])e._nombre=`${e.Departamento?.Nombre||"-"} ► ${e.Provincia?.Nombre||""} ► ${e.Nombre}`});const _=async e=>{const t=u();if((t.Nombre?.length||0)<4||(t.Direccion?.length||0)<4){P.failure("El nombre y la dirección deben tener al menos 4 caracteres.");return}console.log("guardando sede::",t),I.standard("Creando /Actualizando Sede...");try{var n=await ie(t)}catch(c){P.failure(c),I.remove();return}let r=[...g().Sedes];if(t.ID){const c=g().Sedes.find(p=>p.ID===t.ID);c&&Object.assign(c,t),e&&(r=r.filter(p=>p.ID!==t.ID))}else t.ID=n.ID,r.unshift(t);L({...g(),sedes:r}),N([]),I.remove()},w=async e=>{const t=o();if((t.Nombre?.length||0)<4){P.failure("El nombre debe tener al menos 4 caracteres.");return}else if(!t.SedeID){P.failure("Debe seleccionar una sede.");return}console.log("guardando almacen::",t),I.standard("Creando /Actualizando Almacén...");try{var n=await ce(t)}catch(c){P.failure(c),I.remove();return}let r=[...g().Almacenes];if(t.ID){const c=g().Almacenes.find(p=>p.ID===t.ID);c&&Object.assign(c,t),e&&(r=r.filter(p=>p.ID!==t.ID))}else t.ID=n.ID,r.unshift(t);L({...g(),Almacenes:r}),N([]),I.remove()};return s(se,{title:"Sedes & Almacenes",views:[[1,"Sedes"],[2,"Almacenes"]],accesos:[5],get children(){return[s(q,{get when(){return M()===1},get children(){return[(()=>{var e=de(),t=e.firstChild,n=t.firstChild,r=n.nextSibling,c=t.nextSibling,p=c.firstChild;return r.$$keyup=b=>{b.stopPropagation(),z(()=>{h((b.target.value||"").toLowerCase().trim())},150)},p.$$click=b=>{b.stopPropagation(),C({ss:1}),N([1])},e})(),s(J,{get data(){return g().Sedes||[]},css:"w100",maxHeight:"calc(80vh - 13rem)",style:{height:"100%"},columns:[{header:"ID",headerStyle:{width:"3.4rem"},css:"t-c c-purple",getValue:e=>e.ID,cardColumn:[1,2]},{header:"Nombre",cardColumn:[1,1],getValue:e=>e.Nombre,cardCss:"h5 c-steel"},{header:"Dirección",cardColumn:[1,2],getValue:e=>e.Direccion,cardCss:"h5 c-steel"},{header:"Ciudad",cardColumn:[3,2],getValue:e=>{if(!e.Ciudad)return"";const t=e.Ciudad.split("|");return t[1]+" > "+t[0]}},{header:"Actualizado",headerStyle:{width:"9rem"},css:"nowrap",getValue:e=>T(e.upd,"Y-m-d h:n")},{header:"...",headerStyle:{width:"2.6rem"},css:"t-c",cardColumn:[1,2],render:(e,t)=>{const n=r=>{r.stopPropagation(),N([1]),C({...e})};return(()=>{var r=Y();return r.$$click=n,r})()}}]})]}}),s(q,{get when(){return M()===2},get children(){var e=ue(),t=e.firstChild,n=t.firstChild,r=n.firstChild,c=r.nextSibling,p=n.nextSibling,b=p.firstChild;return c.$$keyup=a=>{a.stopPropagation(),z(()=>{h((a.target.value||"").toLowerCase().trim())},150)},b.$$click=a=>{a.stopPropagation(),$({ss:1}),N([2])},l(e,s(J,{get data(){return g().Almacenes||[]},css:"w-page-t",get style(){return{width:te().length>0?`calc(var(--page-width) * ${1-m})`:void 0}},maxHeight:"calc(80vh - 13rem)",columns:[{header:"ID",headerStyle:{width:"3.4rem"},css:"t-c c-purple",getValue:a=>a.ID},{header:"Sede",cardColumn:[3,2],getValue:a=>g().SedesMap.get(a.SedeID)?.Nombre||`Sede-${a.SedeID}`,cardCss:"h5 c-steel"},{header:"Nombre",cardColumn:[3,2],getValue:a=>a.Nombre,cardCss:"h5 c-steel"},{header:"Layout",cardColumn:[3,2],render:(a,A)=>{const D=f=>{f.stopPropagation(),re([1]),$(JSON.parse(JSON.stringify(a)))};return(()=>{var f=ge(),k=f.firstChild,S=k.nextSibling;return l(k,s(q,{get when(){return a.Layout?.length>0},get children(){return[(()=>{var i=F();return l(i,()=>a.Layout.length),i})(),me(),W(),(()=>{var i=F();return l(i,()=>H(a.Layout.map(v=>v.ColCant))),i})(),pe(),W(),(()=>{var i=F();return l(i,()=>H(a.Layout.map(v=>v.RowCant))),i})(),he()]}})),S.$$click=D,f})()}},{header:"Estado",cardColumn:[3,2],getValue:a=>a.ss,cardCss:"h5 c-steel"},{header:"Actualizado",headerStyle:{width:"9rem"},css:"nowrap",getValue:a=>T(a.upd,"Y-m-d h:n")},{header:"...",headerStyle:{width:"2.6rem"},css:"t-c",cardColumn:[1,2],render:(a,A)=>{const D=f=>{f.stopPropagation(),N([2]),$(JSON.parse(JSON.stringify(a)))};return(()=>{var f=Y();return f.$$click=D,f})()}}]}),null),e}}),s(R,{id:1,css:"w56-78 in-s2",get title(){return(u()?.ID>0?"Actualizar":"Crear")+" Sede"},onSave:()=>{console.log("sede a guardar::",u()),_()},onDelete:()=>{_(!0)},get children(){var e=Q();return l(e,s(y,{get saveOn(){return u()},save:"Nombre",css:"w-10x mb-10",label:"Nombre",required:!0,get disabled(){return u()?.ID>0}}),null),l(e,s(y,{get saveOn(){return u()},save:"Descripcion",css:"w-14x mb-10",label:"Descripción"}),null),l(e,s(y,{get saveOn(){return u()},save:"Telefono",css:"w-10x mb-10",label:"Teléfono",get disabled(){return u()?.ID>0}}),null),l(e,s(y,{get saveOn(){return u()},save:"Direccion",css:"w-14x mb-10",label:"Dirección",required:!0}),null),l(e,s(B,{get options(){return x().distritos},required:!0,label:"Departamento | Provincia | Distrito",css:"w-24x mb-10",keys:"ID._nombre",get saveOn(){return u()},save:"CiudadID"}),null),e}}),s(R,{id:2,css:"w56-78 in-s2",get title(){return(o()?.ID>0?"Actualizar":"Crear")+" Almacén"},onSave:()=>{console.log("almacen a guardar::",o()),w()},onDelete:()=>{w(!0)},get children(){var e=Q();return l(e,s(B,{get options(){return g().Sedes},required:!0,label:"Sede",css:"w-12x mb-10",keys:"ID.Nombre",get saveOn(){return o()},save:"SedeID"}),null),l(e,s(y,{get saveOn(){return o()},save:"Nombre",css:"w-12x mb-10",label:"Nombre",required:!0}),null),l(e,s(y,{get saveOn(){return o()},save:"Descripcion",css:"w-12x mb-10",label:"Descripción"}),null),e}}),s(ae,{id:1,style:{width:`calc(var(--page-width) * ${m})`},get title(){return"Layout "+(o()?.Nombre||"-")},onClose:()=>{},onSave:()=>{for(let e of o().Layout||[]){e.Bloques=[];for(let t in e)if(t.substring(0,3)==="xy_"){const[n,r,c]=t.split("_");e.Bloques.push({nm:e[t],rw:parseInt(r),co:parseInt(c)})}}console.log("almacen a guardar::",o()),w()},get children(){return s(Ce,{get almacen(){return o()}})}})]}})}const Ce=O=>{const[h,u]=V([]);return E(K(()=>[O.almacen],()=>{const C=O.almacen.Layout||[];for(let o of C)for(let $ of o.Bloques||[])o[`xy_${$.rw}_${$.co}`]=$.nm;u(C)})),E(()=>{O.almacen.Layout=h()}),(()=>{var C=be(),o=C.firstChild,$=o.firstChild,g=$.nextSibling,L=g.firstChild,x=o.nextSibling;return L.$$click=m=>{m.stopPropagation();const _=h().length>0?oe(h().map(w=>w.ID||0)):0;h().push({RowCant:2,ColCant:3,Name:"",ID:_+1}),u([...h()])},x.style.setProperty("max-height","calc(100% - 6.4rem)"),l(x,s(q,{get when(){return h().length===0},get children(){return fe()}}),null),l(x,s(Z,{get each(){return h()},children:m=>{const _=[],w=[];for(let t=1;t<=(m.ColCant||1);t++)_.push(`${t}`);for(let t=1;t<=(m.RowCant||1);t++)w.push(`${t}`);const e=()=>{const t=[];for(let n of h())n===m&&(n={...n}),t.push(n);u(t)};return(()=>{var t=ve(),n=t.firstChild,r=n.firstChild,c=r.firstChild,p=c.nextSibling,b=r.nextSibling,a=n.nextSibling,A=a.firstChild,D=A.firstChild,f=D.firstChild,k=A.nextSibling;return l(r,s(y,{label:"",save:"Name",saveOn:m,css:"w-09x mr-12",inputCss:"s3",required:!0}),c),l(r,s(y,{label:"",save:"RowCant",saveOn:m,css:"w-025x",inputCss:"s3",onChange:()=>{e()},type:"number"}),p),l(r,s(y,{label:"",save:"ColCant",saveOn:m,css:"s3 w-025x",inputCss:"s3",onChange:()=>{e()},type:"number"}),null),b.$$click=S=>{S.stopPropagation();const i=h().filter(v=>v!==m);u(i)},b.style.setProperty("margin-top","-12px"),b.style.setProperty("margin-right","-4px"),f.style.setProperty("width","3rem"),l(D,()=>_.map(S=>(()=>{var i=$e();return l(i,S),U(v=>(v=`calc(92% / ${_.length})`)!=null?i.style.setProperty("width",v):i.style.removeProperty("width")),i})()),null),l(k,()=>w.map(S=>(()=>{var i=_e(),v=i.firstChild;return l(v,S),l(i,()=>_.map(X=>(()=>{var j=ye();return j.style.setProperty("height","2.6rem"),l(j,s(ee,{save:`xy_${S}_${X}`,saveOn:m,class:"s2 t-c flex ai-center",contentClass:"flex ai-center jc-center"})),j})()),null),i})())),t})()}}),null),C})()};G(["keyup","click"]);export{je as default};
