import"../chunks/DsnmJJEf.js";import{p as Se,f as S,c as l,s as r,r as o,i as e,u as b,b as y,d as Ie,t as ge,e as me,g as _e,a as pe,h as g,aA as he,x as Pe,az as Ve}from"../chunks/Bf0lWsRu.js";import{s as X}from"../chunks/WwA8pLij.js";import{i as J}from"../chunks/D7jGWfSg.js";import{d as Le}from"../chunks/Cu2BEfFs.js";import{I as N}from"../chunks/C61KEcBC.js";import{M as ye}from"../chunks/03-DSbml.js";import{L as Me}from"../chunks/D6G-nuyK.js";import{P as qe}from"../chunks/Cjl-14FK.js";import{S as xe}from"../chunks/CgTtmJH3.js";import{V as Ce}from"../chunks/9nVZToYO.js";import{t as we,f as De,N as H,L as R}from"../chunks/B0A7VF9y.js";import{C as A}from"../chunks/CUNP7WoD.js";import{e as Z,i as fe}from"../chunks/CA0Nq6W4.js";import{b as Ee}from"../chunks/BWVkWQLM.js";import{p as ze}from"../chunks/DEnCy23-.js";import{A as je,P as Re,p as Fe,a as Te}from"../chunks/BNeOhMyC.js";var Be=S('<div class="bg-red-100 text-red-700 p-8 rounded">No hay espacios en al almacén. Agregue uno pulsando en (+)</div>'),He=S("<th> </th>"),Je=S('<td class="relative py-2 px-2" style="height: 2.6rem"><!></td>'),Xe=S('<tr><td class="text-center"> </td><!></tr>'),Ye=S('<div class="_1 bg-white rounded-lg shadow-sm p-8 mb-12 AlmacenLayoutEditor_1eixlxt"><div class="w-full flex items-center justify-between px-8 py-8"><div class="flex items-center"><!> <span class="ff-bold text-slate-600">Filas</span> <!> <span class="ff-bold text-slate-600">Niveles</span> <!></div> <button class="bnr4 b-red" aria-label="Eliminar Layout" style="margin-top: -12px; margin-right: -4px"><i class="icon-trash"></i></button></div> <table class="w-full"><thead><tr><th style="width: 3rem">-</th><!></tr></thead><tbody></tbody></table></div>'),Ge=S('<div class="w-full h-full relative"><div class="flex justify-between w-full mb-8 px-12 pt-12"><div></div> <div class="flex items-center"><button class="bx-green" aria-label="Agregar Layout"><i class="icon-plus"></i></button></div></div> <div class="overflow-auto px-4" style="max-height: calc(100% - 60px)"><!> <!></div></div>');function Ke(ee,Y){Se(Y,!0);let d=ze(Y,"almacen",15);const c=b(()=>d().Layout||[]),te=()=>{const t=e(c).length>0?Math.max(...e(c).map(a=>a.ID||0)):0;e(c).push({RowCant:2,ColCant:3,Name:"",ID:t+1,Bloques:[]}),d(d().Layout=[...e(c)],!0)},k=t=>{d(d().Layout=e(c).filter((a,i)=>i!==t),!0)},u=()=>{d(d().Layout=[...e(c)],!0)};var v=Ge(),q=l(v),E=r(l(q),2),ae=l(E);ae.__click=te,o(E),o(q);var G=r(q,2),K=l(G);{var se=t=>{var a=Be();y(t,a)};J(K,t=>{e(c).length===0&&t(se)})}var re=r(K,2);Z(re,19,()=>e(c),(t,a)=>e(c)[a].ID,(t,a,i)=>{const _=b(()=>e(c)[e(i)]),m=b(()=>Array.from({length:e(_).ColCant||1},(s,I)=>String(I+1))),p=b(()=>Array.from({length:e(_).RowCant||1},(s,I)=>String(I+1)));var z=Ye(),P=l(z),V=l(P),Q=l(V);N(Q,{save:"Name",css:"shadow-small bg-solid no-border w-220 mr-12",inputCss:"text-sm",required:!0,get saveOn(){return e(c)[e(i)]},set saveOn(s){e(c)[e(i)]=s}});var f=r(Q,4);N(f,{save:"RowCant",css:"shadow-small bg-solid no-border w-60 mx-4",inputCss:"text-sm",type:"number",onChange:u,get saveOn(){return e(c)[e(i)]},set saveOn(s){e(c)[e(i)]=s}});var x=r(f,4);N(x,{save:"ColCant",css:"shadow-small bg-solid no-border w-60 mx-4",inputCss:"text-sm",type:"number",onChange:u,get saveOn(){return e(c)[e(i)]},set saveOn(s){e(c)[e(i)]=s}}),o(V);var C=r(V,2);C.__click=()=>k(e(i)),o(P);var w=r(P,2),h=l(w),D=l(h),L=r(l(D));Z(L,17,()=>e(m),fe,(s,I)=>{var n=He(),$=l(n,!0);o(n),ge(()=>{Ee(n,`width: calc(92% / ${e(m).length??""})`),X($,e(I))}),y(s,n)}),o(D),o(h);var O=r(h);Z(O,21,()=>e(p),fe,(s,I)=>{var n=Xe(),$=l(n),U=l($,!0);o($);var oe=r($);Z(oe,17,()=>e(m),fe,(le,F)=>{var M=Je(),W=l(M);{let ne=b(()=>`xy_${e(I)}_${e(F)}`);N(W,{label:"",get save(){return e(ne)},css:"shadow-small bg-solid no-border w-full",inputCss:"text-sm text-center",get saveOn(){return e(c)[e(i)]},set saveOn(ie){e(c)[e(i)]=ie}})}o(M),y(le,M)}),o(n),ge(()=>X(U,e(I))),y(s,n)}),o(O),o(w),o(z),y(t,z)}),o(G),o(v),y(ee,v),Ie()}Le(["click"]);var Qe=S('<div class="flex items-center justify-between mb-6"><div class="i-search mr-16 w-256"><div><i class="icon-search"></i></div> <input class="w-full" autocomplete="off" type="text"/></div> <div class="flex items-center"><button class="bx-green" aria-label="Agregar Sede"><i class="icon-plus"></i></button></div></div> <!>',1),Ue=S('<div class="flex items-center"><div class="ff-bold h3"> </div> <i class="icon-folder-empty"></i> <div class="mr-4 ml-4 h6 text-slate-500">X</div> <div class="ff-bold h3"> </div> <i class="icon-buffer"></i> <div class="mr-4 ml-4 h6 text-slate-500">X</div> <div class="ff-bold h3"> </div> <i class="icon-cube"></i></div>'),We=S("<div></div>"),Ze=S('<div class="w-full flex items-center justify-between"><!> <button class="bnr2 b-blue b-card-1" aria-label="Editar Layout"><i class="icon-pencil"></i></button></div>'),et=S('<div class="w-full"><div class="flex items-center justify-between mb-6"><div class="i-search mr-16 w-256"><div><i class="icon-search"></i></div> <input class="w-full" autocomplete="off" type="text"/></div> <div class="flex items-center"><button class="bx-green" aria-label="Agregar Almacén"><i class="icon-plus"></i></button></div></div> <!></div>'),tt=S('<div class="grid grid-cols-24 gap-10"><!> <!> <!> <!> <!></div>'),at=S('<div class="grid grid-cols-24 gap-10"><!> <!> <!></div>'),st=S("<!> <!> <!> <!> <!>",1);function xt(ee,Y){Se(Y,!0);const d=new je,c=new Re,te=[{id:1,name:"Sedes"},{id:2,name:"Almacenes"}];let k=me(""),u=me(_e({})),v=me(_e({}));const q=async t=>{const a=e(u);if((a.Nombre?.length||0)<4||(a.Direccion?.length||0)<4){H.failure("El nombre y la dirección deben tener al menos 4 caracteres.");return}console.log("guardando sede::",a),R.standard("Creando /Actualizando Sede...");try{var i=await Fe(a)}catch(m){H.failure(m),R.remove();return}let _=[...d.Sedes];if(a.ID){const m=d.Sedes.find(p=>p.ID===a.ID);m&&Object.assign(m,a),t&&(_=_.filter(p=>p.ID!==a.ID))}else a.ID=i.ID,_.unshift(a);d.Sedes=_,A.closeModal(1),R.remove()},E=async t=>{const a=e(v);if((a.Nombre?.length||0)<4){H.failure("El nombre debe tener al menos 4 caracteres.");return}else if(!a.SedeID){H.failure("Debe seleccionar una sede.");return}for(let m of a.Layout||[]){m.Bloques=[];for(let p in m)if(p.substring(0,3)==="xy_"){const[z,P,V]=p.split("_");m.Bloques.push({nm:m[p],rw:parseInt(P),co:parseInt(V)})}}console.log("guardando almacen::",a),R.standard("Creando /Actualizando Almacén...");try{var i=await Te(a)}catch(m){H.failure(m),R.remove();return}let _=[...d.Almacenes];if(a.ID){const m=d.Almacenes.find(p=>p.ID===a.ID);m&&Object.assign(m,a),t&&(_=_.filter(p=>p.ID!==a.ID))}else a.ID=i.ID,_.unshift(a);d.Almacenes=_,A.closeModal(2),A.hideSideLayer(),R.remove()},ae=[{header:"ID",headerCss:"w-32",cellCss:"text-center text-purple-600 px-6",getValue:t=>t.ID},{header:"Nombre",cellCss:"px-6",getValue:t=>t.Nombre},{header:"Dirección",cellCss:"px-6",getValue:t=>t.Direccion},{header:"Ciudad",getValue:t=>{if(!t.Ciudad)return"";const a=t.Ciudad.split("|");return a[1]+" > "+a[0]}},{header:"Actualizado",headerCss:"w-144",cellCss:"whitespace-nowrap px-6",getValue:t=>De(t.upd,"Y-m-d h:n")},{header:"...",headerCss:"w-32",cellCss:"text-center px-6",buttonEditHandler:t=>{g(u,{...t},!0),A.openModal(1)}}],G=[{header:"ID",headerCss:"w-32",cellCss:"text-center text-purple-600 px-6",getValue:t=>t.ID},{header:"Sede",cellCss:"px-6",getValue:t=>d.SedesMap.get(t.SedeID)?.Nombre||`Sede-${t.SedeID}`},{header:"Nombre",cellCss:"px-6",getValue:t=>t.Nombre},{header:"Layout",id:"layout",cellCss:"px-6",getValue:t=>""},{header:"Estado",getValue:t=>t.ss},{header:"Actualizado",headerCss:"w-144",cellCss:"whitespace-nowrap px-6",getValue:t=>De(t.upd,"Y-m-d h:n")},{header:"...",headerCss:"w-32",cellCss:"text-center px-6",buttonEditHandler:t=>{g(v,JSON.parse(JSON.stringify(t)),!0),A.openModal(2)}}],K=b(()=>{if(!e(k))return d.Sedes;const t=e(k).toLowerCase();return d.Sedes.filter(a=>a.Nombre?.toLowerCase().includes(t)||a.Direccion?.toLowerCase().includes(t)||a.Ciudad?.toLowerCase().includes(t))}),se=b(()=>{if(!e(k))return d.Almacenes;const t=e(k).toLowerCase();return d.Almacenes.filter(a=>{const i=d.SedesMap.get(a.SedeID);return a.Nombre?.toLowerCase().includes(t)||i?.Nombre?.toLowerCase().includes(t)})}),re=t=>{g(v,JSON.parse(JSON.stringify(t)),!0);for(let a of e(v).Layout||[])for(let i of a.Bloques||[])a[`xy_${i.rw}_${i.co}`]=i.nm;console.log("ejecutando open side"),A.openSideLayer(1)};qe(ee,{title:"Sedes & Almacenes",get options(){return te},children:(t,a)=>{var i=st(),_=pe(i);{var m=f=>{var x=Qe(),C=pe(x),w=l(C),h=r(l(w),2);h.__keyup=s=>{s.stopPropagation(),we(()=>{g(k,(s.target.value||"").toLowerCase().trim(),!0)},150)},o(w);var D=r(w,2),L=l(D);L.__click=s=>{s.stopPropagation(),g(u,{ss:1},!0),A.openModal(1)},o(D),o(C);var O=r(C,2);Ce(O,{css:"w-full",maxHeight:"calc(80vh - 13rem)",get columns(){return ae},get data(){return e(K)}}),y(f,x)};J(_,f=>{A.pageOptionSelected===1&&f(m)})}var p=r(_,2);{var z=f=>{var x=et(),C=l(x),w=l(C),h=r(l(w),2);h.__keyup=s=>{s.stopPropagation(),we(()=>{g(k,(s.target.value||"").toLowerCase().trim(),!0)},150)},o(w);var D=r(w,2),L=l(D);L.__click=s=>{s.stopPropagation(),g(v,{ID:0,SedeID:0,Nombre:"",Descripcion:"",ss:1,upd:0,Layout:[]},!0),A.openModal(2)},o(D),o(C);var O=r(C,2);Ce(O,{css:"w-full",maxHeight:"calc(80vh - 13rem)",get columns(){return G},get data(){return e(se)},cellRenderer:(I,n=he,$=he)=>{var U=Pe(),oe=pe(U);{var le=F=>{var M=Ze(),W=l(M);{var ne=j=>{const de=b(()=>n().Layout.reduce((T,B)=>T+(B.ColCant||0),0)/n().Layout.length),$e=b(()=>n().Layout.reduce((T,B)=>T+(B.RowCant||0),0)/n().Layout.length);var ce=Ue(),ue=l(ce),Ae=l(ue,!0);o(ue);var ve=r(ue,6),Ne=l(ve,!0);o(ve);var be=r(ve,6),ke=l(be,!0);o(be),Ve(2),o(ce),ge((T,B)=>{X(Ae,n().Layout.length),X(Ne,T),X(ke,B)},[()=>e(de).toFixed(0),()=>e($e).toFixed(0)]),y(j,ce)},ie=j=>{var de=We();y(j,de)};J(W,j=>{n().Layout&&n().Layout.length>0?j(ne):j(ie,!1)})}var Oe=r(W,2);Oe.__click=()=>re(n()),o(M),y(F,M)};J(oe,F=>{$().id==="layout"&&F(le)})}y(I,U)},$$slots:{cellRenderer:!0}}),o(x),y(f,x)};J(p,f=>{A.pageOptionSelected===2&&f(z)})}var P=r(p,2);{let f=b(()=>(e(u)?.ID>0?"Actualizar":"Crear")+" Sede"),x=b(()=>e(u)?.ID>0?()=>{q(!0)}:void 0);ye(P,{id:1,get title(){return e(f)},size:7,bodyCss:"px-16 py-14",onSave:()=>{q()},get onDelete(){return e(x)},children:(C,w)=>{var h=tt(),D=l(h);{let n=b(()=>e(u)?.ID>0);N(D,{save:"Nombre",css:"col-span-24 md:col-span-10",label:"Nombre",required:!0,get disabled(){return e(n)},get saveOn(){return e(u)},set saveOn($){g(u,$,!0)}})}var L=r(D,2);N(L,{save:"Descripcion",css:"col-span-24 md:col-span-14",label:"Descripción",get saveOn(){return e(u)},set saveOn(n){g(u,n,!0)}});var O=r(L,2);{let n=b(()=>e(u)?.ID>0);N(O,{save:"Telefono",css:"col-span-24 md:col-span-10",label:"Teléfono",get disabled(){return e(n)},get saveOn(){return e(u)},set saveOn($){g(u,$,!0)}})}var s=r(O,2);N(s,{save:"Direccion",css:"col-span-24 md:col-span-14",label:"Dirección",required:!0,get saveOn(){return e(u)},set saveOn(n){g(u,n,!0)}});var I=r(s,2);xe(I,{save:"CiudadID",css:"col-span-24",label:"Departamento | Provincia | Distrito",keyId:"ID",keyName:"_nombre",get options(){return c.distritos},required:!0,get saveOn(){return e(u)},set saveOn(n){g(u,n,!0)}}),o(h),y(C,h)},$$slots:{default:!0}})}var V=r(P,2);{let f=b(()=>(e(v)?.ID>0?"Actualizar":"Crear")+" Almacén"),x=b(()=>e(v)?.ID>0?()=>{E(!0)}:void 0);ye(V,{id:2,get title(){return e(f)},size:7,bodyCss:"px-16 py-14",onSave:()=>{E()},get onDelete(){return e(x)},children:(C,w)=>{var h=at(),D=l(h);xe(D,{save:"SedeID",css:"col-span-24 md:col-span-12",label:"Sede",keyId:"ID",keyName:"Nombre",get options(){return d.Sedes},required:!0,get saveOn(){return e(v)},set saveOn(s){g(v,s,!0)}});var L=r(D,2);N(L,{save:"Nombre",css:"col-span-24 md:col-span-12",label:"Nombre",required:!0,get saveOn(){return e(v)},set saveOn(s){g(v,s,!0)}});var O=r(L,2);N(O,{save:"Descripcion",css:"col-span-24",label:"Descripción",get saveOn(){return e(v)},set saveOn(s){g(v,s,!0)}}),o(h),y(C,h)},$$slots:{default:!0}})}var Q=r(V,2);{let f=b(()=>"Layout "+(e(v)?.Nombre||"-"));Me(Q,{id:1,type:"side",get title(){return e(f)},contentCss:"p-0",css:"px-8 py-8 md:px-14 md:py-10",titleCss:"h2 ff-bold",onClose:()=>{},onSave:()=>{E()},children:(x,C)=>{Ke(x,{get almacen(){return e(v)},set almacen(w){g(v,w,!0)}})},$$slots:{default:!0}})}y(t,i)},$$slots:{default:!0}}),Ie()}Le(["keyup","click"]);export{xt as component};
