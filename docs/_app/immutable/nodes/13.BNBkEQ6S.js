import"../chunks/DsnmJJEf.js";import{p as xn,l as kn,i as v,e as Oe,h as G,f as Un,s as je,c as he,r as fe,aE as Bn,t as Nn,b as Fn,d as Dn}from"../chunks/Bf0lWsRu.js";import{s as St}from"../chunks/WwA8pLij.js";import{d as Rn}from"../chunks/Cu2BEfFs.js";import{s as Mn}from"../chunks/C7iUW-It.js";import{b as Vn}from"../chunks/OShJgGfR.js";var ve=typeof self<"u"?self:{};function xt(e,t){e:{for(var r=["CLOSURE_FLAGS"],n=ve,i=0;i<r.length;i++)if((n=n[r[i]])==null){r=null;break e}r=n}return(e=r&&r[e])!=null?e:t}let Cn;const Gn=typeof TextEncoder<"u";function Fr(e){if(Gn)e=(Cn||=new TextEncoder).encode(e);else{let r=0;const n=new Uint8Array(3*e.length);for(let i=0;i<e.length;i++){var t=e.charCodeAt(i);if(t<128)n[r++]=t;else{if(t<2048)n[r++]=t>>6|192;else{if(t>=55296&&t<=57343){if(t<=56319&&i<e.length){const o=e.charCodeAt(++i);if(o>=56320&&o<=57343){t=1024*(t-55296)+o-56320+65536,n[r++]=t>>18|240,n[r++]=t>>12&63|128,n[r++]=t>>6&63|128,n[r++]=63&t|128;continue}i--}t=65533}n[r++]=t>>12|224,n[r++]=t>>6&63|128}n[r++]=63&t|128}}e=r===n.length?n:n.subarray(0,r)}return e}var kt,zn=xt(610401301,!1),Xt=xt(748402147,xt(1,!0));function Qt(){var e=ve.navigator;return e&&(e=e.userAgent)?e:""}const Zt=ve.navigator;kt=Zt&&Zt.userAgentData||null;var Dr={},Be=null;function Wn(e){const t=e.length;let r=3*t/4;r%3?r=Math.floor(r):"=.".indexOf(e[t-1])!=-1&&(r="=.".indexOf(e[t-2])!=-1?r-2:r-1);const n=new Uint8Array(r);let i=0;return(function(o,s){function a(u){for(;l<o.length;){const c=o.charAt(l++),p=Be[c];if(p!=null)return p;if(!/^[\s\xa0]*$/.test(c))throw Error("Unknown base64 encoding at char: "+c)}return u}Rr();let l=0;for(;;){const u=a(-1),c=a(0),p=a(64),f=a(64);if(f===64&&u===-1)break;s(u<<2|c>>4),p!=64&&(s(c<<4&240|p>>2),f!=64&&s(p<<6&192|f))}})(e,(function(o){n[i++]=o})),i!==r?n.subarray(0,i):n}function Rr(){if(!Be){Be={};var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"];for(let r=0;r<5;r++){const n=e.concat(t[r].split(""));Dr[r]=n;for(let i=0;i<n.length;i++){const o=n[i];Be[o]===void 0&&(Be[o]=i)}}}}var Hn=typeof Uint8Array<"u",Mr=!(!(zn&&kt&&kt.brands.length>0)&&(Qt().indexOf("Trident")!=-1||Qt().indexOf("MSIE")!=-1))&&typeof btoa=="function";const er=/[-_.]/g,$n={"-":"+",_:"/",".":"="};function qn(e){return $n[e]||""}function tr(e){if(!Mr)return Wn(e);e=er.test(e)?e.replace(er,qn):e,e=atob(e);const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function Ut(e){return Hn&&e!=null&&e instanceof Uint8Array}var Ge={};function Et(){return Kn||=new Y(null,Ge)}var Y=class{constructor(e,t){if(Vr(t),this.i=e,e!=null&&e.length===0)throw Error("ByteString should be constructed with non-empty values")}};let Kn,Yn;function Vr(e){if(e!==Ge)throw Error("illegal external caller")}function Cr(e,t){e.__closure__error__context__984382||(e.__closure__error__context__984382={}),e.__closure__error__context__984382.severity=t}function ze(e){return Cr(e=Error(e),"warning"),e}function Ze(e,t){if(e!=null){var r=Yn??={},n=r[e]||0;n>=t||(r[e]=n+1,Cr(e=Error(),"incident"),(function(i){ve.setTimeout((()=>{throw i}),0)})(e))}}var st=typeof Symbol=="function"&&typeof Symbol()=="symbol";function $e(e,t,r=!1){return typeof Symbol=="function"&&typeof Symbol()=="symbol"?r&&Symbol.for&&e?Symbol.for(e):e!=null?Symbol(e):Symbol():t}var Jn=$e("jas",void 0,!0),xe=$e(void 0,"1oa"),Bt=$e(void 0,"0ubsb"),Xn=$e(void 0,"0actk"),at=$e("m_m","oa",!0);const Gr={ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},zr=Object.defineProperties,m=st?Jn:"ga";var be;const rr=[];function Wr(e,t){st||m in e||zr(e,Gr),e[m]|=t}function x(e,t){st||m in e||zr(e,Gr),e[m]=t}function Gt(){return typeof BigInt=="function"}x(rr,7),be=Object.freeze(rr);var lt={};function V(e,t){return t===void 0?e.i!==we&&!!(2&(0|e.m[m])):!!(2&t)&&e.i!==we}const we={};var Qn=Object.freeze({});function ut(e){return e.na=!0,e}var Zn=ut((e=>typeof e=="number")),Hr=ut((e=>typeof e=="string")),ei=ut((e=>typeof e=="boolean")),ct=typeof ve.BigInt=="function"&&typeof ve.BigInt(0)=="bigint",ti=ut((e=>ct?e>=ni&&e<=oi:e[0]==="-"?nr(e,ri):nr(e,ii)));const ri=Number.MIN_SAFE_INTEGER.toString(),ni=ct?BigInt(Number.MIN_SAFE_INTEGER):void 0,ii=Number.MAX_SAFE_INTEGER.toString(),oi=ct?BigInt(Number.MAX_SAFE_INTEGER):void 0;function nr(e,t){if(e.length>t.length)return!1;if(e.length<t.length||e===t)return!0;for(let r=0;r<e.length;r++){const n=e[r],i=t[r];if(n>i)return!1;if(n<i)return!0}}let si,y=0,b=0;function ir(e){const t=e>>>0;y=t,b=(e-t)/4294967296>>>0}function Se(e){if(e<0){ir(-e);const[t,r]=zt(y,b);y=t>>>0,b=r>>>0}else ir(e)}function $r(e,t){const r=4294967296*t+(e>>>0);return Number.isSafeInteger(r)?r:We(e,t)}function We(e,t){if(e>>>=0,(t>>>=0)<=2097151)var r=""+(4294967296*t+e);else Gt()?r=""+(BigInt(t)<<BigInt(32)|BigInt(e)):(e=(16777215&e)+6777216*(r=16777215&(e>>>24|t<<8))+6710656*(t=t>>16&65535),r+=8147497*t,t*=2,e>=1e7&&(r+=e/1e7>>>0,e%=1e7),r>=1e7&&(t+=r/1e7>>>0,r%=1e7),r=t+or(r)+or(e));return r}function or(e){return e=String(e),"0000000".slice(e.length)+e}function ht(e){if(e.length<16)Se(Number(e));else if(Gt())e=BigInt(e),y=Number(e&BigInt(4294967295))>>>0,b=Number(e>>BigInt(32)&BigInt(4294967295));else{const t=+(e[0]==="-");b=y=0;const r=e.length;for(let n=t,i=(r-t)%6+t;i<=r;n=i,i+=6){const o=Number(e.slice(n,i));b*=1e6,y=1e6*y+o,y>=4294967296&&(b+=Math.trunc(y/4294967296),b>>>=0,y>>>=0)}if(t){const[n,i]=zt(y,b);y=n,b=i}}}function zt(e,t){return t=~t,e?e=1+~e:t+=1,[e,t]}function Fe(e){return Array.prototype.slice.call(e)}const ai=typeof BigInt=="function"?BigInt.asIntN:void 0,li=typeof BigInt=="function"?BigInt.asUintN:void 0,De=Number.isSafeInteger,Te=Number.isFinite,et=Math.trunc;function At(e){if(e!=null&&typeof e!="number")throw Error(`Value of float/double field must be a number, found ${typeof e}: ${e}`);return e}function qr(e){return e==null||typeof e=="number"?e:e==="NaN"||e==="Infinity"||e==="-Infinity"?Number(e):void 0}function le(e){if(e!=null&&typeof e!="boolean"){var t=typeof e;throw Error(`Expected boolean but got ${t!="object"?t:e?Array.isArray(e)?"array":t:"null"}: ${e}`)}return e}function ne(e){return e==null||typeof e=="boolean"?e:typeof e=="number"?!!e:void 0}const ui=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function Kr(e){switch(typeof e){case"bigint":return!0;case"number":return Te(e);case"string":return ui.test(e);default:return!1}}function Yr(e){if(typeof e!="number"||!Te(e))throw ze("int32");return 0|e}function Nt(e){return e==null?e:Yr(e)}function Pe(e){if(e==null)return e;if(typeof e=="string"&&e)e=+e;else if(typeof e!="number")return;return Te(e)?0|e:void 0}function tt(e){if(e==null)return e;if(typeof e=="string"&&e)e=+e;else if(typeof e!="number")return;return Te(e)?e>>>0:void 0}function sr(e){if(e[0]==="-")return!1;const t=e.length;return t<20||t===20&&Number(e.substring(0,6))<184467}function ci(e){if(e==null)return e;var t=typeof e;if(t==="bigint")return String(li(64,e));if(Kr(e)){if(t==="string")return t=et(Number(e)),De(t)&&t>=0?e=String(t):((t=e.indexOf("."))!==-1&&(e=e.substring(0,t)),sr(e)||(ht(e),e=We(y,b))),e;if(t==="number")return(e=et(e))>=0&&De(e)?e:(function(r){if(r<0){Se(r);var n=We(y,b);return r=Number(n),De(r)?r:n}return sr(n=String(r))?n:(Se(r),$r(y,b))})(e)}}function Wt(e){return e==null||typeof e=="string"?e:void 0}function Jr(e,t,r){if(e!=null&&e[at]===lt)return e;if(Array.isArray(e)){var n=0|e[m];return(r=n|32&r|2&r)!==n&&x(e,r),new t(e)}}function ft(e,t,r,n){var i=n!==void 0;n=!!n;const o=[];var s=e.length;let a,l=4294967295,u=!1;const c=!!(64&t),p=c?128&t?0:-1:void 0;for(1&t||(a=s&&e[s-1],a!=null&&typeof a=="object"&&a.constructor===Object?l=--s:a=void 0,!c||128&t||i||(u=!0,l=l-p+p)),t=void 0,i=0;i<s;i++){let f=e[i];if(f!=null&&(f=r(f,n))!=null)if(c&&i>=l){const _=i-p;(t??={})[_]=f}else o[i]=f}if(a)for(let f in a){if((e=a[f])==null||(e=r(e,n))==null)continue;let _;s=+f,c&&!Number.isNaN(s)&&(_=s+p)<l?o[_]=e:(t??={})[f]=e}return t&&(u?o.push(t):o[l]=t),o}function Ht(e){switch(typeof e){case"number":return Number.isFinite(e)?e:""+e;case"bigint":return ti(e)?Number(e):""+e;case"boolean":return e?1:0;case"object":if(Array.isArray(e)){var t=0|e[m];return e.length===0&&1&t?void 0:ft(e,t,Ht)}if(e!=null&&e[at]===lt)return Xr(e);if(e instanceof Y){if((t=e.i)==null)e="";else if(typeof t=="string")e=t;else{if(Mr){for(var r="",n=0,i=t.length-10240;n<i;)r+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));r+=String.fromCharCode.apply(null,n?t.subarray(n):t),t=btoa(r)}else{r===void 0&&(r=0),Rr(),r=Dr[r],n=Array(Math.floor(t.length/3)),i=r[64]||"";let u=0,c=0;for(;u<t.length-2;u+=3){var o=t[u],s=t[u+1],a=t[u+2],l=r[o>>2];o=r[(3&o)<<4|s>>4],s=r[(15&s)<<2|a>>6],a=r[63&a],n[c++]=l+o+s+a}switch(l=0,a=i,t.length-u){case 2:a=r[(15&(l=t[u+1]))<<2]||i;case 1:t=t[u],n[c]=r[t>>2]+r[(3&t)<<4|l>>4]+a+i}t=n.join("")}e=e.i=t}return e}return}return e}function Xr(e){return ft(e=e.m,0|e[m],Ht)}let hi,fi;function di(e,t,r){return Qr(e,t[0],t[1],2)}function Qr(e,t,r,n=0){if(e==null){var i=32;r?(e=[r],i|=128):e=[],t&&(i=-8380417&i|(1023&t)<<13)}else{if(!Array.isArray(e))throw Error("narr");if(i=0|e[m],Xt&&1&i)throw Error("rfarr");if(2048&i&&!(2&i)&&(function(){if(Xt)throw Error("carr");Ze(Xn,5)})(),256&i)throw Error("farr");if(64&i)return n!==0||2048&i||x(e,2048|i),e;if(r&&(i|=128,r!==e[0]))throw Error("mid");e:{i|=64;var o=(r=e).length;if(o){var s=o-1;const l=r[s];if(l!=null&&typeof l=="object"&&l.constructor===Object){if((s-=t=128&i?0:-1)>=1024)throw Error("pvtlmt");for(var a in l)(o=+a)<s&&(r[o+t]=l[a],delete l[a]);i=-8380417&i|(1023&s)<<13;break e}}if(t){if((a=Math.max(t,o-(128&i?0:-1)))>1024)throw Error("spvt");i=-8380417&i|(1023&a)<<13}}}return i|=64,n===0&&(i|=2048),x(e,i),e}function pi(e,t){if(typeof e!="object")return e;if(Array.isArray(e)){var r=0|e[m];return e.length===0&&1&r?e=void 0:2&r||(!t||4096&r||16&r?e=rt(e,r,!1,t&&!(16&r)):(Wr(e,34),4&r&&Object.freeze(e))),e}return e!=null&&e[at]===lt?V(e,r=0|(t=e.m)[m])?e:en(e,t,r)?Zr(e,t):rt(t,r):e instanceof Y?e:void 0}function Zr(e,t,r){return e=new e.constructor(t),r&&(e.i=we),e.o=we,e}function rt(e,t,r,n){return n??=!!(34&t),e=ft(e,t,pi,n),n=32,r&&(n|=2),x(e,t=8380609&t|n),e}function dt(e){if(e.i!==we)return!1;var t=e.m;return Wr(t=rt(t,0|t[m]),2048),e.m=t,e.i=void 0,e.o=void 0,!0}function Le(e){if(!dt(e)&&V(e,0|e.m[m]))throw Error()}function Ee(e,t){t===void 0&&(t=0|e[m]),32&t&&!(4096&t)&&x(e,4096|t)}function en(e,t,r){return!!(2&r)||!(!(32&r)||4096&r)&&(x(t,2|r),e.i=we,!0)}function F(e,t,r){if((e=pt(e.m,t,void 0,r))!==null)return e}function pt(e,t,r,n){if(t===-1)return null;const i=t+(r?0:-1),o=e.length-1;let s,a;if(!(o<1+(r?0:-1))){if(i>=o)if(s=e[o],s!=null&&typeof s=="object"&&s.constructor===Object)r=s[t],a=!0;else{if(i!==o)return;r=s}else r=e[i];if(n&&r!=null){if((n=n(r))==null)return n;if(!Object.is(n,r))return a?s[t]=n:e[i]=n,n}return r}}function ue(e,t,r){Le(e),W(e=e.m,0|e[m],t,r)}function W(e,t,r,n,i){const o=r+-1;var s=e.length-1;if(s>=0&&o>=s){const a=e[s];if(a!=null&&typeof a=="object"&&a.constructor===Object)return a[r]=n,t}return o<=s?(e[o]=n,t):(n!==void 0&&(r>=(s=(t??=0|e[m])>>13&1023||536870912)?n!=null&&(e[s+-1]={[r]:n}):e[o]=n),t)}function tn(e,t,r,n,i){let o=e.m,s=0|o[m];n=V(e,s)?1:n,i=!!i||n===3,n===2&&dt(e)&&(o=e.m,s=0|o[m]);let a=(e=nn(o,t))===be?7:0|e[m],l=on(a,s);var u=!(4&l);if(u){4&l&&(e=Fe(e),a=0,l=Re(l,s),s=W(o,s,t,e));let c=0,p=0;for(;c<e.length;c++){const f=r(e[c]);f!=null&&(e[p++]=f)}p<c&&(e.length=p),r=-513&(4|l),l=r&=-1025,l&=-4097}return l!==a&&(x(e,l),2&l&&Object.freeze(e)),rn(e,l,o,s,t,n,u,i)}function rn(e,t,r,n,i,o,s,a){let l=t;return o===1||o===4&&(2&t||!(16&t)&&32&n)?Qe(t)||((t|=!e.length||s&&!(4096&t)||32&n&&!(4096&t||16&t)?2:256)!==l&&x(e,t),Object.freeze(e)):(o===2&&Qe(t)&&(e=Fe(e),l=0,t=Re(t,n),n=W(r,n,i,e)),Qe(t)||(a||(t|=16),t!==l&&x(e,t))),2&t||!(4096&t||16&t)||Ee(r,n),e}function nn(e,t,r){return e=pt(e,t,r),Array.isArray(e)?e:be}function on(e,t){return 2&t&&(e|=2),1|e}function Qe(e){return!!(2&e)&&!!(4&e)||!!(256&e)}function sn(e,t,r){Le(e);let n=0|(e=e.m)[m];if(r==null)W(e,n,t);else{var i=r===be?7:0|r[m],o=i,s=Qe(i),a=s||Object.isFrozen(r);for(s||(i=0),a||(r=Fe(r),o=0,i=Re(i,n),a=!1),i|=5,s=0;s<r.length;s++){const l=r[s],u=Yr(l);Object.is(l,u)||(a&&(r=Fe(r),o=0,i=Re(i,n),a=!1),r[s]=u)}i!==o&&(a&&(r=Fe(r),i=Re(i,n)),x(r,i)),W(e,n,t,r)}}function N(e,t,r,n){Le(e),W(e=e.m,0|e[m],t,(n==="0"?Number(r)===0:r===n)?void 0:r)}function ar(e){if(st)return e[xe]??(e[xe]=new Map);if(xe in e)return e[xe];const t=new Map;return Object.defineProperty(e,xe,{value:t}),t}function lr(e,t,r){var n=ot;let i=e.get(n);if(i!=null)return i;i=0;for(let o=0;o<n.length;o++){const s=n[o];pt(t,s)!=null&&(i!==0&&(r=W(t,r,i)),i=s)}return e.set(n,i),i}function He(e,t,r){let n=e.m,i=0|n[m];if(t=(function(a,l,u,c){let p=!1;if((c=pt(a,c,void 0,(f=>{const _=Jr(f,u,l);return p=_!==f&&_!=null,_})))!=null)return p&&!V(c)&&Ee(a,l),c})(n,i,t,r),t==null)return t;if(i=0|n[m],!V(e,i)){var o,s=t;const a=s.m,l=0|a[m];(o=V(s,l)?en(s,a,l)?Zr(s,a,!0):new s.constructor(rt(a,l,!1)):s)!==t&&(dt(e)&&(n=e.m,i=0|n[m]),i=W(n,i,r,t=o),Ee(n,i))}return t}function an(e){return e==null&&(e=void 0),e}function re(e,t,r){return ue(e,t,r=an(r)),r&&!V(r)&&Ee(e.m),e}function Re(e,t){return-273&(2&t?2|e:-3&e)}function Ne(e,t,r,n){var i=n;Le(e);var o=n=e.m,s=0|n[m];const a=V(e,s)?1:2;a===2&&dt(e)&&(s=0|(o=e.m)[m]);let l=(e=nn(o,t))===be?7:0|e[m];var u=on(l,s);const c=!(4&u);if(c){var p=e,f=s;const _=!!(2&u);_&&(f|=2);let S=!_,D=!0,C=0,q=0;for(;C<p.length;C++){const U=Jr(p[C],r,f);if(U instanceof r){if(!_){const Q=V(U);S&&=!Q,D&&=Q}p[q++]=U}}q<C&&(p.length=q),u|=4,u=D?-4097&u:4096|u,u=S?8|u:-9&u}u!==l&&(x(e,u),2&u&&Object.freeze(e)),t=e=rn(e,u,o,s,t,a,c,!0),i=i??new r,t.push(i),o=r=t===be?7:0|t[m],(i=V(i))?(r&=-9,t.length===1&&(r&=-4097)):r|=4096,r!==o&&x(t,r),i||Ee(n)}function L(e,t){return tt(F(e,t))??0}function z(e,t,r){N(e,t,Nt(r),0)}function ke(e,t,r){if(r!=null){if(typeof r!="number"||!Te(r))throw ze("uint32");r>>>=0}ue(e,t,r)}function O(e,t,r){if(r!=null&&typeof r!="string")throw Error();N(e,t,r,"")}function d(e,t,r){if(Le(e),t=(e=tn(e,t,Wt,2,!0)).push,typeof r!="string")throw Error();t.call(e,r)}var de=class{constructor(e,t,r){if(this.buffer=e,r&&!t)throw Error()}};function ur(e){if(typeof e=="string")return new de(tr(e),!0);if(Array.isArray(e))return new de(new Uint8Array(e),!0);if(e.constructor===Uint8Array)return new de(e,!1);if(e.constructor===ArrayBuffer)return e=new Uint8Array(e),new de(e,!1);if(e.constructor===Y){Vr(Ge);var t=e.i;return t=((t=t==null||Ut(t)?t:typeof t=="string"?tr(t):null)==null?t:e.i=t)||new Uint8Array(0),new de(t,!0,e)}if(e instanceof Uint8Array)return e=e.constructor===Uint8Array?e:new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new de(e,!1);throw Error()}function cr(e){return e?/^\d+$/.test(e)?(ht(e),new Ft(y,b)):null:mi||=new Ft(0,0)}var Ft=class{constructor(e,t){this.j=e>>>0,this.i=t>>>0}};let mi;function hr(e){return e?/^-?\d+$/.test(e)?(ht(e),new Dt(y,b)):null:gi||=new Dt(0,0)}var Dt=class{constructor(e,t){this.j=e>>>0,this.i=t>>>0}};let gi;function _e(e,t,r){for(;r>0||t>127;)e.i.push(127&t|128),t=(t>>>7|r<<25)>>>0,r>>>=7;e.i.push(t)}function mt(e,t){for(;t>127;)e.i.push(127&t|128),t>>>=7;e.i.push(t)}function gt(e,t){if(t>=0)mt(e,t);else{for(let r=0;r<9;r++)e.i.push(127&t|128),t>>=7;e.i.push(1)}}function nt(e,t){t.length!==0&&(e.l.push(t),e.j+=t.length)}function X(e,t,r){mt(e.i,8*t+r)}function _t(e,t){return X(e,t,2),t=e.i.end(),nt(e,t),t.push(e.j),t}function yt(e,t){var r=t.pop();for(r=e.j+e.i.length()-r;r>127;)t.push(127&r|128),r>>>=7,e.j++;t.push(r),e.j++}function it(e,t,r){X(e,t,2),mt(e.i,r.length),nt(e,e.i.end()),nt(e,r)}function H(){const e=class{constructor(){throw Error()}};return Object.setPrototypeOf(e,e.prototype),e}var qe=H(),ln=H(),vt=H(),bt=H(),_i=H(),yi=H(),vi=H(),un=H(),bi=H(),$t=H(),A=class{constructor(e,t){this.m=Qr(e,t)}toJSON(){return Xr(this)}};A.prototype[at]=lt,A.prototype.toString=function(){return this.m.toString()};var $=class{constructor(e,t){this.i=e,e=qe,this.j=!!e&&t===e||!1}};function cn(e,t,r,n,i){(t=fn(t,n))!=null&&(r=_t(e,r),i(t,e),yt(e,r))}const wi=new $(cn,qe),Si=new $(cn,qe);var fr=Symbol(),dr=Symbol();let hn;function wt(e){var t=Ei,r=Ai,n=e[fr];if(n)return n;(n={}).ma=e,n.W=(function(c){switch(typeof c){case"boolean":return hi||=[0,void 0,!0];case"number":return c>0?void 0:c===0?fi||=[0,void 0]:[-c,void 0];case"string":return[0,c];case"object":return c}})(e[0]);var i=e[1];let o=1;i&&i.constructor===Object&&(n.ba=i,typeof(i=e[++o])=="function"&&(n.ha=!0,hn??=e[o+1],i=e[o+=2]));const s={};for(;i&&Array.isArray(i)&&i.length&&typeof i[0]=="number"&&i[0]>0;){for(var a=0;a<i.length;a++)s[i[a]]=i;i=e[++o]}for(a=1;i!==void 0;){let c;typeof i=="number"&&(a+=i,i=e[++o]);var l=void 0;if(i instanceof $?c=i:(c=wi,o--),c?.j){i=e[++o],l=e;var u=o;typeof i=="function"&&(i=i(),l[u]=i),l=i}for(u=a+1,typeof(i=e[++o])=="number"&&i<0&&(u-=i,i=e[++o]);a<u;a++)l?r(n,a,c,l):t(n,a,c)}return e[fr]=n}function fn(e,t){return e instanceof A?e.m:Array.isArray(e)?di(e,t):void 0}function Ei(e,t,r){e[t]=r.i}function Ai(e,t,r,n){let i,o;const s=r.i;e[t]=(a,l,u)=>s(a,l,u,o||=wt(n).W,i||=dn(n))}function dn(e){let t=e[dr];if(!t){const r=wt(e);t=(n,i)=>pn(n,i,r),e[dr]=t}return t}function pn(e,t,r){(function(n,i,o){const s=128&i?0:-1,a=n.length;var l;(l=!!a)&&(l=(l=n[a-1])!=null&&typeof l=="object"&&l.constructor===Object);const u=a+(l?-1:0);for(i=128&i?1:0;i<u;i++)o(i-s,n[i]);if(l){n=n[a-1];for(const c in n)!isNaN(c)&&o(+c,n[c])}})(e,0|e[m],((n,i)=>{if(i!=null){var o=(function(s,a){var l=s[a];if(l)return l;if((l=s.ba)&&(l=l[a])){var u=(l=Array.isArray(l)?l[0]instanceof $?l:[Si,l]:[l,void 0])[0].i;if(l=l[1]){const c=dn(l),p=wt(l).W;l=s.ha?hn(p,c):(f,_,S)=>u(f,_,S,p,c)}else l=u;return s[a]=l}})(r,n);o?o(t,i,n):n<500||Ze(Bt,3)}}))}var It,se=0,pe=se;if(Hr(pe)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(pe))throw Error(String(pe))}else if((It=Zn(pe))&&(It=!Number.isSafeInteger(pe)),It)throw Error(String(pe));function qt(e,t){if(Array.isArray(t)){var r=0|t[m];if(4&r)return t;for(var n=0,i=0;n<t.length;n++){const o=e(t[n]);o!=null&&(t[i++]=o)}return i<n&&(t.length=i),x(t,-1537&(5|r)),2&r&&Object.freeze(t),t}}function P(e,t){return new $(e,t)}function mn(e,t,r){(t=qr(t))!=null&&(X(e,r,5),e=e.i,(r=si||=new DataView(new ArrayBuffer(8))).setFloat32(0,+t,!0),b=0,t=y=r.getUint32(0,!0),e.i.push(t>>>0&255),e.i.push(t>>>8&255),e.i.push(t>>>16&255),e.i.push(t>>>24&255))}function Kt(e,t,r){(t=Pe(t))!=null&&t!=null&&(X(e,r,0),gt(e.i,t))}function gn(e,t,r){(t=ne(t))!=null&&(X(e,r,0),e.i.i.push(t?1:0))}function Yt(e,t,r){(t=Wt(t))!=null&&it(e,r,Fr(t))}function _n(e,t,r,n,i){(t=fn(t,n))!=null&&(r=_t(e,r),i(t,e),yt(e,r))}function yn(e,t,r){(t=Pe(t))!=null&&(t=parseInt(t,10),X(e,r,0),gt(e.i,t))}ct||(se=ei(se)?se?"1":"0":Hr(se)?se.trim()||"0":String(se));var Ae,Ye=P(mn,un),Rt=P(mn,un),Tt=P((function(e,t,r){if(t=(function(n){if(n==null)return n;var i=typeof n;if(i==="bigint")return String(ai(64,n));if(Kr(n)){if(i==="string"){if(i=et(Number(n)),De(i))n=String(i);else if((i=n.indexOf("."))!==-1&&(n=n.substring(0,i)),i=n.length,!(n[0]==="-"?i<20||i===20&&Number(n.substring(0,7))>-922337:i<19||i===19&&Number(n.substring(0,6))<922337))if(ht(n),n=y,2147483648&(i=b))if(Gt())n=""+(BigInt(0|i)<<BigInt(32)|BigInt(n>>>0));else{const[s,a]=zt(n,i);n="-"+We(s,a)}else n=We(n,i);return n}if(i==="number"){if(n=et(n),!De(n)){Se(n),i=y;var o=b;(n=2147483648&o)&&(o=~o>>>0,(i=1+~i>>>0)==0&&(o=o+1>>>0)),n=typeof(i=$r(i,o))=="number"?n?-i:i:n?"-"+i:i}return n}}})(t),t!=null&&(typeof t=="string"&&hr(t),t!=null))switch(X(e,r,0),typeof t){case"number":e=e.i,Se(t),_e(e,y,b);break;case"bigint":r=BigInt.asUintN(64,t),r=new Dt(Number(r&BigInt(4294967295)),Number(r>>BigInt(32))),_e(e.i,r.j,r.i);break;default:r=hr(t),_e(e.i,r.j,r.i)}}),yi),Ii=P((function(e,t,r){if((t=ci(t))!=null&&(typeof t=="string"&&cr(t),t!=null))switch(X(e,r,0),typeof t){case"number":e=e.i,Se(t),_e(e,y,b);break;case"bigint":r=BigInt.asUintN(64,t),r=new Ft(Number(r&BigInt(4294967295)),Number(r>>BigInt(32))),_e(e.i,r.j,r.i);break;default:r=cr(t),_e(e.i,r.j,r.i)}}),vi),M=P(Kt,bt);Ae=new $((function(e,t,r){if((t=qt(Pe,t))!=null&&t.length){r=_t(e,r);for(let n=0;n<t.length;n++)gt(e.i,t[n]);yt(e,r)}}),bt);var j,g=P(Kt,bt),Ti=P(Kt,bt),E=P(gn,ln),w=P(gn,ln),I=P(Yt,vt);j=new $((function(e,t,r){if((t=qt(Wt,t))!=null)for(let s=0;s<t.length;s++){var n=e,i=r,o=t[s];o!=null&&it(n,i,Fr(o))}}),vt);var Jt,k=P(Yt,vt),vn=P(Yt,vt),R=(function(e,t,r=qe){return new $(t,r)})(0,(function(e,t,r,n,i){if(Array.isArray(t))for(let o=0;o<t.length;o++)_n(e,t[o],r,n,i)})),B=new $(_n,qe),Pi=P((function(e,t,r){(t=tt(t))!=null&&t!=null&&(X(e,r,0),mt(e.i,t))}),_i),te=P(yn,$t);Jt=new $((function(e,t,r){if((t=qt(Pe,t))!=null&&t.length){r=_t(e,r);for(let n=0;n<t.length;n++)gt(e.i,t[n]);yt(e,r)}}),$t);var J=P(yn,$t);function Ke(e){return function(){const t=new class{constructor(){this.l=[],this.j=0,this.i=new class{constructor(){this.i=[]}length(){return this.i.length}end(){const s=this.i;return this.i=[],s}}}};pn(this.m,t,wt(e)),nt(t,t.i.end());const r=new Uint8Array(t.j),n=t.l,i=n.length;let o=0;for(let s=0;s<i;s++){const a=n[s];r.set(a,o),o+=a.length}return t.l=[r],r}}function Pt(e,t){if(t!=null)if(Array.isArray(t))ue(e,2,ft(t,0,Ht));else{if(!(typeof t=="string"||t instanceof Y||Ut(t)))throw Error("invalid value in Any.value field: "+t+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");if(t!=null){if(typeof t=="string")t=t?new Y(t,Ge):Et();else if(t.constructor!==Y){if(!Ut(t))throw Error();t=t.length?new Y(new Uint8Array(t),Ge):Et()}}N(e,2,t,Et())}}var me=class extends A{constructor(e){super(e)}},pr=[0,k,P((function(e,t,r){if(t!=null){if(t instanceof A){const n=t.pa;return void(n?(t=n(t),t!=null&&it(e,r,ur(t).buffer)):Ze(Bt,3))}if(Array.isArray(t))return void Ze(Bt,3)}(t=t==null||typeof t=="string"||t instanceof Y?t:void 0)!=null&&it(e,r,ur(t).buffer)}),bi)];let Lt,mr=globalThis.trustedTypes;function gr(e){var t;return Lt===void 0&&(Lt=(function(){let r=null;if(!mr)return r;try{const n=i=>i;r=mr.createPolicy("goog#html",{createHTML:n,createScript:n,createScriptURL:n})}catch{}return r})()),e=(t=Lt)?t.createScriptURL(e):e,new class{constructor(r){this.i=r}toString(){return this.i+""}}(e)}function Li(e,...t){if(t.length===0)return gr(e[0]);let r=e[0];for(let n=0;n<t.length;n++)r+=encodeURIComponent(t[n])+e[n+1];return gr(r)}var bn={};bn[336783863]=[0,I,E,-1,M,[0,[1,2,3,4,5,6,7,8,9],B,[0],B,[0,E,I,E,te,-1,Jt,I,-1,[0,E,-1],te,E,-1],B,[0,I,-2],B,[0,M,E,1,E,-3],B,[0,M,te,E,-1,Ae,te,-1,E],B,[0,I,-2],B,[0,I,te],B,[0,te,I,-1,E],B,[0,te,-1,E]],[0,I],E,[0,[1,3],[2,4],B,[0,Ae],-1,B,[0,j],-1,R,[0,I,-1]],I];var _r=class extends A{constructor(e){super(e)}},yr=[0,Tt,-1,w,-3,Tt,Ae,k,g,Tt,-1,w,g,w,-2,k],K=class extends A{constructor(e){super(e,500)}N(e){return re(this,7,e)}},Me=[-1,{}],vr=[0,I,1,Me],br=[0,I,j,Me];function Z(e,t){Ne(e,1,K,t)}var wn=class extends A{constructor(e){super(e,500)}N(e){return re(this,1001,e)}};wn.prototype.j=Ke([-500,R,[-500,k,-1,j,-3,[-2,bn,E],R,pr,g,-1,vr,br,R,[0,k,w],k,yr,g,j,987,j],4,R,[-500,I,-1,[-1,{}],998,I],R,[-500,I,j,-1,[-2,{},E],997,j,-1],g,R,[-500,I,j,Me,998,j],j,g,vr,br,R,[0,k,-1,Me],j,-2,yr,k,-1,w,[0,w,Pi],978,Me,R,pr]);var wr=class extends A{constructor(e){super(e)}};let Je;const Oi=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function Sn(){if(Je===void 0)try{await WebAssembly.instantiate(Oi),Je=!0}catch{Je=!1}return Je}async function Ue(e,t=Li``){const r=await Sn()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${t}/${e}_${r}.js`,wasmBinaryPath:`${t}/${e}_${r}.wasm`}}var ae=class{};function Sr(e){function t(s,a){return new ReadableStream({start(){},async pull(l){i=i.then((async()=>{if(s.cache.length>0)l.enqueue(s.cache.shift());else{var{value:u,done:c}=await e.read();u&&(a.active&&a.cache.push(u),s.active&&l.enqueue(u)),c&&l.close()}})),await i},cancel(){s.active=!1,s.cache.length=0,a.active||e.cancel()}})}var r={cache:[],active:!0};const n={cache:[],active:!0};let i=Promise.resolve();const o=t(r,n);return r=t(n,r),[o.getReader(),r.getReader()]}async function Er(e,t){const r=new Uint8Array(t);let n=0;for(;n<t;){const{value:i,done:o}=await e.read();if(i){const s=i.subarray(0,t-n);r.set(s,n),n+=s.length}if(o)throw Error(`Expected ${t} bytes, but stream ended after reading ${n} bytes.`)}return await e.cancel(),r}ae.forVisionTasks=function(e){return Ue("vision",e)},ae.forTextTasks=function(e){return Ue("text",e)},ae.forGenAiExperimentalTasks=function(e){return Ue("genai_experimental",e)},ae.forGenAiTasks=function(e){return Ue("genai",e)},ae.forAudioTasks=function(e){return Ue("audio",e)},ae.isSimdSupported=function(){return Sn()};const ji=[[0,async e=>{const t=new TextEncoder().encode("TFL3").length;return e=await Er(e,t+4),new TextDecoder("utf-8").decode(e.subarray(4,t+4))==="TFL3"}],[1,async e=>(e=await Er(e,6))[4]===80&&e[5]===75]];function xi(){var e=navigator;return typeof OffscreenCanvas<"u"&&(!(function(t=navigator){return(t=t.userAgent).includes("Safari")&&!t.includes("Chrome")})(e)||!!((e=e.userAgent.match(/Version\/([\d]+).*Safari/))&&e.length>=1&&Number(e[1])>=17))}async function Ar(e){if(typeof importScripts!="function"){const t=document.createElement("script");return t.src=e.toString(),t.crossOrigin="anonymous",new Promise(((r,n)=>{t.addEventListener("load",(()=>{r()}),!1),t.addEventListener("error",(i=>{n(i)}),!1),document.body.appendChild(t)}))}importScripts(e.toString())}function h(e,t,r){e.o||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),r(t=e.h.stringToNewUTF8(t)),e.h._free(t)}function Ir(e,t,r){e.o||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const n=new Uint32Array(t.length);for(let i=0;i<t.length;i++)n[i]=e.h.stringToNewUTF8(t[i]);t=e.h._malloc(4*n.length),e.h.HEAPU32.set(n,t>>2),r(t);for(const i of n)e.h._free(i);e.h._free(t)}function ee(e,t,r){e.h.simpleListeners=e.h.simpleListeners||{},e.h.simpleListeners[t]=r}function oe(e,t,r){let n=[];e.h.simpleListeners=e.h.simpleListeners||{},e.h.simpleListeners[t]=(i,o,s)=>{o?(r(n,s),n=[]):n.push(i)}}const ki=(Tr=class{constructor(e,t){this.l=!0,this.h=e,this.i=null,this.j=0,this.o=typeof this.h._addIntToInputStream=="function",t!==void 0?this.h.canvas=t:xi()?this.h.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.h.canvas=document.createElement("canvas"))}async initializeGraph(e){const t=await(await fetch(e)).arrayBuffer();e=!(e.endsWith(".pbtxt")||e.endsWith(".textproto")),this.setGraph(new Uint8Array(t),e)}setGraphFromString(e){this.setGraph(new TextEncoder().encode(e),!1)}setGraph(e,t){const r=e.length,n=this.h._malloc(r);this.h.HEAPU8.set(e,n),t?this.h._changeBinaryGraph(r,n):this.h._changeTextGraph(r,n),this.h._free(n)}configureAudio(e,t,r,n,i){this.h._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),h(this,n||"input_audio",(o=>{h(this,i=i||"audio_header",(s=>{this.h._configureAudio(o,s,e,t??0,r)}))}))}setAutoResizeCanvas(e){this.l=e}setAutoRenderToScreen(e){this.h._setAutoRenderToScreen(e)}setGpuBufferVerticalFlip(e){this.h.gpuOriginForWebTexturesIsBottomLeft=e}attachErrorListener(e){this.h.errorListener=e}attachEmptyPacketListener(e,t){this.h.emptyPacketListeners=this.h.emptyPacketListeners||{},this.h.emptyPacketListeners[e]=t}addAudioToStream(e,t,r){this.addAudioToStreamWithShape(e,0,0,t,r)}addAudioToStreamWithShape(e,t,r,n,i){const o=4*e.length;this.j!==o&&(this.i&&this.h._free(this.i),this.i=this.h._malloc(o),this.j=o),this.h.HEAPF32.set(e,this.i/4),h(this,n,(s=>{this.h._addAudioToInputStream(this.i,t,r,s,i)}))}addGpuBufferToStream(e,t,r){h(this,t,(n=>{if(!this.h.canvas)throw Error("No OpenGL canvas configured.");n?this.h._bindTextureToStream(n):this.h._bindTextureToCanvas();const i=this.h.canvas.getContext("webgl2")||this.h.canvas.getContext("webgl");if(!i)throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");this.h.gpuOriginForWebTexturesIsBottomLeft&&i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),this.h.gpuOriginForWebTexturesIsBottomLeft&&i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1);const[o,s]=e.videoWidth!==void 0?[e.videoWidth,e.videoHeight]:e.naturalWidth!==void 0?[e.naturalWidth,e.naturalHeight]:e.displayWidth!==void 0?[e.displayWidth,e.displayHeight]:[e.width,e.height];!this.l||o===this.h.canvas.width&&s===this.h.canvas.height||(this.h.canvas.width=o,this.h.canvas.height=s);const[a,l]=[o,s];this.h._addBoundTextureToStream(n,a,l,r)}))}addBoolToStream(e,t,r){h(this,t,(n=>{this.h._addBoolToInputStream(e,n,r)}))}addDoubleToStream(e,t,r){h(this,t,(n=>{this.h._addDoubleToInputStream(e,n,r)}))}addFloatToStream(e,t,r){h(this,t,(n=>{this.h._addFloatToInputStream(e,n,r)}))}addIntToStream(e,t,r){h(this,t,(n=>{this.h._addIntToInputStream(e,n,r)}))}addUintToStream(e,t,r){h(this,t,(n=>{this.h._addUintToInputStream(e,n,r)}))}addStringToStream(e,t,r){h(this,t,(n=>{h(this,e,(i=>{this.h._addStringToInputStream(i,n,r)}))}))}addStringRecordToStream(e,t,r){h(this,t,(n=>{Ir(this,Object.keys(e),(i=>{Ir(this,Object.values(e),(o=>{this.h._addFlatHashMapToInputStream(i,o,Object.keys(e).length,n,r)}))}))}))}addProtoToStream(e,t,r,n){h(this,r,(i=>{h(this,t,(o=>{const s=this.h._malloc(e.length);this.h.HEAPU8.set(e,s),this.h._addProtoToInputStream(s,e.length,o,i,n),this.h._free(s)}))}))}addEmptyPacketToStream(e,t){h(this,e,(r=>{this.h._addEmptyPacketToInputStream(r,t)}))}addBoolVectorToStream(e,t,r){h(this,t,(n=>{const i=this.h._allocateBoolVector(e.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const o of e)this.h._addBoolVectorEntry(i,o);this.h._addBoolVectorToInputStream(i,n,r)}))}addDoubleVectorToStream(e,t,r){h(this,t,(n=>{const i=this.h._allocateDoubleVector(e.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const o of e)this.h._addDoubleVectorEntry(i,o);this.h._addDoubleVectorToInputStream(i,n,r)}))}addFloatVectorToStream(e,t,r){h(this,t,(n=>{const i=this.h._allocateFloatVector(e.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const o of e)this.h._addFloatVectorEntry(i,o);this.h._addFloatVectorToInputStream(i,n,r)}))}addIntVectorToStream(e,t,r){h(this,t,(n=>{const i=this.h._allocateIntVector(e.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const o of e)this.h._addIntVectorEntry(i,o);this.h._addIntVectorToInputStream(i,n,r)}))}addUintVectorToStream(e,t,r){h(this,t,(n=>{const i=this.h._allocateUintVector(e.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const o of e)this.h._addUintVectorEntry(i,o);this.h._addUintVectorToInputStream(i,n,r)}))}addStringVectorToStream(e,t,r){h(this,t,(n=>{const i=this.h._allocateStringVector(e.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const o of e)h(this,o,(s=>{this.h._addStringVectorEntry(i,s)}));this.h._addStringVectorToInputStream(i,n,r)}))}addBoolToInputSidePacket(e,t){h(this,t,(r=>{this.h._addBoolToInputSidePacket(e,r)}))}addDoubleToInputSidePacket(e,t){h(this,t,(r=>{this.h._addDoubleToInputSidePacket(e,r)}))}addFloatToInputSidePacket(e,t){h(this,t,(r=>{this.h._addFloatToInputSidePacket(e,r)}))}addIntToInputSidePacket(e,t){h(this,t,(r=>{this.h._addIntToInputSidePacket(e,r)}))}addUintToInputSidePacket(e,t){h(this,t,(r=>{this.h._addUintToInputSidePacket(e,r)}))}addStringToInputSidePacket(e,t){h(this,t,(r=>{h(this,e,(n=>{this.h._addStringToInputSidePacket(n,r)}))}))}addProtoToInputSidePacket(e,t,r){h(this,r,(n=>{h(this,t,(i=>{const o=this.h._malloc(e.length);this.h.HEAPU8.set(e,o),this.h._addProtoToInputSidePacket(o,e.length,i,n),this.h._free(o)}))}))}addBoolVectorToInputSidePacket(e,t){h(this,t,(r=>{const n=this.h._allocateBoolVector(e.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const i of e)this.h._addBoolVectorEntry(n,i);this.h._addBoolVectorToInputSidePacket(n,r)}))}addDoubleVectorToInputSidePacket(e,t){h(this,t,(r=>{const n=this.h._allocateDoubleVector(e.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const i of e)this.h._addDoubleVectorEntry(n,i);this.h._addDoubleVectorToInputSidePacket(n,r)}))}addFloatVectorToInputSidePacket(e,t){h(this,t,(r=>{const n=this.h._allocateFloatVector(e.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const i of e)this.h._addFloatVectorEntry(n,i);this.h._addFloatVectorToInputSidePacket(n,r)}))}addIntVectorToInputSidePacket(e,t){h(this,t,(r=>{const n=this.h._allocateIntVector(e.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const i of e)this.h._addIntVectorEntry(n,i);this.h._addIntVectorToInputSidePacket(n,r)}))}addUintVectorToInputSidePacket(e,t){h(this,t,(r=>{const n=this.h._allocateUintVector(e.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const i of e)this.h._addUintVectorEntry(n,i);this.h._addUintVectorToInputSidePacket(n,r)}))}addStringVectorToInputSidePacket(e,t){h(this,t,(r=>{const n=this.h._allocateStringVector(e.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const i of e)h(this,i,(o=>{this.h._addStringVectorEntry(n,o)}));this.h._addStringVectorToInputSidePacket(n,r)}))}attachBoolListener(e,t){ee(this,e,t),h(this,e,(r=>{this.h._attachBoolListener(r)}))}attachBoolVectorListener(e,t){oe(this,e,t),h(this,e,(r=>{this.h._attachBoolVectorListener(r)}))}attachIntListener(e,t){ee(this,e,t),h(this,e,(r=>{this.h._attachIntListener(r)}))}attachIntVectorListener(e,t){oe(this,e,t),h(this,e,(r=>{this.h._attachIntVectorListener(r)}))}attachUintListener(e,t){ee(this,e,t),h(this,e,(r=>{this.h._attachUintListener(r)}))}attachUintVectorListener(e,t){oe(this,e,t),h(this,e,(r=>{this.h._attachUintVectorListener(r)}))}attachDoubleListener(e,t){ee(this,e,t),h(this,e,(r=>{this.h._attachDoubleListener(r)}))}attachDoubleVectorListener(e,t){oe(this,e,t),h(this,e,(r=>{this.h._attachDoubleVectorListener(r)}))}attachFloatListener(e,t){ee(this,e,t),h(this,e,(r=>{this.h._attachFloatListener(r)}))}attachFloatVectorListener(e,t){oe(this,e,t),h(this,e,(r=>{this.h._attachFloatVectorListener(r)}))}attachStringListener(e,t){ee(this,e,t),h(this,e,(r=>{this.h._attachStringListener(r)}))}attachStringVectorListener(e,t){oe(this,e,t),h(this,e,(r=>{this.h._attachStringVectorListener(r)}))}attachProtoListener(e,t,r){ee(this,e,t),h(this,e,(n=>{this.h._attachProtoListener(n,r||!1)}))}attachProtoVectorListener(e,t,r){oe(this,e,t),h(this,e,(n=>{this.h._attachProtoVectorListener(n,r||!1)}))}attachAudioListener(e,t,r){this.h._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),ee(this,e,((n,i)=>{n=new Float32Array(n.buffer,n.byteOffset,n.length/4),t(n,i)})),h(this,e,(n=>{this.h._attachAudioListener(n,r||!1)}))}finishProcessing(){this.h._waitUntilIdle()}closeGraph(){this.h._closeGraph(),this.h.simpleListeners=void 0,this.h.emptyPacketListeners=void 0}},class extends Tr{ja(){this.h._registerModelResourcesGraphService()}});var Tr;async function Ui(e,t){const r=await(async(n,i,o)=>{var s=T;if(n&&await Ar(n),!self.ModuleFactory||i&&(await Ar(i),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&o&&((n=self.Module).locateFile=o.locateFile,o.mainScriptUrlOrBlob&&(n.mainScriptUrlOrBlob=o.mainScriptUrlOrBlob)),o=await self.ModuleFactory(self.Module||o),self.ModuleFactory=self.Module=void 0,new s(o,null)})(e.wasmLoaderPath,e.assetLoaderPath,{locateFile:n=>n.endsWith(".wasm")?e.wasmBinaryPath.toString():e.assetBinaryPath&&n.endsWith(".data")?e.assetBinaryPath.toString():n});return await r.N(t),r}async function Ot(e,t){return Ui(e,t)}function Pr(e){try{const t=e.J.length;if(t===1)throw Error(e.J[0].message);if(t>1)throw Error("Encountered multiple errors: "+e.J.map((r=>r.message)).join(", "))}finally{e.J=[]}}function ge(e,t){e.I=Math.max(e.I,t)}var Mt=class{constructor(e){this.j=e,this.J=[],this.I=0,this.j.setAutoRenderToScreen(!1)}setGraph(e,t){this.j.attachErrorListener(((r,n)=>{this.J.push(Error(n))})),this.j.ja(),this.j.setGraph(e,t),Pr(this)}finishProcessing(){this.j.finishProcessing(),Pr(this)}close(){this.j.closeGraph()}};Mt.prototype.close=Mt.prototype.close;var Ie=class extends A{constructor(e){super(e)}j(){return Pe(F(this,2))??0}};function Lr(e,t){re(e,1,t)}var Bi=class extends A{constructor(e){super(e)}},En=[0,J,g,Rt,-1,M];function Ni(e,t,r,n){if(e.data!==void 0){var i=new Uint8Array(e.data.buffer,t,r);return n===1&&(function(o,s,a){o.i.push([s,a]),o.i.sort(((l,u)=>l[0]-u[0])),s=0;for(const[l,u]of o.i){const c=u;(a=l)<=s&&(s=Math.max(s,a+c))}s===o.length&&(o.data=void 0)})(e,t,r),i}}Ie.prototype.l=Ke(En);class Fi{constructor(t){this.i=[],this.data=t,this.length=t.length}}function An(e,t){return new Di((async()=>{const{value:r,done:n}=await e.read();return n?void 0:r}),t)}async function Or(e,t,r,n,i){if(i===2)return e.i=[],e.j=()=>Promise.resolve(void 0),setTimeout((()=>{e.l()}),0),Promise.resolve(0);for(;e.size<r+n;){var o=await e.j();if(o===void 0)break;e.i.push(new Fi(o))}if(e.size<r+n)throw Error(`Data size is too small: ${e.size}, expected at least ${r+n}.`);o=t._malloc(n)>>>0;let s=0;for(let a=0;a<e.i.length;a++){const l=e.i[a];if(r>=l.length){r-=l.length;continue}const u=Math.min(n,l.length-r);if((r=Ni(l,r,u,i))===void 0)throw Error("Data has already been released.");if(t.HEAPU8.set(r,o+s),r=0,s+=u,(n-=u)===0)break}if(n!==0)throw Error("Data not found.");return Promise.resolve(o)}var Di=class{constructor(e,t){this.i=[],this.j=e,this.l=t}get size(){let e=0;for(let t=0;t<this.i.length;t++)e+=this.i[t].length;return e}};function Ve(e){return typeof e=="object"&&e!=null&&"imageSource"in e}function Ce(e){return typeof e=="object"&&e!=null&&"audioSource"in e}async function jr(e,t,r){e=new Tn(e,r);let n=0;for(t=t.getReader();;){const{value:i,done:o}=await t.read();if(o)break;e.set(i,n),n+=i.byteLength}if(r!==n)throw In(e),Error(`File could not be fully loaded to memory, so was not retained. Loaded ${n}/${r} bytes before failure`);return e}function In(e){if(e.i)try{e.h._free(e.j)}catch{}finally{e.i=!1}}var Tn=class{constructor(e,t){this.h=e,this.l=t,this.j=this.h._malloc(t)>>>0,this.o=this.h.HEAPU8,this.i=!!this.j}get offset(){if(!this.i)throw Error("WasmFileReference has been freed.");return this.j}get size(){if(!this.i)throw Error("WasmFileReference has been freed.");return this.l}set(e,t){this.o.set(e,this.j+(t??0))}},Pn=class extends A{constructor(e){super(e)}};Pn.prototype.j=Ke([0,k,2,j,g,w]);var Ri=class extends A{constructor(e){super(e)}},Mi=class extends A{constructor(e){super(e)}},Vi=class extends A{constructor(e){super(e)}},Ln=class extends A{constructor(e){super(e)}},jt=[0,g,-6,1,g,1,[0,w,J,-2],[0,w,Rt],J,-2,[0,w,-1,J,Rt,te,M,E,-1],1,w,g,M,-1,[0,J,g],w,-1,Ye,g,-5,Ye,-1,[0,M,Ye],M,E,[0,M,-2],Ye,[0,g],[0,g,-4],E,M,-2,E],xr=[0,k,-2],kr=[0,[4,6],jt,g,1,Ti,j,vn,Jt,xr,M,[0,[0,g,-1,R,[0,g,[0,g,-1],-1,[0,J,-1],w],w,-2,g,-1],[0,g,-1,w],jt,w,g,[0,g]],I,-3,[0,g,w],jt,[0,xr,-2],Ae];Ln.prototype.j=Ke([0,k,8,[0,w,-6],1,g,1,g,[0,R,[0,k,Ii,-1,J],kr,g],[0,g,w,-3],1,J,1,kr,1,g,5,J,Ae,1,En,w,g]);var Ci=class extends A{constructor(e){super(e)}},On=class extends A{constructor(e){super(e)}},ot=[2,4];On.prototype.j=Ke([0,ot,g,vn,g,B,[0,1,k]]);const Gi=(function(e){return class extends e{constructor(){super(...arguments),this.P=!1,this.F=this.H=0}M(){if(this.P)throw Error("Cannot process because LLM inference engine is currently loading or processing.");this.P=!0}L(){this.P=!1}async createLlmInferenceEngine(t,r){this.M();try{const n=An(t,(()=>{}));await this.h.createLlmInferenceEngine(L(r,2)??512,He(r,Ie,3)?.j()??40,ne(F(r,6))??!1??!1,L(r,7)??0,ne(F(r,8))??!1??!1,((i,o,s)=>Or(n,this.h,i,o,s)))}finally{this.L()}}async aa(t,r){this.M();try{await this.la(t),await this.h.ccall("CreateLlmInferenceEngineConverted","void",["number","number","boolean"],[L(r,2)??512,He(r,Ie,3)?.j()??40,ne(F(r,6))??!1??!1],{async:!0})}finally{this.L()}}V(){this.M();try{const t=this.h;t.ccall("DeleteLlmInferenceEngine","void",[],[],{async:!1}),this.H&&(t._FreeSession(this.H),this.F===this.H&&(this.F=0),this.H=0),this.F&&(t._FreeSession(this.F),this.F=0)}finally{this.L()}}async R(t,r,n){this.M();try{const i=[],o=this.h;o._userProgressListener=(f,_)=>{f&&i.push(f),n&&n(f,_)};const s=r.l(),a=s.length,l=this.h._malloc(a);this.h.HEAPU8.set(s,l);const u=t.some(Ce),c=t.some(Ve);o.ccallNum=o.ccall;const p=await o.ccallNum("MakeSessionForPredict","number",["number","number","boolean","boolean"],[l,a,c,u],{async:!0});r=[];for(const f of t)if(typeof f=="string")h(this,f,(_=>{o._AddTextQueryChunk(p,_)}));else if(Ve(f)){const{image:_,width:S,height:D}=await this.ea(f.imageSource),C=typeof OffscreenCanvas<"u"?new OffscreenCanvas(S,D):document.createElement("canvas");C.width=S,C.height=D;const q=C.getContext("2d");q.drawImage(_,0,0);const U=q.getImageData(0,0,S,D),Q=this.h._malloc(U.width*U.height*4);this.h.HEAPU8.set(U.data,Q),o._AddImageQueryChunk(p,Q,U.width,U.height),r.push(Q)}else{if(!Ce(f))throw Error("Unsupported PromptPart type in query.");{const _=await this.da(f.audioSource),S=this.h._malloc(_.audioSamples.byteLength);this.h.HEAPF32.set(_.audioSamples,S/4),o._AddAudioQueryChunk(p,_.audioSampleRateHz,S,_.audioSamples.length),r.push(S)}}await o.ccall("PredictSession","void",["number"],[p],{async:!0}),t=!0,c&&this.F===0&&(this.F=p,t=!1),u&&this.H===0&&(this.H=p,t=!1),t&&o._FreeSession(p);for(const f of r)this.h._free(f);return r.length=0,n&&n("",!0),this.h._free(l),o._userProgressListener=void 0,i.join("")}finally{this.L()}}S(t){this.M();let r=0,n="";for(const i of t)typeof i=="string"?n+=i:Ve(i)?r+=260:Ce(i)&&console.warn("sizeInTokens is not yet implemented for audio; audio tokens will not be counted");try{let i;return h(this,n,(o=>{i=this.h._GetSizeInTokens(o)})),r+i}finally{this.L()}}async la(t){t=await(async function(r){const n=[];for(var i=0;;){const{done:o,value:s}=await r.read();if(o)break;n.push(s),i+=s.length}if(n.length===0)return new Uint8Array(0);if(n.length===1)return n[0];r=new Uint8Array(i),i=0;for(const o of n)r.set(o,i),i+=o.length;return r})(t);try{this.h.FS_unlink("llm.task")}catch{}this.h.FS_createDataFile("/","llm.task",t,!0,!1,!1)}async ea(t){if(typeof t=="string"){const r=new Image;r.src=t,r.crossOrigin="Anonymous";try{await r.decode()}catch{throw Error(`Image from URL ${t} failed to load`)}return{image:r,width:r.naturalWidth,height:r.naturalHeight}}if(t instanceof HTMLImageElement){try{await t.decode()}catch{throw Error("Image from HTMLImageElement failed to load")}return{image:t,width:t.naturalWidth,height:t.naturalHeight}}return t instanceof HTMLVideoElement?{image:t,width:t.videoWidth,height:t.videoHeight}:t instanceof VideoFrame?{image:t,width:t.displayWidth,height:t.displayHeight}:{image:t,width:t.width,height:t.height}}async da(t){if(typeof t=="string"){const r=await fetch(t);if(!r.ok)throw Error(`Audio fetch for ${t} had error: ${r.status}`);return t=await r.arrayBuffer(),{audioSamples:(t=await new AudioContext({sampleRate:16e3}).decodeAudioData(t)).getChannelData(0),audioSampleRateHz:t.sampleRate}}return typeof t=="object"&&t!=null&&"audioSamples"in t&&"audioSampleRateHz"in t?t:{audioSamples:t.getChannelData(0),audioSampleRateHz:t.sampleRate}}}})((function(e){return class jn extends e{static async ka(r,n){let i;n||=await jn.X();const o=[];for(const s of r?.requiredFeatures??[])n.features.has(s)?o.push(s):console.warn(`WebGPU feature ${s} is not supported.`);r={...r,requiredFeatures:o};try{i=await n.requestDevice(r)}catch(s){throw console.error("Unable to initialize WebGPU with the requested features."),s}return(r=i).adapterInfo||(r.adapterInfo=n.info),i}static async X(r){if(!(r=await navigator.gpu.requestAdapter(r)))throw Error("Unable to request adapter from navigator.gpu; Ensure WebGPU is enabled.");return r}fa(r){if(n)typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&(n.id="canvas_webgpu");else var n=new OffscreenCanvas(1,1);n.getContext("webgpu").configure({device:r,format:navigator.gpu.getPreferredCanvasFormat()}),this.h.preinitializedWebGPUDevice=r}Z(){return this.h.ccall("closeGraph","void",[],[],{async:!0})}}})((function(e){return class extends e{addStreamingReaderToInputSidePacket(t,r){this.h.addStreamingReaderToInputSidePacket(((n,i,o)=>Or(t,this.h,n,i,o)),r)}}})((function(e){return class extends e{Y(t,r){h(this,"lora_model_ref_in",(n=>{this.h._addRawDataSpanToInputStream(t.offset,t.size,n,r)}))}}})(class extends ki{}))));class Vt extends Gi{}var Ct=class{constructor(e){this.j=e,this.i=Ur,Ur++}},Ur=1;class zi{constructor(){let t,r;this.promise=new Promise(((n,i)=>{t=n,r=i})),this.resolve=t,this.reject=r}}function Br(e){return e===1?1:e+e%2}async function Xe(){const e=await Vt.X({powerPreference:"high-performance"});var t=e.limits.maxBufferSize,r=e.limits.maxStorageBufferBindingSize;return t<524550144&&console.warn(`This WebGPU device is unable to execute most LLM tasks, because the required maxBufferSize is usually at least 524550144, but your device only supports maxBufferSize of ${t}`),r<524550144&&console.warn(`The WebGPU device is unable to execute LLM tasks, because the required maxStorageBufferBindingSize is usually at least 524550144, but your device only supports maxStorageBufferBindingSize of ${r}`),t={requiredFeatures:["shader-f16"],requiredLimits:{maxStorageBufferBindingSize:r,maxBufferSize:t,maxStorageBuffersPerShaderStage:e.limits.maxStorageBuffersPerShaderStage}},e.features.has("subgroups")&&(console.warn("Experimental Chromium WGSL subgroup support detected. Enabling this feature in the inference engine."),r=["shader-f16","subgroups"],e.features.has("subgroups-f16")&&r.push("subgroups-f16"),t.requiredFeatures=r),Vt.ka(t,e)}function ye(e){if(e.D.length>0){const t=[...e.D];if(e.D.length=0,!e.o)throw t;e.o.reject(t),e.o=void 0}}function Wi(e){const t=(function(n){const i=new wn;d(i,10,"text_in"),d(i,10,"token_cost_in"),d(i,10,"lora_model_id_to_apply_in"),d(i,10,"lora_model_ref_in"),d(i,10,"lora_model_id_to_load_in"),d(i,16,"streaming_reader"),d(i,15,"text_out"),d(i,15,"text_end"),d(i,15,"token_cost_out");var o=new K;O(o,2,"TokenizerInputBuildCalculator"),d(o,3,"PROMPT:text_in"),d(o,3,"LORA_ID:lora_model_id_to_apply_in"),d(o,4,"prompt"),Z(i,o),O(o=new K,2,"ModelDataCalculator"),d(o,6,"MODEL_DATA:__side_packet_1"),d(o,6,"MODEL_TYPE:model_type"),d(o,5,"READ_DATA_FN:streaming_reader"),d(o,3,"LORA_MODEL_SPAN:lora_model_ref_in"),d(o,3,"LORA_MODEL_ID:lora_model_id_to_load_in"),d(o,4,"LORA_DATA:lora_model_data"),Z(i,o),O(o=new K,2,"Gpt2UnicodeMappingCalculator"),d(o,5,"MODEL_TYPE:model_type"),d(o,6,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),Z(i,o),O(o=new me,1,"type.googleapis.com/odml.infra.proto.TokenizerCalculatorOptions");var s=new On,a=L(n.i,2);z(s,1,a),O(a=new Ci,2,"spm_vocab_model"),a=an(a);e:{Le(s);var l=s.m,u=0|l[m];if(a==null){var c=ar(l);if(lr(c,l,u)!==4)break e;c.set(ot,0)}else{const p=ar(c=l),f=lr(p,c,u);f!==4&&(f&&(u=W(c,u,f)),p.set(ot,4))}W(l,u,4,a)}return a&&!V(a)&&Ee(s.m),z(s,3,2),Pt(o,s.j()),O(s=new K,2,"TokenizerCalculator"),Ne(s,8,me,o),d(s,5,"MODEL_DATA:__side_packet_1"),d(s,3,"PROMPT_AND_INPUT_OPTIONS:prompt"),d(s,5,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),d(s,6,"PROCESSOR_GETTER:__input_side_1"),d(s,4,"IDS_AND_INPUT_OPTIONS:__stream_0"),Z(i,s),O(o=new me,1,"type.googleapis.com/odml.infra.proto.LlmGpuCalculatorOptions"),z(s=new Ln,12,3),O(s,1,"llm.tflite"),z(s,14,0),a=Br(L(n.i,5)),z(s,22,a),a=He(n.i,Ie,3),re(s,31,a),N(a=new Ri,1,le(!0),!1),ne(F(n.i,6))!=null&&(ne(F(n.i,6))??!1)&&N(a,1,le(!1),!1),N(a,2,le(!0),!1),N(a,5,le(!0),!1),re(s,10,a),a=tn(n.i,4,Pe,Qn===void 0?2:4),sn(s,29,a),a=new Vi,z(l=new Mi,1,1),c=L(n.i,2),z(l,2,c),re(a,1,l),re(s,20,a),Pt(o,s.j()),O(s=new K,2,"LlmGpuCalculator"),Ne(s,8,me,o),d(s,3,"IDS_AND_INPUT_OPTIONS:__stream_0"),d(s,3,"FINISH:finish"),d(s,3,"LORA_DATA:lora_model_data"),d(s,5,"MODEL_DATA:__side_packet_1"),d(s,4,"DECODED_IDS:__stream_3"),d(s,4,"OUTPUT_END:__stream_4"),O(o=new _r,1,"FINISH"),N(o,2,le(!0),!1),Ne(s,13,_r,o),Z(i,s),O(o=new K,2,"IsPacketPresentCalculator"),d(o,3,"__stream_4"),d(o,4,"text_end"),Z(i,o),O(o=new me,1,"type.googleapis.com/odml.infra.proto.DetokenizerCalculatorOptions"),s=new Pn,n=Br(L(n.i,5)),z(s,5,n),d(s,4,"<eos>"),d(s,4,"<|endoftext|>"),Pt(o,s.j()),O(n=new K,2,"DetokenizerCalculator"),Ne(n,8,me,o),d(n,3,"IDS_AND_INPUT_OPTIONS:__stream_3"),d(n,5,"PROCESSOR_GETTER:__input_side_1"),d(n,5,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),d(n,5,"MODEL_DATA:__side_packet_1"),d(n,4,"FINISH_AND_INPUT_OPTIONS:finish"),d(n,4,"WORDS:text_out"),Z(i,n),O(n=new K,2,"TokenCostCalculator"),d(n,3,"PROMPT:token_cost_in"),d(n,5,"PROCESSOR_GETTER:__input_side_1"),d(n,5,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),d(n,4,"NUM_TOKENS:token_cost_out"),Z(i,n),i})(e);e.j.attachStringVectorListener("text_out",((n,i)=>{n=(function(o,s){return o==null||o.length===0?[]:o.map((a=>(a=(a=a.replaceAll("‚ñÅ"," ")).replaceAll("<0x0A>",`
`),s&&(a=a.trimStart()),a.split("\\[eod\\]",1)[0])))})(n,e.G.length===0),n.forEach(((o,s)=>{s<L(e.i,5)&&e.G[s].push(o)})),e.v&&e.D.length===0&&(e.A?(n.length>L(e.i,5)&&n.pop(),e.v(n,!1)):e.v(n[0],!1)),ge(e,i)})),e.j.attachEmptyPacketListener("text_out",(n=>{ge(e,n)})),e.j.attachBoolListener("text_end",((n,i)=>{ge(e,i);try{ye(e)}catch(o){throw e.l=!1,o}if(e.o&&(e.o.resolve(e.G.map((o=>o.join("")))),e.o=void 0),e.v)if(e.A){for(n=[],i=0;i<L(e.i,5);i++)n.push("");e.v(n,!0)}else e.v("",!0);e.l=!1,e.A=void 0})),e.j.attachEmptyPacketListener("text_end",(n=>{e.l=!1,e.A=void 0,ge(e,n),ye(e),e.o&&(e.o.resolve(e.G.map((i=>i.join("")))),e.o=void 0)})),e.j.attachIntListener("token_cost_out",((n,i)=>{e.T=n,ge(e,i)})),e.U&&e.j.addStreamingReaderToInputSidePacket(e.U,"streaming_reader");const r=t.j();return e.C?.removeEventListener("uncapturederror",e.K),e.j.Z().then((()=>{e.C?.addEventListener("uncapturederror",e.K),e.D.length=0,e.setGraph(new Uint8Array(r),!0),e.finishProcessing()}))}function Nr(e,t,r,n){if(e.v=typeof r=="function"?r:n,(n=(t=Array.isArray(t)?t:[t]).filter((i=>Ve(i))).length)>0&&(tt(F(e.i,7))==null||L(e.i,7)<n))throw Error(`maxNumImages is set to ${tt(F(e.i,7))!=null?L(e.i,7):0}, but the query included ${n} images.`);if((n=t.filter((i=>Ce(i))).length)>0&&(ne(F(e.i,8))==null||!ne(F(e.i,8))))throw Error(`supportAudio was not enabled, but the query included ${n} audio chunks.`);if(e.B){if(e.A&&L(e.i,5)>1)throw Error("Multi-response generation is not supported for converted LLM models (.task format) yet, nor is it supported for multimodality. Please use the .bin format without multimodality or request only one response.");if(r instanceof Ct)throw Error("LoRA is not supported for converted LLM models (.task format) yet, nor is it supported for multimodality. Please use the .bin format without multimodality to use LoRA.");return e.j.R(t,e.u,((i,o)=>{e.D.length===0&&e.v&&(e.A?e.v([i],o):e.v(i,o))})).then((i=>(ye(e),[i])))}if(e.l)throw Error("Previous invocation or loading is still ongoing.");for(e.l=!0,e.G.length=0,n=0;n<L(e.i,5);n++)e.G[n]=[];if(n=e.I+1,e.j.addStringToStream(t.join(""),"text_in",n),r instanceof Ct){if(r.j!==e)throw e.l=!1,e.A=void 0,Error("The LoRA model was not loaded by this LLM Inference task.");e.j.addUintToStream(r.i,"lora_model_id_to_apply_in",n)}else e.j.addEmptyPacketToStream("lora_model_id_to_apply_in",n);return e.finishProcessing(),e.o=new zi,e.o.promise}var T=class extends Mt{constructor(e,t){if(super(new Vt(e,t)),this.G=[],this.O=this.B=this.l=!1,this.D=[],this.K=r=>{if((r=r.error).message.match(/exceeds the max buffer size limit/))throw Error(`Failed to run this LLM model because it requires a buffer size that exceeds the maximum size your device supports, but you could try a smaller LLM model or different device.
WebGPU throws: "${r.message}"`);if(r.message.match(/is larger than the maximum storage buffer binding size/))throw Error(`Failed to run this LLM model because it requires a storage buffer binding size that exceeds the maximum size your device supports, but you could try a smaller LLM model or different device.
WebGPU throws: "${r.message}"`);this.D.push(r)},this.i=new Bi,Lr(this.i,new wr),this.u=new Ie,re(this.i,3,this.u),ke(this.i,2,512),e=this.u,!Te(2))throw ze("enum");N(e,1,2,0),z(this.u,2,40),N(this.u,3,At(1),0),ue(this.u,5,Nt(0)),N(this.u,4,At(.8),0),ke(this.i,5,1)}async N(e){if(this.l)throw Error("Cannot set options while loading or processing.");if(e.baseOptions?.modelAssetPath&&e.baseOptions?.modelAssetBuffer)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");let t;const r=new Promise((s=>{t=s}));if(e.baseOptions?.modelAssetPath){var n=await fetch(e.baseOptions.modelAssetPath.toString());if(!n.ok)throw Error(`Failed to fetch model: ${e.baseOptions.modelAssetPath} (${n.status})`);if(!n.body)throw Error(`Failed to fetch model: ${e.baseOptions.modelAssetPath} (no body)`);n=n.body.getReader()}else e.baseOptions?.modelAssetBuffer instanceof Uint8Array?n=(function(s){return new ReadableStream({start(){},async pull(a){a.enqueue(s),a.close()}})})(e.baseOptions.modelAssetBuffer).getReader():e.baseOptions?.modelAssetBuffer instanceof ReadableStreamDefaultReader?(n=e.baseOptions.modelAssetBuffer,e.baseOptions.modelAssetBuffer=void 0):t();if(!n)throw Error("No model asset provided.");{const[s,a]=Sr(n);this.O=await(async function(l){const u=[];let c;for(const[f,_]of ji){const S=f;var p=_;[l,c]=Sr(l),p=await p(c),await c.cancel(),p&&u.push(S)}if(await l.cancel(),u.length===0)throw Error("No model format matched.");if(u.length===1)return u[0];throw Error(`Multiple model formats matched: ${u}`)})(a)===1;var i="maxNumImages"in e&&e.maxNumImages?e.maxNumImages:0;ke(this.i,7,i);var o="supportAudio"in e&&!!e.supportAudio;ue(this.i,8,le(o)),this.O||i>0||o?(this.B=!0,n=s):(this.B=!1,this.U=An(s,t))}if(e.baseOptions?.gpuOptions?.device&&(this.C&&this.C.removeEventListener("uncapturederror",this.K),this.C=e.baseOptions.gpuOptions.device,this.j.fa(this.C),this.C.addEventListener("uncapturederror",this.K)),"maxTokens"in e&&ke(this.i,2,e.maxTokens??512),"topK"in e&&z(this.u,2,e.topK??40),"temperature"in e&&N(this.u,4,At(e.temperature??.8),0),"randomSeed"in e&&ue(this.u,5,Nt(e.randomSeed??0)),"loraRanks"in e&&(function(s,a){sn(s,4,a)})(this.i,e.loraRanks??[]),"numResponses"in e){if((i=e.numResponses??1)<1)throw Error("'numResponses' must be at least 1.");if(this.B&&i>1)throw Error("'numResponses > 1' is not supported for converted LLM models yet, and is also not supported with multimodality.");ke(this.i,5,i),o=He(this.i,Ie,3),i>1&&o&&(o.j()<=1||(F(o,4,qr)??0)<=0)&&console.warn("To generate multiple responses, it is expected topK > 1 and temperature > 0; otherwise, all the generated responses may be the same.")}return"forceF32"in e&&e.forceF32!==void 0&&ue(this.i,6,le(e.forceF32)),this.B?(this.j.V(),this.O?this.j.aa(n,this.i).then((()=>{ye(this)})):this.j.createLlmInferenceEngine(n,this.i).then((()=>{ye(this)}))):(this.l=!0,e=Wi(this).then((()=>{})),Promise.all([r,e]).then((()=>{this.l=!1,ye(this)})))}get baseOptions(){return He(this.i,wr,1)}set baseOptions(e){Lr(this.i,e)}get isIdle(){return!this.l&&!this.o}R(e,t,r){return L(this.i,5)>1&&console.warn("'numResponses' is set larger than 1 and this function only returns the first response, so we recommend either using 'generateResponses()' to obtain multiple responses, or else setting 'numResponses' to 1 for better performance."),this.A=!1,Nr(this,e,t,r).then((n=>n[0]))}ca(e,t,r){return this.A=!0,Nr(this,e,t,r)}S(e){if(e=Array.isArray(e)?e:[e],this.B)return this.j.S(e);if(this.l)throw Error("Previous invocation or loading is still ongoing.");if(e.some(Ve))throw Error("sizeInTokens requires maxNumImages > 0 for images.");if(e.some(Ce))throw Error("sizeInTokens requires supportAudio for audio.");return e=e.join(""),this.l=!0,this.T=void 0,this.j.addStringToStream(e,"token_cost_in",this.I+1),this.finishProcessing(),this.l=!1,this.T}async ia(e){if(this.B)throw Error("LoRA is not supported for converted LLM models (.task format) yet, nor is it supported for multimodality. Please use the old format (.bin) without multimodality to use LoRA.");if(this.l)throw Error("Cannot load LoRA model while loading or processing.");if(this.l=!0,e instanceof Uint8Array){var t=new Tn(this.j.h,e.length);t.set(e),e=t}else e=e instanceof Blob?await(async function(n,i){return jr(n,i.stream(),i.size)})(this.j.h,e):await(async function(n,i){i=await fetch(i.toString());const o=Number(i.headers.get("content-length"));if(!i.body)throw Error("Response body is not available.");if(!o)throw Error("File size is 0.");return jr(n,i.body,o)})(this.j.h,e);t=new Ct(this);const r=this.I+1;return this.j.Y(e,r),this.j.addUintToStream(t.i,"lora_model_id_to_load_in",r),this.finishProcessing(),In(e),ge(this,r),this.l=!1,t}close(){this.B&&this.j.V(),this.C?.removeEventListener("uncapturederror",this.K),super.close()}};T.prototype.loadLoraModel=T.prototype.ia,T.prototype.sizeInTokens=T.prototype.S,T.prototype.generateResponses=T.prototype.ca,T.prototype.generateResponse=T.prototype.R,T.prototype.setOptions=T.prototype.N,T.createWebGpuDevice=Xe,T.createFromModelPath=async function(e,t){return Ot(e,t={baseOptions:{gpuOptions:{device:await Xe()},modelAssetPath:t}})},T.createFromModelBuffer=async function(e,t){return Ot(e,t={baseOptions:{gpuOptions:{device:await Xe()},modelAssetBuffer:t}})},T.createFromOptions=async function(e,t){if(!t.baseOptions?.gpuOptions?.device){const r=await Xe();t.baseOptions=t.baseOptions??{},t.baseOptions.gpuOptions=t?.baseOptions?.gpuOptions??{},t.baseOptions.gpuOptions.device=r}return Ot(e,t)};var Hi=Un('<div class="container svelte-1jdyw6o"><h1>Gemma 3 Web Explorer</h1> <div> </div> <div class="chat-interface"><textarea placeholder="Ask your fine-tuned model anything..." class="svelte-1jdyw6o"></textarea> <button class="svelte-1jdyw6o"> </button></div> <div class="output-panel svelte-1jdyw6o"><strong>Output:</strong> <p class="response svelte-1jdyw6o"> </p></div></div>');function Qi(e,t){xn(t,!0);let r=Oe(null),n=Oe(""),i=Oe("System ready. Waiting for model initialization..."),o=Oe(!1),s=Oe(!1);const a="/models/functiongemma_finetuned_fp16_ekv1024.bin";kn(()=>{async function ie(){try{const ce=await ae.forGenAiTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-genai/wasm");G(r,await T.createFromOptions(ce,{baseOptions:{modelAssetPath:a},maxTokens:1024,temperature:.4,topK:40})),G(s,!0),G(i,"FunctionGemma is ready!")}catch(ce){console.error("Model load error:",ce),G(i,`Error: ${ce instanceof Error?ce.message:"Failed to load model"}`)}}return ie(),()=>{v(r)&&v(r).close()}});async function l(){if(!v(n)||!v(r)||v(o)){console.log("promp:",v(n),v(r),v(o));return}G(o,!0),G(i,"");try{await v(r).generateResponse(v(n),(ie,ce)=>{G(i,v(i)+ie)})}catch(ie){G(i,"Inference failed. check console."),console.error(ie)}finally{G(o,!1)}}var u=Hi(),c=je(he(u),2);let p;var f=he(c,!0);fe(c);var _=je(c,2),S=he(_);Bn(S);var D=je(S,2);D.__click=l;var C=he(D,!0);fe(D),fe(_);var q=je(_,2),U=je(he(q),2),Q=he(U,!0);fe(U),fe(q),fe(u),Nn(()=>{p=Mn(c,1,"badge svelte-1jdyw6o",null,p,{loaded:v(s)}),St(f,v(s)?"‚óè Local Model Active":"‚óã Downloading Model..."),S.disabled=!v(s)||v(o),D.disabled=!v(s)||v(o),St(C,v(o)?"Thinking...":"Run Inference"),St(Q,v(i))}),Vn(S,()=>v(n),ie=>G(n,ie)),Fn(e,u),Dn()}Rn(["click"]);export{Qi as component};
