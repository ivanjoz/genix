import{a as p,k as oe,c as o,d as se,g as d,b as l,i as s,S as j,r as M,t as u}from"./web-CZ5hrCiI.js";import{t as ce,b as q,L as b,P as Q,N as R}from"./main-C-D57zym.js";import{C as B}from"./Editables-BbVvwxBY.js";import{a as le,I as D}from"./Input-CDYNTxzY.js";import{a as ie,b as de}from"./Modals-CEOOSKqR.js";import{Q as ue}from"./QTable-eWAZW59C.js";import{S as G,m as me,P as pe}from"./app-DXoIs7bk.js";import{u as ge,g as _e,p as $e}from"./productos-C91pzhQp.js";import{u as be}from"./sedes-almacenes-BbHdUNcl.js";import"./http-C-zenNQH.js";import"./store-DGzfqJJ9.js";var Se=u('<div class="search-c4 mr-16 w14rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text>'),fe=u('<div class="flex ai-center c-red"><i class=icon-attention></i>Debe seleccionar un almacén.'),ve=u('<button class="bn1 b-blue mr-08"><i class=icon-floppy></i>Guardar (<!$><!/>)'),he=u('<div class="flex ai-center jc-between mb-06"><div class="flex ai-center"><!$><!/><!$><!/><!$><!/></div><div class="flex ai-center"><!$><!/><button class="bn1 b-green"><i class=icon-plus>'),Ce=u('<div class="w100-10 flex-wrap in-s2"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),xe=u('<div class="flex ai-center jc-end"><div></div><div class="mr-02 ml-02">→</div><div class="c-red ff-bold">'),Pe=u('<div class="c-red ff-bold">'),ke=u("<i class=icon-ok>");function je(){const[g,h]=p([]),[C]=ge(),[w]=be(),[E,J]=p({almacenID:0}),[_,W]=p({}),[S,T]=p(-1),[i,U]=p(new Set),[X,Y]=p(!1);let x=new Map;const F=async e=>{let t=[];b.standard("Obteniendo Registros...");try{t=await _e(e)}catch{b.remove();return}console.log("productos stock::",t),h(t),Q.setValue("almacen_id",e);for(let r of t){const a=[r.ProductoID,r.SKU||"0",r.Lote||"0"].join("_");x.set(a,r)}b.remove()};oe(()=>{if(S()==-1&&w()?.Almacenes?.length>0){const e=E();e.almacenID=Q.getValueInt("almacen_id")||0,e.almacenID||(e.almacenID=w().Almacenes[0].ID),T(e.almacenID),J({...e}),F(e.almacenID)}});const Z=e=>{if(!e.ProductoID||!e.Cantidad){R.failure("Debe seleccionar un producto y asignar una cantidad.");return}const t=[e.ProductoID,e.SKU||"0",e.Lote||"0"].join("_"),r=g();if(i().add(t),x.has(t)){const a=x.get(t);a.Cantidad=e.Cantidad,a.CostoUn=e.CostoUn||a.CostoUn,a._cantidadPrev=a._cantidadPrev||a.Cantidad||-1,a._hasUpdated=!0}else x.set(t,e),r.unshift(e),e._cantidadPrev=-1,e.AlmacenID=S(),e._hasUpdated=!0;U(new Set(i())),h([...r]),W({})},ee=async()=>{const e=g().filter(r=>r._hasUpdated);if(e.length===0){R.failure("No hay registros a actualizar.");return}b.standard("Enviando registros...");let t;try{t=await $e(e)}catch{b.remove();return}for(let r of e)r._cantidadPrev=0;console.log("resultado obtenido::",t),h([...g()]),b.remove()},[z,te]=p(""),re=(e,t)=>{const r=new Set(e.map(c=>c.ProductoID)),a=[...e];for(let c of C().productos)r.has(c.ID)||a.push({AlmacenID:t,ProductoID:c.ID,Cantidad:0,_isVirtual:!0});return a};return o(pe,{title:"Almacén Stock",get children(){return[(()=>{var e=d(he),t=e.firstChild,r=t.firstChild,[a,c]=l(r.nextSibling),$=a.nextSibling,[P,L]=l($.nextSibling),k=P.nextSibling,[N,A]=l(k.nextSibling),f=t.nextSibling,O=f.firstChild,[I,V]=l(O.nextSibling),K=I.nextSibling;return s(t,o(G,{get saveOn(){return E()},save:"almacenID",css:"w20rem s6 mb-02 mr-12",label:"",keys:"ID.Nombre",get options(){return w()?.Almacenes||[]},placeholder:" ALMACÉN",onChange:n=>{if(T(n?.ID||0),n){F(n.ID);return}}}),a,c),s(t,o(j,{get when(){return S()>0},get children(){return[(()=>{var n=d(Se),m=n.firstChild,v=m.nextSibling;return v.$$keyup=y=>{y.stopPropagation(),ce(()=>{te((y.target.value||"").toLowerCase().trim())},150)},M(),n})(),o(le,{label:"Todos Productos",get checked(){return X()},onChange:n=>{Y(n);let m=[];n?m=re(g(),S()):m=g().filter(v=>!v._isVirtual),h(m)}})]}}),P,L),s(t,o(j,{get when(){return!S()},get children(){return d(fe)}}),N,A),s(f,o(j,{get when(){return i().size>0},get children(){var n=d(ve),m=n.firstChild,v=m.nextSibling,y=v.nextSibling,[H,ae]=l(y.nextSibling);return H.nextSibling,n.$$click=ne=>{ne.stopPropagation(),ee()},s(n,()=>i().size,H,ae),M(),n}}),I,V),K.$$click=n=>{n.stopPropagation(),ie([2])},M(),e})(),o(ue,{get data(){return g()},css:"w-page-t",tableCss:"",maxHeight:"calc(80vh - 13rem)",get filterText(){return z()},makeFilter:e=>C().productosMap.get(e.ProductoID)?.Nombre||"",columns:[{header:"Producto",css:"",render:e=>{const t=C().productosMap.get(e.ProductoID)?.Nombre||`P-${e.ProductoID}`;return me(t,z())}},{header:"Lote",css:"c-purple",getValue:e=>e.Lote},{header:"SKU",css:"c-purple",getValue:e=>e.SKU},{header:"Propiedades",css:"",getValue:e=>""},{header:"Stock",cardColumn:[3,2],field:"Nombre",css:"t-r",headerStyle:{width:"8rem"},render:e=>o(B,{saveOn:e,save:"",contentClass:"px-06 flex ai-center jc-end",inputClass:"t-c",type:"number",getValue:()=>e.Cantidad,onChange:t=>{if(e.Cantidad===t)return;e._cantidadPrev=e._cantidadPrev||e.Cantidad||-1,e.Cantidad=parseInt(t||"0"),e._hasUpdated=!0;const r=[e.ProductoID,e.SKU||"0",e.Lote||"0"].join("_");i().add(r),U(new Set(i()))},render:()=>{if(e._cantidadPrev&&e._cantidadPrev!==e.Cantidad){const t=e._cantidadPrev===-1?0:e._cantidadPrev;return(()=>{var r=d(xe),a=r.firstChild,c=a.nextSibling,$=c.nextSibling;return s(a,t),s($,()=>e.Cantidad),r})()}else return e.Cantidad?String(e.Cantidad):(()=>{var t=d(Pe);return s(t,()=>e.Cantidad),t})()}})},{header:"Costo UN",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",getValue:e=>e.CostoUn?q(e.CostoUn,2):"",render:e=>o(B,{saveOn:e,save:"CostoUn",contentClass:"px-06 flex ai-center jc-end",inputClass:"t-c",type:"number",onChange:t=>{e._hasUpdated=!0;const r=[e.ProductoID,e.SKU||"0",e.Lote||"0"].join("_");i().add(r),U(new Set(i()))},render:()=>e.CostoUn?q(e.CostoUn,2):""})},{header:"Stock Min",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",getValue:e=>""}]}),o(de,{title:"Nuevo Producto Stock",id:2,css:"py-12 px-12",get buttonSave(){return[d(ke),"Agregar"]},onSave:()=>{Z(_())},get children(){var e=d(Ce),t=e.firstChild,[r,a]=l(t.nextSibling),c=r.nextSibling,[$,P]=l(c.nextSibling),L=$.nextSibling,[k,N]=l(L.nextSibling),A=k.nextSibling,[f,O]=l(A.nextSibling),I=f.nextSibling,[V,K]=l(I.nextSibling);return s(e,o(G,{get saveOn(){return _()},save:"ProductoID",css:"w-24x mb-10",label:"Producto1",keys:"ID.Nombre",get options(){return C()?.productos||[]},placeholder:" ",required:!0}),r,a),s(e,o(D,{get saveOn(){return _()},save:"SKU",css:"w-16x mb-10",label:"SKU"}),$,P),s(e,o(D,{get saveOn(){return _()},save:"Cantidad",required:!0,css:"w-08x mb-10",label:"Cantidad",type:"number"}),k,N),s(e,o(D,{get saveOn(){return _()},save:"Lote",css:"w-16x mb-10",label:"Lote",type:"text"}),f,O),s(e,o(D,{get saveOn(){return _()},save:"CostoUn",css:"w-08x mb-10",label:"Costo x Unidad",type:"number"}),V,K),e}})]}})}se(["keyup","click"]);export{je as default};
