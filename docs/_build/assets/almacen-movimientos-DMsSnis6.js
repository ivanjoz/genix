import{a as p,k as H,c as i,d as j,g as v,b as h,i as r,r as q,e as B,t as $,f as R}from"./web-BZ6LonWj.js";import{D as S}from"./Datepicker-CBN0ZvJN.js";import{Q as V}from"./QTable-DpMhOfGM.js";import{S as K,m as A,P as Q}from"./app-B5wVexcE.js";import{e as z,o as G,t as J,f as W,L as b}from"./Input-Cf7HKpQs.js";import{u as X,m as Y,q as Z}from"./productos-CLBJZEeQ.js";import{u as ee}from"./sedes-almacenes-CJUuScrB.js";var te=$('<div class="flex a-center"><div class=mr-08></div><div class="ff-mono c-blue">(</div><div class=ff-mono></div><div class="ff-mono c-blue">)'),ae=$('<div class="flex ai-center jc-between mb-06"><div class="flex ai-center w100-10"><!$><!/><!$><!/><!$><!/><button class="bn1 b-blue ml-10"><i class=icon-search></i></button></div><div class="search-c4 mr-16 w14rem ml-auto"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text>'),re=$("<div>");function de(){X();const[m]=ee(),x=G.getFechaUnix(),P=x-7,[a,w]=p({fechaFin:x,fechaInicio:P,almacenID:0}),[I,M]=p([]);H(()=>{const e=(m().Almacenes||[])[0]?.ID;e&&e!==a().almacenID&&w({...a(),almacenID:e})});const d=new Map,u=new Map,y=z(Y,"id"),D=async()=>{b.standard("Consultando registros...");let e;try{e=await Z(a())}catch{b.remove();return}console.log("registros obtenidos: ",e);for(let t of e.Productos)u.set(t.ID,t);for(let t of e.Usuarios)d.set(t.id,t);M(e.Movimientos),b.remove()},[f,k]=p(""),_=(e,t)=>{if(!e)return"";const s=m().AlmacenesMap.get(e)?.Nombre||`Almacen-${e}`;return(()=>{var n=v(te),c=n.firstChild,g=c.nextSibling,l=g.nextSibling;return r(c,s),r(l,t),n})()};return i(Q,{title:"Almacén Stock",get children(){return[(()=>{var e=v(ae),t=e.firstChild,s=t.firstChild,[n,c]=h(s.nextSibling),g=n.nextSibling,[l,F]=h(g.nextSibling),T=l.nextSibling,[C,N]=h(T.nextSibling),O=C.nextSibling,U=t.nextSibling,E=U.firstChild,L=E.nextSibling;return t.style.setProperty("max-width","64rem"),r(t,i(K,{get saveOn(){return a()},save:"almacenID",css:"w-08x mb-02 mr-12",label:"Almacén",keys:"ID.Nombre",get options(){return m()?.Almacenes||[]},placeholder:"",required:!0,onChange:o=>{}}),n,c),r(t,i(S,{label:"Fecha Inicio",css:"w-045x",save:"fechaInicio",get saveOn(){return a()}}),l,F),r(t,i(S,{label:"Fecha Fin",css:"w-045x",save:"fechaFin",get saveOn(){return a()}}),C,N),O.$$click=o=>{o.stopPropagation(),D()},L.$$keyup=o=>{o.stopPropagation(),J(()=>{k((o.target.value||"").toLowerCase().trim())},150)},q(),e})(),i(V,{get data(){return I()},css:"w100",tableCss:"w-page-t w100",maxHeight:"calc(100vh - 8rem - 12px)",makeFilter:e=>{const t=u.get(e.ProductoID)?.Nombre||"",s=d.get(e.CreatedBy||1)?.usuario||"";return[t,s].join(" ")},get filterText(){return f()},columns:[{header:"Fecha Hora",css:"ff-mono",getValue:e=>W(e.Created,"d-M h:n")},{header:"Producto",css:"",render:e=>{const t=u.get(e.ProductoID)?.Nombre||`Producto-${e.ProductoID}`;return A(t,f())}},{header:"Lote",css:"c-purple t-c",getValue:e=>e.Lote},{header:"SKU",css:"c-purple t-c",getValue:e=>e.SKU},{header:"Movimiento",css:"t-c",render:e=>y.get(e.Tipo)?.name||"-"},{header:"Cantidad",css:"t-r ff-mono",render:e=>(()=>{var t=v(re);return r(t,()=>e.Cantidad),B(()=>R(t,"flex jc-end "+(e.Cantidad<0?"c-red":"c-blue"))),t})()},{header:"Almacén Origen",css:"",render:e=>_(e.AlmacenOrigenID,e.AlmacenOrigenCantidad)},{header:"Almacén Destino",css:"",render:e=>_(e.AlmacenID,e.AlmacenCantidad)},{header:"Usuario",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",render:e=>{const t=d.get(e.CreatedBy||1)?.usuario||`Usuario-${e.CreatedBy}`;return A(t,f())}}]})]}})}j(["click","keyup"]);export{de as default};
