import{d as C,a as S,i as _,f as $,b as f,e as w,j as x,s as P,t as h}from"./web-B5q02dNy.js";import{K as v,O as U,N as D}from"./app-BWK4gxn2.js";var L=h("<div>"),z=h('<div><input type=file accept="image/png, image/jpeg, image/webp"><div><i class=icon-upload></i></div><div class=h5>Subir Imagen'),R=h("<picture class=dsp-cont><img>"),E=h("<source type=image/avif>"),N=h("<source type=image/webp>"),k=h("<div><div><button><i class=icon-cancel>"),A=h("<textarea rows=3 placeholder=Nombre...>"),B=h('<button class="bnr2 b-blue"><i class=icon-ok>'),M=h('<div><div class="c-white h3 ff-bold">Loading...');const q=s=>{const[e,c]=S(s||{src:""}),[p,d]=S(s.src?-1:0),m=async r=>{const t=r.target.files[0];console.log("imagefile::",t);const i=await F({source:t,size:1.2,quality:.89});d(-1),c({src:i})},y=async()=>{let r;d(.001);const a={Content:e().src,Folder:"img-uploads",Description:e().description};s.setDataToSend&&s.setDataToSend(a);try{r=await U({data:a,route:s.saveAPI||"images",refreshIndexDBCache:s.refreshIndexDBCache||"",onUploadProgress:t=>{const i=Math.round(t.loaded*100/t.total);console.log("progress:: ",i),d(i)}})}catch(t){D.failure("Error guardando la imagen:",t);return}s.clearOnUpload?(c({src:""}),d(0)):(d(-1),c({src:`${r.imageName}-x2`,types:["webp","avif"]})),s.onUploaded&&s.onUploaded(r.imageName)},u=()=>e().src?.length>0&&(e()?.types||[]).length===0,g=()=>{let r=e().src;return r.substring(0,5)!=="data:"&&r.substring(0,8)!=="https://"&&r.substring(0,7)!=="http://"&&(r=window.S3_URL+r),r};return(()=>{var r=L();return _(r,(()=>{var a=$(()=>(e()?.src||"").length===0);return()=>a()&&(()=>{var t=z(),i=t.firstChild,l=i.nextSibling;return i.addEventListener("change",n=>m(n)),l.style.setProperty("font-size","2.4rem"),f(()=>w(t,`w100 h100 p-rel flex-column ai-center jc-center ${v.card_input_layer}`)),t})()})(),null),_(r,(()=>{var a=$(()=>e()?.src?.length>0);return()=>a()&&(()=>{var t=R(),i=t.firstChild;return _(t,(()=>{var l=$(()=>!!e().types?.includes("avif"));return()=>l()&&(()=>{var n=E();return f(()=>x(n,"srcset",g()+".avif")),n})()})(),i),_(t,(()=>{var l=$(()=>!!e().types?.includes("webp"));return()=>l()&&(()=>{var n=N();return f(()=>x(n,"srcset",g()+".webp")),n})()})(),i),f(l=>{var n=`w100 h100 p-abs ${v.card_image_img1}`,o=g()+(e().types?.length>0?`.${e().types[0]}`:"");return n!==l.e&&w(i,l.e=n),o!==l.t&&x(i,"src",l.t=o),l},{e:void 0,t:void 0}),t})()})(),null),_(r,(()=>{var a=$(()=>p()==-1);return()=>a()&&(()=>{var t=k(),i=t.firstChild,l=i.firstChild;return _(t,(()=>{var n=$(()=>!!u());return()=>n()&&(()=>{var o=A();return o.addEventListener("blur",b=>{b.stopPropagation(),e().description=b.target.value||""}),f(()=>w(o,`w100 ${v.card_image_textarea}`)),o})()})(),i),l.$$click=n=>{if(n.stopPropagation(),s.onDelete){s.onDelete(s.src);return}c({src:""}),d(0)},_(i,(()=>{var n=$(()=>!!u());return()=>n()&&(()=>{var o=B();return o.$$click=b=>{b.stopPropagation(),y()},o})()})(),null),f(n=>{var o=`w100 h100 p-abs ${v.card_image_layer}${u()?" s1":""}`,b=`w100 p-abs flex-center ${v.card_image_layer_botton}`,I=`bnr2 b-red mr-04 ${u()?"":v.card_image_layer_bn_close2}`;return o!==n.e&&w(t,n.e=o),b!==n.t&&w(i,n.t=b),I!==n.a&&w(l,n.a=I),n},{e:void 0,t:void 0,a:void 0}),t})()})(),null),_(r,(()=>{var a=$(()=>p()>0);return()=>a()&&(()=>{var t=M();return f(()=>w(t,`w100 h100 p-abs flex-center ${v.card_image_layer_loading}`)),t})()})(),null),f(a=>{var t=`p-rel ${v.card_image_1} ${e()?.src?"":v.card_input}`,i=s.cardStyle;return t!==a.e&&w(r,a.e=t),a.t=P(r,i,a.t),a},{e:void 0,t:void 0}),r})()},j=(s,e,c,p,d)=>{const m=document.createElement("canvas");return m.width=e,m.height=c,m.getContext("2d").drawImage(s,0,0,e,c),new Promise(u=>{m.toBlob(g=>{g=g;const r=new FileReader;r.readAsDataURL(g),r.onloadend=()=>{const a=r.result;u(a)}},p,d)})},F=s=>{const e=document.createElement("canvas"),c=new Image;return new Promise((p,d)=>{c.onload=()=>{s.originalSize=[c.width,c.height],e.width=s.originalSize[0],e.height=s.originalSize[1];const m=s.size*1e3*1e3,y=e.width*e.height;let u=e.width,g=e.height;if(y>m){const a=(y/m)**.5;u=Math.floor(e.width/a),g=Math.floor(e.height/a)}e.getContext("2d").drawImage(c,0,0,e.width,e.height),console.log("args 11::",s),j(e,u,g,"image/webp",s.quality).then(a=>{p(a)}).catch(a=>{d(a)})},c.src=URL.createObjectURL(s.source),console.log("Data-URL::",c.src)})};C(["click"]);export{q as I};
