import{a as J,k as W,c as s,d as fe,S as B,g as c,r as P,b as $,i as n,e as ve,F as xe,t as u,l as Se}from"./web-BZ6LonWj.js";import{t as U,f as Z,I as y,N as z,L as V}from"./Input-Cf7HKpQs.js";import{C as Ce}from"./Editables-DkdxoLzM.js";import{s as q,o as ye,M as ee,S as we,a as De}from"./Modals-D1JuGy2b.js";import{Q as te}from"./QTable-DpMhOfGM.js";import{f as re,S as le,P as Ie}from"./app-B5wVexcE.js";import{u as Ne,a as Ae,p as Pe,b as Oe}from"./sedes-almacenes-CJUuScrB.js";import{a as ae,m as ke}from"./simple-statistics-CHr0eFhd.js";var Le=u('<div class="flex ai-center jc-between mb-06"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus>'),Ve=u('<div class=w100><div class="flex ai-center jc-between mb-06"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button></div></div><!$><!/>'),qe=u('<div class="flex-wrap ai-start w100-10"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),Ee=u('<div class="flex-wrap ai-start w100-10"><!$><!/><!$><!/><!$><!/>'),se=u('<button class="bnr2 b-blue b-card-1"><i class=icon-pencil>'),Y=u('<div class="ff-bold h3">'),je=u("<i class=icon-folder-empty>"),ne=u('<div class="mr-04 ml-04 h6 c-steel">X'),Fe=u("<i class=icon-buffer>"),ze=u("<i class=icon-cube>"),Te=u('<div class="w100 flex ai-center jc-between"><div class="flex ai-center"></div><button class="bnr2 b-blue b-card-1"><i class=icon-pencil>'),Me=u("<div class=box-error-ms>No hay espacios en al almacén. Agregue uno pulsando en (+)"),Re=u('<div class="w100 h100 p-rel"><div class="flex jc-between w100 mb-08"><div></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button></div></div><div class="overflow-auto pad-sr6"><!$><!/><!$><!/>'),Je=u('<div class="card-c12p w100 mb-12"><div class="w100 flex ai-center jc-between px-08 py-08"><div class="flex ai-center"><!$><!/><span class="ff-bold c-steel">Filas</span><!$><!/><span class="ff-bold c-steel">Niveles</span><!$><!/></div><button class="bnr4 b-red"><i class=icon-trash></i></button></div><table class=w100><thead><tr><th>-</th><!$><!/></tr></thead><tbody>'),Be=u("<th>"),He=u("<tr><td class=t-c></td><!$><!/>"),Qe=u('<td class="p-rel py-02 px-02">');function rt(){const[T,_]=J(""),[g,w]=J({}),[m,C]=J({}),[f,M]=Ne(),[I]=Ae(),R=.48;W(()=>{for(let e of I()?.distritos||[])e._nombre=`${e.Departamento?.Nombre||"-"} ► ${e.Provincia?.Nombre||""} ► ${e.Nombre}`});const E=async e=>{const t=g();if((t.Nombre?.length||0)<4||(t.Direccion?.length||0)<4){z.failure("El nombre y la dirección deben tener al menos 4 caracteres.");return}console.log("guardando sede::",t),V.standard("Creando /Actualizando Sede...");try{var o=await Pe(t)}catch(a){z.failure(a),V.remove();return}let r=[...f().Sedes];if(t.ID){const a=f().Sedes.find(i=>i.ID===t.ID);a&&Object.assign(a,t),e&&(r=r.filter(i=>i.ID!==t.ID))}else t.ID=o.ID,r.unshift(t);M({...f(),sedes:r}),q([]),V.remove()},j=async e=>{const t=m();if((t.Nombre?.length||0)<4){z.failure("El nombre debe tener al menos 4 caracteres.");return}else if(!t.SedeID){z.failure("Debe seleccionar una sede.");return}console.log("guardando almacen::",t),V.standard("Creando /Actualizando Almacén...");try{var o=await Oe(t)}catch(a){z.failure(a),V.remove();return}let r=[...f().Almacenes];if(t.ID){const a=f().Almacenes.find(i=>i.ID===t.ID);a&&Object.assign(a,t),e&&(r=r.filter(i=>i.ID!==t.ID))}else t.ID=o.ID,r.unshift(t);M({...f(),Almacenes:r}),q([]),V.remove()};return s(Ie,{title:"Sedes & Almacenes",views:[[1,"Sedes"],[2,"Almacenes"]],accesos:[5],get children(){return[s(B,{get when(){return re()===1},get children(){return[(()=>{var e=c(Le),t=e.firstChild,o=t.firstChild,r=o.nextSibling,a=t.nextSibling,i=a.firstChild;return r.$$keyup=p=>{p.stopPropagation(),U(()=>{_((p.target.value||"").toLowerCase().trim())},150)},i.$$click=p=>{p.stopPropagation(),w({ss:1}),q([1])},P(),e})(),s(te,{get data(){return f().Sedes||[]},css:"w100",maxHeight:"calc(80vh - 13rem)",style:{height:"100%"},columns:[{header:"ID",headerStyle:{width:"3.4rem"},css:"t-c c-purple",getValue:e=>e.ID,cardColumn:[1,2]},{header:"Nombre",cardColumn:[1,1],getValue:e=>e.Nombre,cardCss:"h5 c-steel"},{header:"Dirección",cardColumn:[1,2],getValue:e=>e.Direccion,cardCss:"h5 c-steel"},{header:"Ciudad",cardColumn:[3,2],getValue:e=>{if(!e.Ciudad)return"";const t=e.Ciudad.split("|");return t[1]+" > "+t[0]}},{header:"Actualizado",headerStyle:{width:"9rem"},css:"nowrap",getValue:e=>Z(e.upd,"Y-m-d h:n")},{header:"...",headerStyle:{width:"2.6rem"},css:"t-c",cardColumn:[1,2],render:(e,t)=>{const o=r=>{r.stopPropagation(),q([1]),w({...e})};return(()=>{var r=c(se);return r.$$click=o,P(),r})()}}]})]}}),s(B,{get when(){return re()===2},get children(){var e=c(Ve),t=e.firstChild,o=t.firstChild,r=o.firstChild,a=r.nextSibling,i=o.nextSibling,p=i.firstChild,d=t.nextSibling,[b,v]=$(d.nextSibling);return a.$$keyup=l=>{l.stopPropagation(),U(()=>{_((l.target.value||"").toLowerCase().trim())},150)},p.$$click=l=>{l.stopPropagation(),C({ss:1}),q([2])},n(e,s(te,{get data(){return f().Almacenes||[]},tableCss:"w-page-t",get style(){return{width:ye().length>0?`calc(var(--page-width) * ${1-R})`:void 0}},maxHeight:"calc(80vh - 13rem)",columns:[{header:"ID",headerStyle:{width:"3.4rem"},css:"t-c c-purple",getValue:l=>l.ID},{header:"Sede",cardColumn:[3,2],getValue:l=>f().SedesMap.get(l.SedeID)?.Nombre||`Sede-${l.SedeID}`,cardCss:"h5 c-steel"},{header:"Nombre",cardColumn:[3,2],getValue:l=>l.Nombre,cardCss:"h5 c-steel"},{header:"Layout",cardColumn:[3,2],render:(l,D)=>{const N=h=>{h.stopPropagation(),De([1]),C(JSON.parse(JSON.stringify(l)))};return(()=>{var h=c(Te),O=h.firstChild,k=O.nextSibling;return n(O,s(B,{get when(){return l.Layout?.length>0},get children(){return[(()=>{var x=c(Y);return n(x,()=>l.Layout.length),x})(),c(je),c(ne),(()=>{var x=c(Y);return n(x,()=>ae(l.Layout.map(F=>F.ColCant))),x})(),c(Fe),c(ne),(()=>{var x=c(Y);return n(x,()=>ae(l.Layout.map(F=>F.RowCant))),x})(),c(ze)]}})),k.$$click=N,P(),h})()}},{header:"Estado",cardColumn:[3,2],getValue:l=>l.ss,cardCss:"h5 c-steel"},{header:"Actualizado",headerStyle:{width:"9rem"},css:"nowrap",getValue:l=>Z(l.upd,"Y-m-d h:n")},{header:"...",headerStyle:{width:"2.6rem"},css:"t-c",cardColumn:[1,2],render:(l,D)=>{const N=h=>{h.stopPropagation(),q([2]),C(JSON.parse(JSON.stringify(l)))};return(()=>{var h=c(se);return h.$$click=N,P(),h})()}}]}),b,v),P(),e}}),s(ee,{id:1,css:"w56-78 in-s2",get title(){return(g()?.ID>0?"Actualizar":"Crear")+" Sede"},onSave:()=>{console.log("sede a guardar::",g()),E()},onDelete:()=>{E(!0)},get children(){var e=c(qe),t=e.firstChild,[o,r]=$(t.nextSibling),a=o.nextSibling,[i,p]=$(a.nextSibling),d=i.nextSibling,[b,v]=$(d.nextSibling),l=b.nextSibling,[D,N]=$(l.nextSibling),h=D.nextSibling,[O,k]=$(h.nextSibling);return n(e,s(y,{get saveOn(){return g()},save:"Nombre",css:"w-10x mb-10",label:"Nombre",required:!0,get disabled(){return g()?.ID>0}}),o,r),n(e,s(y,{get saveOn(){return g()},save:"Descripcion",css:"w-14x mb-10",label:"Descripción"}),i,p),n(e,s(y,{get saveOn(){return g()},save:"Telefono",css:"w-10x mb-10",label:"Teléfono",get disabled(){return g()?.ID>0}}),b,v),n(e,s(y,{get saveOn(){return g()},save:"Direccion",css:"w-14x mb-10",label:"Dirección",required:!0}),D,N),n(e,s(le,{get options(){return I().distritos},required:!0,label:"Departamento | Provincia | Distrito",css:"w-24x mb-10",keys:"ID._nombre",get saveOn(){return g()},save:"CiudadID"}),O,k),e}}),s(ee,{id:2,css:"w56-78 in-s2",get title(){return(m()?.ID>0?"Actualizar":"Crear")+" Almacén"},onSave:()=>{console.log("almacen a guardar::",m()),j()},onDelete:()=>{j(!0)},get children(){var e=c(Ee),t=e.firstChild,[o,r]=$(t.nextSibling),a=o.nextSibling,[i,p]=$(a.nextSibling),d=i.nextSibling,[b,v]=$(d.nextSibling);return n(e,s(le,{get options(){return f().Sedes},required:!0,label:"Sede",css:"w-12x mb-10",keys:"ID.Nombre",get saveOn(){return m()},save:"SedeID"}),o,r),n(e,s(y,{get saveOn(){return m()},save:"Nombre",css:"w-12x mb-10",label:"Nombre",required:!0}),i,p),n(e,s(y,{get saveOn(){return m()},save:"Descripcion",css:"w-12x mb-10",label:"Descripción"}),b,v),e}}),s(we,{id:1,style:{width:`calc(var(--page-width) * ${R})`},get title(){return"Layout "+(m()?.Nombre||"-")},onClose:()=>{},onSave:()=>{for(let e of m().Layout||[]){e.Bloques=[];for(let t in e)if(t.substring(0,3)==="xy_"){const[o,r,a]=t.split("_");e.Bloques.push({nm:e[t],rw:parseInt(r),co:parseInt(a)})}}console.log("almacen a guardar::",m()),j()},get children(){return s(Ye,{get almacen(){return m()}})}})]}})}const Ye=T=>{const[_,g]=J([]);return W(Se(()=>[T.almacen],()=>{const w=T.almacen.Layout||[];for(let m of w)for(let C of m.Bloques||[])m[`xy_${C.rw}_${C.co}`]=C.nm;g(w)})),W(()=>{T.almacen.Layout=_()}),(()=>{var w=c(Re),m=w.firstChild,C=m.firstChild,f=C.nextSibling,M=f.firstChild,I=m.nextSibling,R=I.firstChild,[E,j]=$(R.nextSibling),e=E.nextSibling,[t,o]=$(e.nextSibling);return M.$$click=r=>{r.stopPropagation();const a=_().length>0?ke(_().map(i=>i.ID||0)):0;_().push({RowCant:2,ColCant:3,Name:"",ID:a+1}),g([..._()])},I.style.setProperty("max-height","calc(100% - 6.4rem)"),n(I,s(B,{get when(){return _().length===0},get children(){return c(Me)}}),E,j),n(I,s(xe,{get each(){return _()},children:r=>{const a=[],i=[];for(let d=1;d<=(r.ColCant||1);d++)a.push(`${d}`);for(let d=1;d<=(r.RowCant||1);d++)i.push(`${d}`);const p=()=>{const d=[];for(let b of _())b===r&&(b={...b}),d.push(b);g(d)};return(()=>{var d=c(Je),b=d.firstChild,v=b.firstChild,l=v.firstChild,[D,N]=$(l.nextSibling),h=D.nextSibling,O=h.nextSibling,[k,x]=$(O.nextSibling),F=k.nextSibling,ie=F.nextSibling,[ce,oe]=$(ie.nextSibling),H=v.nextSibling,de=b.nextSibling,X=de.firstChild,G=X.firstChild,K=G.firstChild,ue=K.nextSibling,[me,$e]=$(ue.nextSibling),ge=X.nextSibling;return n(v,s(y,{label:"",save:"Name",saveOn:r,css:"w-09x mr-12",inputCss:"s3",required:!0}),D,N),n(v,s(y,{label:"",save:"RowCant",saveOn:r,css:"w-025x",inputCss:"s3",onChange:()=>{p()},type:"number"}),k,x),n(v,s(y,{label:"",save:"ColCant",saveOn:r,css:"s3 w-025x",inputCss:"s3",onChange:()=>{p()},type:"number"}),ce,oe),H.$$click=L=>{L.stopPropagation();const S=_().filter(A=>A!==r);g(S)},H.style.setProperty("margin-top","-12px"),H.style.setProperty("margin-right","-4px"),K.style.setProperty("width","3rem"),n(G,()=>a.map(L=>(()=>{var S=c(Be);return n(S,L),ve(A=>(A=`calc(92% / ${a.length})`)!=null?S.style.setProperty("width",A):S.style.removeProperty("width")),S})()),me,$e),n(ge,()=>i.map(L=>(()=>{var S=c(He),A=S.firstChild,be=A.nextSibling,[pe,he]=$(be.nextSibling);return n(A,L),n(S,()=>a.map(_e=>(()=>{var Q=c(Qe);return Q.style.setProperty("height","2.6rem"),n(Q,s(Ce,{save:`xy_${L}_${_e}`,saveOn:r,class:"s2 t-c flex ai-center",contentClass:"flex ai-center jc-center"})),Q})()),pe,he),S})())),P(),d})()}}),t,o),P(),w})()};fe(["keyup","click"]);export{rt as default};
