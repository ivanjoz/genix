var z=e=>{if(!Array.isArray(e)||e.length!==2)return e;let[t,n]=e;if(!Array.isArray(t))return e;let s={};for(let o of t){if(!Array.isArray(o))continue;let c=o[0],u={},a=-1;for(let h=1;h<o.length;h+=2){let l=o[h],p=o[h+1];u[l]=p,l>a&&(a=l)}s[c]={fields:u,maxIndex:a}}let r=null,d=o=>{if(!Array.isArray(o)||o.length===0)return o;let c=o[0];if(c===1){if(o.length<2)return o;let u=o[1];if(!Array.isArray(u))return o;let a=u[0],h=new Set;for(let l=1;l<u.length;l++)h.add(u[l]);return r=a,i(a,o.slice(2),h)}if(c===0){if(r===null)return o;let u=new Set,a=1;if(Array.isArray(o[1])){let h=o[1],l=!1;if(h.length>0){let p=h[0];typeof p=="number"&&p!==0&&p!==1&&p!==2&&p!==3?l=!0:l=typeof p=="number"&&p!==0&&p!==1&&p!==2&&p!==3}if(l){for(let p of h)typeof p=="number"&&u.add(p);a=2}}return i(r,o.slice(a),u)}if(c===2){let u=[];for(let a=1;a<o.length;a++)u.push(d(o[a]));return u}if(c===3){let u={};for(let a=1;a<o.length;a+=2)if(a+1<o.length){let h=String(o[a]);u[h]=d(o[a+1])}return u}return o.map(d)},i=(o,c,u)=>{let a=s[o];if(!a)return c;let{fields:h,maxIndex:l}=a,p={},f=0;for(let _=0;_<=l;_++){if(u.has(_))continue;if(f>=c.length)break;let y=h[_];y&&(p[y]=d(c[f])),f++}return p};return d(n)};var D=(e,t)=>{if(Array.isArray(e))return e.map(n=>D(n,t));if(typeof e!="object"||!e||!e._)return e;for(let[n,s]of Object.entries(e))if(t.has(n)){let r=t.get(n);if(r===n)continue;e[r]=s,delete e[n]}for(let n=0;n<e._.length;n+=2){let s=t.get(e._[n]);e[s]=D(e._[n+1],t)}return delete e._,e};var B="precache-v2",j="assets-v2",G="static-v2",M="app",w=new Map,se=[],oe=e=>{let t=e.indexOf("?");t!==-1&&(e=e.substring(0,t));let n=e.indexOf("@");n!==-1&&(e=e.substring(0,n)),e=e.substring(e.indexOf("/",8));let s=e.lastIndexOf(".");return e==="/"||(s===-1&&e[2])==="/"?[e,"*"]:[e,e.substring(s+1)]};self.addEventListener("install",e=>{e.waitUntil(caches.open(B).then(t=>t.addAll(se)).then(()=>self.skipWaiting()))});self.addEventListener("activate",e=>{let t=[B,j,G,M];e.waitUntil(self.clients.claim())});var re=e=>{let t=e.indexOf('name="build-version"');if(t===-1)return null;let n=e.indexOf('"',t+28);return e.substring(n+1,n+7)},ie=e=>{let t=Math.floor(Date.now()/1e3),n=parseInt(e.toLowerCase(),36)*10,s=t-n,r=Math.floor(s/60/60),d=Math.floor((s-r*60*60)/60),i=`${r} hora${r===1?"":"s"}`,o=`${i} ${d} min`;return r===0&&(o=`${d} min`),r>12&&(o=`m\xE1s de ${i}`),o},J={build:"",hasUpdated:!1};w.set(99,async e=>({...e,response:"pong"}));self._isLocal=self.origin.includes("localhost")||self.origin.includes("127.0.0.1");var q=0;w.set(7,async e=>{let t=Math.floor(Date.now()/1e3);if(q&&t-q<30)return console.log("Saltando revisi\xF3n de actualizaci\xF3n."),{};let n=e.version;if(!n)return console.log("No se envi\xF3 la version (build) a comparar."),{};let s=await ce(n);return q=t,{versionHasUpdated:s}});var ce=async e=>{J.build=e;let t=new Headers;t.append("pragma","no-cache"),t.append("cache-control","no-cache");try{let s=await(await fetch(self.location.origin+"/app-version",{method:"GET",headers:t})).text(),r=re(s)||"";if(J.build=r,console.log("build code compare fetch:: ",e," | ",r),e!==r)return await caches.delete(j),ie(r)}catch(n){console.warn("Error al obtener la versi\xF3n nueva (HTML)::",n)}return""},L=new Map,V=new Map,Q=new Map,A=(e,t)=>{let n=Q.get(e);n?n(t):console.log("No se encontr\xF3 el handler para el client:",e,"|",t)};self.addEventListener("fetch",e=>{let t=e.request,n=new URL(e.request.url);if(n.pathname.startsWith("/store/")||t.headers.get("X-App-Scope")==="store")return;if(n.pathname==="/_sw_"){e.respondWith((async()=>{let l=parseInt(n.searchParams.get("accion")||"0"),p=parseInt(n.searchParams.get("req")||"0"),f=n.searchParams.get("env")||"main";L.has(e.clientId)||L.set(e.clientId,L.size+1);let _=L.get(e.clientId)||0,y=p*1e3+_,g=V.get(y)||0;if(g&&Date.now()-g<1e3){let x=Date.now()-g;return console.log("El id ",p," est\xE1 duplicado. | Client:",e.clientId,"| Hace:",x,"ms"),new Response(JSON.stringify({Error:"ReqID Duplicado."}),{headers:{"Content-Type":"application/json"}})}V.set(p,Date.now());let m=await self.clients.get(e.clientId);if(!m){console.warn(`No se encontr\xF3 el client con ID ${e.clientId}`);let x={error:`No se encontr\xF3 el client con ID ${e.clientId}`};return new Response(JSON.stringify(x),{headers:{"Content-Type":"application/json"}})}Q.set(_,x=>{m.postMessage(x)});let C=w.get(l);if(!C){console.warn(`No se encontr\xF3 el handler para la acci\xF3n ${l}`);let x={error:`No se encontr\xF3 el handler para la acci\xF3n ${l}`};return new Response(JSON.stringify(x),{headers:{"Content-Type":"application/json"}})}let v=await e.request.clone().json();v.__enviroment__=f,v.__client__=_;let T={...await C(v),__response__:l,__req__:p},R="";return l===3&&(R=[v.route,v.cacheMode,p].join(" | ")),m.postMessage(T),console.log(`Respondiendo Fetch (${R}):`,F(T)),new Response(JSON.stringify({ok:1}),{headers:{"Content-Type":"application/json"}})})());return}if(self._isLocal)return;if(n.searchParams.has("__cache__")){let l=n.searchParams.get("__cache__")||"",[p,f,_]=l.split("."),y=parseInt(p),g=parseInt(f);if(isNaN(y)||isNaN(g))return console.warn(`Invalid __cache__ parameter format: ${l}. Bypassing cache.`),fetch(e.request);n.searchParams.delete("__cache__");let m=n.toString();console.log("buscando cach\xE9:",m),e.respondWith((async()=>{let C=await caches.open(`cache_req_${_}`),b=await C.match(m),v=Math.floor(Date.now()/1e3);if(b){let I=parseInt(b.headers.get("x-cache-timestamp")),T=parseInt(b.headers.get("x-cache-version"));if(I&&T&&v-I<y*60&&T===g)return console.log(`Serving from cache: ${m}`),b;console.log(`Cache stale or version mismatch for ${m}. Fetching new.`)}try{let I=await fetch(e.request);if(I.status===200){let T=I.clone(),R=new Headers(T.headers);R.set("x-cache-timestamp",String(v)),R.set("x-cache-version",String(g));let x=new Response(await T.blob(),{status:T.status,statusText:T.statusText,headers:R});await C.put(m,x),console.log(`Fetched and cached: ${m}`)}else console.log("La consulta fall\xF3::",I.status);return I}catch(I){if(console.error(`Fetch failed for ${m}:`,I),b)return console.log(`Network failed, serving stale cache for ${m}`),b;throw I}})())}let s=t.headers.get("Content-Type");if(console.log("event URL:: ",t.url,"|",s),!t.url.startsWith(self.location.origin))return;let[r,d]=oe(t.url);if(r==="/app-version")return;let i=new URL(t.url),o=i.origin===self.location.origin,c=t.mode==="navigate",u=!i.pathname.includes(".")||i.pathname==="/";d==="*"&&console.log("Re-routing Service Worker:: ",r);let a=["js","css","html","*","ts","mjs","tsx"].includes(d)?j:G,h="/";if(o&&c&&u){e.respondWith(caches.open(a).then(l=>l.match(h).then(p=>p&&!navigator.onLine?(console.log(`[Service Worker] Serving cached HTML for ${t.url} from ${h}`),p):(console.log(`[Service Worker] HTML not in cache, fetching from network: ${t.url}`),fetch(t).then(f=>{let _=f.headers.get("Content-Type");return f.ok&&_&&_.includes("text/html")&&(console.log(`[Service Worker] Caching new HTML response from ${t.url} as ${h}`),l.put(h,f.clone())),f}).catch(f=>p||(console.error(`[Service Worker] Network failed for HTML navigation: ${t.url}`,f),new Response("<h1>Offline</h1><p>You appear to be offline and this content is not cached.</p>",{headers:{"Content-Type":"text/html"}})))))));return}e.respondWith(caches.open("cache_").then(l=>l.match(t).then(p=>{if(p)if((p.headers.get("content-type")||"").includes("/html"))console.log("Es HTML!!",d);else return console.log("[Service Worker] Serving from cache:",t.url),p;return fetch(t).then(f=>{if(!f||f.status!==200||f.type!=="basic")return f;let _=t.headers.get("Content-Type");console.log("Guardando en cach\xE9: ",a," | "+t.url," | ",_);let y=f.clone();return console.log("[Service Worker] Caching new asset:",t.url),l.put(t,y),f}).catch(f=>(console.error("[Service Worker] Fetch failed:",t.url,f),new Response("Network error occurred.",{status:503,statusText:"Service Unavailable"})))})))});var $=new Map,X=async(e,t)=>{let n=t?t+"_"+M:M,r=await(await caches.open(n)).match(e),d=$.get(n);return!r&&d&&d.delete(e),r},k=async(e,t)=>{let n=t?t+"_"+M:M;$.has(n)||$.set(n,new Map);let s=$.get(n);if(s?.has(e)){if(await caches.has(n))return s.get(e);$.set(n,new Map)}let r=await caches.open(n),d=Date.now(),i=await r.match(e);if(i){let o=await i.json();if(o.__keys__){let c=new Map(o.__keys__),u=new Map([...c.entries()].map(a=>[a[1],a[0]]));o=D(o.content,u)}return console.log(`Cache response "${e}" in ${Date.now()-d}ms (v2)`),o}},S=async(e,t,n)=>{let s=n?n+"_"+M:M;$.has(s)||$.set(s,new Map);let r=await caches.open(s),d=$.get(s);if(!t){d?.delete(e),await r.delete(e);return}d?.set(e,t);let i=Date.now();typeof t!="string"&&(t=JSON.stringify(t));let o=new Response(t,{headers:{"Content-Type":"application/json","Content-Length":String(t.length)}});await r.put(e,o),console.log(`Cache put "${e}" in ${Date.now()-i}ms (v2)`)},F=e=>{let t={};for(let n in e){let s=e[n];typeof s=="number"||typeof s=="string"?t[n]=s:Array.isArray(s)?t[n]=`[${s.length}]`:s&&typeof s=="object"&&(t[n]=`{${Object.keys(s).join(", ")}}`)}return t};var N=new Map,U=new Map,W=new Map,O=class{ws=null;config;clientId;clientIDs=new Set;subscribed=!1;connectPromise=null;constructor(t){this.config={wsUrl:t.wsUrl,apiKey:t.apiKey,targetId:t.targetId,stunServers:t.stunServers||["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"],trickle:t.trickle??!1,timeout:t.timeout??3e4,__client__:t.__client__},this.clientId="client-"+Math.random().toString(36).substring(2,11),this.clientIDs.add(t.__client__)}addClient(t){this.clientIDs.add(t)}removeClient(t){this.clientIDs.delete(t)}hasClients(){return this.clientIDs.size>0}async connect(){return this.isConnected()?{clientId:this.clientId,connected:!0}:this.connectPromise?this.connectPromise:(this.connectPromise=new Promise((t,n)=>{try{this.startAppSyncSubscription(t,n)}catch(s){this.connectPromise=null,n(s)}}),this.connectPromise)}startAppSyncSubscription(t,n){let r=new URL(this.config.wsUrl.replace("wss://","https://")).host,d=r.replace("appsync-api","appsync-realtime-api");d=`wss://${d}/event/realtime`;let i=new Date().toISOString().replace(/[:\-]|\.\d{3}/g,""),o={host:r,"x-amz-date":i,"x-api-key":this.config.apiKey},c=btoa(JSON.stringify(o));console.log("[AppSync] Connecting to",d),this.ws=new WebSocket(d,["aws-appsync-event-ws",`header-${c}`]);let u=setTimeout(()=>{this.ws?.readyState!==WebSocket.OPEN&&(this.ws?.close(),this.connectPromise=null,n(new Error("Connection timeout")))},this.config.timeout);this.ws.onopen=()=>{this.ws?.send(JSON.stringify({type:"connection_init"}))},this.ws.onmessage=a=>{let h=JSON.parse(a.data);if(h.type==="connection_ack")clearTimeout(u),this.subscribe(),t({clientId:this.clientId,connected:!0});else if(h.type==="event"||h.type==="data"){let l=[];h.type==="data"&&h.event?l=[h.event]:h.payload&&h.payload.events&&(l=h.payload.events);for(let p of l){let f=p;if(typeof p=="string")try{f=JSON.parse(p)}catch{}f&&f.to===this.clientId&&this.handleIncomingSignal(f)}}},this.ws.onerror=a=>{clearTimeout(u),this.connectPromise=null,this.sendErrorToClient(new Error("WebSocket Error")),n(a)},this.ws.onclose=()=>{this.connectPromise=null,this.sendCloseToClient()}}subscribe(){if(this.subscribed)return;let t=new URL(this.config.wsUrl.replace("wss://","https://")),n=new Date().toISOString().replace(/[:\-]|\.\d{3}/g,""),s={host:t.host,"x-amz-date":n,"x-api-key":this.config.apiKey},r={id:"sub-"+Math.random().toString(36).substring(2,11),type:"subscribe",channel:`/genix-bridge/${this.clientId}`,authorization:s};this.ws?.send(JSON.stringify(r)),this.subscribed=!0}async sendSignal(t,n){let s=this.config.wsUrl.replace("wss://","https://");s.endsWith("/event")||(s=s.replace(/\/$/,"")+"/event");let r=new Date().toISOString().replace(/[:\-]|\.\d{3}/g,""),d="";try{let o=JSON.parse(n);o.sessionToken&&(d=o.sessionToken,delete o.sessionToken,n=JSON.stringify(o))}catch{}let i={from:this.clientId,to:this.config.targetId,action:t,data:n};d&&(i.sessionToken=d);try{let o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"x-amz-date":r},body:JSON.stringify({channel:"genix-bridge/server",events:[JSON.stringify(i)]})});if(!o.ok)throw new Error(`Publish failed: ${o.status}`)}catch(o){throw this.sendErrorToClient(o instanceof Error?o:new Error("Signal send failed")),o}}handleIncomingSignal(t){for(let n of this.clientIDs)A(n,{__response__:40,signal:{action:t.action,data:t.data,sessionToken:t.sessionToken}})}sendErrorToClient(t){for(let n of this.clientIDs)A(n,{__response__:30,error:t.message})}sendCloseToClient(){for(let t of this.clientIDs)A(t,{__response__:30,closed:!0})}disconnect(){this.ws?.close()}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}getClientId(){return this.clientId}getTargetId(){return this.config.targetId}},Y=async e=>{let t=e.targetId,n=e.__client__,s={wsUrl:e.wsUrl,apiKey:e.apiKey,targetId:t,stunServers:e.stunServers||["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"],trickle:e.trickle??!1,timeout:e.timeout??3e4,__client__:n};W.set(n,s),U.set(n,t);let r=N.get(t);return r&&r.isConnected()?(console.log("[AppSync] Reusing connection for target:",t),r.addClient(n),{clientId:r.getClientId(),connected:!0}):(r&&(console.log("[AppSync] Connection exists but not connected, reconnecting..."),r.disconnect()),r=new O(s),N.set(t,r),await r.connect())},Z=async e=>{let t=U.get(e.__client__);if(!t)throw new Error("No target associated with this client. Call connect first.");let n=N.get(t);if(!n||!n.isConnected()){let s=W.get(e.__client__);if(!s)throw new Error("No connection config found");n=new O(s),N.set(t,n),await n.connect()}try{await n.sendSignal(e.action,e.data)}catch(s){let r=W.get(e.__client__);if(r)n.disconnect(),n=new O(r),N.set(t,n),await n.connect(),await n.sendSignal(e.action,e.data);else throw s}return{success:!0}},ee=async e=>{let t=U.get(e.__client__);if(t){let n=N.get(t);n&&(n.removeClient(e.__client__),n.hasClients()||(n.disconnect(),N.delete(t))),U.delete(e.__client__)}return W.delete(e.__client__),{success:!0}};var ae=async(e,t)=>{let n=e.headers.get("Content-Type");if(e.status&&t.status&&(t.status.code=e.status,t.status.message=e.statusText),e.status===200){let s=e.body?.getReader(),r=new ReadableStream({start(o){return c();function c(){return s.read().then(({done:u,value:a})=>u?(o.close(),Promise.resolve()):(A(t.__client__,{__response__:5,bytes:a.length}),o.enqueue(a),c()))}}}),i=await new Response(r).text();return t&&(t.contentLength=i.length),Promise.resolve(JSON.parse(i))}else if(e.status===401)console.warn("Error 401, la sesi\xF3n ha expirado.");else if(e.status!==200)return console.log(e),!n||n.indexOf("/json")===-1?(console.log("Parseando como texto"),e.text()):(console.log("parseando como JSON"),e.json())},H=(e,t)=>{let n={};for(let[s,r]of Object.entries(e)){if(r&&!Array.isArray(r))continue;let d=0;for(let i of r||[]){let o=i.updated||i.upd||0;t?(d===0||o<d)&&(d=o):o>d&&(d=o)}n[s]=d}return n},E=(e,t,n)=>{let s=e.includes("?")?"&":"?";return typeof n=="string"&&(n=n.replace("?","&")),e+`${s}${t}=${n}`},K=!1,te=new Set;w.set(11,async()=>(K=!0,te=new Set,setTimeout(()=>{K=!1},8e3),{ok:1}));w.set(3,async e=>await pe(e));w.set(30,async e=>await Y(e));w.set(31,async e=>await Z(e));w.set(32,async e=>await ee(e));var P=e=>{let t=[e.route,e.partition?.value||"0"].join("_"),n=[e.__enviroment__||"main",e.module||"?"].join("_");return[t,n]};w.set(12,async e=>{let[t,n]=P(e),s=await k(t+"_updated",n);return console.log("lastSync obtenido (1):",e,e.route,t,s),{updatedStatus:s?.updatedStatus||{},updated:s?.fetchTime||0}});var le=(e,t)=>e.keysIDs&&Object.hasOwn(e.keysIDs,t)?e.keysIDs[t]:e.keyID||"id",ue=(e,t)=>{if(typeof t=="string")return e[t]||e.ID||0;if(Array.isArray(t)){let n=[];for(let s of t)if(e[s])n.push(e[s]);else return 0;return n.join("_")}else return 0},ne=async(e,t,n,s)=>{Array.isArray(n)&&(n={_default:n});let r=H(n),d=H(n,!0),i=!1;for(let[a,h]of Object.entries(r)){if(!h)continue;let l=t.updatedStatus[a];h!==l&&(t.updatedStatus[a]=h,i=!0),d[a]<l&&console.warn(`Cache Error: En "${e.route}" [${a}] se est\xE1n obteniendo registros con [updated] menor que el cach\xE9 (${(n[a]||[]).length} recibidos)`)}console.log("Fetch cache ha cambiado?:",i,"|",e.route,"|",r);let[o,c]=P(e),u=o+"_updated";if(!i&&e.cacheMode!=="updateOnly")n=await k(o,c);else if(i){let a=await k(o,c);console.log("cache obtenido:",o,c,e),self._isLocal&&console.log("prevResponse (old)",e.route,e.cacheMode,{...a});let h={};for(let[l,p]of Object.entries(n)){if((p||[]).length===0)continue;let f=le(e,l),_=0;h[String(f)]=(h[String(f)]||0)+p.length;let y=b=>{let v=ue(b,f);return v||_++,v},g=a[l]||[];if(!Array.isArray(g))continue;let m=new Map;for(let b of g)m.set(y(b),b);for(let b of p)m.set(y(b),b);_>0&&console.warn(`Cache Error: En "${e.route}" (${l}) hay ${_} registros sin la key: ${f}`),console.log("Cache usedKeysCount",h);let C=[];for(let b of m.values())C.push(b);a[l]=C}self._isLocal&&console.log("prevResponse (new)",e.route,e.cacheMode,{...a}),S(o,a,c),n=a}else n=null;return t.fetchTime=s,S(u,t,c),n},de=new Set;w.set(21,async e=>{let t=(e.__req__||0)*1e3+e.__client__;de.add(t)});var pe=async e=>{console.log("Obteniendo fetch service worker:",e.route,"|",e.cacheMode,"|",e.__req__,"|",e.__version__);let[t,n]=P(e),s=t+"_updated",r=c=>{if(!c||Object.keys(c).length===0)return["sin registros"];let u=[];for(let a of Object.keys(c))u.push(`${a}=${(c[a]||[]).length}`);return u},d={fetchTime:0,updatedStatus:{},__version__:e.__version__},i=await k(s,n)||d;if(i.fetchTime&&i.__version__!==e.__version__)console.log(`Linmpiando cach\xE9, difererente versi\xF3n ${e.__version__} > ${i.__version__}. Route ${e.route}`),i=d,await S(s,i,n),await S(t,null,n);else{let c=await X(t,n);i.fetchTime&&!c?(await S(s,d,n),i=d):c&&!i.fetchTime&&await S(t,null,n)}if(e.cacheMode==="offline"){let c=await k(t,n);if(c&&c.__version__===e.__version__){let u=H(c);for(let[a,h]of Object.entries(u)){let l=!1;i.updatedStatus[a]!==h&&(console.log("El updatedStatus difiere:",e.route,"|",a,"|",i.updatedStatus[a]," vs ",h),i.updatedStatus[a]=h,l=!0),l&&S(s,i,n)}}return console.log("Enviando fetch response (offline):",e.route),console.log(`${e.route}: Retornando registros "${e.cacheMode||"normal"}". ${r(c).join(" | ")}`),{content:c?._default?c._default:c}}let o=Math.floor(Date.now()/1e3);e.status={code:200,message:""};try{let c=e.routeParsed||e.route;if(e.partition&&e.partition.value){let p=e.partition.param||e.partition.key;c=E(c,p,e.partition.value)}let u=i&&i.updatedStatus&&i.fetchTime;console.log("hasCache",e.route,i);let a=e.fields||[];for(let p of a)i.updatedStatus[p]||0||(c=E(c,p,0));if(u){if(i.updatedStatus._default)c=E(c,"updated",i.updatedStatus._default);else{let g=0;for(let[m,C]of Object.entries(i.updatedStatus))(g===0||C<g)&&(g=C),!(a.length>0&&!a.includes(m))&&(c=E(c,m,C));c=E(c,"updated",g)}let p=e.cacheSyncTime||e.useCache?.min||0,f=i.fetchTime+p*60,_=f-o,y=e.cacheMode==="refresh";i.forceNetwork?(console.log("Forzando fetch por flag forceNetwork en ILastSync:",e.route),y=!0,i.forceNetwork=!1,await S(s,i,n)):K&&!te.has(t)?(console.log("Forzando fetch por flag global:",e.route),y=!0):_<=0&&(console.log("Preparando fetch: ",e.route," | Last: ",i.fetchTime,"| Remainig:",_),y=!0);for(let g of e.fields||[])i.updatedStatus[g]||0||(y=!0);if(!y){let g=f-o;if(console.log(`Obviando sync fech "${t}". Quedan ${g}s`),e.cacheMode==="updateOnly")return console.log(e.route,"Retornando null por 'updated only'"),{content:null};{let m=await k(t,n);return console.log(`${e.route}: Retornando registros "${e.cacheMode||"normal"}`,F(m)),{content:m?._default?m._default:m}}}}console.log(`Realizando fetch (${c})...`);let h=await self.fetch(c,{headers:e.headers});if(h.status&&h.status!==200)return{error:await h.text()};let l=await ae(h,e)||{};if(console.log("response pre-unmarshall",l),l=z(l),console.log("response post-unmarshall",l),Array.isArray(l.response)&&typeof l.message=="string"&&(l=l.response),Array.isArray(l)&&(l={_default:l}),l.__version__=e.__version__,console.log(`Fetch response recibida! (${c}) | Has-cach\xE9: ${u}`),u)console.log("prevResponse (hasCache)",e.route,e.cacheMode,{...l}),l=await ne(e,i,l,o);else{let p=H(l);Object.assign(i,{fetchTime:o,updatedStatus:p}),S(s,i,n),console.log("prevResponse (recent)",e.route,e.cacheMode,{...l}),S(t,l,n)}return console.log(`${e.route}: Retornando registros "${e.cacheMode||"normal"}". ${r(l).join(" | ")}`),{content:l}}catch(c){return console.log("Fetch Error::",c),{error:c}}};w.set(13,async e=>{let[t,n]=P(e.args)+"_updated",s=await k(t,n)||{fetchTime:0,updatedStatus:{}},r=Math.floor(Date.now()/1e3)-5;e.args.__enviroment__=e.__enviroment__,console.log("Guardando external fech response en cach\xE9:",e.args.route),ne(e.args,s,e.response,r)});w.set(14,async e=>{let[t,n]=P(e),s=t+"_updated",r=await k(s,n)||{fetchTime:0,updatedStatus:{}};return r.forceNetwork=!0,await S(s,r,n),console.log(`ForceNetwork set to true for key: ${s}`),{ok:1}});w.set(15,async e=>{let t={route:e.route,module:e.module,partition:{value:e.partValue}},[n,s]=P(t),r=await k(n,s);if(!r)return[];let d=r[e.propInResponse||"_default"];if(!d)return[];if(e.filter){let i=e.filter.split(",").filter(c=>c).map(c=>{let u=c.split("=");return isNaN(u[1])?u.push(0):u.push(parseInt(u[1])),u});console.log("keyValues filters:",i);let o=[];for(let c of d)for(let u of i){let a=c[u[0]];(a===u[1]||a===u[2])&&o.push(c)}return o}else return r});w.set(22,async e=>{console.log("obteniendo cantidad de registros obtenidos");let t=await caches.keys();console.log("cache stores::",t,"| Env:",e.__enviroment__);let n=[];for(let s of t){if(!s.includes("_"))continue;let[r,d]=s.split("_");r===e.__enviroment__&&n.push({name:s,module:d,size:0})}return await Promise.all(n.map(s=>new Promise((r,d)=>{let i;caches.open(s.name).then(o=>(i=o,i.keys())).then(o=>Promise.all(o.map(async c=>{try{let u=await i.match(c);if(u){let a=u.headers.get("Content-Length")||u.headers.get("content-length");s.size||(s.size=0),s.size+=parseInt(a||"0",10)}else console.warn(`Service Worker: No matching response found for request in cache '${s.name}':`,c.url)}catch(u){console.error(`Service Worker: Error matching request or getting size for ${c.url}:`,u)}}))).then(()=>{r(0)}).catch(o=>{console.log("Error al obtener informacion del cach\xE9:",o),d(o)})}))),console.log("cacheStats",n),{cacheStats:n}});w.set(23,async e=>(console.log(`Eliminando cach\xE9 "${e.cacheName}" (Enviroment ${e.__enviroment__})...`),await caches.delete(e.cacheName),console.log(`Cach\xE9 "${e.cacheName}" eliminado! (Enviroment ${e.__enviroment__})...`),{ok:1}));w.set(26,async e=>{console.log("Eliminando cach\xE9...");let t=await caches.keys();for(let n of t)n.startsWith(e.__enviroment__)&&(console.log(`Eliminando cach\xE9 por ambiente "${e.__enviroment__}": ${n}`),await caches.delete(n));return console.log("Cach\xE9 eliminado."),{ok:1}});w.set(24,async e=>{let t=[e.__enviroment__||"main",e.module||"?"].join("_");console.log("Setting ForceNerwork for routes: ",e.routes);let s=await(await caches.open(t+"_"+M)).keys(),r=new Set;for(let d of s){let i=d.url.split("/")[3];if(i){console.log("buscando request::",i);for(let o of e.routes)if(i.startsWith(o)&&i.endsWith("_updated")){let c=await k(i,t);c.forceNetwork=!0,await S(i,c,t),r.add(o);break}}}return console.log(`ForceNetwork = true for routes: ${[...r].join(", ")} | In ${s.length}`),{ok:1}});
//# sourceMappingURL=sw.js.map
