<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
		<script>
			window._env = {
				SIGNALING_ENDPOINT: "%PUBLIC_SIGNALING_ENDPOINT%",
				SIGNALING_API_KEY: "%PUBLIC_SIGNALING_API_KEY%"
			};
			//ENVIROMENT_VARIABLES

			window.global = window;
			console.log('[Main App] Path:', window.location.pathname, 'Search:', window.location.search, '_IS_STORE_APP:', !!window._IS_STORE_APP);
			// GitHub Pages SPA routing hack for /store sub-app
			(function() {
				var path = window.location.pathname;
				if (path.startsWith('/store') && !window._IS_STORE_APP) {
					console.log('[Main App] Redirecting to store...');
					// Check if it's a file request (has a dot in the last segment)
					var lastSegment = path.split('/').pop();
					if (lastSegment.includes('.')) {
						console.log('[Main App] Detected file request, skipping redirect');
						return;
					}

					// Redirect to store index with the path as a parameter
					var repoName = ''; // Since it's a custom domain, repoName is empty
					var storePath = path.substring(6); // Remove '/store'
					var search = window.location.search;
					if (search.indexOf('?p=') !== -1 || search.indexOf('&p=') !== -1) {
						console.log('[Main App] Already has p parameter, avoiding loop');
						return;
					}
					var target = '/store/?p=' + encodeURIComponent(storePath) + search.replace('?', '&') + window.location.hash;
					console.log('[Main App] Replacing location with:', target);
					window.location.replace(target);
				}
			})();
		</script>
		<script src="/libs/simplepeer.min.js"></script>
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>
