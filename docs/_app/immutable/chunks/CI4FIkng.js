import"./DsnmJJEf.js";import{a as fe}from"./B723hspN.js";import{p as ue,e as J,g as K,l as Q,h as v,i as t,f as g,c as b,s as m,r as p,t as w,b as _,d as me,av as _e}from"./CaHRSXkO.js";import{s as V}from"./CrFq4NBa.js";import{i as h}from"./BLuAT40e.js";import{b as k,d as W,s as N}from"./ZZ_SO04P.js";import{d as ge,e as be}from"./EZdBy8tr.js";import{p as n}from"./DdsaxoiY.js";import{E as T,i as j,d as pe}from"./BEo5_Va5.js";import{N as E,a as Y}from"./Bt0GHlld.js";var he=g('<div class="w-full h-full relative flex flex-col items-center justify-center card_input_layer svelte-ilfl9z"><input type="file" accept="image/png, image/jpeg, image/webp" class="svelte-ilfl9z"/> <div style="font-size: 2.4rem"><i class="icon-upload"></i></div> <div class="h5">Subir Imagen</div></div>'),ye=g('<source type="image/avif"/>'),xe=g('<source type="image/webp"/>'),we=g('<picture class="contents"><!> <!> <img class="w-full h-full absolute card_image_img1 svelte-ilfl9z" alt="Upload preview"/></picture>'),Ce=g('<textarea class="w-full card_image_textarea svelte-ilfl9z" placeholder="Nombre..."></textarea>'),ze=g('<div class="absolute w-full card_image_upload_text svelte-ilfl9z"> </div>'),Ue=g('<button class="bnr-1 _5 card_image_btn svelte-ilfl9z" aria-label="Subir imagen"><i class="icon-ok"></i></button>'),Se=g('<div><!> <!> <div class="w-full absolute flex items-center justify-center card_image_layer_botton svelte-ilfl9z"><button aria-label="Eliminar imagen"><i class="icon-cancel"></i></button> <!></div></div>'),Pe=g('<div class="w-full h-full absolute flex flex-col items-center justify-center card_image_layer_loading svelte-ilfl9z"><div class="c-white h3 ff-bold">Loading...</div> <div class="flex relative items-center justify-center h-22 lh-10 w-[calc(100%-16px)] left-0 right-0 mt-8 _8 mr-8 ml-9 p-2 svelte-ilfl9z"><div class="absolute _9 left-2 h-18 svelte-ilfl9z"></div> <div class="absolute fs14 ff-bold text-white"> </div></div></div>'),Ie=g("<div><!> <!> <!> <!></div>");function Le(Z,s){ue(s,!0);let U=n(s,"src",3,""),B=n(s,"types",19,()=>[]),$=n(s,"saveAPI",3,"images"),A=n(s,"onUploaded",3,void 0),L=n(s,"setDataToSend",3,void 0),ee=n(s,"clearOnUpload",3,!1),O=n(s,"description",3,""),ae=n(s,"cardStyle",3,""),R=n(s,"onDelete",3,void 0),te=n(s,"cardCss",3,""),F=n(s,"hideFormUseMessage",3,""),re=n(s,"hideForm",3,!1),ie=n(s,"hideUploadButton",3,!1),se=n(s,"id",3,void 0),a=J(K({src:U(),types:B(),description:O()})),d=J(K(U()?-1:0));T.imageCounter++;const I=se()||T.imageCounter;Q(()=>{U(),v(a,{src:U(),base64:"",types:B(),description:O()},!0)});const M=r=>{if(t(a).base64)return t(a).base64;if(!t(a).src)return"";let e=t(a).src||"";return e.substring(0,8)!=="https://"&&e.substring(0,7)!=="http://"&&(s.folder&&(e=s.folder+"/"+e),s.size&&(e=`${e}-x${s.size}`),e=T.S3_URL+e),r&&(e=e+"."+r),e};let D;const le=async r=>{const l=r.target.files;if(!(!l||l.length===0)){D=l[0],console.log("imagefile::",D);try{const i=await Y(D,1200,"avif");console.log("imageB64",i),v(d,-1),v(a,{src:"",base64:i,types:[],description:t(a).description},!0),s.onChange?.(t(a))}catch(i){E.failure("Error procesando la imagen: "+String(i)),v(d,0)}}},q=async()=>{let r={};if(!t(a).base64)return E.failure("No hay nada que enviar."),Promise.resolve(r);v(d,.001);const e={Content:"",Content_x6:"",Content_x4:"",Content_x2:"",Description:t(a).description};if(s.useConvertAvif){const l=[{i:6,r:980,fn:i=>e.Content_x6=i},{i:4,r:670,fn:i=>e.Content_x4=i},{i:2,r:360,fn:i=>e.Content_x2=i}];for(const i of l)i.promise=new Promise(f=>{Y(D,i.r,"avif").then(y=>{i.fn(y),f(0)})});try{await Promise.all(l.map(i=>i.promise))}catch(i){return E.failure(`Error al convertir imagen: ${i}`),Promise.resolve(r)}}else e.Content=t(a).base64;L()&&L()(e),console.log("data a enviar::",e);try{r=await pe({data:e,route:$()||"images",onUploadProgress:l=>{l.total&&(v(d,Math.round(l.loaded*100/l.total),!0),console.log("progress:: ",t(d)))}})}catch(l){return E.failure("Error guardando la imagen: "+String(l)),r}return r.id=I,r.description=t(a).description,ee()?v(a,{src:"",base64:"",types:[],description:""},!0):v(a,{src:`${r.imageName}-x2`,base64:"",types:["webp","avif"],description:t(a).description},!0),v(d,-1),A()&&A()(r.imageName,r.description),r};Q(()=>{t(a).base64?j.set(I,q):j.delete(I)}),fe(()=>{j.delete(I)});var S=Ie(),H=b(S);{var oe=r=>{var e=he(),l=b(e);l.__change=le,_e(4),p(e),_(r,e)};h(H,r=>{(t(a)?.src||"").length===0&&r(oe)})}var X=m(H,2);{var ne=r=>{var e=we(),l=b(e);{var i=o=>{var x=ye();w(P=>k(x,"srcset",P),[()=>M("avif")]),_(o,x)};h(l,o=>{t(a).types?.includes("avif")&&o(i)})}var f=m(l,2);{var y=o=>{var x=xe();w(P=>k(x,"srcset",P),[()=>M("webp")]),_(o,x)};h(f,o=>{t(a).types?.includes("webp")&&o(y)})}var C=m(f,2);p(e),w(o=>k(C,"src",o),[()=>M(t(a)?.types?.[0])]),_(r,e)};h(X,r=>{(t(a).src||t(a).base64||"").length>0&&r(ne)})}var G=m(X,2);{var ce=r=>{var e=Se(),l=b(e);{var i=c=>{var u=Ce();k(u,"rows",3),be("blur",u,z=>{z.stopPropagation(),t(a).description=z.currentTarget.value||"",s.onChange?.(t(a))}),_(c,u)};h(l,c=>{t(a).base64&&!F()&&!re()&&c(i)})}var f=m(l,2);{var y=c=>{var u=ze(),z=b(u,!0);p(u),w(()=>V(z,F())),_(c,u)};h(f,c=>{t(a).base64&&F()&&c(y)})}var C=m(f,2),o=b(C);o.__click=c=>{if(c.stopPropagation(),R()){R()(U());return}v(a,{src:"",base64:"",types:[],description:""},!0),s.onChange?.(t(a)),v(d,0)};var x=m(o,2);{var P=c=>{var u=Ue();u.__click=z=>{z.stopPropagation(),q()},_(c,u)};h(x,c=>{t(a).base64&&!ie()&&c(P)})}p(C),p(e),w(()=>{N(e,1,`w-full h-full absolute card_image_layer${t(a).base64?" s1":""}`,"svelte-ilfl9z"),N(o,1,`bnr-1 _4 mr-12 ${t(a).base64?"":"card_image_layer_bn_close2"} card_image_btn`,"svelte-ilfl9z")}),_(r,e)};h(G,r=>{t(d)===-1&&r(ce)})}var de=m(G,2);{var ve=r=>{var e=Pe(),l=m(b(e),2),i=b(l),f=m(i,2),y=b(f);p(f),p(l),p(e),w((C,o)=>{W(i,`width: calc(${C??""}% - 4px);`),V(y,`${o??""} %`)},[()=>Math.round(t(d)),()=>Math.round(t(d))]),_(r,e)};h(de,r=>{t(d)>0&&r(ve)})}p(S),w(()=>{N(S,1,`relative ${te()??""} card_image_1 ${t(a)?.src?"":"card_input"}`,"svelte-ilfl9z"),W(S,ae())}),_(Z,S),me()}ge(["change","click"]);export{Le as I};
