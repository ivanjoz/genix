import{d as R,t as w,i as m,b as x,s as S,c as f}from"./web-B9EQUxsk.js";import{d as h,b as u,a as I}from"./solid-DoXAfIeo.js";import{s as y,b as N}from"./http-zIS_ecGQ.js";import{E as U,N as A}from"./main-CbQ9Ia1e.js";var k=w("<div>"),B=w('<div><input type=file accept="image/png, image/jpeg, image/webp"><div><i class=icon-upload></i></div><div class=h5>Subir Imagen'),z=w("<picture class=dsp-cont><img>"),L=w("<source type=image/avif>"),P=w("<source type=image/webp>"),M=w("<div><div><button><i class=icon-cancel>"),F=w("<textarea rows=3 placeholder=Nombre...>"),j=w('<button class="bnr2 b-blue"><i class=icon-ok>'),O=w('<div><div class="c-white h3 ff-bold">Loading...'),T=w("<div><picture class=dsp-cont><img>"),q=w("<div><div class=spinner4><div class=spinner-item></div><div class=spinner-item></div><div class=spinner-item></div><div class=spinner-item></div><div class=spinner-item></div></div><div>Cargando...");const Q=e=>{const[t,o]=I(e||{src:""}),[g,s]=I(e.src?-1:0),l=async a=>{const n=a.target.files[0];console.log("imagefile::",n);const d=await W({source:n,size:1.2,quality:.89});s(-1),o({src:d})},_=async()=>{let a;s(.001);const i={Content:t().src,Folder:"img-uploads",Description:t().description};e.setDataToSend&&e.setDataToSend(i);try{a=await N({data:i,route:e.saveAPI||"images",refreshIndexDBCache:e.refreshIndexDBCache||"",onUploadProgress:n=>{const d=Math.round(n.loaded*100/n.total);console.log("progress:: ",d),s(d)}})}catch(n){A.failure("Error guardando la imagen:",n);return}e.clearOnUpload?(o({src:""}),s(0)):(s(-1),o({src:`${a.imageName}-x2`,types:["webp","avif"]})),e.onUploaded&&e.onUploaded(a.imageName,t().description)},v=()=>t().src?.length>0&&(t()?.types||[]).length===0,r=()=>{let a=t().src;return a.substring(0,5)!=="data:"&&a.substring(0,8)!=="https://"&&a.substring(0,7)!=="http://"&&(a=U.S3_URL+a),a};return(()=>{var a=k();return m(a,(()=>{var i=h(()=>(t()?.src||"").length===0);return()=>i()&&(()=>{var n=B(),d=n.firstChild,$=d.nextSibling;return d.addEventListener("change",c=>l(c)),$.style.setProperty("font-size","2.4rem"),u(()=>f(n,`w100 h100 p-rel flex-column ai-center jc-center ${y.card_input_layer}`)),n})()})(),null),m(a,(()=>{var i=h(()=>t()?.src?.length>0);return()=>i()&&(()=>{var n=z(),d=n.firstChild;return m(n,(()=>{var $=h(()=>!!t().types?.includes("avif"));return()=>$()&&(()=>{var c=L();return u(()=>x(c,"srcset",r()+".avif")),c})()})(),d),m(n,(()=>{var $=h(()=>!!t().types?.includes("webp"));return()=>$()&&(()=>{var c=P();return u(()=>x(c,"srcset",r()+".webp")),c})()})(),d),u($=>{var c=`w100 h100 p-abs ${y.card_image_img1}`,b=r()+(t().types?.length>0?`.${t().types[0]}`:"");return c!==$.e&&f(d,$.e=c),b!==$.t&&x(d,"src",$.t=b),$},{e:void 0,t:void 0}),n})()})(),null),m(a,(()=>{var i=h(()=>g()==-1);return()=>i()&&(()=>{var n=M(),d=n.firstChild,$=d.firstChild;return m(n,(()=>{var c=h(()=>!!v());return()=>c()&&(()=>{var b=F();return b.addEventListener("blur",C=>{C.stopPropagation(),t().description=C.target.value||""}),u(()=>f(b,`w100 ${y.card_image_textarea}`)),b})()})(),d),$.$$click=c=>{if(c.stopPropagation(),e.onDelete){e.onDelete(e.src);return}o({src:""}),s(0)},m(d,(()=>{var c=h(()=>!!v());return()=>c()&&(()=>{var b=j();return b.$$click=C=>{C.stopPropagation(),_()},b})()})(),null),u(c=>{var b=`w100 h100 p-abs ${y.card_image_layer}${v()?" s1":""}`,C=`w100 p-abs flex-center ${y.card_image_layer_botton}`,E=`bnr2 b-red mr-04 ${v()?"":y.card_image_layer_bn_close2}`;return b!==c.e&&f(n,c.e=b),C!==c.t&&f(d,c.t=C),E!==c.a&&f($,c.a=E),c},{e:void 0,t:void 0,a:void 0}),n})()})(),null),m(a,(()=>{var i=h(()=>g()>0);return()=>i()&&(()=>{var n=O();return u(()=>f(n,`w100 h100 p-abs flex-center ${y.card_image_layer_loading}`)),n})()})(),null),u(i=>{var n=`p-rel ${e.cardCss?e.cardCss+" ":""}${y.card_image_1} ${t()?.src?"":y.card_input}`,d=e.cardStyle;return n!==i.e&&f(a,i.e=n),i.t=S(a,d,i.t),i},{e:void 0,t:void 0}),a})()},H=(e,t,o,g,s)=>{const l=document.createElement("canvas");return l.width=t,l.height=o,l.getContext("2d").drawImage(e,0,0,t,o),new Promise(v=>{l.toBlob(r=>{r=r;const a=new FileReader;a.readAsDataURL(r),a.onloadend=()=>{const i=a.result;v(i)}},g,s)})},W=e=>{const t=document.createElement("canvas"),o=new window.Image;return new Promise((g,s)=>{o.onload=()=>{e.originalSize=[o.width,o.height],t.width=e.originalSize[0],t.height=e.originalSize[1];const l=e.size*1e3*1e3,_=t.width*t.height;let v=t.width,r=t.height;if(_>l){const i=(_/l)**.5;v=Math.floor(t.width/i),r=Math.floor(t.height/i)}t.getContext("2d").drawImage(o,0,0,t.width,t.height),console.log("args 11::",e),H(t,v,r,"image/webp",e.quality).then(i=>{g(i)}).catch(i=>{s(i)})},o.src=URL.createObjectURL(e.source),console.log("Data-URL::",o.src)})},D=(e,t)=>(e.substring(0,5)!=="data:"&&(e.substring(0,8)!=="https://"&&e.substring(0,7)!=="http://"&&(e=U.S3_URL+e),t&&(e=`${e}-x${t}`)),e),V=e=>{const t=()=>D(e.src,e.size);return(()=>{var o=z(),g=o.firstChild;return m(o,(()=>{var s=h(()=>!!e.types?.includes("avif"));return()=>s()&&(()=>{var l=L();return u(()=>x(l,"srcset",t()+".avif")),l})()})(),g),m(o,(()=>{var s=h(()=>!!e.types?.includes("webp"));return()=>s()&&(()=>{var l=P();return u(()=>x(l,"srcset",t()+".webp")),l})()})(),g),u(s=>{var l=e.style,_=`${e.class||""}`,v=e.style,r=t()+(e.types?.length>0?`.${e.types[0]}`:"");return s.e=S(o,l,s.e),_!==s.t&&f(g,s.t=_),s.a=S(g,v,s.a),r!==s.o&&x(g,"src",s.o=r),s},{e:void 0,t:void 0,a:void 0,o:void 0}),o})()},Y=e=>{const t=()=>D(e.src,e.size),[o,g]=I(1);let s=e.class||y.image_card_default;return e.selectable&&(s+=" sel"),(()=>{var l=T(),_=l.firstChild,v=_.firstChild;return l.$$click=r=>{r.stopPropagation(),e.onSelect&&e.onSelect()},f(l,`p-rel imgc1 ${s}`),_.addEventListener("load",()=>{console.log("on load!!"),g(0)}),_.addEventListener("error",()=>g(2)),m(_,(()=>{var r=h(()=>!!e.types?.includes("avif"));return()=>r()&&(()=>{var a=L();return u(()=>x(a,"srcset",t()+".avif")),a})()})(),v),m(_,(()=>{var r=h(()=>!!e.types?.includes("webp"));return()=>r()&&(()=>{var a=P();return u(()=>x(a,"srcset",t()+".webp")),a})()})(),v),v.addEventListener("load",()=>{console.log("on load!!"),g(0)}),v.addEventListener("error",()=>g(2)),m(l,(()=>{var r=h(()=>o()===1);return()=>r()&&(()=>{var a=q(),i=a.firstChild,n=i.nextSibling;return n.style.setProperty("color","white"),u(()=>f(a,`${y.image_loading_layer}`)),a})()})(),null),m(l,(()=>{var r=h(()=>!!e.description);return()=>r()&&(()=>{var a=k();return m(a,()=>e.description),u(()=>f(a,`p-abs ff-bold flex-center w100 ${y.image_card_desc}`)),a})()})(),null),u(r=>{var a={...e.style||{},"background-color":o()===1?"#34353e":""},i=`${e.imageClass||""} w100 h100`,n=e.imageStyle,d=t()+(e.types?.length>0?`.${e.types[0]}`:"");return r.e=S(l,a,r.e),i!==r.t&&f(v,r.t=i),r.a=S(v,n,r.a),d!==r.o&&x(v,"src",r.o=d),r},{e:void 0,t:void 0,a:void 0,o:void 0}),l})()};R(["click"]);export{V as I,Q as a,Y as b};
