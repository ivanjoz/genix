import{a2 as S,E as L,b6 as y,k as h,a3 as d,aO as m,at as b}from"./Du-3VwLa.js";import{g as C}from"./B5wGtz18.js";import{N as M,t as T}from"./VsnTSXou.js";const _=t=>{let e="";for(;e.length<t;)e+=(Math.random()+1).toString(36).substring(2);return e.substring(0,t)},N=async(t,e)=>{e=e.substring(0,32);const s=Uint8Array.from(atob(t),a=>a.charCodeAt(0));console.log("encrypted len::",s.length);const n=await crypto.subtle.importKey("raw",new TextEncoder().encode(e),{name:"AES-GCM"},!1,["decrypt"]);if(s.length<12)throw new Error("Invalid encrypted data");const r=s.slice(0,12);console.log("nonce:: ",new TextDecoder().decode(r));const i=s.slice(12);console.log("desencriptando:: ",r.length,e.length,i.length);let p;try{p=await crypto.subtle.decrypt({name:"AES-GCM",iv:r},n,i)}catch(a){return console.log("Error desencriptando:: ",a),""}return console.log("decripted data:: ",p),new TextDecoder().decode(p)},J=(t,e,s,n)=>{if(e=e||0,typeof t!="number")return t?"-":"";e===-1&&(t<1?t=Math.round(t*1e4)/1e4:t<10?t=Math.round(t*1e3)/1e3:t>=10&&(t=Math.round(t*100)/100));let r;if(typeof e=="number"&&e>=0)if(e===0)r=Math.round(t).toString();else{const i=Math.pow(10,e);r=(Math.round(t*i)/i).toFixed(e)}else r=t.toString();return t>=100&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,",")),r},w=()=>typeof window<"u",f=w();let k="https://dnh72xkkh3junf57p3vexemlvm0emgys.lambda-url.us-east-1.on.aws/api/";f&&window.location.host.includes("localhost")&&window.location.host!=="localhost:8000"&&(k="http://localhost:3589/api/");const o={appId:"genix",S3_URL:"https://d16qwm950j0pjf.cloudfront.net/",serviceWorker:"/sw.js",apiRoute:"http://localhost:3589/",enviroment:"dev",counterID:1,sideLayerSize:0,fetchID:1e3,imageWorker:null,zoneOffset:new Date().getTimezoneOffset()*60,dexieVersion:1,cache:{},params:{fetchID:1001,fetchProcesses:new Map},pendingRequests:[],API_ROUTES:{MAIN:k},screen:f?window.screen:{height:-1,width:-1},language:f?window.navigator?.language||"":"-",deviceMemory:f&&window.navigator?.deviceMemory||0,throttleTimer:null,hostname:"",pathname:"",empresaID:0,empresa:{},imageCounter:1e4,clearAccesos:null,navigate:C,history:{pushState:(t,e,s)=>{console.log("Es server!!",t,e,s)}},getPathname:()=>f?window.location.pathname:o.pathname||"",getEmpresaID:()=>{if(!o.empresaID){const t=localStorage.getItem(o.appId+"EmpresaID");if(t)return o.empresaID=parseInt(t),o.empresaID;let e="";f&&(e=document.head.querySelector('meta[name="loc"]')?.getAttribute("content")||""),e||(e=o.getPathname()),e=e.replace(".html","");const s=e.split("/").filter(n=>n);if(s[1]&&s[1].includes("-")){let n=s[1].split("-")[0];isNaN(n)||(o.empresaID=parseInt(n))}else if(!isNaN(s[1]))return o.empresaID=parseInt(s[1])}return o.empresaID},loadEmpresaConfig:()=>{if(o.empresa.id)return;const t=o.getEmpresaID();t?fetch(o.S3_URL+`empresas/e-${t}.json`).then(e=>e.json()).then(e=>{o.empresa=e}):console.warn("No se encontró la empresa-id:",t)}},l=typeof window<"u"?window.localStorage:{getItem:t=>"",setItem:(t,e)=>"",removeItem:t=>""},x=t=>{const e=l.getItem(o.appId+"UserToken"),s=parseInt(l.getItem(o.appId+"TokenExpTime")||"0"),n=Math.floor(Date.now()/1e3);if(e){if(!s||n>s)return t||(M.failure("La sesión ha expirado, vuelva a iniciar sesión."),o.clearAccesos?.()),""}else return console.error("No se encontró la data del usuario. ¿Está logeado?:",o.appId),"";return s-n<900?T(()=>{M.warning("La sesión expirará en 15 minutos")},20):s-n<300&&T(()=>{M.warning("La sesión expirará en 5 minutos")},20),e||""},q=()=>w()?w()&&x(!0)?2:3:0;o.clearAccesos=()=>{w&&(l.removeItem(o.appId+"Accesos"),l.removeItem(o.appId+"UserInfo"),l.removeItem(o.appId+"UserToken"),l.removeItem(o.appId+"TokenExpTime"),o.navigate("/login"))};class z{constructor(){const e=[];for(let s=32;s<36;s++)e.push(s.toString(36));this.#e=e,this.#s=e.join(","),this.#a()}#e=[];#s="";#t=!1;#n="";#r=new Map;#o=null;#a(){const e=l?.getItem(o.appId+"UserInfo");e&&(this.#o=JSON.parse(e))}clearAccesos=o.clearAccesos;getUserInfo(){return this.#o}async parseAccesos(e,s){const n=await N(e.UserInfo,s),r=JSON.parse(n);let i=[...r.a||[]];i=i.concat((r.r||[]).map(v=>v*10+8));const p={id:r.d,user:r.u,email:e.UserEmail,names:e.UserNames};l.setItem(o.appId+"UserInfo",JSON.stringify(p)),l.setItem(o.appId+"UserToken",e.UserToken),l.setItem(o.appId+"TokenExpTime",String(e.TokenExpTime)),l.setItem(o.appId+"EmpresaID",String(e.EmpresaID)),this.#a();const c=this.#e;let a=c[c.length-1],u=0;for(let v of i.map(U=>U.toString(32)))u>3&&(u=0),a+=v,a+=c[u],u++;const I=D(a),A=`${I.substring(0,2)}${a}${I.substring(2,4)}`;l.setItem(o.appId+"Accesos",A)}checkAcceso(e,s){s=s||1;const n=this.#s;if(this.#n===""&&(this.#n=l.getItem(o.appId+"Accesos")||""),!this.#n)return!1;if(!this.#t){if(!this.#i())return console.warn("Los accesos han sido modificados."),!1;this.#t=!0,setTimeout(()=>{this.#t=!1},50)}const r=i=>{for(let p of i){const c=(e*10+p).toString(32);if(!this.#r.has(c)){const u=new RegExp(`[${n}]${c}[${n}]`).test(this.#n);this.#r.set(c,u)}const a=this.#r.get(c);if(a)return a}return!1};return r(!s||s===1?[1,7]:s===2?[2,7]:s===3?[3,7]:s===4?[4,7]:s===8?[8]:[7])}checkRol(e){return this.checkAcceso(e,8)}#i(){const e=this.#n,s=e.substring(2,e.length-2);return e.substring(0,2)+e.substring(e.length-2)===D(s)}}const D=t=>{let e=888888;for(let r=0;r<t.length;r++){const i=r%1e3,c=t[r].charCodeAt(0),a=Math.abs(e-c+i)%10;a>6?e+=(c+i)*a+a:a>3?e-=(c-i)*a-i:(e+=Math.abs((c-i)*(a+1))-a*(r%10),e>=1e6&&(e=Math.abs(e)%1e5))}const s=String(e%1e3);for(let r=0;r<s.length;r++)e+=Math.pow(parseInt(s[0]),6-r);let n=e.toString(32).split("").reverse().join("");if(n.length>4)n=n.substring(0,4);else if(n.length<4)for(let r=n.length;r<4;r++)n+=String(4-r);return n},B=new z;class O extends Map{#e=new Map;#s=S(0);#t=S(0);#n=y||-1;constructor(e){if(super(),e){for(var[s,n]of e)super.set(s,n);this.#t.v=super.size}}#r(e){return y===this.#n?S(e):L(e)}has(e){var s=this.#e,n=s.get(e);if(n===void 0){var r=super.get(e);if(r!==void 0)n=this.#r(0),s.set(e,n);else return h(this.#s),!1}return h(n),!0}forEach(e,s){this.#o(),super.forEach(e,s)}get(e){var s=this.#e,n=s.get(e);if(n===void 0){var r=super.get(e);if(r!==void 0)n=this.#r(0),s.set(e,n);else{h(this.#s);return}}return h(n),super.get(e)}set(e,s){var n=this.#e,r=n.get(e),i=super.get(e),p=super.set(e,s),c=this.#s;if(r===void 0)r=this.#r(0),n.set(e,r),d(this.#t,super.size),m(c);else if(i!==s){m(r);var a=c.reactions===null?null:new Set(c.reactions),u=a===null||!r.reactions?.every(I=>a.has(I));u&&m(c)}return p}delete(e){var s=this.#e,n=s.get(e),r=super.delete(e);return n!==void 0&&(s.delete(e),d(this.#t,super.size),d(n,-1),m(this.#s)),r}clear(){if(super.size!==0){super.clear();var e=this.#e;d(this.#t,0);for(var s of e.values())d(s,-1);m(this.#s),e.clear()}}#o(){h(this.#s);var e=this.#e;if(this.#t.v!==e.size){for(var s of super.keys())if(!e.has(s)){var n=this.#r(0);e.set(s,n)}}for([,n]of this.#e)h(n)}keys(){return h(this.#s),super.keys()}values(){return this.#o(),super.values()}entries(){return this.#o(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return h(this.#t),super.size}}const R=()=>{let t=1;return window.innerWidth<740?t=3:window.innerWidth<1140&&(t=2),t},j=b({module:{menus:[]},openSearchLayer:0,deviceType:R(),mobileMenuOpen:0,popoverShowID:0,showSideLayer:0,isLoading:1,pageTitle:"",pageOptions:[],toggleMobileMenu:()=>{},setSideLayer:t=>{j.showSideLayer=t},showMobileSearchLayer:null}),F=new WeakMap,E=b(new O),G=(t,e)=>{if(t===0)return o.fetchID++,o.fetchID;e===0?E.delete(t):E.set(t,e)},g=b([]),H=t=>{g.includes(t)||g.push(t)},K=t=>{const e=g.indexOf(t);e>-1&&g.splice(e,1)},V=()=>{g.length=0},Q=new Map;export{j as C,o as E,F as W,B as a,K as b,q as c,V as d,H as e,E as f,R as g,J as h,Q as i,x as j,G as k,_ as m,g as o};
