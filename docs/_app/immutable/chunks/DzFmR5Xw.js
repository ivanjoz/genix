import"./DsnmJJEf.js";import{a as de}from"./BFTutmdY.js";import{p as fe,e as ve,g as ue,l as J,h as f,i as t,f as _,c as b,s as m,u as me,r as p,t as w,b as g,d as ge,az as _e}from"./Bf0lWsRu.js";import{s as K}from"./WwA8pLij.js";import{i as h}from"./D7jGWfSg.js";import{a as E,b as Q}from"./BWVkWQLM.js";import{s as T}from"./C7iUW-It.js";import{d as be,e as pe}from"./Cu2BEfFs.js";import{p as n}from"./DEnCy23-.js";import{E as j,i as B,d as he}from"./D1d-xt8D.js";import{N as F,a as V}from"./DJ1PLn14.js";var ye=_('<div class="w-full h-full relative flex flex-col items-center justify-center card_input_layer svelte-ilfl9z"><input type="file" accept="image/png, image/jpeg, image/webp" class="svelte-ilfl9z"/> <div style="font-size: 2.4rem"><i class="icon-upload"></i></div> <div class="h5">Subir Imagen</div></div>'),xe=_('<source type="image/avif"/>'),we=_('<source type="image/webp"/>'),ze=_('<picture class="contents"><!> <!> <img class="w-full h-full absolute card_image_img1 svelte-ilfl9z" alt="Upload preview"/></picture>'),Ce=_('<textarea class="w-full card_image_textarea svelte-ilfl9z" placeholder="Nombre..."></textarea>'),Se=_('<div class="absolute w-full card_image_upload_text svelte-ilfl9z"> </div>'),Ue=_('<button class="bnr-1 _5 card_image_btn svelte-ilfl9z" aria-label="Subir imagen"><i class="icon-ok"></i></button>'),Pe=_('<div><!> <!> <div class="w-full absolute flex items-center justify-center card_image_layer_botton svelte-ilfl9z"><button aria-label="Eliminar imagen"><i class="icon-cancel"></i></button> <!></div></div>'),Ie=_('<div class="w-full h-full absolute flex flex-col items-center justify-center card_image_layer_loading svelte-ilfl9z"><div class="c-white h3 ff-bold">Loading...</div> <div class="flex relative items-center justify-center h-22 lh-10 w-[calc(100%-16px)] left-0 right-0 mt-8 _8 mr-8 ml-9 p-2 svelte-ilfl9z"><div class="absolute _9 left-2 h-18 svelte-ilfl9z"></div> <div class="absolute fs14 ff-bold text-white"> </div></div></div>'),De=_("<div><!> <!> <!> <!></div>");function Re(W,i){fe(i,!0);let S=n(i,"src",3,""),A=n(i,"types",19,()=>[]),Y=n(i,"saveAPI",3,"images"),L=n(i,"onUploaded",3,void 0),O=n(i,"setDataToSend",3,void 0),Z=n(i,"clearOnUpload",3,!1),R=n(i,"description",3,""),$=n(i,"cardStyle",3,""),q=n(i,"onDelete",3,void 0),ee=n(i,"cardCss",3,""),M=n(i,"hideFormUseMessage",3,""),ae=n(i,"hideForm",3,!1),te=n(i,"hideUploadButton",3,!1),re=n(i,"id",3,void 0),a=ve(ue(i.imageSource||{src:S(),types:A(),description:R()})),d=me(()=>S()||t(a)?.base64?-1:0);j.imageCounter++;const I=re()||j.imageCounter;J(()=>{S(),i.imageSource,f(a,i.imageSource||{src:S(),base64:"",types:A(),description:R()},!0)});const N=r=>{if(t(a).base64)return t(a).base64;if(!t(a).src)return"";let e=t(a).src||"";return e.substring(0,8)!=="https://"&&e.substring(0,7)!=="http://"&&(i.folder&&(e=i.folder+"/"+e),i.size&&(e=`${e}-x${i.size}`),e=j.S3_URL+e),r&&(e=e+"."+r),e};let D;const k=async()=>{let r={};if(!t(a).base64)return F.failure("No hay nada que enviar."),Promise.resolve(r);f(d,.001);const e={Content:"",Content_x6:"",Content_x4:"",Content_x2:"",Description:t(a).description};if(i.useConvertAvif){const l=[{i:6,r:980,fn:s=>e.Content_x6=s},{i:4,r:670,fn:s=>e.Content_x4=s},{i:2,r:360,fn:s=>e.Content_x2=s}];for(const s of l)s.promise=new Promise(v=>{V(D,s.r,"avif").then(y=>{s.fn(y),v(0)})});try{await Promise.all(l.map(s=>s.promise))}catch(s){return F.failure(`Error al convertir imagen: ${s}`),Promise.resolve(r)}}else e.Content=t(a).base64;O()&&O()(e),console.log("data a enviar::",e);try{r=await he({data:e,route:Y()||"images",onUploadProgress:l=>{l.total&&(f(d,Math.round(l.loaded*100/l.total)),console.log("progress:: ",t(d)))}})}catch(l){return F.failure("Error guardando la imagen: "+String(l)),r}return r.id=I,r.description=t(a).description,Z()?f(a,{src:"",base64:"",types:[],description:""},!0):f(a,{src:`${r.imageName}-x2`,base64:"",types:["webp","avif"],description:t(a).description},!0),f(d,-1),L()&&L()(r.imageName,r.description),r},ie=async r=>{const l=r.target.files;if(!(!l||l.length===0)){D=l[0],console.log("imagefile::",D);try{const s=await V(D,1200,"avif");console.log("imageB64",s),f(d,-1),f(a,{src:"",base64:s,types:[],description:t(a).description},!0),i.onChange?.(t(a),k)}catch(s){F.failure("Error procesando la imagen: "+String(s)),f(d,0)}}};J(()=>{t(a).base64?B.set(I,k):B.delete(I)}),de(()=>{B.delete(I)});var U=De(),H=b(U);{var se=r=>{var e=ye(),l=b(e);l.__change=ie,_e(4),p(e),g(r,e)};h(H,r=>{(t(a)?.src||"").length===0&&r(se)})}var X=m(H,2);{var le=r=>{var e=ze(),l=b(e);{var s=o=>{var x=xe();w(P=>E(x,"srcset",P),[()=>N("avif")]),g(o,x)};h(l,o=>{t(a).types?.includes("avif")&&o(s)})}var v=m(l,2);{var y=o=>{var x=we();w(P=>E(x,"srcset",P),[()=>N("webp")]),g(o,x)};h(v,o=>{t(a).types?.includes("webp")&&o(y)})}var z=m(v,2);p(e),w(o=>E(z,"src",o),[()=>N(t(a)?.types?.[0])]),g(r,e)};h(X,r=>{(t(a).src||t(a).base64||"").length>0&&r(le)})}var G=m(X,2);{var oe=r=>{var e=Pe(),l=b(e);{var s=c=>{var u=Ce();E(u,"rows",3),pe("blur",u,C=>{C.stopPropagation(),t(a).description=C.currentTarget.value||"",i.onChange?.(t(a),k)}),g(c,u)};h(l,c=>{t(a).base64&&!M()&&!ae()&&c(s)})}var v=m(l,2);{var y=c=>{var u=Se(),C=b(u,!0);p(u),w(()=>K(C,M())),g(c,u)};h(v,c=>{t(a).base64&&M()&&c(y)})}var z=m(v,2),o=b(z);o.__click=c=>{if(c.stopPropagation(),q()){q()(S());return}f(a,{src:"",base64:"",types:[],description:""},!0),i.onChange?.(t(a)),f(d,0)};var x=m(o,2);{var P=c=>{var u=Ue();u.__click=C=>{C.stopPropagation(),k()},g(c,u)};h(x,c=>{t(a).base64&&!te()&&c(P)})}p(z),p(e),w(()=>{T(e,1,`w-full h-full absolute card_image_layer${t(a).base64?" s1":""}`,"svelte-ilfl9z"),T(o,1,`bnr-1 _4 mr-12 ${t(a).base64?"":"card_image_layer_bn_close2"} card_image_btn`,"svelte-ilfl9z")}),g(r,e)};h(G,r=>{t(d)===-1&&r(oe)})}var ne=m(G,2);{var ce=r=>{var e=Ie(),l=m(b(e),2),s=b(l),v=m(s,2),y=b(v);p(v),p(l),p(e),w((z,o)=>{Q(s,`width: calc(${z??""}% - 4px);`),K(y,`${o??""} %`)},[()=>Math.round(t(d)),()=>Math.round(t(d))]),g(r,e)};h(ne,r=>{t(d)>0&&r(ce)})}p(U),w(()=>{T(U,1,`relative ${ee()??""} card_image_1 ${t(a)?.src?"":"card_input"}`,"svelte-ilfl9z"),Q(U,$())}),g(W,U),ge()}be(["change","click"]);export{Re as I};
