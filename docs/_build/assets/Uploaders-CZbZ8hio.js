import{d as Y,a as F,g as _,b as h,i as b,j as f,e as m,f as w,p as z,r as H,s as A,t as y}from"./web-CZ5hrCiI.js";import{s as S,c as Z}from"./http-C-zenNQH.js";import{N as ee,E as O}from"./main-C-D57zym.js";var te=y("<div><!$><!/><!$><!/><!$><!/><!$><!/>"),ae=y('<div><input type=file accept="image/png, image/jpeg, image/webp"><div><i class=icon-upload></i></div><div class=h5>Subir Imagen'),T=y("<picture class=dsp-cont><!$><!/><!$><!/><img>"),q=y("<source type=image/avif>"),W=y("<source type=image/webp>"),re=y("<div><!$><!/><div><button><i class=icon-cancel></i></button><!$><!/>"),ne=y("<textarea rows=3 placeholder=Nombre...>"),ie=y('<button class="bnr2 b-blue"><i class=icon-ok>'),se=y('<div><div class="c-white h3 ff-bold">Loading...');const $e=e=>{const[t,r]=F(e||{src:""}),[I,c]=F(e.src?-1:0),u=async a=>{const l=a.target.files[0];console.log("imagefile::",l);const x=await ce({source:l,size:1.2,quality:.89});c(-1),r({src:x})},p=async()=>{let a;c(.001);const n={Content:t().src,Folder:"img-uploads",Description:t().description};e.setDataToSend&&e.setDataToSend(n);try{a=await Z({data:n,route:e.saveAPI||"images",refreshIndexDBCache:e.refreshIndexDBCache||"",onUploadProgress:l=>{const x=Math.round(l.loaded*100/l.total);console.log("progress:: ",x),c(x)}})}catch(l){ee.failure("Error guardando la imagen:",l);return}e.clearOnUpload?(r({src:""}),c(0)):(c(-1),r({src:`${a.imageName}-x2`,types:["webp","avif"]})),e.onUploaded&&e.onUploaded(a.imageName,t().description)},g=()=>t().src?.length>0&&(t()?.types||[]).length===0,d=()=>{let a=t().src;return a.substring(0,5)!=="data:"&&a.substring(0,8)!=="https://"&&a.substring(0,7)!=="http://"&&(a=O.S3_URL+a),a};return(()=>{var a=_(te),n=a.firstChild,[l,x]=h(n.nextSibling),k=l.nextSibling,[L,X]=h(k.nextSibling),G=L.nextSibling,[B,J]=h(G.nextSibling),K=B.nextSibling,[Q,V]=h(K.nextSibling);return b(a,(()=>{var o=f(()=>(t()?.src||"").length===0);return()=>o()&&(()=>{var s=_(ae),C=s.firstChild,P=C.nextSibling;return C.addEventListener("change",D=>u(D)),P.style.setProperty("font-size","2.4rem"),m(()=>w(s,`w100 h100 p-rel flex-column ai-center jc-center ${S.card_input_layer}`)),s})()})(),l,x),b(a,(()=>{var o=f(()=>t()?.src?.length>0);return()=>o()&&(()=>{var s=_(T),C=s.firstChild,[P,D]=h(C.nextSibling),R=P.nextSibling,[U,M]=h(R.nextSibling),N=U.nextSibling;return b(s,(()=>{var v=f(()=>!!t().types?.includes("avif"));return()=>v()&&(()=>{var i=_(q);return m(()=>z(i,"srcset",d()+".avif")),i})()})(),P,D),b(s,(()=>{var v=f(()=>!!t().types?.includes("webp"));return()=>v()&&(()=>{var i=_(W);return m(()=>z(i,"srcset",d()+".webp")),i})()})(),U,M),m(v=>{var i=`w100 h100 p-abs ${S.card_image_img1}`,$=d()+(t().types?.length>0?`.${t().types[0]}`:"");return i!==v.e&&w(N,v.e=i),$!==v.t&&z(N,"src",v.t=$),v},{e:void 0,t:void 0}),s})()})(),L,X),b(a,(()=>{var o=f(()=>I()==-1);return()=>o()&&(()=>{var s=_(re),C=s.firstChild,[P,D]=h(C.nextSibling),R=P.nextSibling,U=R.firstChild,M=U.nextSibling,[N,v]=h(M.nextSibling);return b(s,(()=>{var i=f(()=>!!g());return()=>i()&&(()=>{var $=_(ne);return $.addEventListener("blur",E=>{E.stopPropagation(),t().description=E.target.value||""}),m(()=>w($,`w100 ${S.card_image_textarea}`)),$})()})(),P,D),U.$$click=i=>{if(i.stopPropagation(),e.onDelete){e.onDelete(e.src);return}r({src:""}),c(0)},b(R,(()=>{var i=f(()=>!!g());return()=>i()&&(()=>{var $=_(ie);return $.$$click=E=>{E.stopPropagation(),p()},H(),$})()})(),N,v),m(i=>{var $=`w100 h100 p-abs ${S.card_image_layer}${g()?" s1":""}`,E=`w100 p-abs flex-center ${S.card_image_layer_botton}`,j=`bnr2 b-red mr-04 ${g()?"":S.card_image_layer_bn_close2}`;return $!==i.e&&w(s,i.e=$),E!==i.t&&w(R,i.t=E),j!==i.a&&w(U,i.a=j),i},{e:void 0,t:void 0,a:void 0}),H(),s})()})(),B,J),b(a,(()=>{var o=f(()=>I()>0);return()=>o()&&(()=>{var s=_(se);return m(()=>w(s,`w100 h100 p-abs flex-center ${S.card_image_layer_loading}`)),s})()})(),Q,V),m(o=>{var s=`p-rel ${S.card_image_1} ${t()?.src?"":S.card_input}`,C=e.cardStyle;return s!==o.e&&w(a,o.e=s),o.t=A(a,C,o.t),o},{e:void 0,t:void 0}),a})()},le=(e,t,r,I,c)=>{const u=document.createElement("canvas");return u.width=t,u.height=r,u.getContext("2d").drawImage(e,0,0,t,r),new Promise(g=>{u.toBlob(d=>{d=d;const a=new FileReader;a.readAsDataURL(d),a.onloadend=()=>{const n=a.result;g(n)}},I,c)})},ce=e=>{const t=document.createElement("canvas"),r=new Image;return new Promise((I,c)=>{r.onload=()=>{e.originalSize=[r.width,r.height],t.width=e.originalSize[0],t.height=e.originalSize[1];const u=e.size*1e3*1e3,p=t.width*t.height;let g=t.width,d=t.height;if(p>u){const n=(p/u)**.5;g=Math.floor(t.width/n),d=Math.floor(t.height/n)}t.getContext("2d").drawImage(r,0,0,t.width,t.height),console.log("args 11::",e),le(t,g,d,"image/webp",e.quality).then(n=>{I(n)}).catch(n=>{c(n)})},r.src=URL.createObjectURL(e.source),console.log("Data-URL::",r.src)})},_e=e=>{const t=()=>{let r=e.src;return r.substring(0,5)!=="data:"&&(r.substring(0,8)!=="https://"&&r.substring(0,7)!=="http://"&&(r=O.S3_URL+r),e.size&&(r=`${r}-x${e.size}`)),r};return(()=>{var r=_(T),I=r.firstChild,[c,u]=h(I.nextSibling),p=c.nextSibling,[g,d]=h(p.nextSibling),a=g.nextSibling;return b(r,(()=>{var n=f(()=>!!e.types?.includes("avif"));return()=>n()&&(()=>{var l=_(q);return m(()=>z(l,"srcset",t()+".avif")),l})()})(),c,u),b(r,(()=>{var n=f(()=>!!e.types?.includes("webp"));return()=>n()&&(()=>{var l=_(W);return m(()=>z(l,"srcset",t()+".webp")),l})()})(),g,d),m(n=>{var l=e.style,x=`${e.class||""}`,k=e.style,L=t()+(e.types?.length>0?`.${e.types[0]}`:"");return n.e=A(r,l,n.e),x!==n.t&&w(a,n.t=x),n.a=A(a,k,n.a),L!==n.o&&z(a,"src",n.o=L),n},{e:void 0,t:void 0,a:void 0,o:void 0}),r})()};Y(["click"]);export{$e as I,_e as a};
