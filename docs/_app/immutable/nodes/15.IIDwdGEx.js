import"../chunks/DsnmJJEf.js";import{p as j,e as b,g as F,l as H,m as q,h as f,i as o,d as E,f as K,a as R,c as y,u as z,s as p,r as M,b as G}from"../chunks/CaHRSXkO.js";import{d as J}from"../chunks/EZdBy8tr.js";import{P as Q}from"../chunks/DVpTgxki.js";import{S as W}from"../chunks/vPm9H9nQ.js";import{D as O}from"../chunks/CzqP_zqU.js";import{V as X}from"../chunks/Cu5tfjpp.js";import{N as Y,t as Z,f as ee,L as I,h as S}from"../chunks/7feyQhk5.js";import{A as te}from"../chunks/Brg1lz4h.js";import{P as re}from"../chunks/DV0bFLE3.js";import{a as ae}from"../chunks/BGtFDaK0.js";const se=[{id:1,name:"Entrada Manual"},{id:2,name:"Salida Manual"}],oe=async c=>{let h=`almacen-movimientos?almacen-id=${c.almacenID}`;if(!c.fechaInicio||!c.fechaFin)throw"No se encontró una fecha de inicio o fin.";const l=-18e3;h+=`&fecha-hora-inicio=${c.fechaInicio*24*60*60+l}`,h+=`&fecha-hora-fin=${(c.fechaFin+1)*24*60*60+l}`;let n;try{n=await ae({route:h,errorMessage:"Hubo un error al obtener los movimientos del almacén"})}catch(d){throw Y.failure(d),d}return n.Usuarios=n.Usuarios||[],n.Productos=n.Productos||[],n.Movimientos=n.Movimientos||[],n.Movimientos.sort((d,g)=>g.Created-d.Created),n};var ne=K('<div class="flex items-center justify-between mb-12"><div class="flex items-center w-full" style="max-width: 64rem;"><!> <!> <!> <button class="px-16 py-8 bx-purple mt-8 h-44" aria-label="Consultar registros"><i class="icon-search"></i></button></div> <div class="flex items-center mr-16 w-224 ml-auto relative"><div class="absolute left-12 text-gray-400"><i class="icon-search"></i></div> <input class="w-full pl-36 pr-12 py-8 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" autocomplete="off" type="text" placeholder="Buscar..."/></div></div> <!>',1);function xe(c,h){j(h,!0);const l=new te;new re;const d=Math.floor(Date.now()/(1e3*60*60*24)),g=d-7;let i=b(F({fechaFin:d,fechaInicio:g,almacenID:0})),$=b(F([])),v=b("");const x=new Map,w=new Map,U=new Map(se.map(e=>[e.id,e]));H(()=>{l?.Almacenes?.length>0&&q(()=>{const e=(l.Almacenes||[])[0]?.ID;f(i,{...o(i),almacenID:e},!0)})});const L=async()=>{if(!o(i).almacenID)return;I.standard("Consultando registros...");let e;try{e=await oe(o(i))}catch{I.remove();return}console.log("registros obtenidos: ",e);for(const t of e.Productos)w.set(t.ID,t);for(const t of e.Usuarios)x.set(t.id,t);f($,e.Movimientos,!0),I.remove()},A=(e,t)=>e?`<div class="flex items-center">
      <div class="mr-8">${l.AlmacenesMap.get(e)?.Nombre||`Almacen-${e}`}</div>
      <div class="ff-mono text-blue-600">(</div>
      <div class="ff-mono">${t}</div>
      <div class="ff-mono text-blue-600">)</div>
    </div>`:"",N=[{header:"Fecha Hora",headerCss:"w-120",cellCss:"ff-mono px-6",getValue:e=>ee(e.Created,"d-M h:n")},{header:"Producto",render:e=>{const t=w.get(e.ProductoID)?.Nombre||`Producto-${e.ProductoID}`,m=o(v).toLowerCase().trim().split(" ").filter(r=>r),u=S(t,m);let s="";for(const r of u)r.highl?s+=`<span class="bg-yellow-200">${r.text}</span>`:s+=r.text;return s}},{header:"Lote",headerCss:"w-100",cellCss:"text-purple-600 text-center px-6",getValue:e=>e.Lote||"-"},{header:"SKU",headerCss:"w-100",cellCss:"text-purple-600 text-center px-6",getValue:e=>e.SKU||"-"},{header:"Movimiento",headerCss:"w-120",cellCss:"text-center px-6",render:e=>U.get(e.Tipo)?.name||"-"},{header:"Cantidad",headerCss:"w-100",cellCss:"text-right ff-mono px-6",render:e=>`<div class="flex justify-end ${e.Cantidad<0?"text-red-500":"text-blue-600"}">
          ${e.Cantidad}
        </div>`},{header:"Almacén Origen",render:e=>A(e.AlmacenOrigenID,e.AlmacenOrigenCantidad)},{header:"Almacén Destino",render:e=>A(e.AlmacenID,e.AlmacenCantidad)},{header:"Usuario",headerCss:"w-120",cellCss:"text-center px-6",render:e=>{const t=x.get(e.CreatedBy||1)?.usuario||`Usuario-${e.CreatedBy}`,m=o(v).toLowerCase().trim().split(" ").filter(r=>r),u=S(t,m);let s="";for(const r of u)r.highl?s+=`<span class="bg-yellow-200">${r.text}</span>`:s+=r.text;return s}}];Q(c,{title:"Almacén Movimientos",children:(e,t)=>{var m=ne(),u=R(m),s=y(u),r=y(s);{let a=z(()=>l?.Almacenes||[]);W(r,{save:"almacenID",css:"w-240 mr-12",label:"Almacén",keyId:"ID",keyName:"Nombre",get options(){return o(a)},placeholder:"",required:!0,get saveOn(){return o(i)},set saveOn(C){f(i,C,!0)}})}var _=p(r,2);O(_,{label:"Fecha Inicio",css:"w-140 mr-12",save:"fechaInicio",get saveOn(){return o(i)},set saveOn(a){f(i,a,!0)}});var D=p(_,2);O(D,{label:"Fecha Fin",css:"w-140 mr-12",save:"fechaFin",get saveOn(){return o(i)},set saveOn(a){f(i,a,!0)}});var T=p(D,2);T.__click=a=>{a.stopPropagation(),L()},M(s);var P=p(s,2),k=p(y(P),2);k.__keyup=a=>{a.stopPropagation(),Z(()=>{f(v,(a.target.value||"").toLowerCase().trim(),!0)},150)},M(P),M(u);var V=p(u,2);X(V,{get data(){return o($)},get columns(){return N},css:"w-full",tableCss:"w-full",maxHeight:"calc(100vh - 8rem - 12px)",get filterText(){return o(v)},getFilterContent:a=>{const C=w.get(a.ProductoID)?.Nombre||"",B=x.get(a.CreatedBy||1)?.usuario||"";return[C,B].join(" ").toLowerCase()},useFilterCache:!0}),G(e,m)},$$slots:{default:!0}}),E()}J(["click","keyup"]);export{xe as component};
