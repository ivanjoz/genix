import{a as O,j as xe,c as a,d as je,g as u,b as d,i as n,S as P,r as W,e as ie,f as X,t as f}from"./web-n9SrCLWm.js";import{c as we,t as ye,F as De,H as se,N as L,f as Y,a as v,S as q,I as H,n as Ie,q as E,P as Me,L as R,e as Z}from"./app-CxTCLAtU.js";import{s as k,M as ee}from"./Modals-BV2PqnYn.js";import{Q as te}from"./QTable-BpZD-x6b.js";import{u as Ne,c as oe,g as Te,a as Fe,b as ae,p as Oe,d as Pe,e as ke}from"./ventas-B3c_tsgO.js";import{u as Re}from"./sedes-almacenes-CuoWpN8h.js";var Ve=f('<div class=lh-10><div class="ff-bold h3"></div><div class="h5 c-steel">'),Le=f('<div class="lh-10 t-r"><div class="ff-mono h5"></div><div class="h5 c-steel">'),qe=f("<div>"),ce=f('<div class="box-error-ms mt-08">Seleccione una Caja'),He=f('<div class="flex w100 jc-between mt-08"><div class="flex ai-center"><div class="h3 ff-bold mr-08"></div><button class="bn1 b-yellow"><i class=icon-pencil></i></button></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button>'),Ee=f('<div class="flex w100 jc-between mt-08"><div></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button>'),Ue=f('<div class="flex jc-between mb-06"><div class=""><div class="flex jc-between w100 mb-10"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button></div></div><!$><!/></div><div class=card-c4><!$><!/><!$><!/><!$><!/>'),Ae=f('<div class="w100-10 flex-wrap in-s2"><!$><!/><!$><!/><!$><!/><!$><!/><div class="w100 flex jc-between ai-center"><div></div><!$><!/>'),Be=f('<div class="w100 c-red ff-bold"><i class=icon-attention></i><!$><!/>'),Ge=f('<div class="w100-10 flex-wrap in-s2"><!$><!/><div class=w-10x><button class="bn1 b-purple"><i class="h5 icon-arrows-cw"></i>Recalcular</button></div><!$><!/><div class=w-10x></div><!$><!/><!$><!/>'),ze=f('<div class="w100-10 flex-wrap in-s2"><!$><!/><!$><!/><!$><!/><div class=w-12x></div><!$><!/><!$><!/>'),re=f("<span>");function Ze(){const ne=we(oe,"id"),[de]=Re(),[ue,me]=O(""),[U,ge]=O(1),[i,V]=O({}),[j,A]=O({}),[h,B]=O({}),[be,$e]=O([]),[ve,fe]=O([]),[b,G]=Ne(),he=[{header:"ID",headerStyle:{width:"2rem"},css:"t-c c-purple2",getValue:t=>t.ID},{header:"Nombre",field:"Nombre",cellStyle:{"padding-top":"2px","padding-bottom":"3px"},render:t=>(()=>{var r=u(Ve),l=r.firstChild,c=l.nextSibling;return n(l,()=>t.Nombre),n(c,()=>ae.find(p=>p.id===t.Tipo)?.name||"-"),r})()},{header:"Cuadre",field:"Nombre",render:t=>t.CuadreFecha?(()=>{var r=u(Le),l=r.firstChild,c=l.nextSibling;return n(l,()=>v(t.CuadreSaldo/100,2)),n(c,()=>Y(t.CuadreFecha,"d-M h:n")),r})():""},{header:"Saldo",field:"Nombre",css:"t-r ff-mono",render:t=>(()=>{var r=u(qe);return n(r,()=>v(t.SaldoCurrent/100,2)),r})()}],pe=async()=>{const t=i();if(!t.Nombre||!t.Tipo||!t.SedeID){L.failure("Los inputs Nombre, Tipo y Sede son obligatorios");return}R.standard("Guardando caja...");try{await Oe(t)}catch(r){console.warn(r);return}R.remove(),Object.assign(b().CajasMap.get(t.ID),t),b().Cajas=[...b().Cajas],G({...b()}),k([])},Se=async()=>{const t=j();t.SaldoSistema=i().SaldoCurrent,R.standard("Guardando caja...");let r;try{r=await Pe(t)}catch(c){console.warn(c);return}R.remove();const l=b().CajasMap.get(t.CajaID);if(typeof r?.NeedUpdateSaldo=="number"){l.SaldoCurrent=r.NeedUpdateSaldo,V({...l});const c={...j()};c._error=`Hubo una actualización en el saldo de la caja. El saldo actual es "${v(l.SaldoCurrent/100),2}". Intente nuevamente con el cálculo actualizado.`,c.SaldoDiferencia=c.SaldoReal-l.SaldoCurrent,A(c)}else l.SaldoCurrent=t.SaldoReal,b().Cajas=[...b().Cajas],G({...b()}),Object.assign(i(),l),k([])},_e=async()=>{const t=h();(!t.Tipo||!t.Monto)&&L.failure("Se necesita seleccionar un monto y un tipo."),R.standard("Guardando Movimiento...");let r;try{r=await ke(t)}catch(c){console.warn(c);return}R.remove();const l=b().CajasMap.get(t.CajaID);l.SaldoCurrent=t.SaldoFinal,b().Cajas=[...b().Cajas],G({...b()}),Object.assign(i(),l),k([])},le=xe(()=>[3].includes(h().Tipo));return a(Me,{title:"Cajas & Bancos",get children(){return[(()=>{var t=u(Ue),r=t.firstChild,l=r.firstChild,c=l.firstChild,p=c.firstChild,_=p.nextSibling,D=c.nextSibling,w=D.firstChild,C=l.nextSibling,[I,M]=d(C.nextSibling),m=r.nextSibling,y=m.firstChild,[x,N]=d(y.nextSibling),T=x.nextSibling,[g,s]=d(T.nextSibling),S=g.nextSibling,[z,Q]=d(S.nextSibling);return _.$$keyup=e=>{e.stopPropagation(),ye(()=>{me((e.target.value||"").toLowerCase().trim())},150)},w.$$click=e=>{e.stopPropagation(),V({ID:-1,ss:1}),k([1])},n(r,a(te,{css:"selectable w100",columns:he,maxHeight:"calc(100vh - 8rem - 16px)",styleMobile:{height:"100vh"},get data(){return b()?.Cajas||[]},get selected(){return i().ID},isSelected:(e,o)=>e?.ID===o,get filterText(){return ue()},filterKeys:["nombre"],onRowCLick:e=>{const o=i().ID===e.ID?{}:{...e};V(o)}}),I,M),n(m,a(De,{get selectedID(){return U()},class:"w100",options:[[1,"Movimientos"],[2,"Cuadres"]],buttonStyle:{"min-height":"2.1rem"},buttonClass:"ff-bold",onSelect:e=>{ge(e)}}),x,N),n(m,a(P,{get when(){return U()===1},get children(){return a(se,{get baseObject(){return i()},startPromise:async e=>{if(!e.ID)return;let o;try{o=await Te({CajaID:e.ID,lastRegistros:200})}catch($){L.failure($);return}$e(o)},get children(){return[a(P,{get when(){return!i().ID},get children(){return u(ce)}}),a(P,{get when(){return!!i().ID},get children(){return[(()=>{var e=u(He),o=e.firstChild,$=o.firstChild,F=$.nextSibling,K=o.nextSibling,Ce=K.firstChild;return n($,()=>i()?.Nombre||""),F.$$click=J=>{J.stopPropagation(),k([1])},Ce.$$click=J=>{J.stopPropagation(),k([3]),B({CajaID:i().ID,SaldoFinal:i().SaldoCurrent})},W(),e})(),a(te,{css:"w100 mt-08",maxHeight:"calc(100vh - 8rem - 16px)",styleMobile:{height:"100vh"},get data(){return be()},columns:[{header:"Fecha Hora",getValue:e=>Y(e.Created,"d-M h:n")},{header:"Tipo Mov.",getValue:e=>ne.get(e.Tipo)?.name||""},{header:"Monto",css:"ff-mono t-r",render:e=>(()=>{var o=u(re);return n(o,()=>v(e.Monto/100,2)),ie(()=>X(o,e.Monto<0?"c-red":"")),o})()},{header:"Saldo Final",css:"ff-mono t-r",getValue:e=>v(e.SaldoFinal/100,2)},{header:"Nº Documento",getValue:e=>""},{header:"Usuario",css:"t-c",getValue:e=>e.Usuario?.usuario||""}]})]}})]}})}}),g,s),n(m,a(P,{get when(){return U()===2},get children(){return a(se,{get baseObject(){return i()},startPromise:async e=>{if(!e.ID)return;let o;try{o=await Fe({CajaID:e.ID,lastRegistros:200})}catch($){L.failure($);return}fe(o)},get children(){return[a(P,{get when(){return!i().ID},get children(){return u(ce)}}),a(P,{get when(){return!!i().ID},get children(){return[(()=>{var e=u(Ee),o=e.firstChild,$=o.nextSibling,F=$.firstChild;return F.$$click=K=>{K.stopPropagation(),k([2]),A({CajaID:i().ID})},W(),e})(),a(te,{css:"w100 mt-08",maxHeight:"calc(100vh - 8rem - 16px)",styleMobile:{height:"100vh"},get data(){return ve()},onRowCLick:e=>{const o=i().ID===e.ID?{}:{...e};V(o)},columns:[{header:"Fecha Hora",getValue:e=>Y(e.Created,"d-M h:n")},{header:"Saldo Sistema",css:"ff-mono t-r",getValue:e=>v((e.SaldoSistema||0)/100,2)},{header:"Diferencia",css:"ff-mono t-r",getValue:e=>v((e.SaldoDiferencia||0)/100,2)},{header:"Saldo Real",css:"ff-mono t-r",getValue:e=>v((e.SaldoReal||0)/100,2)},{header:"Usuario",css:"t-c",getValue:e=>e.Usuario?.usuario||""}]})]}})]}})}}),z,Q),ie(e=>{var o=!![2,3].includes(Z()),$=Z()===1?"36%":"100%",F=Z()===1?"calc(62.5% + 1rem)":"100%";return o!==e.e&&t.classList.toggle("column",e.e=o),$!==e.t&&((e.t=$)!=null?r.style.setProperty("width",$):r.style.removeProperty("width")),F!==e.a&&((e.a=F)!=null?m.style.setProperty("width",F):m.style.removeProperty("width")),e},{e:void 0,t:void 0,a:void 0}),W(),t})(),a(ee,{id:1,title:"Cajas",onSave:()=>{pe()},onDelete:()=>{},get children(){var t=u(Ae),r=t.firstChild,[l,c]=d(r.nextSibling),p=l.nextSibling,[_,D]=d(p.nextSibling),w=_.nextSibling,[C,I]=d(w.nextSibling),M=C.nextSibling,[m,y]=d(M.nextSibling),x=m.nextSibling,N=x.firstChild,T=N.nextSibling,[g,s]=d(T.nextSibling);return n(t,a(q,{get saveOn(){return i()},save:"Tipo",css:"w-10x mb-10",label:"Tipo",keys:"id.name",options:ae,placeholder:"",required:!0}),l,c),n(t,a(H,{get saveOn(){return i()},save:"Nombre",css:"w-14x mb-10",label:"Nombre",required:!0}),_,D),n(t,a(H,{get saveOn(){return i()},save:"Descripcion",css:"w-24x mb-10",label:"Descripcion"}),C,I),n(t,a(q,{get saveOn(){return i()},save:"SedeID",css:"w-10x mb-10",label:"Sede",required:!0,get options(){return de().Sedes},keys:"ID.Nombre"}),m,y),n(x,a(Ie,{label:"Saldo Negativo",get saveOn(){return i()},save:"Nombre"}),g,s),t}}),a(ee,{id:2,title:"Cuadre de Caja",onSave:()=>{Se()},get children(){var t=u(Ge),r=t.firstChild,[l,c]=d(r.nextSibling),p=l.nextSibling,_=p.firstChild,D=p.nextSibling,[w,C]=d(D.nextSibling),I=w.nextSibling,M=I.nextSibling,[m,y]=d(M.nextSibling),x=m.nextSibling,[N,T]=d(x.nextSibling);return n(t,a(E,{css:"w-14x mb-10",label:"Saldo Sistema",inputCss:"h3 ff-mono jc-center",get content(){return v(i().SaldoCurrent/100,2)}}),l,c),_.style.setProperty("margin-top","0.9rem"),n(t,a(H,{get saveOn(){return j()},save:"SaldoReal",type:"number",inputCss:"h3 ff-mono t-c",baseDecimals:2,css:"w-14x mb-10",label:"Saldo Encontrado",required:!0,onChange:()=>{console.log("caja cuadre::",j()),A({...j()})}}),w,C),n(t,a(E,{css:"w-14x mb-10",label:"Diferencia",inputCss:"h3 ff-mono jc-center",getContent:()=>{const g=(j().SaldoReal||0)-i().SaldoCurrent;return g?(()=>{var s=u(re);return X(s,g>0?"c-blue":"c-red"),n(s,()=>v(g/100,2)),s})():""}}),m,y),n(t,a(P,{get when(){return j()._error},get children(){var g=u(Be),s=g.firstChild,S=s.nextSibling,[z,Q]=d(S.nextSibling);return n(g,()=>j()._error,z,Q),g}}),N,T),t}}),a(ee,{id:3,title:"Movimiento de Caja",onSave:()=>{_e()},get children(){var t=u(ze),r=t.firstChild,[l,c]=d(r.nextSibling),p=l.nextSibling,[_,D]=d(p.nextSibling),w=_.nextSibling,[C,I]=d(w.nextSibling),M=C.nextSibling,m=M.nextSibling,[y,x]=d(m.nextSibling),N=y.nextSibling,[T,g]=d(N.nextSibling);return n(t,a(q,{get saveOn(){return h()},save:"Tipo",css:"w-12x mb-10",label:"Tipo",keys:"id.name",get options(){return oe.filter(s=>s.group===2)},placeholder:"",required:!0,onChange:()=>{h().CajaRefID=0,B({...h()})}}),l,c),n(t,a(q,{get saveOn(){return h()},save:"CajaRefID",css:"w-12x mb-10",label:"Caja Destino",keys:"id.name",options:ae,get disabled(){return!le()},get placeholder(){return le()?"seleccione":"no aplica"},required:!0}),_,D),n(t,a(H,{get saveOn(){return h()},save:"Monto",inputCss:"ff-mono h3 t-c",css:"w-12x mb-10",label:"Monto",baseDecimals:2,required:!0,type:"number",transform:s=>{const S=ne.get(h().Tipo);return console.log("movimiento tipo::",S),S?.isNegative&&typeof s=="number"&&s>0&&(s=s*-1),s},onChange:()=>{const s={...h()};s.SaldoFinal=i().SaldoCurrent+(s.Monto||0),B(s)}}),C,I),n(t,a(E,{css:"w-12x mb-10",label:"Saldo Inicial",inputCss:"h3 ff-mono jc-center",get content(){return v(i().SaldoCurrent/100,2)}}),y,x),n(t,a(E,{css:"w-12x mb-10",label:"Saldo Final",inputCss:"h3 ff-mono jc-center",getContent:()=>{const s=h().SaldoFinal;return(()=>{var S=u(re);return X(S,s>=0?"":"c-red"),n(S,()=>v(s/100,2)),S})()}}),T,g),t}})]}})}je(["keyup","click"]);export{Ze as default};
