import{a as R,c as g,d as we,g as c,b as m,i as l,S as O,j,r as D,e as q,t as a,k as Pe,l as Ce,f as ge}from"./web-BZ6LonWj.js";import{e as ae,t as ke,I as Q,g as Ee,N as J,L as F}from"./Input-Cf7HKpQs.js";import{s as G,C as Me,M as $e}from"./Modals-D1JuGy2b.js";import{Q as Ae}from"./QTable-DpMhOfGM.js";import{M as me,d as N,S as Ie,a as De,P as Oe}from"./app-B5wVexcE.js";import{d as Ne,e as Le,f as Te,g as je}from"./empresas-BbaDxmtN.js";var Fe=a('<button class="bnr2 b-blue"><i class=icon-pencil>'),Ge=a("<span class=c-red>(Modo Edición)"),Re=a("<span class=mr-04>:"),qe=a('<span class="c-purple2 ml-04">'),ze=a('<button class="bn1 b-white">'),Ve=a('<div class="flex jc-between w100"><div class="ff-bold h2"><span class="">Accesos</span><!$><!/><!$><!/></div><div class="flex ai-center m-corner-r"><!$><!/><!$><!/><!$><!/>'),He=a('<div class="box-error-ms mb-08 w-fit">Debe seleccionar un perfil para editar sus accesos.'),Qe=a('<div class="flex jc-between mb-06"><div class=""><div class="flex jc-between w100 mb-10"><div class="search-c4 mr-16 w16rem"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text></div><div class="flex ai-center"><button class="bn1 b-green"><i class=icon-plus></i></button></div></div><!$><!/></div><!$><!/>'),Ue=a('<div class="flex-wrap w100-10"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><div class="flex ai-center line-c1 w-24x mb-04"><div></div><div class="ff-bold h3">Acciones</div><div></div></div><!$><!/>'),Be=a('<div class="flex-wrap w100-10"><!$><!/><!$><!/>'),Ke=a('<button class="bn1 b-green mr-08"><i class=icon-plus>'),Je=a('<button class="bn1 d-blue"><i class=icon-floppy></i><span class=m-hide>Guardar'),We=a('<i class="c-red icon-cancel">'),Xe=a("<i class=icon-pencil>"),Ye=a('<div class="ff-bold c-purple4 h5"><!$><!/> > <!$><!/>'),Ze=a("<div class=flex-wrap>"),et=a('<div class="line-1 p-abs">'),tt=a('<div class="p-abs flex-center bn1 i-edit"><i class=icon-pencil>'),rt=a('<div class="p-abs flex-center a-id c-purple3">'),st=a("<div class=acciones-ac1>"),lt=a('<div class="acciones-ac2 w100 flex jc-center z10">'),ot=a("<div><div class=mr-04></div><!$><!/><!$><!/><!$><!/>"),it=a("<div class=bnc1><i>"),nt=a('<div class="flex-center h5 ff-bold lh-10">');const fe=[{id:1,name:"Gestión"},{id:2,name:"Seguridad"},{id:3,name:"Maestros"},{id:4,name:"Productos"},{id:5,name:"Reportes"}],ve=[{id:1,name:"Visualizar",short:"VER",icon:"icon-eye",color:"#00c07d",color2:"#49c99c"},{id:2,name:"Editar",short:"EDITAR",icon:"icon-pencil",color:"#0080f9"},{id:3,name:"Eliminar",short:"ELIMINAR",icon:"icon-trash",color:"#0080f9"},{id:7,name:"Todo",short:"EDITAR",icon:"icon-shield",color:"#af12eb",color2:"#d35eff"}],ce=ae(ve,"id");function ft(){const[o,P]=Ne(),[C,U]=Le(),W=ae(fe,"id"),f=ae(me,"id"),[p,z]=R({}),[v,k]=R({}),[X,Y]=R(0),[Z,ee]=R(""),[M,te]=R(!1),i=()=>{const e=new Map,r=X();for(let s of o())for(let $ of s.modulosIDs){if(r&&r!==$)continue;const _=[$,s.grupo].join("_");e.has(_)||e.set(_,[]),e.get(_).push(s);break}const t=[];for(let[s,$]of e){const[_,x]=s.split("_").map(A=>parseInt(A));t.push({moduleID:_,group:x,accesos:$,groupName:W.get(x)?.name||"",moduleName:r?"":f.get(_)?.name||""})}return t},d=[{header:"ID",headerStyle:{width:"2.6rem"},css:"c c-purple2",getValue:e=>e.id},{header:"Perfil",field:"nombre",getValue:e=>e.nombre,cardColumn:[1,1]},{header:"...",headerStyle:{width:"2.6rem"},cardColumn:[1,2],render:e=>(()=>{var r=c(Fe);return r.$$click=t=>{t.stopPropagation(),k({...e}),G([2])},D(),r})()}],h=async()=>{const e=p();if(!e.nombre||!e.orden||(e.acciones?.length||0)==0||!e.grupo||(e.modulosIDs.length||0)===0){J.failure("Faltan propiedades para agregar el acceso.");return}F.standard("Actualizando Acceso...");try{var r=await Te(e)}catch($){J.failure($),F.remove();return}F.remove(),console.log("acceso resultado::",r);let t=[...o()];(e.id||0)<=0&&(e.id=r.id);const s=t.find($=>$.id===e.id);s?Object.assign(s,e):o().push(e),z({}),P([...o()]),G([])},b=async(e,r)=>{const t=v();if(!t.nombre){J.failure("Faltan propiedades para agregar el acceso.");return}if(r){t.accesos=[];for(let[y,I]of t.accesosMap){I.length===0&&t.accesosMap.delete(y);for(let V of I)t.accesos.push(y*10+V)}const x=o().filter(y=>t.accesosMap.has(y.id)),A=new Set;for(let y of x)for(let I of y.modulosIDs)A.add(I);t.modulosIDs=[...A]}console.log("perfil:: ",t),F.standard("Actualizando Perfil...");try{var s=await je(t)}catch(x){J.failure(x),F.remove();return}const $=[...C().perfiles];C().perfiles=$,(t.id||0)<=0&&(t.id=s.id);const _=$.find(x=>x.id===t.id);t._open=!1,_?Object.assign(_,t):$.push(t),F.remove(),console.log("perfil resultado::",s),k({}),U({...C()}),G([])};return g(Oe,{title:"Perfiles & Accesos",fetchLoading:!0,get children(){return[(()=>{var e=c(Qe),r=e.firstChild,t=r.firstChild,s=t.firstChild,$=s.firstChild,_=$.nextSibling,x=s.nextSibling,A=x.firstChild,y=t.nextSibling,[I,V]=m(y.nextSibling),B=r.nextSibling,[re,se]=m(B.nextSibling);return _.$$keyup=n=>{n.stopPropagation(),ke(()=>{ee((n.target.value||"").toLowerCase().trim())},150)},A.$$click=n=>{n.stopPropagation(),k({ss:1}),G([2])},l(r,g(Ae,{css:"selectable w100",columns:d,maxHeight:"calc(100vh - 8rem - 16px)",styleMobile:{height:"100vh"},get data(){return C().perfiles},get selected(){return v().id},get filterText(){return Z()},filterKeys:["nombre"],isSelected:(n,u)=>n.id===u,onRowCLick:n=>{n.id===v().id?k({}):k({...n,_open:!0})}}),I,V),l(e,g(Me,{get showMobileLayer(){return v()._open},get style(){return{width:N()===1?"64.5%":"100%"}},onClose:()=>{k({})},get children(){return[(()=>{var n=c(Ve),u=n.firstChild,S=u.firstChild,L=S.nextSibling,[T,H]=m(L.nextSibling),le=T.nextSibling,[oe,ie]=m(le.nextSibling),K=u.nextSibling,pe=K.firstChild,[de,be]=m(pe.nextSibling),_e=de.nextSibling,[ue,he]=m(_e.nextSibling),xe=ue.nextSibling,[Se,ye]=m(xe.nextSibling);return l(u,g(O,{get when(){return M()},get children(){return c(Ge)}}),T,H),l(u,g(O,{get when(){return v().id>0},get children(){return[c(Re),(()=>{var w=c(qe);return l(w,()=>v().nombre),w})()]}}),oe,ie),l(K,(()=>{var w=j(()=>!!M());return()=>w()&&(()=>{var E=c(Ke);return E.$$click=ne=>{ne.stopPropagation(),z({ss:1}),G([1])},D(),E})()})(),de,be),l(K,(()=>{var w=j(()=>v().id>0);return()=>w()&&(()=>{var E=c(Je);return E.$$click=ne=>{ne.stopPropagation(),b(!1,!0)},D(),E})()})(),ue,he),l(K,g(O,{get when(){return!v().id},get children(){var w=c(ze);return w.$$click=E=>{E.stopPropagation(),te(!M())},l(w,(()=>{var E=j(()=>!!M());return()=>E()?c(We):c(Xe)})()),D(),w}}),Se,ye),n})(),g(O,{get when(){return j(()=>!M())()&&!v().id},get children(){return c(He)}}),j(()=>i().map(n=>[(()=>{var u=c(Ye),S=u.firstChild,[L,T]=m(S.nextSibling),H=L.nextSibling,le=H.nextSibling,[oe,ie]=m(le.nextSibling);return l(u,()=>n.moduleName.toUpperCase(),L,T),l(u,()=>n.groupName.toUpperCase(),oe,ie),u})(),(()=>{var u=c(Ze);return u.style.setProperty("margin","0 -8px"),u.style.setProperty("width","calc(100% + 16px)"),l(u,()=>n.accesos.map(S=>g(ct,{get isEdit(){return M()},acceso:S,get saveOn(){return j(()=>!!v().id)()?v():null},onEdit:()=>{console.log("acceso seleccionado::",S),z({...S}),G([1])}}))),q(()=>u.classList.toggle("px-04",N()!==1)),u})()]))]}}),re,se),q(n=>{var u=!![2,3].includes(N()),S=N()===1?"34%":"100%";return u!==n.e&&e.classList.toggle("column",n.e=u),S!==n.t&&((n.t=S)!=null?r.style.setProperty("width",S):r.style.removeProperty("width")),n},{e:void 0,t:void 0}),D(),e})(),g($e,{id:1,get title(){return p().id?"Editando Acceso":"Creando Acceso"},css:"w44-64 in-s2",get isEdit(){return!!p().id},onSave:()=>{h()},onDelete:()=>{},get children(){var e=c(Ue),r=e.firstChild,[t,s]=m(r.nextSibling),$=t.nextSibling,[_,x]=m($.nextSibling),A=_.nextSibling,[y,I]=m(A.nextSibling),V=y.nextSibling,[B,re]=m(V.nextSibling),se=B.nextSibling,[n,u]=m(se.nextSibling),S=n.nextSibling,L=S.nextSibling,[T,H]=m(L.nextSibling);return l(e,g(Q,{get saveOn(){return p()},save:"nombre",css:"w-14x mb-10",label:"Nombre",required:!0}),t,s),l(e,g(Ie,{get saveOn(){return p()},save:"grupo",css:"w-10x mb-10",label:"Grupo",required:!0,options:fe,keys:"id.name"}),_,x),l(e,g(Q,{get saveOn(){return p()},save:"descripcion",css:"w-16x mb-10",label:"Descripcion"}),y,I),l(e,g(Q,{get saveOn(){return p()},save:"orden",css:"w-08x mb-10",label:"Orden",type:"number"}),B,re),l(e,g(De,{get saveOn(){return p()},save:"modulosIDs",css:"w100 mb-10",label:"Modulos",required:!0,options:me,keys:"id.name"}),n,u),l(e,g(Ee,{save:"acciones",get saveOn(){return p()},css:"w-24x mb-10",options:ve,keys:"id.name"}),T,H),e}}),g($e,{id:2,get title(){return v().id?"Editando Perfil":"Creando Perfil"},css:"w44-64 in-s2",get isEdit(){return!!p().id},onSave:()=>{b()},onClose:()=>{k({})},onDelete:()=>{},get children(){var e=c(Be),r=e.firstChild,[t,s]=m(r.nextSibling),$=t.nextSibling,[_,x]=m($.nextSibling);return l(e,g(Q,{get saveOn(){return v()},save:"nombre",css:"w-24x mb-10",label:"Nombre",required:!0}),t,s),l(e,g(Q,{get saveOn(){return v()},save:"descripcion",css:"w-24x mb-10",label:"Descripcion"}),_,x),e}})]}})}const ct=o=>{const[P,C]=R([]);Pe(Ce(()=>o.saveOn,()=>{C(o.saveOn?.accesosMap?.get(o.acceso.id)||[])}));const U=()=>{if(P().length===0||o.isEdit)return;const f=P();f.sort().reverse();const p=ce.get(f[0]||0);return p?.color2||p?.color||""},W=()=>{let f="acceso-card";return o.isEdit&&(f+=" sel"),[2,3].includes(N())&&(f+=" mobile"),f};return(()=>{var f=c(ot),p=f.firstChild,z=p.nextSibling,[v,k]=m(z.nextSibling),X=v.nextSibling,[Y,Z]=m(X.nextSibling),ee=Y.nextSibling,[M,te]=m(ee.nextSibling);return f.$$click=i=>{if(![1].includes(N()))if(i.stopPropagation(),P().length>=o.acceso.acciones.length)C([]);else{const d=[...P()],h=o.acceso.acciones.filter(b=>!d.includes(b));d.push(h[0]),C(d.filter(b=>b))}},l(p,()=>o.acceso.nombre),l(f,g(O,{get when(){return[2,3].includes(N())},get children(){var i=c(et);return q(d=>(d=U())!=null?i.style.setProperty("background-color",d):i.style.removeProperty("background-color")),i}}),v,k),l(f,g(O,{get when(){return o.isEdit},get children(){return[(()=>{var i=c(tt);return i.$$click=d=>{d.stopPropagation(),o.onEdit&&o.onEdit()},D(),i})(),(()=>{var i=c(rt);return l(i,()=>o.acceso.id),i})()]}}),Y,Z),l(f,g(O,{get when(){return!o.isEdit&&o.saveOn},get children(){return[(()=>{var i=c(st);return l(i,()=>P().map(d=>{console.log("acciones ids:: ",d);const h=ce.get(d);return(()=>{var b=c(it),e=b.firstChild;return q(r=>{var t=h.color,s=h.icon;return t!==r.e&&((r.e=t)!=null?b.style.setProperty("background-color",t):b.style.removeProperty("background-color")),s!==r.t&&ge(e,r.t=s),r},{e:void 0,t:void 0}),b})()})),i})(),(()=>{var i=c(lt);return l(i,()=>o.acceso.acciones.map(d=>{const h=ce.get(d),b=P().includes(d);return(()=>{var e=c(nt);return e.$$click=r=>{r.stopPropagation();let t=[...P()];t.includes(d)?t=t.filter(s=>s!==d):t.push(d),console.log("seteando acciones:: ",t),t.sort((s,$)=>$-s),t.length===0?o.saveOn.accesosMap.delete(o.acceso.id):o.saveOn.accesosMap.set(o.acceso.id,t),C(t)},(b?"white":void 0)!=null?e.style.setProperty("color",b?"white":void 0):e.style.removeProperty("color"),l(e,()=>h.short),q(r=>{var t=b?h.color:void 0,s=b?h.color:void 0;return t!==r.e&&((r.e=t)!=null?e.style.setProperty("background-color",t):e.style.removeProperty("background-color")),s!==r.t&&((r.t=s)!=null?e.style.setProperty("border-color",s):e.style.removeProperty("border-color")),r},{e:void 0,t:void 0}),D(),e})()})),i})()]}}),M,te),q(i=>{var d=W(),h=U();return d!==i.e&&ge(f,i.e=d),h!==i.t&&((i.t=h)!=null?f.style.setProperty("border-left-color",h):f.style.removeProperty("border-left-color")),i},{e:void 0,t:void 0}),D(),f})()};we(["click","keyup"]);export{ft as default};
