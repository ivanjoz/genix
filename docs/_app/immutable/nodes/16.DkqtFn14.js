import"../chunks/DsnmJJEf.js";import{p as Pe,e as V,g as A,l as Ce,i as e,h as n,d as Le,f as D,a as R,c as i,s as r,r as l,u as P,b as x,t as U,x as B}from"../chunks/CaHRSXkO.js";import{s as z}from"../chunks/CrFq4NBa.js";import{i as $}from"../chunks/BLuAT40e.js";import{d as qe}from"../chunks/EZdBy8tr.js";import{s as be}from"../chunks/ZZ_SO04P.js";import{I as J}from"../chunks/C7ON8eMg.js";import{M as se}from"../chunks/CjajAhZ1.js";import{O as He}from"../chunks/C7N1FGw4.js";import{P as Ue}from"../chunks/DVpTgxki.js";import{S as K}from"../chunks/vPm9H9nQ.js";import{C as ze}from"../chunks/R2AuMfvk.js";import{V as oe}from"../chunks/Cu5tfjpp.js";import{N as Q,t as Ee,f as ie,L as E}from"../chunks/7feyQhk5.js";import{C as L,f as O}from"../chunks/BGtFDaK0.js";import{A as Ge}from"../chunks/Brg1lz4h.js";import{c as he,C as Ae,g as Be,a as Je,b as le,p as Ke,d as Qe,e as We}from"../chunks/xWnkAKcQ.js";var Xe=D('<div class="flex justify-center items-center py-40"><div class="text-slate-400">Cargando...</div></div>'),Ye=D('<div class="bg-red-100 text-red-700 p-8 mt-8 rounded">Seleccione una Caja</div>'),Ze=D('<div class="flex w-full justify-between mt-8"><div class="flex items-center"><div class="text-[1.1rem] ff-bold mr-8"> </div> <button class="bx-yellow" aria-label="edit"><i class="icon-pencil"></i></button></div> <div class="flex items-center"><button class="bx-green" aria-label="add"><i class="icon-plus"></i></button></div></div> <!>',1),ea=D('<div class="flex justify-center items-center py-40"><div class="text-slate-400">Cargando...</div></div>'),aa=D('<div class="bg-red-100 text-red-700 p-8 mt-8 rounded">Seleccione una Caja</div>'),ta=D('<div class="flex w-full justify-between mt-8"><div></div> <div class="flex items-center"><button class="bx-green" aria-label="add"><i class="icon-plus"></i></button></div></div> <!>',1),ra=D('<div class="grid grid-cols-24 gap-10"><!> <!> <!> <!> <div class="col-span-24 flex justify-between items-center"><div></div> <!></div></div>'),sa=D("<span> </span>"),oa=D('<div class="col-span-24 text-red-600 ff-bold"><i class="icon-attention"></i> </div>'),ia=D('<div class="flex items-start w-full p-16"><div class="w-260 mr-16"><div class="w-full mb-12"><div class="text-sm mb-4 text-slate-600">Saldo Sistema</div> <div class="text-[1.1rem] ff-mono text-center bg-slate-100 py-8 rounded"> </div></div> <!> <div class="mb-12"></div> <div class="w-full"><div class="text-sm mb-4 text-slate-600">Diferencia</div> <div class="text-[1.1rem] min-h-32 ff-mono text-center bg-slate-100 py-8 rounded"><!></div></div></div> <div class="flex items-end"><button class="bx-purple w-full mt-24"><i class="text-[0.875rem] icon-arrows-cw"></i> Recalcular</button></div> <!></div>'),la=D("<span> </span>"),na=D('<div class="grid grid-cols-24 gap-10"><!> <!> <!> <div class="col-span-24 md:col-span-12"></div> <div class="col-span-24 md:col-span-12"><div class="text-sm mb-4 text-slate-600">Saldo Inicial</div> <div class="text-[1.1rem] ff-mono text-center bg-slate-100 py-8 rounded"> </div></div> <div class="col-span-24 md:col-span-12"><div class="text-sm mb-4 text-slate-600">Saldo Final</div> <div class="text-[1.1rem] ff-mono text-center bg-slate-100 py-8 rounded"><!></div></div></div>'),da=D('<div class="flex flex-col md:flex-row justify-between mb-6 gap-10"><div class="w-full md:w-[36%]"><div class="flex justify-between items-center w-full mb-10"><div class="i-search mr-16 w-256"><div><i class="icon-search"></i></div> <input class="w-full" autocomplete="off" type="text"/></div> <div class="flex items-center"><button class="bx-green" aria-label="agregar"><i class="icon-plus"></i></button></div></div> <!></div> <div class="w-full md:w-[calc(64%-22px)] bg-white rounded-md shadow-sm p-12"><!> <!> <!></div></div> <!> <!> <!>',1);function Ma(je,Se){Pe(Se,!0);const ne=new Map(he.map(a=>[a.id,a])),we=new Ge,T=new Ae;let W=V(""),q=V(1),t=V(A({})),j=V(A({})),C=V(A({})),de=V(A([])),ce=V(A([])),X=V(!1),Y=V(!1);const ye=[{header:"ID",headerCss:"w-32",cellCss:"text-center text-purple-600 px-6",getValue:a=>a.ID},{header:"Nombre",cellCss:"px-6 py-2",getValue:a=>a.Nombre,render:a=>{const b=le.find(v=>v.id===a.Tipo)?.name||"-";return`<div class="leading-tight">
          <div class="ff-bold leading-[1.1] h3">${a.Nombre}</div>
          <div class="fs15 text-slate-500">${b}</div>
        </div>`}},{header:"Cuadre",getValue:a=>a.CuadreFecha?String(a.CuadreFecha):"",render:a=>{if(!a.CuadreFecha)return"";const b=O(a.CuadreSaldo/100,2),v=ie(a.CuadreFecha,"d-M h:n");return`<div class="leading-tight text-right">
          <div class="ff-mono text-[0.875rem]">${b}</div>
          <div class="text-[0.875rem] text-slate-500">${v}</div>
        </div>`}},{header:"Saldo",cellCss:"text-right ff-mono px-6",getValue:a=>O(a.SaldoCurrent/100,2)}],De=async()=>{const a=e(t);if(!a.Nombre||!a.Tipo||!a.SedeID){Q.failure("Los inputs Nombre, Tipo y Sede son obligatorios");return}E.standard("Guardando caja...");try{await Ke(a)}catch(v){console.warn(v);return}E.remove();const b=T.CajasMap.get(a.ID);b&&(Object.assign(b,a),T.Cajas=[...T.Cajas]),L.closeModal(1)},Me=async()=>{const a=e(j);a.SaldoSistema=e(t).SaldoCurrent,E.standard("Guardando caja...");let b;try{b=await Qe(a)}catch(M){console.warn(M);return}E.remove();const v=T.CajasMap.get(a.CajaID);if(v)if(typeof b?.NeedUpdateSaldo=="number"){v.SaldoCurrent=b.NeedUpdateSaldo,n(t,{...v},!0);const M={...e(j)};M._error=`Hubo una actualización en el saldo de la caja. El saldo actual es "${O(v.SaldoCurrent/100,2)}". Intente nuevamente con el cálculo actualizado.`,M.SaldoDiferencia=M.SaldoReal-v.SaldoCurrent,n(j,M,!0)}else v.SaldoCurrent=a.SaldoReal,T.Cajas=[...T.Cajas],Object.assign(e(t),v),L.closeModal(2)},Ie=async()=>{const a=e(C);if(!a.Tipo||!a.Monto){Q.failure("Se necesita seleccionar un monto y un tipo.");return}E.standard("Guardando Movimiento...");let b;try{b=await We(a)}catch(M){console.warn(M);return}E.remove();const v=T.CajasMap.get(a.CajaID);v&&(v.SaldoCurrent=a.SaldoFinal,T.Cajas=[...T.Cajas],Object.assign(e(t),v),L.closeModal(3))},ve=P(()=>[3].includes(e(C).Tipo));Ce(()=>{e(q)===1&&e(t).ID&&(n(X,!0),Be({CajaID:e(t).ID,lastRegistros:200}).then(a=>{n(de,a,!0)}).catch(a=>{Q.failure(a)}).finally(()=>{n(X,!1)}))}),Ce(()=>{e(q)===2&&e(t).ID&&(n(Y,!0),Je({CajaID:e(t).ID,lastRegistros:200}).then(a=>{n(ce,a,!0)}).catch(a=>{console.log("Error:",a),Q.failure(a)}).finally(()=>{n(Y,!1)}))});const Ne=P(()=>{if(!e(W))return T.Cajas;const a=e(W).toLowerCase();return T.Cajas.filter(b=>b.Nombre?.toLowerCase().includes(a))});Ue(je,{title:"Cajas & Bancos",children:(a,b)=>{var v=da(),M=R(v),Z=i(M),ee=i(Z),ae=i(ee),Oe=r(i(ae),2);Oe.__keyup=d=>{d.stopPropagation(),Ee(()=>{n(W,(d.target.value||"").toLowerCase().trim(),!0)},150)},l(ae);var ue=r(ae,2),Te=i(ue);Te.__click=d=>{d.stopPropagation(),n(t,{ID:-1,ss:1},!0),L.openModal(1)},l(ue),l(ee);var ke=r(ee,2);oe(ke,{css:"w-full",get columns(){return ye},maxHeight:"calc(100vh - 8rem - 16px)",get data(){return e(Ne)},get selected(){return e(t).ID},isSelected:(d,I)=>d?.ID===I,tableCss:"cursor-pointer",onRowClick:d=>{const I=e(t).ID===d.ID?{}:{...d};n(t,I,!0)}}),l(Z);var me=r(Z,2),pe=i(me);He(pe,{get selected(){return e(q)},options:[[1,"Movimientos"],[2,"Cuadres"]],buttonCss:"ff-bold",onSelect:d=>{n(q,d[0],!0)}});var fe=r(pe,2);{var Fe=d=>{var I=B(),h=R(I);{var S=c=>{var f=Xe();x(c,f)},w=c=>{var f=B(),N=R(f);{var F=g=>{var y=Ye();x(g,y)},p=g=>{var y=Ze(),k=R(y),s=i(k),o=i(s),_=i(o,!0);l(o);var u=r(o,2);u.__click=m=>{m.stopPropagation(),L.openModal(1)},l(s);var H=r(s,2),te=i(H);te.__click=m=>{m.stopPropagation(),L.openModal(3),n(C,{CajaID:e(t).ID,SaldoFinal:e(t).SaldoCurrent},!0)},l(H),l(k);var G=r(k,2);oe(G,{css:"w-full mt-8",maxHeight:"calc(100vh - 8rem - 16px)",get data(){return e(de)},columns:[{header:"Fecha Hora",getValue:m=>ie(m.Created,"d-M h:n")},{header:"Tipo Mov.",getValue:m=>ne.get(m.Tipo)?.name||""},{header:"Monto",cellCss:"ff-mono text-right px-6",render:m=>{const re=O(m.Monto/100,2);return`<span class="${m.Monto<0?"text-red-600":""}">${re}</span>`}},{header:"Saldo Final",cellCss:"ff-mono text-right px-6",getValue:m=>O(m.SaldoFinal/100,2)},{header:"Nº Documento",getValue:m=>""},{header:"Usuario",cellCss:"text-center px-6",getValue:m=>m.Usuario?.usuario||""}]}),U(()=>z(_,e(t)?.Nombre||"")),x(g,y)};$(N,g=>{e(t).ID?g(p,!1):g(F)},!0)}x(c,f)};$(h,c=>{e(X)?c(S):c(w,!1)})}x(d,I)};$(fe,d=>{e(q)===1&&d(Fe)})}var $e=r(fe,2);{var Ve=d=>{var I=B(),h=R(I);{var S=c=>{var f=ea();x(c,f)},w=c=>{var f=B(),N=R(f);{var F=g=>{var y=aa();x(g,y)},p=g=>{var y=ta(),k=R(y),s=r(i(k),2),o=i(s);o.__click=u=>{u.stopPropagation(),L.openModal(2),n(j,{CajaID:e(t).ID},!0)},l(s),l(k);var _=r(k,2);oe(_,{css:"w-full mt-8",maxHeight:"calc(100vh - 8rem - 16px)",get data(){return e(ce)},columns:[{header:"Fecha Hora",getValue:u=>ie(u.Created,"d-M h:n")},{header:"Saldo Sistema",cellCss:"ff-mono text-right px-6",getValue:u=>O((u.SaldoSistema||0)/100,2)},{header:"Diferencia",cellCss:"ff-mono text-right px-6",getValue:u=>O((u.SaldoDiferencia||0)/100,2)},{header:"Saldo Real",cellCss:"ff-mono text-right px-6",getValue:u=>O((u.SaldoReal||0)/100,2)},{header:"Usuario",cellCss:"text-center px-6",getValue:u=>u.Usuario?.usuario||""}]}),x(g,y)};$(N,g=>{e(t).ID?g(p,!1):g(F)},!0)}x(c,f)};$(h,c=>{e(Y)?c(S):c(w,!1)})}x(d,I)};$($e,d=>{e(q)===2&&d(Ve)})}l(me),l(M);var ge=r(M,2);se(ge,{id:1,title:"Cajas",size:6,bodyCss:"px-16 py-14",onSave:()=>{De()},onDelete:()=>{},children:(d,I)=>{var h=ra(),S=i(h);K(S,{save:"Tipo",css:"col-span-24 md:col-span-10",label:"Tipo",keyId:"id",keyName:"name",get options(){return le},placeholder:"",required:!0,get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var w=r(S,2);J(w,{save:"Nombre",css:"col-span-24 md:col-span-14",label:"Nombre",required:!0,get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var c=r(w,2);J(c,{save:"Descripcion",css:"col-span-24",label:"Descripcion",get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var f=r(c,2);K(f,{save:"SedeID",css:"col-span-24 md:col-span-10",label:"Sede",required:!0,get options(){return we.Sedes},keyId:"ID",keyName:"Nombre",get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}});var N=r(f,2),F=r(i(N),2);ze(F,{label:"Saldo Negativo",save:"Nombre",get saveOn(){return e(t)},set saveOn(p){n(t,p,!0)}}),l(N),l(h),x(d,h)},$$slots:{default:!0}});var _e=r(ge,2);se(_e,{id:2,title:"Cuadre de Caja",size:6,onSave:()=>{Me()},children:(d,I)=>{var h=ia(),S=i(h),w=i(S),c=r(i(w),2),f=i(c,!0);l(c),l(w);var N=r(w,2);J(N,{save:"SaldoReal",type:"number",inputCss:"text-[1.1rem] ff-mono text-center",baseDecimals:2,css:"w-full mb-12",label:"Saldo Encontrado",required:!0,onChange:()=>{console.log("caja cuadre::",e(j)),n(j,{...e(j)},!0)},get saveOn(){return e(j)},set saveOn(o){n(j,o,!0)}});var F=r(N,4),p=r(i(F),2),g=i(p);{var y=o=>{const _=P(()=>(e(j).SaldoReal||0)-e(t).SaldoCurrent);var u=B(),H=R(u);{var te=G=>{var m=sa(),re=i(m,!0);l(m),U(xe=>{be(m,1,e(_)>0?"text-blue-600":"text-red-600"),z(re,xe)},[()=>O(e(_)/100,2)]),x(G,m)};$(H,G=>{e(_)&&G(te)})}x(o,u)};$(g,o=>{e(j).SaldoReal&&o(y)})}l(p),l(F),l(S);var k=r(S,4);{var s=o=>{var _=oa(),u=r(i(_),1,!0);l(_),U(()=>z(u,e(j)._error)),x(o,_)};$(k,o=>{e(j)._error&&o(s)})}l(h),U(o=>z(f,o),[()=>O((e(t).SaldoCurrent||0)/100,2)]),x(d,h)},$$slots:{default:!0}});var Re=r(_e,2);se(Re,{id:3,title:"Movimiento de Caja",size:6,onSave:()=>{Ie()},children:(d,I)=>{var h=na(),S=i(h);{let s=P(()=>he.filter(o=>o.group===2));K(S,{save:"Tipo",css:"col-span-24 md:col-span-12",label:"Tipo",keyId:"id",keyName:"name",get options(){return e(s)},placeholder:"",required:!0,onChange:()=>{e(C).CajaRefID=0,n(C,{...e(C)},!0)},get saveOn(){return e(C)},set saveOn(o){n(C,o,!0)}})}var w=r(S,2);{let s=P(()=>!e(ve)),o=P(()=>e(ve)?"seleccione":"no aplica");K(w,{save:"CajaRefID",css:"col-span-24 md:col-span-12",label:"Caja Destino",keyId:"id",keyName:"name",get options(){return le},get disabled(){return e(s)},get placeholder(){return e(o)},required:!0,get saveOn(){return e(C)},set saveOn(_){n(C,_,!0)}})}var c=r(w,2);J(c,{save:"Monto",inputCss:"ff-mono text-[1.1rem] text-center",css:"col-span-24 md:col-span-12",label:"Monto",baseDecimals:2,required:!0,type:"number",transform:s=>{const o=ne.get(e(C).Tipo);return console.log("movimiento tipo::",o),o?.isNegative&&typeof s=="number"&&s>0&&(s=s*-1),s},onChange:()=>{const s={...e(C)};s.SaldoFinal=e(t).SaldoCurrent+(s.Monto||0),n(C,s,!0)},get saveOn(){return e(C)},set saveOn(s){n(C,s,!0)}});var f=r(c,4),N=r(i(f),2),F=i(N,!0);l(N),l(f);var p=r(f,2),g=r(i(p),2),y=i(g);{var k=s=>{const o=P(()=>e(C).SaldoFinal);var _=la(),u=i(_,!0);l(_),U(H=>{be(_,1,e(o)>=0?"":"text-red-600"),z(u,H)},[()=>O(e(o)/100,2)]),x(s,_)};$(y,s=>{e(C).SaldoFinal!==void 0&&s(k)})}l(g),l(p),l(h),U(s=>z(F,s),[()=>O(e(t).SaldoCurrent/100,2)]),x(d,h)},$$slots:{default:!0}}),x(a,v)},$$slots:{default:!0}}),Le()}qe(["keyup","click"]);export{Ma as component};
