import"./DsnmJJEf.js";import{p as Oe,a2 as Y,at as Te,g as me,k as e,f as k,a as O,d as _,r as f,s as le,t as E,aH as M,b as c,c as Me,a3 as H,h as et,b4 as Ve,au as W,b5 as tt}from"./xxzRbNoF.js";import{s as Z}from"./Dh4QK2gy.js";import{d as Fe,e as at,s as rt}from"./CR64gONK.js";import{i as F}from"./Dlky6Ld2.js";import{e as fe,i as _e}from"./DYyZyIdl.js";import{h as st}from"./B6XpzTLd.js";import{s as L,a as X,r as lt,b as be,d as it}from"./BtvgxEYs.js";import{b as Le}from"./BezaTGJA.js";import{p as I}from"./BiWXNKKg.js";import{i as nt,h as ot}from"./VsnTSXou.js";function vt(z){let t=null,V=0,ie=new Map,D=null,p=new Set,j=!1,T=null;function C(){if(j||(t=z.getScrollElement(),!t))return;j=!0,V=t.scrollTop;const n=()=>{D!==null&&cancelAnimationFrame(D),D=requestAnimationFrame(()=>{t&&(V=t.scrollTop,m()),D=null})};t.addEventListener("scroll",n,{passive:!0}),T=new ResizeObserver(()=>{m()}),T.observe(t)}function m(){p.forEach(n=>n())}function g(n){return ie.get(n)??z.estimateSize(n)}function u(){return z.getCount?z.getCount():z.count}function B(){let n=0;const q=u();for(let b=0;b<q;b++)n+=g(b);return n}function K(){if(!t)return[];V=t.scrollTop;const n=u(),q=z.overscan??3,b=t.clientHeight;if(b<=0)return[];let G=0,x=0;for(let o=0;o<n;o++){const h=g(o);if(x+h>V){G=Math.max(0,o-q);break}x+=h}x=0;for(let o=0;o<G;o++)x+=g(o);const N=[],ne=V+b;for(let o=G;o<n;o++){const h=g(o),A=x+h;if(N.push({index:o,start:x,size:h,end:A,key:o}),x=A,x>ne+q*z.estimateSize(0))break}return N}return C(),{subscribe:n=>(p.add(n),()=>{p.delete(n)}),getVirtualItems:()=>(j||C(),K()),getTotalSize:()=>(j||C(),B()),refresh:()=>{m()}}}var ct=k('<i class="icon-attention c-red svelte-x3xm2s"></i>'),dt=k("<input/>"),ft=k('<div class="_2 svelte-x3xm2s"> </div> <div><div role="button" tabindex="0"> <!></div> <!></div>',1);function ut(z,t){Oe(t,!0);let V=I(t,"saveOn",7),ie=I(t,"contentClass",3,""),D=I(t,"inputClass",3,""),p=I(t,"required",3,!1),j=I(t,"type",3,"text"),T=Y(!1),C=Y(void 0);const m=t.getValue?t.getValue(V()):(V()||{})[t.save];let g=Y(Te(m)),u=Y(Te(m));me(()=>{e(T)&&e(C)&&e(C).focus()});function B(i){return j()==="number"?parseFloat(i||"0"):i}function K(i){const d=B(i);V()[t.save]=d,H(g,d,!0)}function n(i){i.stopPropagation(),H(u,e(g),!0),H(T,!0)}function q(i){i.stopPropagation(),K(i.target.value)}function b(i){i.stopPropagation();const d=B(i.target.value);e(u)!==d&&(H(u,d,!0),t.onChange&&t.onChange(d)),H(T,!1)}const G=M(()=>t.render?t.render(e(g),e(T)):e(g));var x=ft(),N=O(x),ne=_(N,!0);f(N);var o=le(N,2),h=_(o);h.__click=n,h.__keydown=i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),n(i))};let A;var $=_(h),xe=le($);{var Ce=i=>{var d=ct();c(i,d)};F(xe,i=>{!e(g)&&p()&&i(Ce)})}f(h);var ue=le(h,2);{var ye=i=>{var d=dt();lt(d),d.__keyup=q,Le(d,a=>H(C,a),()=>e(C)),E(()=>{be(d,"type",j()),it(d,e(g)||""),L(d,1,`w-full ${D()}`,"svelte-x3xm2s")}),at("blur",d,b),c(i,d)};F(ue,i=>{e(T)&&i(ye)})}f(o),E(()=>{Z(ne,e(g)),L(o,1,`_1 ${t.css??""}`,"svelte-x3xm2s"),L(h,1,ie(),"svelte-x3xm2s"),A=X(h,"",A,{visibility:e(T)?"hidden":"visible"}),Z($,`${e(G)??""} `)}),c(z,x),Me()}Fe(["click","keydown","keyup"]);var ht=k('<th><div class="svelte-1kfim0d"> </div></th>'),gt=k('<th><div class="svelte-1kfim0d"> </div></th>'),_t=k('<tr class="vtable-header-row vtable-header-row-sub svelte-1kfim0d"></tr>'),mt=k('<tr><td class="vtable-empty svelte-1kfim0d"><div class="vtable-empty-message svelte-1kfim0d"> </div></td></tr>'),bt=k("<span> </span>"),xt=k("<td><!></td>"),Ct=k('<tr><td style="border: none;"></td></tr>'),yt=k("<tr></tr> <!>",1),St=k('<div><table><thead class="vtable-header svelte-1kfim0d"><tr class="vtable-header-row svelte-1kfim0d"></tr><!></thead><tbody class="vtable-body svelte-1kfim0d"><!></tbody></table></div>');function Ft(z,t){Oe(t,!0);let V=I(t,"maxHeight",3,"calc(100vh - 8rem)"),ie=I(t,"css",3,""),D=I(t,"tableCss",3,""),p=I(t,"estimateSize",3,34),j=I(t,"overscan",3,15),T=I(t,"emptyMessage",3,"No se encontraron registros."),C=Y(void 0),m=Y(Te([])),g=Y(0),u=null,B=!1,K=Y(0);const n=M(()=>{const a=[],r=[],v=[];for(const s of t.columns){const l={...s};if(l._colspan=s.subcols?.length||0,a.push(l),s.subcols&&s.subcols.length>0)for(const y of s.subcols)r.push(y),v.push(y);else v.push(l)}return{level1:a,level2:r,flatColumns:v,hasSubcols:r.length>0}}),q=M(()=>(t.filterText||"").toLowerCase().split(" ").filter(a=>a.length>1)),b=M(()=>{if(console.log("filterText",t.filterText),t.filterText&&t.getFilterContent){const a=t.data.filter(r=>nt(t.getFilterContent(r).toLowerCase(),e(q)));return console.log("data filtrada::",a),a}else return t.data});me(()=>{(t.selected||!t.selected)&&console.log("selected::",t.selected)}),me(()=>{if(e(C)&&!u){u=vt({count:0,getScrollElement:()=>e(C),estimateSize:()=>p(),overscan:j(),getCount:()=>e(b).length});const a=()=>{const v=u.getVirtualItems(),s=u.getTotalSize();H(m,[...v],!0),H(g,s,!0)},r=u.subscribe(a);return requestAnimationFrame(()=>{a(),B=!0}),()=>{B=!1,u=null,r()}}}),me(()=>{e(b),e(b).length,B&&u&&et(()=>{Ve(K),u.refresh();const a=u.getVirtualItems(),r=u.getTotalSize();H(m,[...a],!0),H(g,r,!0)})});function G(a,r,v){let s="",l=!1,y=!1;a.renderHTML?(s=a.renderHTML(r,v,()=>{Ve(K)}),l=!0):a.render?(s=a.render(r,v,()=>{Ve(K)}),l=typeof s=="string"&&/<[^>]+>/.test(s)):a.getValue?(s=a.getValue(r,v),l=!1):a.field&&(s=r[a.field],l=!1),t.cellRenderer&&(y=!0);let R=typeof a.cellCss=="string"?a.cellCss:a.onEditChange?"relative":"px-8 py-4";return a.css&&(R+=" "+a.css),{content:s,isHTML:l,useSnippet:y,css:R}}function x(a){return typeof a.header=="function"?a.header():a.header}function N(a,r){return!t.selected||!t.isSelected?!1:t.isSelected(a,t.selected)}function ne(a,r){t.onRowClick&&t.onRowClick(a,r)}var o=St(),h=_(o),A=_(h),$=_(A);fe($,21,()=>e(n).level1,_e,(a,r)=>{var v=ht();let s;var l=_(v),y=_(l,!0);f(l),f(v),E((R,P)=>{s=L(v,1,`vtable-header-cell ${(e(r).headerCss||"")??""}`,"svelte-1kfim0d",s,{hsc:(e(r).subcols||[]).length>0}),X(v,R),be(v,"colspan",e(r)._colspan||1),be(v,"rowspan",e(r)._colspan?1:e(n).hasSubcols?2:1),Z(y,P)},[()=>e(r).headerStyle?Object.entries(e(r).headerStyle).map(([R,P])=>`${R}: ${P}`).join("; "):"",()=>x(e(r))]),c(a,v)}),f($);var xe=le($);{var Ce=a=>{var r=_t();fe(r,21,()=>e(n).level2,_e,(v,s)=>{var l=gt(),y=_(l),R=_(y,!0);f(y),f(l),E((P,oe)=>{L(l,1,`vtable-header-cell ${(e(s).headerCss||"")??""}`,"svelte-1kfim0d"),X(l,P),Z(R,oe)},[()=>e(s).headerStyle?Object.entries(e(s).headerStyle).map(([P,oe])=>`${P}: ${oe}`).join("; "):"",()=>x(e(s))]),c(v,l)}),f(r),c(a,r)};F(xe,a=>{e(n).hasSubcols&&a(Ce)})}f(A);var ue=le(A),ye=_(ue);{var i=a=>{var r=mt(),v=_(r),s=_(v),l=_(s,!0);f(s),f(v),f(r),E(()=>{be(v,"colspan",e(n).flatColumns.length),Z(l,T())}),c(a,r)},d=a=>{var r=W(),v=O(r);fe(v,19,()=>e(m),s=>`${s.index}-${e(K)}`,(s,l,y)=>{const R=M(()=>e(m)[0]?.start||0),P=M(()=>e(y)===e(m).length-1),oe=M(()=>e(g)-(e(m)[0]?.size||p())*e(m).length),J=M(()=>e(b)[e(l).index]);var we=W(),je=O(we);{var qe=Se=>{const Ae=M(()=>N(e(J),e(l).index));var Ee=yt(),ee=O(Ee);let He;ee.__click=()=>ne(e(J),e(l).index),fe(ee,21,()=>e(n).flatColumns,_e,(ve,w)=>{const U=M(()=>G(e(w),e(J),e(l).index));var te=xt();te.__click=S=>{e(w).onEditChange&&S.stopPropagation()};var pe=_(te);{var Be=S=>{var Q=W(),ke=O(Q);st(ke,()=>e(U).content),c(S,Q)},Ke=S=>{var Q=W(),ke=O(Q);{var Ne=ae=>{ut(ae,{get saveOn(){return e(J)},getValue:()=>e(U).content,onChange:he=>{e(w).onEditChange?.(e(J),he)}})},Ue=ae=>{var he=W(),We=O(he);{var Ye=re=>{var ce=W(),ze=O(ce);rt(ze,()=>t.cellRenderer,()=>e(J),()=>e(w),()=>e(U).content,()=>e(l).index),c(re,ce)},Ge=re=>{var ce=W(),ze=O(ce);{var Je=se=>{var de=W(),Xe=O(de);fe(Xe,17,()=>ot(e(U).content,e(q)),_e,(Ze,Ie)=>{var ge=bt();let Re;var $e=_(ge,!0);f(ge),E(()=>{Re=L(ge,1,"svelte-1kfim0d",null,Re,{_2:e(Ie).highl}),Z($e,e(Ie).text)}),c(Ze,ge)}),c(se,de)},Qe=se=>{var de=tt();E(()=>Z(de,e(U).content)),c(se,de)};F(ze,se=>{t.filterText&&e(w).highlight?se(Je):se(Qe,!1)})}c(re,ce)};F(We,re=>{e(U).useSnippet&&t.cellRenderer?re(Ye):re(Ge,!1)},!0)}c(ae,he)};F(ke,ae=>{e(w).onEditChange?ae(Ne):ae(Ue,!1)},!0)}c(S,Q)};F(pe,S=>{e(U).isHTML?S(Be):S(Ke,!1)})}f(te),E(S=>{L(te,1,e(U).css,"svelte-1kfim0d"),X(te,S)},[()=>e(w).cellStyle?Object.entries(e(w).cellStyle).map(([S,Q])=>`${S}: ${Q}`).join("; "):""]),c(ve,te)}),f(ee);var Pe=le(ee,2);{var De=ve=>{var w=Ct();E(()=>X(w,`height: ${e(oe)??""}px; visibility: hidden;`)),c(ve,w)};F(Pe,ve=>{e(P)&&ve(De)})}E(()=>{He=L(ee,1,"vtable-row svelte-1kfim0d",null,He,{"vtable-row-even":e(l).index%2===0,"vtable-row-odd":e(l).index%2!==0,"vtable-row-selected":e(Ae)}),X(ee,`transform: translateY(${e(R)??""}px);`)}),c(Se,Ee)};F(je,Se=>{e(J)&&Se(qe)})}c(s,we)}),c(a,r)};F(ye,a=>{e(b).length===0?a(i):a(d,!1)})}f(ue),f(h),f(o),Le(o,a=>H(C,a),()=>e(C)),E(()=>{L(o,1,`vtable-container ${ie()??""}`,"svelte-1kfim0d"),X(o,`max-height: ${V()??""}; overflow: auto;`),L(h,1,`vtable ${D()??""}`,"svelte-1kfim0d")}),c(z,o),Me()}Fe(["click"]);export{Ft as V};
