import{a as p,k as H,c,d as j,g as v,b as h,i as r,r as q,e as B,t as $,f as R}from"./web-n9SrCLWm.js";import{D as S}from"./Datepicker-CClIS149.js";import{Q as V}from"./QTable-BpZD-x6b.js";import{c as K,w as Q,S as z,t as G,f as J,z as A,P as W,L as b}from"./app-CxTCLAtU.js";import{u as X,m as Y,q as Z}from"./productos-101t7mEq.js";import{u as ee}from"./sedes-almacenes-CuoWpN8h.js";var te=$('<div class="flex a-center"><div class=mr-08></div><div class="ff-mono c-blue">(</div><div class=ff-mono></div><div class="ff-mono c-blue">)'),ae=$('<div class="flex ai-center jc-between mb-06"><div class="flex ai-center w100-10"><!$><!/><!$><!/><!$><!/><button class="bn1 b-blue ml-10"><i class=icon-search></i></button></div><div class="search-c4 mr-16 w14rem ml-auto"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text>'),re=$("<div>");function me(){X();const[m]=ee(),x=Q.getFechaUnix(),w=x-7,[a,P]=p({fechaFin:x,fechaInicio:w,almacenID:0}),[I,M]=p([]);H(()=>{const e=(m().Almacenes||[])[0]?.ID;e&&e!==a().almacenID&&P({...a(),almacenID:e})});const d=new Map,u=new Map,y=K(Y,"id"),D=async()=>{b.standard("Consultando registros...");let e;try{e=await Z(a())}catch{b.remove();return}console.log("registros obtenidos: ",e);for(let t of e.Productos)u.set(t.ID,t);for(let t of e.Usuarios)d.set(t.id,t);M(e.Movimientos),b.remove()},[g,k]=p(""),_=(e,t)=>{if(!e)return"";const s=m().AlmacenesMap.get(e)?.Nombre||`Almacen-${e}`;return(()=>{var n=v(te),i=n.firstChild,f=i.nextSibling,l=f.nextSibling;return r(i,s),r(l,t),n})()};return c(W,{title:"Almacén Stock",get children(){return[(()=>{var e=v(ae),t=e.firstChild,s=t.firstChild,[n,i]=h(s.nextSibling),f=n.nextSibling,[l,F]=h(f.nextSibling),T=l.nextSibling,[C,N]=h(T.nextSibling),O=C.nextSibling,U=t.nextSibling,E=U.firstChild,L=E.nextSibling;return t.style.setProperty("max-width","64rem"),r(t,c(z,{get saveOn(){return a()},save:"almacenID",css:"w-08x mb-02 mr-12",label:"Almacén",keys:"ID.Nombre",get options(){return m()?.Almacenes||[]},placeholder:"",required:!0,onChange:o=>{}}),n,i),r(t,c(S,{label:"Fecha Inicio",css:"w-045x",save:"fechaInicio",get saveOn(){return a()}}),l,F),r(t,c(S,{label:"Fecha Fin",css:"w-045x",save:"fechaFin",get saveOn(){return a()}}),C,N),O.$$click=o=>{o.stopPropagation(),D()},L.$$keyup=o=>{o.stopPropagation(),G(()=>{k((o.target.value||"").toLowerCase().trim())},150)},q(),e})(),c(V,{get data(){return I()},css:"w100",tableCss:"w-page-t w100",maxHeight:"calc(100vh - 8rem - 12px)",makeFilter:e=>{const t=u.get(e.ProductoID)?.Nombre||"",s=d.get(e.CreatedBy||1)?.usuario||"";return[t,s].join(" ")},get filterText(){return g()},columns:[{header:"Fecha Hora",css:"ff-mono",getValue:e=>J(e.Created,"d-M h:n")},{header:"Producto",css:"",render:e=>{const t=u.get(e.ProductoID)?.Nombre||`Producto-${e.ProductoID}`;return A(t,g())}},{header:"Lote",css:"c-purple t-c",getValue:e=>e.Lote},{header:"SKU",css:"c-purple t-c",getValue:e=>e.SKU},{header:"Movimiento",css:"t-c",render:e=>y.get(e.Tipo)?.name||"-"},{header:"Cantidad",css:"t-r ff-mono",render:e=>(()=>{var t=v(re);return r(t,()=>e.Cantidad),B(()=>R(t,"flex jc-end "+(e.Cantidad<0?"c-red":"c-blue"))),t})()},{header:"Almacén Origen",css:"",render:e=>_(e.AlmacenOrigenID,e.AlmacenOrigenCantidad)},{header:"Almacén Destino",css:"",render:e=>_(e.AlmacenID,e.AlmacenCantidad)},{header:"Usuario",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",render:e=>{const t=d.get(e.CreatedBy||1)?.usuario||`Usuario-${e.CreatedBy}`;return A(t,g())}}]})]}})}j(["click","keyup"]);export{me as default};
