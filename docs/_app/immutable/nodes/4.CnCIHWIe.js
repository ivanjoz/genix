import"../chunks/DsnmJJEf.js";import{e as h,g as w,i as a,h as n,p as Y,d as B,f as A,a as J,c as m,s as l,r as v,b as V,u as O}from"../chunks/DsnVzSLI.js";import{d as K}from"../chunks/BzG9rrjb.js";import{I as p}from"../chunks/DJtCHpSH.js";import{M as Q}from"../chunks/pZLrJn3o.js";import{P as W}from"../chunks/DQXXBHmb.js";import{V as X}from"../chunks/lFulS-eH.js";import{t as Z,N as g,n as U}from"../chunks/DP6SISrU.js";import{G as ee,P as se,C as q,c as ae}from"../chunks/Bz9XdVJx.js";import{f as re}from"../chunks/CAaV5v2W.js";class te extends ee{route="empresas";useCache={min:5,ver:1};#e=h(w([]));get empresas(){return a(this.#e)}set empresas(r){n(this.#e,r,!0)}#s=h(w(new Map));get empresasMap(){return a(this.#s)}set empresasMap(r){n(this.#s,r,!0)}handler(r){const d=r?.Records||r||[];this.empresas=d.map(o=>(o.SmtpConfig=o.SmtpConfig||{},o.CulquiConfig=o.CulquiConfig||{},o)),this.empresasMap=new Map(this.empresas.map(o=>[o.id,o]))}constructor(){super(),this.fetch()}updateEmpresa(r){const d=this.empresas.find(o=>o.id===r.id);d?Object.assign(d,r):this.empresas.unshift(r),this.empresasMap.set(r.id,r)}removeEmpresa(r){this.empresas=this.empresas.filter(d=>d.id!==r),this.empresasMap.delete(r)}}const oe=f=>se({data:f,route:"empresas",refreshRoutes:["empresas"]});var ne=A('<div class="grid grid-cols-24 gap-10 p-6"><!> <!> <!> <!> <!> <!> <!> <!></div>'),ie=A('<div class="h-full"><div class="flex items-center justify-between mb-6"><div class="i-search mr-16 w-256"><div><i class="icon-search"></i></div> <input class="w-full" autocomplete="off" type="text"/></div> <div class="flex items-center"><button class="bx-green" aria-label="Agregar empresa"><i class="icon-plus"></i></button></div></div> <!></div> <!>',1);function be(f,r){Y(r,!0);const d=new te;let o=h(""),e=h(w({}));async function R(s){const c=a(e);if((c.Nombre?.length||0)<3){g.failure("El nombre de la empresa debe tener al menos 3 caracteres.");return}if((c.RUC?.length||0)<8){g.failure("El RUC debe tener al menos 8 caracteres.");return}s&&(c.ss=0),U.Loading.standard("Guardando Empresa...");try{const u=await oe(c);s?d.removeEmpresa(c.id):(c.id||(c.id=u.id),d.updateEmpresa(c)),ae(1),g.success("Empresa guardada correctamente")}catch(u){g.failure(u)}U.Loading.remove()}const k=[{header:"ID",headerCss:"w-54",cellCss:"text-center ff-bold",getValue:s=>s.id},{header:"Nombre",highlight:!0,cellCss:"px-6 c-blue",getValue:s=>s.Nombre},{header:"Razón Social",getValue:s=>s.RazonSocial},{header:"RUC",headerCss:"w-120",cellCss:"px-6",getValue:s=>s.RUC},{header:"Estado",headerCss:"w-80",cellCss:"text-center",getValue:s=>s.ss},{header:"Actualizado",headerCss:"w-144",cellCss:"px-6 nowrap",getValue:s=>re(s.upd,"Y-m-d h:n")},{header:"...",headerCss:"w-42",cellCss:"t-c",id:"actions",buttonEditHandler:s=>{n(e,{...s},!0),q.openModal(1)}}];W(f,{title:"Empresas",children:(s,c)=>{var u=ie(),C=J(u),b=m(C),_=m(b),G=l(m(_),2);G.__keyup=i=>{i.stopPropagation(),Z(()=>{n(o,(i.target.value||"").toLowerCase().trim(),!0)},150)},v(_);var M=l(_,2),L=m(M);L.__click=i=>{i.stopPropagation(),n(e,{ss:1,SmtpConfig:{},CulquiConfig:{}},!0),q.openModal(1)},v(M),v(b);var j=l(b,2);X(j,{get columns(){return k},get data(){return d.empresas},css:"w-full",maxHeight:"calc(80vh - 13rem)",get filterText(){return a(o)},getFilterContent:i=>[i.Nombre,i.RazonSocial,i.RUC,i.Email].filter(E=>E).join(" ").toLowerCase()}),v(C);var D=l(C,2);{let i=O(()=>(a(e)?.id>0?"Actualizar":"Guardar")+" Empresa"),E=O(()=>a(e)?.id>0),H=O(()=>a(e)?.id>0?()=>R(!0):void 0);Q(D,{id:1,size:6,get title(){return a(i)},get isEdit(){return a(E)},onSave:()=>R(),get onDelete(){return a(H)},children:(I,le)=>{var x=ne(),S=m(x);p(S,{save:"Nombre",css:"col-span-24 md:col-span-12",label:"Nombre",required:!0,get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var $=l(S,2);p($,{save:"RazonSocial",css:"col-span-24 md:col-span-12",label:"Razón Social",get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var y=l($,2);p(y,{save:"RUC",css:"col-span-24 md:col-span-8",label:"RUC",required:!0,get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var z=l(y,2);p(z,{save:"Email",css:"col-span-24 md:col-span-8",label:"Email",type:"email",get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var N=l(z,2);p(N,{save:"Telefono",css:"col-span-24 md:col-span-8",label:"Teléfono",get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var P=l(N,2);p(P,{save:"Representante",css:"col-span-24 md:col-span-12",label:"Representante",get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var T=l(P,2);p(T,{save:"Ciudad",css:"col-span-24 md:col-span-12",label:"Ciudad",get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}});var F=l(T,2);p(F,{save:"Direccion",css:"col-span-24",label:"Dirección",useTextArea:!0,rows:2,get saveOn(){return a(e)},set saveOn(t){n(e,t,!0)}}),v(x),V(I,x)},$$slots:{default:!0}})}V(s,u)},$$slots:{default:!0}}),B()}K(["keyup","click"]);export{be as component};
