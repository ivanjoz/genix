import"./DsnmJJEf.js";import{a as ce}from"./BFTutmdY.js";import{p as ve,e as ge,g as me,l as J,h as v,i as r,f as _,c as p,s as f,u as fe,r as b,t as U,b as u,d as ue,az as _e}from"./Bf0lWsRu.js";import{s as K}from"./WwA8pLij.js";import{i as h}from"./D7jGWfSg.js";import{a as E,b as Q}from"./BWVkWQLM.js";import{s as T}from"./C7iUW-It.js";import{d as pe,e as be}from"./Cu2BEfFs.js";import{p as l}from"./DEnCy23-.js";import{E as j,i as B,d as he}from"./CUNP7WoD.js";import{N as F,a as V}from"./B0A7VF9y.js";var ye=_('<div class="w-full h-full relative flex flex-col items-center justify-center card_input_layer ImageUploader_16nzghv"><input type="file" accept="image/png, image/jpeg, image/webp" class="ImageUploader_16nzghv"/> <div style="font-size: 2.4rem"><i class="icon-upload"></i></div> <div class="h5">Subir Imagen</div></div>'),xe=_('<source type="image/avif"/>'),Ue=_('<source type="image/webp"/>'),we=_('<picture class="contents"><!> <!> <img class="w-full h-full absolute card_image_img1 ImageUploader_16nzghv" alt="Upload preview"/></picture>'),Ie=_('<textarea class="w-full card_image_textarea ImageUploader_16nzghv" placeholder="Nombre..."></textarea>'),ze=_('<div class="absolute w-full card_image_upload_text ImageUploader_16nzghv"> </div>'),Ce=_('<button class="bnr-1 _5 card_image_btn ImageUploader_16nzghv" aria-label="Subir imagen"><i class="icon-ok"></i></button>'),Se=_('<div><!> <!> <div class="w-full absolute flex items-center justify-center card_image_layer_botton ImageUploader_16nzghv"><button aria-label="Eliminar imagen"><i class="icon-cancel"></i></button> <!></div></div>'),Pe=_('<div class="w-full h-full absolute flex flex-col items-center justify-center card_image_layer_loading ImageUploader_16nzghv"><div class="c-white h3 ff-bold">Loading...</div> <div class="flex relative items-center justify-center h-22 lh-10 w-[calc(100%-16px)] left-0 right-0 mt-8 _8 mr-8 ml-9 p-2 ImageUploader_16nzghv"><div class="absolute _9 left-2 h-18 ImageUploader_16nzghv"></div> <div class="absolute fs14 ff-bold text-white"> </div></div></div>'),De=_("<div><!> <!> <!> <!></div>");function Re(W,i){ve(i,!0);let z=l(i,"src",3,""),A=l(i,"types",19,()=>[]),Y=l(i,"saveAPI",3,"images"),L=l(i,"onUploaded",3,void 0),O=l(i,"setDataToSend",3,void 0),Z=l(i,"clearOnUpload",3,!1),R=l(i,"description",3,""),$=l(i,"cardStyle",3,""),q=l(i,"onDelete",3,void 0),ee=l(i,"cardCss",3,""),M=l(i,"hideFormUseMessage",3,""),ae=l(i,"hideForm",3,!1),re=l(i,"hideUploadButton",3,!1),te=l(i,"id",3,void 0),a=ge(me(i.imageSource||{src:z(),types:A(),description:R()})),c=fe(()=>z()||r(a)?.base64?-1:0);j.imageCounter++;const P=te()||j.imageCounter;J(()=>{z(),i.imageSource,v(a,i.imageSource||{src:z(),base64:"",types:A(),description:R()},!0)});const N=t=>{if(r(a).base64)return r(a).base64;if(!r(a).src)return"";let e=r(a).src||"";return e.substring(0,8)!=="https://"&&e.substring(0,7)!=="http://"&&(i.folder&&(e=i.folder+"/"+e),i.size&&(e=`${e}-x${i.size}`),e=j.S3_URL+e),t&&(e=e+"."+t),e};let D;const k=async()=>{let t={};if(!r(a).base64)return F.failure("No hay nada que enviar."),Promise.resolve(t);v(c,.001);const e={Content:"",Content_x6:"",Content_x4:"",Content_x2:"",Description:r(a).description};if(i.useConvertAvif){const o=[{i:6,r:980,fn:s=>e.Content_x6=s},{i:4,r:670,fn:s=>e.Content_x4=s},{i:2,r:360,fn:s=>e.Content_x2=s}];for(const s of o)s.promise=new Promise(g=>{V(D,s.r,"avif").then(y=>{s.fn(y),g(0)})});try{await Promise.all(o.map(s=>s.promise))}catch(s){return F.failure(`Error al convertir imagen: ${s}`),Promise.resolve(t)}}else e.Content=r(a).base64;O()&&O()(e),console.log("data a enviar::",e);try{t=await he({data:e,route:Y()||"images",onUploadProgress:o=>{o.total&&(v(c,Math.round(o.loaded*100/o.total)),console.log("progress:: ",r(c)))}})}catch(o){return F.failure("Error guardando la imagen: "+String(o)),t}return t.id=P,t.description=r(a).description,Z()?v(a,{src:"",base64:"",types:[],description:""},!0):v(a,{src:`${t.imageName}-x2`,base64:"",types:["webp","avif"],description:r(a).description},!0),v(c,-1),L()&&L()(t.imageName,t.description),t},ie=async t=>{const o=t.target.files;if(!(!o||o.length===0)){D=o[0],console.log("imagefile::",D);try{const s=await V(D,1200,"avif");console.log("imageB64",s),v(c,-1),v(a,{src:"",base64:s,types:[],description:r(a).description},!0),i.onChange?.(r(a),k)}catch(s){F.failure("Error procesando la imagen: "+String(s)),v(c,0)}}};J(()=>{r(a).base64?B.set(P,k):B.delete(P)}),ce(()=>{B.delete(P)});var C=De(),H=p(C);{var se=t=>{var e=ye(),o=p(e);o.__change=ie,_e(4),b(e),u(t,e)};h(H,t=>{(r(a)?.src||"").length===0&&t(se)})}var X=f(H,2);{var oe=t=>{var e=we(),o=p(e);{var s=n=>{var x=xe();U(S=>E(x,"srcset",S),[()=>N("avif")]),u(n,x)};h(o,n=>{r(a).types?.includes("avif")&&n(s)})}var g=f(o,2);{var y=n=>{var x=Ue();U(S=>E(x,"srcset",S),[()=>N("webp")]),u(n,x)};h(g,n=>{r(a).types?.includes("webp")&&n(y)})}var w=f(g,2);b(e),U(n=>E(w,"src",n),[()=>N(r(a)?.types?.[0])]),u(t,e)};h(X,t=>{(r(a).src||r(a).base64||"").length>0&&t(oe)})}var G=f(X,2);{var ne=t=>{var e=Se(),o=p(e);{var s=d=>{var m=Ie();E(m,"rows",3),be("blur",m,I=>{I.stopPropagation(),r(a).description=I.currentTarget.value||"",i.onChange?.(r(a),k)}),u(d,m)};h(o,d=>{r(a).base64&&!M()&&!ae()&&d(s)})}var g=f(o,2);{var y=d=>{var m=ze(),I=p(m,!0);b(m),U(()=>K(I,M())),u(d,m)};h(g,d=>{r(a).base64&&M()&&d(y)})}var w=f(g,2),n=p(w);n.__click=d=>{if(d.stopPropagation(),q()){q()(z());return}v(a,{src:"",base64:"",types:[],description:""},!0),i.onChange?.(r(a)),v(c,0)};var x=f(n,2);{var S=d=>{var m=Ce();m.__click=I=>{I.stopPropagation(),k()},u(d,m)};h(x,d=>{r(a).base64&&!re()&&d(S)})}b(w),b(e),U(()=>{T(e,1,`w-full h-full absolute card_image_layer${r(a).base64?" s1":""}`,"ImageUploader_16nzghv"),T(n,1,`bnr-1 _4 mr-12 ${r(a).base64?"":"card_image_layer_bn_close2"} card_image_btn`,"ImageUploader_16nzghv")}),u(t,e)};h(G,t=>{r(c)===-1&&t(ne)})}var le=f(G,2);{var de=t=>{var e=Pe(),o=f(p(e),2),s=p(o),g=f(s,2),y=p(g);b(g),b(o),b(e),U((w,n)=>{Q(s,`width: calc(${w??""}% - 4px);`),K(y,`${n??""} %`)},[()=>Math.round(r(c)),()=>Math.round(r(c))]),u(t,e)};h(le,t=>{r(c)>0&&t(de)})}b(C),U(()=>{T(C,1,`relative ${ee()??""} card_image_1 ${r(a)?.src?"":"card_input"}`,"ImageUploader_16nzghv"),Q(C,$())}),u(W,C),ue()}pe(["change","click"]);export{Re as I};
