import"../chunks/DsnmJJEf.js";import{a5 as Ze,h as Ve,p as ze,at as Ae,g as ie,k as i,aH as de,a2 as b,a3 as m,aq as me,f as K,d as Y,a as fe,s as ee,r as W,b as V,b5 as je,t as oe,c as Oe,a4 as Ee,au as Se}from"../chunks/xxzRbNoF.js";import{s as se}from"../chunks/Dh4QK2gy.js";import{i as ne}from"../chunks/Dlky6Ld2.js";import{s as Ke,d as Ge,e as Ue}from"../chunks/CR64gONK.js";import{e as xe,S as Pe,s as Qe,a as Xe,b as $e}from"../chunks/BtvgxEYs.js";import{b as Me}from"../chunks/BezaTGJA.js";import{p as _e}from"../chunks/BiWXNKKg.js";import{t as et}from"../chunks/VsnTSXou.js";import{W as Ie,C as De}from"../chunks/CFEalmJ9.js";import{P as tt}from"../chunks/fDZ52bj7.js";import{a as it}from"../chunks/tZ8tr9i3.js";import{e as nt}from"../chunks/DYyZyIdl.js";import{V as ot}from"../chunks/b8IW__Wg.js";import{P as st}from"../chunks/DPuKOyj_.js";function rt(f,e,n){Ze(()=>{var o=Ve(()=>e(f,n?.())||{});if(o?.destroy)return()=>o.destroy()})}const at={smoothScroll:!0,shouldThrowOnBounds:!0,align:"auto"},lt=(f,e,n)=>{if(f===0)return 0;const o=f*e;return Math.max(0,o-n)},Ne=(f,e,n,o,d,a,s,h,g,r,v)=>{if(a==="bottomToTop"){const l=Math.ceil(e/n)+1,u=r??o*n,w=Math.max(0,u-e)-f,H=Math.floor(w/n);if(H<0)return{start:0,end:Math.min(o,l+d*2)};const D=Math.max(0,H-d),S=Math.min(o,H+l+d);return{start:D,end:S}}else{const l=Math.floor(f/n),u=Math.min(o,l+Math.ceil(e/n)+1),T=r??o*n,w=Math.max(0,T-e),H=Math.max(1,Math.floor(n*.25));if(Math.abs(f-w)<=H){const E=o;let R=E,z=0;const O=j=>{const G=v?v[j]:void 0;return Number.isFinite(G)&&G>0?G:n};for(;R>0&&z<e;){const j=O(R-1);z+=j,R-=1}return{start:Math.max(0,R-d),end:E}}const S=Math.max(0,l-d),I=Math.min(o,u+d);return{start:S,end:I}}},ct=(f,e,n,o,d,a,s,h,g)=>{const r=a||g||0;if(f==="bottomToTop"){const v=s??e*d,l=(e-n)*d,u=Math.max(0,r-v);return l+u}else{if(h){const v=$(h,d,o);return Math.max(0,Math.round(v))}return o*d}},dt=(f,e,n=!1)=>{const{initialized:o,mode:d,containerElement:a,viewportElement:s,calculatedItemHeight:h,scrollTop:g}=f,{setHeight:r,setScrollTop:v}=e;if(n&&a&&s&&o){const l=a.getBoundingClientRect().height;if(r(l),d==="bottomToTop"){const T=Math.floor(g/h)*h;s.scrollTop=T,v(T)}}},ht=(f,e,n,o,d,a=0,s=0,h="topToBottom")=>{const g=f.filter(w=>w);if(g.length===0)return{newHeight:o,newLastMeasuredIndex:e.start,updatedHeightCache:n,clearedDirtyItems:new Set,newTotalHeight:a,newValidCount:s,heightChanges:[]};const r={...n},v=new Set,l=[];let u=a,T=s;return d.size>0?d.forEach(w=>{let H;h==="bottomToTop"?H=g.length-1-(w-e.start):H=w-e.start;const D=g[H];if(D&&H>=0&&H<g.length)try{D.offsetHeight;const S=D.getBoundingClientRect().height,I=r[w];if(Number.isFinite(S)&&S>0&&(!I||Math.abs(I-S)>=.1)){const E=I||o,R=S-E;l.push({index:w,oldHeight:E,newHeight:S,delta:R}),I&&Number.isFinite(I)&&I>0?u=u-I+S:(u+=S,T++),r[w]=S}v.add(w)}catch{v.add(w)}else v.add(w)}):g.forEach((w,H)=>{const D=h==="bottomToTop"?Math.max(0,(e.end??e.start+g.length)-1-H):e.start+H;if(!r[D])try{const S=w.getBoundingClientRect().height;Number.isFinite(S)&&S>0&&(u+=S,T++,r[D]=S)}catch{}}),{newHeight:T>0?u/T:o,newLastMeasuredIndex:e.start,updatedHeightCache:r,clearedDirtyItems:v,newTotalHeight:u,newValidCount:T,heightChanges:l}},$=(f,e,n,o,d=1e3)=>{const a=Math.max(0,Math.floor(n));if(a<=0)return 0;{let s=0;for(let h=0;h<a;h++){const g=f[h],r=Number.isFinite(g)&&g>0?g:e;s+=r}return s}},ut=(f,e,n,o,d,a,s,h,g,r,v=0,l=0,u="topToBottom")=>{const T=n();return T.start===a&&r.size===0?null:(e&&clearTimeout(e),setTimeout(()=>{const{newHeight:H,newLastMeasuredIndex:D,updatedHeightCache:S,clearedDirtyItems:I,newTotalHeight:E,newValidCount:R,heightChanges:z}=ht(o,T,d,s,r,v,l,u);(Math.abs(H-s)>1||r.size>0)&&h({newHeight:H,newLastMeasuredIndex:D,updatedHeightCache:S,clearedDirtyItems:I,newTotalHeight:E,newValidCount:R,heightChanges:z})},g))},gt=()=>{let f=!1,e=null;return n=>{e=n,f||(f=!0,requestAnimationFrame(()=>{f=!1,e&&(e(),e=null)}))}},mt=(f,e,n,o=1)=>{const d=n[f];return d===void 0?!0:Math.abs(e-d)>o},ft=(f,e,n,o)=>f?f.start!==e.start||f.end!==e.end||n!==o:!0,vt=(f,e,n,o,d,a,s)=>{const h=d<=1,g=d>=s-a-1;return{visibleItemsCount:f.end-f.start,startIndex:f.start,endIndex:f.end,totalItems:e,processedItems:n,averageItemHeight:o,atTop:h,atBottom:g,totalHeight:s}},pt=f=>{const{mode:e,align:n,targetIndex:o,itemsLength:d,calculatedItemHeight:a,height:s,scrollTop:h,firstVisibleIndex:g,lastVisibleIndex:r,heightCache:v}=f;return e==="bottomToTop"?_t({align:n,targetIndex:o,itemsLength:d,calculatedItemHeight:a,height:s,scrollTop:h,firstVisibleIndex:g,lastVisibleIndex:r,heightCache:v}):bt({align:n,targetIndex:o,calculatedItemHeight:a,height:s,scrollTop:h,firstVisibleIndex:g,lastVisibleIndex:r,heightCache:v})},_t=f=>{const{align:e,targetIndex:n,itemsLength:o,calculatedItemHeight:d,height:a,scrollTop:s,firstVisibleIndex:h,lastVisibleIndex:g,heightCache:r}=f,v=$(r,d,o),l=$(r,d,n),u=d;if(e==="auto"){if(n<h)return Math.max(0,v-(l+u));if(n>g-1)return Math.max(0,v-l-a);{const T=v-(l+u),w=v-l,H=Math.abs(s-T),D=Math.abs(s+a-w);return H<D?T:Math.max(0,w-a)}}else{if(e==="top")return Math.max(0,v-(l+u));if(e==="bottom")return Math.max(0,v-l-a);if(e==="nearest"){const T=v-(l+u),w=v-l;if(w<=s||T>=s+a){const H=Math.abs(s-T),D=Math.abs(s+a-w);return H<D?T:Math.max(0,w-a)}else return null}}return null},bt=f=>{const{align:e,targetIndex:n,calculatedItemHeight:o,height:d,scrollTop:a,firstVisibleIndex:s,lastVisibleIndex:h,heightCache:g}=f;if(e==="auto"){if(n<s)return $(g,o,n);if(n>h-1){const r=$(g,o,n+1);return Math.max(0,r-d)}else{const r=$(g,o,n),v=$(g,o,n+1),l=Math.abs(a-r),u=Math.abs(a+d-v);return l<u?r:Math.max(0,v-d)}}else{if(e==="top")return $(g,o,n);if(e==="bottom"){const r=$(g,o,n+1);return Math.max(0,r-d)}else if(e==="nearest"){const r=$(g,o,n),v=$(g,o,n+1);if(v<=a||r>=a+d){const l=Math.abs(a-r),u=Math.abs(a+d-v);return l<u?r:Math.max(0,v-d)}else return null}}return null},qe={now:()=>typeof performance<"u"&&performance.now?performance.now():Date.now()},Tt=(f,e,n={})=>{const{leading:o=!0,trailing:d=!1}=n;let a=0,s=null,h=null,g=!0;const r=v=>{a=qe.now(),f(...v)};return((...v)=>{const l=qe.now(),u=g?e:l-a;if(h=v,s&&(clearTimeout(s),s=null),u>=e)o&&(g=!1,r(v)),d&&!o&&(s=setTimeout(()=>{h&&r(h),s=null},e));else if(g&&o)g=!1,r(v);else if(d){const T=e-u;s=setTimeout(()=>{h&&r(h),s=null},T)}})};var We={},wt=K("<!> <div><!></div>",1),Ht=K("<div><div><div><div></div></div></div></div>");function xt(f,e){ze(e,!0);const n=gt(),o=16,d=new WeakMap,a=typeof process<"u"&&(We?.PUBLIC_SVELTE_VIRTUAL_LIST_DEBUG==="true"||We?.SVELTE_VIRTUAL_LIST_DEBUG==="true"),s=_e(e,"items",19,()=>[]),h=_e(e,"defaultEstimatedItemHeight",3,40),g=_e(e,"debug",3,!1),r=_e(e,"mode",3,"topToBottom"),v=_e(e,"bufferSize",3,20),l=Ae([]);let u=b(0);const T=!1;let w=b(!1),H=b(-1),D=b(0),S=null,I=null,E=null;const R=Ae(new Set);let z=b(0),O=b(0),j=b(null),G=b(0),Q=b(0),re=b(null);const t=new yt({itemLength:s().length,itemHeight:h(),internalDebug:a}),F=Math.random().toString(36).slice(2,7),_=(c,p)=>{if(!(!g()&&!a))try{const x=new Date().toISOString().split("T")[1]?.replace("Z","");console.info(`[SVL][${F}] ${x} ${c}`,p??"")}catch{}};let N=b(0);const ve=de(()=>()=>{const c=i(P)();return(r()==="bottomToTop"?s().slice(c.start,c.end).reverse():s().slice(c.start,c.end)).map((x,C)=>({item:x,originalIndex:r()==="bottomToTop"?c.end-1-C:c.start+C,sliceIndex:C}))}),be=c=>{if(!t.viewportElement||!t.initialized||i(J))return;if(r()==="bottomToTop"&&ae&&!i(Z)&&performance.now()>=i(N)){const M=performance.now(),L=t.viewport,q=d.get(L)??0;if(M-q<o){m(N,M+50);return}d.set(L,M);const y=Math.max(0,i(B)()-i(u));_("b2t-correction-approx",{approximateScrollTop:y}),t.viewport.scrollTop=y,t.scrollTop=y,me().then(()=>{const A=t.viewport.querySelector('[data-original-index="0"]');if(A){const X=t.viewport.getBoundingClientRect(),te=A.getBoundingClientRect();Math.abs(X.y+X.height-(te.y+te.height))<=4||(A.scrollIntoView({block:"end",behavior:"smooth",inline:"nearest"}),_("b2t-correction-native",{containerBottom:X.y+X.height,itemBottom:te.y+te.height})),t.scrollTop=t.viewport.scrollTop,m(N,performance.now()+200)}});return}const p=t.viewport.scrollTop,x=Math.max(0,i(B)()-i(u));let C=0;const k=i(P)();for(const M of c)M.index<k.start&&(C+=M.delta);if(Math.abs(C)>1){const M=Math.min(x,Math.max(0,p+C));t.viewport.scrollTop=M,t.scrollTop=M}},he=Tt(()=>{i(z)>0&&(ae=i(ue),t.startDynamicUpdate(),U())},16,{leading:!0,trailing:!0});ie(()=>{he()}),ie(()=>{t.updateItemLength(s().length)});const U=()=>{m(Q,t.totalHeight,!0),S=ut(T,S,i(P),l,t.getHeightCache(),i(H),t.averageHeight,c=>{if(t.itemHeight=c.newHeight,m(H,c.newLastMeasuredIndex,!0),c.heightChanges.length>0&&t.processDirtyHeights(c.heightChanges),c.heightChanges.length>0&&r()==="bottomToTop"){const p=c.heightChanges;queueMicrotask(()=>be(p))}if(r()==="topToBottom"&&t.isReady&&t.initialized){const p=i(Q),x=t.totalHeight,C=x-p;if(Math.abs(C)>1){const k=Math.max(0,x-(i(u)||0)),M=Math.max(t.averageHeight,10),L=t.viewport.scrollTop;if(Math.abs(L-k)<=M){const y=Math.min(k,Math.max(0,L+C));t.viewport.scrollTop=y,t.scrollTop=y}}}Ve(()=>{R.clear(),m(z,0),ae=!1}),t.endDynamicUpdate()},i(H)<0?0:100,R,0,0,r())};let J=b(!1),Z=b(!1),ye=b(0),pe=b(0);const B=de(()=>()=>t.totalHeight),ue=de(()=>t.scrollTop>=i(B)()-i(u)-1);let ae=!1,le=null;function Re(){if(!t.viewportElement)return;const c=t.viewport.querySelector(`[data-original-index="${s().length-1}"]`);if(!c)return;const p=t.viewport.getBoundingClientRect(),x=c.getBoundingClientRect();m(re,Math.round(Math.abs(x.bottom-p.bottom)),!0),a&&console.info("[SVL] bottomDistance(px):",i(re))}ie(()=>{if(t.initialized&&r()==="bottomToTop"&&t.viewportElement){const c=Math.max(0,i(B)()-i(u)),p=t.viewport.scrollTop,x=Math.abs(p-c),C=Math.abs(t.averageHeight-i(ye))>1,k=Math.max(0,i(B)()-i(u)),M=Math.abs(p-k)<t.averageHeight;if(C&&!i(J)&&!M&&!i(Z)&&performance.now()>=i(N)&&!t.isDynamicUpdateInProgress&&x>t.averageHeight*3){const q=Math.round(c);t.viewport.scrollTop=q,t.scrollTop=q}x>t.averageHeight*5&&m(J,!0),m(ye,t.averageHeight,!0)}}),ie(()=>{const c=s().length;if(t.initialized&&r()==="bottomToTop"&&t.isReady&&i(pe)>0&&c-i(pe)!==0){const x=t.viewport.scrollTop,C=t.averageHeight,k=i(u),M=i(B)(),L=Math.max(0,M-k);(Math.abs(x-Math.max(0,i(pe)*C-k))<C*2||x===0)&&t.runDynamicUpdate(()=>{const y=L;t.viewport.scrollTop=y,t.scrollTop=y,m(J,!1)})}m(pe,c,!0)}),ie(()=>{if(t.isReady){const c=t.container.getBoundingClientRect().height;Number.isFinite(c)&&c>0&&m(u,c,!0)}}),ie(()=>{if(i(u)===0&&t.isReady){const c=t.container.getBoundingClientRect().height;Number.isFinite(c)&&c>0&&m(O,c,!0)}});const P=de(()=>()=>{if(!s().length)return{start:0,end:0};const c=i(u)||0;if(r()==="bottomToTop"&&!t.initialized&&t.scrollTop===0&&c>0){const p=Math.max(0,i(B)()-c);return le=Ne(p,c,t.averageHeight,s().length,v(),r(),i(ue),ae,le,i(B)(),t.getHeightCache()),le}return le=Ne(t.scrollTop,c,t.averageHeight,s().length,v(),r(),i(ue),ae,le,i(B)(),t.getHeightCache()),le}),ce=()=>{t.viewportElement&&(i(w)||(m(w,!0),n(()=>{const c=t.viewport.scrollTop;if(r()==="bottomToTop"&&i(D)-c>.5&&(m(N,performance.now()+450),m(J,!0)),m(D,c,!0),t.scrollTop=c,Re(),a){const p=i(P)();_("scroll",{mode:r(),scrollTop:t.scrollTop,height:i(u),totalHeight:i(B)(),averageItemHeight:t.averageHeight,visibleRange:p})}m(w,!1)})))},Te=(c=!1)=>{if(_("updateHeightAndScroll-enter",{immediate:c,initialized:t.initialized,mode:r()}),!t.initialized&&r()==="bottomToTop"){me().then(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(!t.isReady)return;const p=t.container.getBoundingClientRect().height;m(u,p,!0);const x=lt(s().length,t.averageHeight,p),k=String(F).toLowerCase().replace(/[^a-z0-9]/g,"").slice(-4),M=parseInt(k,36),L=Number.isNaN(M)?Math.floor(Math.random()*3):M%3;_("b2t-init",{measuredHeight:p,targetScrollTop:x,jitterMs:L}),setTimeout(()=>{t.viewport.scrollTop=x,t.scrollTop=x,requestAnimationFrame(()=>{t.initialized||(t.initialized=!0),me().then(()=>{const q=t.viewport.querySelector('[data-original-index="0"]');if(!q)return;const y=t.viewport.getBoundingClientRect(),A=q.getBoundingClientRect();Math.abs(y.y+y.height-(A.y+A.height))<=4||(q.scrollIntoView({block:"end",inline:"nearest"}),t.scrollTop=t.viewport.scrollTop,_("b2t-init-native-fallback",{containerBottom:y.y+y.height,itemBottom:A.y+A.height}))})})},L)})})});return}dt({initialized:t.initialized,mode:r(),containerElement:t.containerElement,viewportElement:t.viewportElement,calculatedItemHeight:t.averageHeight,height:i(u),scrollTop:t.scrollTop},{setHeight:p=>m(u,p,!0),setScrollTop:p=>t.scrollTop=p},c),_("updateHeightAndScroll-exit",{immediate:c})};E=new ResizeObserver(c=>{n(()=>{_("item-resize-observer",{entries:c.length});let p=!1;i(P)();for(const x of c){const C=x.target,k=l.indexOf(C),M=parseInt(C.dataset.originalIndex||"-1",10);if(k!==-1&&M>=0){const L=C.getBoundingClientRect().height;mt(M,L,t.getHeightCache())&&(i(z)===0&&(ae=i(ue)),R.add(M),m(z,R.size,!0),p=!0)}}p&&(_("item-resize-recalc"),U())})}),it(()=>(_("onMount-enter",{mode:r(),items:s().length}),Te(),me().then(()=>requestAnimationFrame(()=>requestAnimationFrame(()=>{_("post-hydration-measure"),U()}))),I=new ResizeObserver(()=>{if(!t.initialized){_("container-resize-ignored","not-initialized");return}_("container-resize"),Te(!0)}),t.isReady&&I.observe(t.container),()=>{I&&I.disconnect(),E&&E.disconnect()})),ie(()=>{a&&(m(j,i(P)(),!0),m(G,t.averageHeight,!0))});const Le=(c,p=!0,x=!0)=>{console.warn("SvelteVirtualList: scrollToIndex is deprecated and will be removed in a future version. Use the new scroll method from the component instance instead."),ge({index:c,smoothScroll:p,shouldThrowOnBounds:x})},ge=async c=>{const{index:p,smoothScroll:x,shouldThrowOnBounds:C,align:k}={...at,...c};if(!s().length)return;if(!t.viewportElement){me().then(()=>{t.viewportElement&&ge({index:p,smoothScroll:x,shouldThrowOnBounds:C,align:k})});return}let M=p;if(M<0||M>=s().length){if(C)throw new Error(`scroll: index ${M} is out of bounds (0-${s().length-1})`);M=Math.max(0,Math.min(M,s().length-1))}const{start:L,end:q}=i(P)(),y=pt({mode:r(),align:k||"auto",targetIndex:M,itemsLength:s().length,calculatedItemHeight:t.averageHeight,height:i(u),scrollTop:t.scrollTop,firstVisibleIndex:L,lastVisibleIndex:q,heightCache:t.getHeightCache()});if(y!==null){if(m(Z,!0),a&&t.viewportElement){const A=Math.max(0,t.viewport.scrollHeight-t.viewport.clientHeight);console.info("[SVL] scroll-intent",{targetIndex:M,align:k||"auto",firstVisibleIndex:L,lastVisibleIndex:q,currentScrollTop:t.scrollTop,scrollTarget:y,domMaxScrollTop:A})}if(r()==="bottomToTop"&&x){const A=t.viewport.querySelectorAll("[data-original-index]");let X=-1,te=null;for(const He of A){const Fe=parseInt(He.getAttribute("data-original-index")||"-1");Fe>X&&(X=Fe,te=He)}te?.scrollIntoView({behavior:"smooth"}),await me(),await new Promise(He=>setTimeout(He,100)),await me()}t.viewport.scrollTo({top:y,behavior:x?"smooth":"auto"}),requestAnimationFrame(()=>{if(t.scrollTop=y,a&&t.viewportElement){const A=Math.max(0,t.viewport.scrollHeight-t.viewport.clientHeight);console.info("[SVL] scroll-after-call",{scrollTop:t.scrollTop,domMaxScrollTop:A})}}),setTimeout(()=>{m(Z,!1)},x?500:100)}};function Ye(c){return E&&E.observe(c),{destroy(){E&&E.unobserve(c)}}}var Je={scrollToIndex:Le,scroll:ge},we=Ht();xe(we,()=>({id:"virtual-list-container",...e.testId?{"data-testid":`${e.testId}-container`}:{},class:e.containerClass??"virtual-list-container"}),void 0,void 0,"svelte-1yn1i8s");var Ce=Y(we);xe(Ce,()=>({id:"virtual-list-viewport",...e.testId?{"data-testid":`${e.testId}-viewport`}:{},class:e.viewportClass??"virtual-list-viewport",onscroll:ce}),void 0,void 0,"svelte-1yn1i8s");var Be=Y(Ce);xe(Be,c=>({id:"virtual-list-content",...e.testId?{"data-testid":`${e.testId}-content`}:{},class:e.contentClass??"virtual-list-content",[Pe]:c}),[()=>({height:`${Math.max(i(u),i(B)())??""}px`})],void 0,"svelte-1yn1i8s");var ke=Y(Be);return xe(ke,c=>({id:"virtual-list-items",...e.testId?{"data-testid":`${e.testId}-items`}:{},class:e.itemsClass??"virtual-list-items",[Pe]:c}),[()=>({visibility:i(u)===0&&r()==="bottomToTop"?"hidden":"visible",transform:`translateY(${(()=>{const c=i(u)||i(O)||0,p=i(P)(),x=c===0?400:c;return Math.round(ct(r(),s().length,p.end,p.start,t.averageHeight,x,i(B)(),t.getHeightCache(),i(O)))})()??""}px)`})],void 0,"svelte-1yn1i8s"),nt(ke,23,()=>i(ve)(),c=>c.originalIndex,(c,p,x)=>{var C=wt(),k=fe(C);{var M=y=>{const A=de(()=>vt(i(P)(),s().length,Object.keys(t.getHeightCache()).length,t.averageHeight,t.scrollTop,i(u)||0,i(B)()));var X=je();oe(te=>se(X,te),[()=>e.debugFunction?e.debugFunction(i(A)):console.info("Virtual List Debug:",i(A))]),V(y,X)};ne(k,y=>{g()&&i(x)===0&&ft(i(j),i(P)(),i(G),t.averageHeight)&&y(M)})}var L=ee(k,2);xe(L,()=>({"data-original-index":i(p).originalIndex,...e.testId?{"data-testid":`${e.testId}-item-${i(p).originalIndex}`}:{}}),void 0,void 0,"svelte-1yn1i8s");var q=Y(L);Ke(q,()=>e.renderItem,()=>i(p).item,()=>i(p).originalIndex),W(L),Me(L,(y,A)=>l[A.sliceIndex]=y,y=>l?.[y.sliceIndex],()=>[i(p)]),rt(L,y=>Ye?.(y)),V(c,C)}),W(ke),W(Be),W(Ce),Me(Ce,c=>t.viewportElement=c,()=>t?.viewportElement),W(we),Me(we,c=>t.containerElement=c,()=>t?.containerElement),V(f,we),Oe(Je)}class Mt{onRecompute;isScheduled=!1;isPending=!1;blockDepth=0;timeoutId=null;rafId=null;constructor(e){this.onRecompute=e}schedule=()=>{if(this.blockDepth>0){this.isPending=!0;return}if(this.isScheduled)return;if(this.isScheduled=!0,!(typeof window<"u"&&typeof requestAnimationFrame=="function")){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.timeoutId=setTimeout(()=>{this.timeoutId=null,this.isScheduled=!1,this.onRecompute()},0);return}this.rafId!==null&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.isScheduled=!1,this.onRecompute()})};block=()=>{this.blockDepth+=1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null,this.isScheduled=!1,this.isPending=!0),this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null,this.isScheduled=!1,this.isPending=!0)};unblock=()=>{this.blockDepth!==0&&(this.blockDepth-=1,this.blockDepth===0&&this.isPending&&(this.isPending=!1,this.onRecompute()))};cancel=()=>{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.isScheduled=!1,this.isPending=!1}}class yt{#o=b(0);get _totalMeasuredHeight(){return i(this.#o)}set _totalMeasuredHeight(e){m(this.#o,e,!0)}#s=b(0);get _measuredCount(){return i(this.#s)}set _measuredCount(e){m(this.#s,e,!0)}#r=b(0);get _itemLength(){return i(this.#r)}set _itemLength(e){m(this.#r,e,!0)}#a=b(40);get _itemHeight(){return i(this.#a)}set _itemHeight(e){m(this.#a,e,!0)}#l=b(40);get _averageHeight(){return i(this.#l)}set _averageHeight(e){m(this.#l,e,!0)}#c=b(0);get _totalHeight(){return i(this.#c)}set _totalHeight(e){m(this.#c,e,!0)}_measuredFlags=null;#d=b(!1);get _initialized(){return i(this.#d)}set _initialized(e){m(this.#d,e,!0)}#h=b(0);get _scrollTop(){return i(this.#h)}set _scrollTop(e){m(this.#h,e,!0)}#u=b(null);get _containerElement(){return i(this.#u)}set _containerElement(e){m(this.#u,e,!0)}#g=b(null);get _viewportElement(){return i(this.#g)}set _viewportElement(e){m(this.#g,e,!0)}_internalDebug=!1;#m=b(!1);get _isReady(){return i(this.#m)}set _isReady(e){m(this.#m,e,!0)}#f=b(!1);get _dynamicUpdateInProgress(){return i(this.#f)}set _dynamicUpdateInProgress(e){m(this.#f,e,!0)}#v=b(0);get _dynamicUpdateDepth(){return i(this.#v)}set _dynamicUpdateDepth(e){m(this.#v,e,!0)}#p=b(null);get _itemsWrapperElement(){return i(this.#p)}set _itemsWrapperElement(e){m(this.#p,e,!0)}#_=b(!1);get _gridDetected(){return i(this.#_)}set _gridDetected(e){m(this.#_,e,!0)}#b=b(1);get _gridColumns(){return i(this.#b)}set _gridColumns(e){m(this.#b,e,!0)}_gridObserver=null;_mutationObserver=null;_heightCache={};_scheduler=new Mt(()=>this.recomputeDerivedHeights());recomputeDerivedHeights(){const e=this._measuredCount>0?this._totalMeasuredHeight/this._measuredCount:this._itemHeight;this._averageHeight=e;const n=this._itemLength-this._measuredCount;this._totalHeight=this._totalMeasuredHeight+n*e}recomputeIsReady(){this._isReady=!!this._containerElement&&!!this._viewportElement}scheduleRecomputeDerivedHeights(){const e=typeof navigator<"u"&&typeof navigator.userAgent=="string"?/jsdom/i.test(navigator.userAgent):!1;if(typeof window>"u"||e){this.recomputeDerivedHeights();return}if(this._dynamicUpdateDepth>0){this._scheduler.block();return}this._scheduler.schedule()}get totalMeasuredHeight(){return this._totalMeasuredHeight}get measuredCount(){return this._measuredCount}get itemLength(){return this._itemLength}get itemHeight(){return this._itemHeight}set itemHeight(e){this._itemHeight=e,this.scheduleRecomputeDerivedHeights()}get initialized(){return this._initialized}set initialized(e){if(this._initialized)throw new Error("ReactiveListManager: initialized flag cannot be set to true after it has been set to true");this._initialized=e}get scrollTop(){return this._scrollTop}set scrollTop(e){this._internalDebug&&this.#w(e),this._scrollTop=e}get containerElement(){return this._containerElement}get container(){if(!this._isReady)throw new Error("ReactiveListManager: container is not ready");return this._containerElement}set containerElement(e){this._containerElement=e,this.recomputeIsReady()}get viewportElement(){return this._viewportElement}get viewport(){if(!this._isReady)throw new Error("ReactiveListManager: viewport is not ready");return this._viewportElement}set viewportElement(e){this._viewportElement=e,this.recomputeIsReady()}get itemsWrapperElement(){return this._itemsWrapperElement}set itemsWrapperElement(e){if(this._itemsWrapperElement!==e){if(this._gridObserver){try{this._gridObserver.disconnect()}catch{}this._gridObserver=null}if(this._mutationObserver){try{this._mutationObserver.disconnect()}catch{}this._mutationObserver=null}}if(this._itemsWrapperElement=e,!e){this._gridDetected=!1,this._gridColumns=1;return}this.#H(),this.#x(),this.#n()}get gridDetected(){return this._gridDetected}get gridColumns(){return this._gridColumns}get isReady(){return this._isReady}get isDynamicUpdateInProgress(){return this._dynamicUpdateDepth>0}startDynamicUpdate(){const e=this._dynamicUpdateDepth===0;this._dynamicUpdateDepth+=1,e&&(this._dynamicUpdateInProgress=!0,this._isReady&&this._viewportElement&&this._viewportElement.style.setProperty("overflow-anchor","none"))}endDynamicUpdate(){this._dynamicUpdateDepth<=0||(this._dynamicUpdateDepth-=1,this._dynamicUpdateDepth===0&&(this._isReady&&this._viewportElement&&this._viewportElement.style.setProperty("overflow-anchor","auto"),this._dynamicUpdateInProgress=!1,this._scheduler.unblock()))}async runDynamicUpdate(e){this.startDynamicUpdate();try{const n=e();return n instanceof Promise?await n:n}finally{this.endDynamicUpdate()}}#T=null;#t=0;#e=0;#i=!1;#w(e){const n=typeof performance<"u"&&performance.now?performance.now():Date.now();this.#T===e?n-this.#t<=1e3?(this.#e+=1,this.#e>10&&!this.#i&&(this.#i=!0,console.warn(`
================ SvelteVirtualList DEBUG ================
scrollTop assigned same value ${e} > 10 times within 1s
count=${this.#e}, windowStart=${Math.round(this.#t)}ms
This may indicate redundant updates or feedback loops.
========================================================
`))):(this.#t=n,this.#e=1,this.#i=!1):(this.#T=e,this.#t=n,this.#e=1,this.#i=!1)}get averageHeight(){return this._averageHeight}get totalHeight(){return this._totalHeight}flushRecompute=()=>{this.recomputeDerivedHeights()};getHeightCache(){return this._heightCache}constructor(e){this._itemLength=e.itemLength,this._itemHeight=e.itemHeight,this._internalDebug=e.internalDebug??!1,this._measuredFlags=new Uint8Array(Math.max(0,this._itemLength)),this.recomputeDerivedHeights()}processDirtyHeights(e){if(e.length===0)return;let n=0,o=0;for(const s of e){const{index:h,oldHeight:g,newHeight:r}=s;g!==void 0&&(n-=g,o-=1),r!==void 0?(n+=r,o+=1,this._heightCache[h]=r):delete this._heightCache[h],this._measuredFlags&&h>=0&&h<this._measuredFlags.length&&(this._measuredFlags[h]=1)}const d=typeof navigator<"u"&&typeof navigator.userAgent=="string"?/jsdom/i.test(navigator.userAgent):!1;if(typeof window>"u"||d){if(n===0&&o===0)return}else if(o===0)return;this._totalMeasuredHeight+=n,this._measuredCount+=o,this.scheduleRecomputeDerivedHeights()}updateItemLength(e){this._itemLength=e,this._measuredFlags=new Uint8Array(Math.max(0,e)),this.recomputeDerivedHeights()}updateEstimatedHeight(e){this._itemHeight=e,this.scheduleRecomputeDerivedHeights()}setMeasuredHeight(e,n){if(e<0||e>=this._itemLength)return;const o=this._heightCache[e];Number.isFinite(o)&&o>0?this._totalMeasuredHeight-=o:this._measuredCount+=1,Number.isFinite(n)&&n>0&&(this._heightCache[e]=n,this._totalMeasuredHeight+=n,this.scheduleRecomputeDerivedHeights())}reset(){this._totalMeasuredHeight=0,this._measuredCount=0,this._measuredFlags=this._itemLength>0?new Uint8Array(this._itemLength):null,this.scheduleRecomputeDerivedHeights()}getDebugInfo(){return{totalMeasuredHeight:this._totalMeasuredHeight,measuredCount:this._measuredCount,itemLength:this._itemLength,coveragePercent:this._itemLength>0?this._measuredCount/this._itemLength*100:0,itemHeight:this._itemHeight,averageHeight:this.averageHeight,totalHeight:this.totalHeight,gridDetected:this._gridDetected,gridColumns:this._gridColumns}}getMeasurementCoverage(){return this.getDebugInfo().coveragePercent}hasSufficientMeasurements(e=10){return this.getMeasurementCoverage()>=e}recomputeGridDetection(){this.#n()}#H(){const e=this._itemsWrapperElement;if(!(typeof window>"u"||!e))try{this._gridObserver=new ResizeObserver(()=>{this.#n()}),this._gridObserver.observe(e)}catch{this._gridObserver=null}}#x(){const e=this._itemsWrapperElement;if(!(typeof window>"u"||!e))try{this._mutationObserver=new MutationObserver(n=>{for(const o of n)if(o.type==="attributes"&&(o.attributeName==="class"||o.attributeName==="style")){this.#n();break}}),this._mutationObserver.observe(e,{attributes:!0,attributeFilter:["class","style"]})}catch{this._mutationObserver=null}}#n(){const e=this._itemsWrapperElement;if(!e){this._gridDetected=!1,this._gridColumns=1;return}let n=!1,o=1;try{const d=getComputedStyle(e);if(d.display==="grid"){const a=d.gridTemplateColumns,s=/repeat\(\s*(\d+)\s*,/i.exec(a);if(s&&s[1])o=Math.max(1,parseInt(s[1],10)),n=!0;else if(a&&a!=="none"){const h=this.#M(a);Number.isFinite(h)&&h>0&&(o=h,n=!0)}}}catch{}if(!n){const d=e.children;if(d&&d.length>0){const a=d[0].getBoundingClientRect().top;let s=0;for(let h=0;h<d.length;h+=1){const g=d[h].getBoundingClientRect().top;if(Math.abs(g-a)<=1)s+=1;else break}s>0&&(o=s,n=s>1)}}this._gridDetected=n,this._gridColumns=Math.max(1,o),this._internalDebug&&console.info("[ReactiveListManager] grid detection:",{detected:this._gridDetected,columns:this._gridColumns})}#M(e){let n=0,o=0,d=!1;for(let a=0;a<e.length;a+=1){const s=e[a];s==="("?n+=1:s===")"&&(n=Math.max(0,n-1)),n===0&&/\s/.test(s)?d&&(o+=1,d=!1):s!==" "&&(d=!0)}return d&&(o+=1),o}}var Ct=K('<i class="icon-attention c-red"></i>'),St=K('<input class="svelte-18ox6zj"/>'),It=K('<div class="_3 min-h-28 px-8 py-4 flex items-center svelte-18ox6zj" role="button" tabindex="0"> </div>'),Dt=K('<div class="h-200 w-400 p-4 _4 overflow-auto svelte-18ox6zj"><!></div>'),Et=K('<div class="_2 svelte-18ox6zj"> </div> <div class="_1 svelte-18ox6zj" role="button" tabindex="0"><div> <!></div> <!> <!></div>',1);function Rt(f,e){ze(e,!0);let n=_e(e,"saveOn",7),o=de(()=>De.popoverShowID===e.id),d=b(null),a=b(null),s=b(""),h=b(null),g=!1;const r=()=>{if(Ie.has(e.options))return;const t=new Map,F=new Map;for(const _ of e.options)t.set(_[e.keyField],_),F.set(_[e.valueField].toLowerCase(),_);Ie.set(e.options,{idToRecord:t,valueToRecord:F})};r();let v=de(()=>(console.log("filtrando valores::",i(s)),i(s)?e.options.filter(t=>String(t[e.valueField]||"").toLowerCase().includes(i(s))):e.options));const l=t=>{const F=Ie.get(e.options)?.valueToRecord||new Map;m(h,F.get(String(t.value||"").toLowerCase()),!0),i(h)?t.value=i(h)[e.valueField]:t.value="",n()&&e.save&&(i(h)?n()[e.save]=i(h)[e.keyField]:delete n()[e.save])},u=t=>{console.log("selected",t),m(h,t,!0),i(a)&&(i(a).value=t[e.valueField]),n()&&e.save&&(n()[e.save]=t[e.keyField]),De.popoverShowID=0};ie(()=>{(i(h)||!i(h))&&console.log("selected 2",i(h))});const T=de(()=>e.render?e.render(i(h),i(o)):i(h)?.[e.valueField]||""),w=()=>{m(s,""),De.popoverShowID=e.id};ie(()=>{i(o)&&i(a)&&(i(h)&&(i(a).value=i(h)[e.valueField]),i(a).focus())}),ie(()=>{n()&&e.save&&(r(),Ve(()=>{const t=Ie.get(e.options)?.idToRecord||new Map;m(h,n()[e.save]?t.get(n()[e.save]):null,!0),console.log("selected 3",i(h)),i(h)?i(a)&&(i(a).value=i(h)[e.valueField]):i(a)&&(i(a).value="")}))});var H=Et(),D=fe(H),S=Y(D,!0);W(D);var I=ee(D,2);I.__keydown=t=>{(t.key==="Enter"||t.key===" ")&&t.preventDefault()},I.__click=t=>{t.stopPropagation(),w()};var E=Y(I);let R;var z=Y(E),O=ee(z);{var j=t=>{var F=Ct();V(t,F)};ne(O,t=>{!i(h)&&e.required&&t(j)})}W(E);var G=ee(E,2);{var Q=t=>{var F=St();F.__keyup=_=>{const N=(_.target.value||"").trim();et(()=>{m(s,String(N||"").toLowerCase(),!0)},200)},Me(F,_=>m(a,_),()=>i(a)),oe(_=>$e(F,"id",_),[()=>String(e.id)]),Ue("focus",F,()=>{}),Ue("blur",F,_=>{if(g){g=!1;return}l(_.target),De.popoverShowID=0,m(s,"")}),V(t,F)};ne(G,t=>{i(o)&&t(Q)})}var re=ee(G,2);tt(re,{get referenceElement(){return i(d)},get open(){return i(o)},placement:"bottom",children:(t,F)=>{var _=Dt(),N=Y(_);xt(N,{get items(){return i(v)},renderItem:(be,he=Ee)=>{var U=It();U.__click=Z=>{Z.stopPropagation(),u(he())},U.__mousedown=()=>{g=!0},U.__keydown=Z=>{(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),u(he()))};var J=Y(U,!0);W(U),oe(()=>se(J,he()[e.valueField])),V(be,U)},$$slots:{renderItem:!0}}),W(_),V(t,_)},$$slots:{default:!0}}),W(I),Me(I,t=>m(d,t),()=>i(d)),oe(()=>{se(S,i(T)),Qe(E,1,e.contentClass,"svelte-18ox6zj"),R=Xe(E,"",R,{visibility:i(o)?"hidden":"visible"}),se(z,`${i(T)??""} `)}),V(f,H),Oe()}Ge(["keydown","click","keyup","mousedown"]);var Lt=K('<span class="updated-badge svelte-1dovub1">Updated</span>'),Bt=K('<div class="selected-info mt-2 svelte-1dovub1"><strong>Selected:</strong> <!></div>'),kt=K('<span style="color: #ef4444; font-weight: 600;"> </span>'),Ft=K('<span style="background-color: #fef3c7; padding: 0.125rem 0.25rem; border-radius: 3px;"> </span>'),At=K('<div class="action-buttons"><button class="btn-small btn-edit" title="Edit">‚úèÔ∏è</button> <button class="btn-small btn-delete" title="Delete">üóëÔ∏è</button></div>'),Vt=K('<div class="header-section svelte-1dovub1"><h2 class="svelte-1dovub1">VTable Component - Snippet-based cellRenderer Demo</h2> <p class="text-sm text-gray-600 mt-2 svelte-1dovub1"> </p> <p class="text-sm text-blue-600 mt-1 svelte-1dovub1">Using <strong>cellRendererSnippet</strong> to render actual Svelte components in cells!</p> <p class="text-sm text-gray-500 mt-2 svelte-1dovub1">üí° <strong>Tip:</strong> Click any row to update it. Try the Edit/Delete buttons in the Actions column!</p> <!></div> <!>',1);function $t(f,e){ze(e,!0);let n=b(Ae(a())),o=b(void 0);const d=[{header:"ID",id:101,renderHTML:l=>l._updated?`<span class="updated-indicator">üîÑ</span> ${l.id}`:l.id,css:"id-column"},{header:"Personal Information",headerCss:"text-center header-group",subcols:[{header:"Edad",getValue:l=>l.edad,css:"text-center"},{header:"Nombre",id:103,getValue:l=>l.nombre,css:"nombre-column"}]},{header:"Contact & Details",headerCss:"text-center header-group",subcols:[{header:"Apellidos",getValue:l=>l.apellidos,onEditChange(l,u){l.apellidos=u}},{header:"Selector",getValue:l=>l.edad,css:"text-center"}]},{header:"Actions",id:"actions",css:"text-center action-column",getValue:()=>""}];function a(){console.log("generando data::");const l=[];for(let u=0;u<15e3;u++){const T={id:s(12),edad:Math.floor(Math.random()*100),nombre:s(18).toLowerCase(),apellidos:s(23),numero:Math.floor(Math.random()*1e3),selector:""};l.push(T)}return l}function s(l){let u="";const T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",w=T.length;let H=0;for(;H<l;)u+=T.charAt(Math.floor(Math.random()*w)),H+=1;return u}function h(l,u){console.log("Row clicked:",l,"at index:",u),l.nombre=l.nombre+"_1",l._updated=!l._updated,m(o,l,!0),m(n,[...i(n)],!0)}function g(l,u){return l===u}function r(l){console.log("Edit:",l),alert(`Editing: ${l.nombre}`)}function v(l){confirm(`Delete ${l.nombre}?`)&&m(n,i(n).filter(u=>u!==l),!0)}st(f,{children:(l,u)=>{var T=Vt(),w=fe(T),H=ee(Y(w),2),D=Y(H);W(H);var S=ee(H,6);{var I=R=>{var z=Bt(),O=ee(Y(z)),j=ee(O);{var G=Q=>{var re=Lt();V(Q,re)};ne(j,Q=>{i(o)._updated&&Q(G)})}W(z),oe(()=>se(O,` ${i(o).nombre??""} (ID: ${i(o).id??""}) `)),V(R,z)};ne(S,R=>{i(o)&&R(I)})}W(w);var E=ee(w,2);ot(E,{get columns(){return d},get data(){return i(n)},maxHeight:"calc(100vh - 16rem)",onRowClick:h,get selected(){return i(o)},isSelected:g,estimateSize:34,overscan:15,cellRenderer:(z,O=Ee,j=Ee,G=Ee)=>{var Q=Se(),re=fe(Q);{var t=_=>{var N=kt(),ve=Y(N);W(N),oe(()=>se(ve,`${G()??""} üî•`)),V(_,N)},F=_=>{var N=Se(),ve=fe(N);{var be=U=>{var J=Ft(),Z=Y(J,!0);W(J),oe(()=>se(Z,G())),V(U,J)},he=U=>{var J=Se(),Z=fe(J);{var ye=B=>{Rt(B,{get id(){return O().id},get options(){return i(n)},keyField:"id",valueField:"nombre",get saveOn(){return O()},save:"selector"})},pe=B=>{var ue=Se(),ae=fe(ue);{var le=P=>{var ce=At(),Te=Y(ce);Te.__click=ge=>{ge.stopPropagation(),r(O())};var Le=ee(Te,2);Le.__click=ge=>{ge.stopPropagation(),v(O())},W(ce),V(P,ce)},Re=P=>{var ce=je();oe(()=>se(ce,G())),V(P,ce)};ne(ae,P=>{j().id==="actions"?P(le):P(Re,!1)},!0)}V(B,ue)};ne(Z,B=>{j().header==="Selector"?B(ye):B(pe,!1)},!0)}V(U,J)};ne(ve,U=>{O()._updated&&j().header==="Apellidos"?U(be):U(he,!1)},!0)}V(_,N)};ne(re,_=>{j().header==="Edad"&&O().edad>50?_(t):_(F,!1)})}V(z,Q)},$$slots:{cellRenderer:!0}}),oe(R=>se(D,`Testing with ${R??""} rows - Svelte 5 + Custom Virtualizer`),[()=>i(n).length.toLocaleString()]),V(l,T)},$$slots:{default:!0}}),Oe()}Ge(["click"]);export{$t as component};
