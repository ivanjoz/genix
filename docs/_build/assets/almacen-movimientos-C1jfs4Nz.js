import{d as y,t as v,i as o,c as D}from"./web-B9EQUxsk.js";import{a as p,e as S,c as n,b as F}from"./solid-DoXAfIeo.js";import{D as C}from"./Datepicker-DuS8gtAO.js";import{Q as k}from"./QTable-Bindcl4_.js";import{S as T,m as $,P as N}from"./app-CK7_gtPn.js";import{e as O,P as U,t as L,f as j,L as g}from"./main-CyvPQj02.js";import{u as q,m as B,q as E}from"./productos-BmhRVR8j.js";import{u as H}from"./sedes-almacenes-DPevvdp1.js";import"./store-DHPf-lLy.js";import"./main-3KfG555U.js";import"./http-5mnECz6S.js";var R=v('<div class="flex a-center"><div class=mr-08></div><div class="ff-mono c-blue">(</div><div class=ff-mono></div><div class="ff-mono c-blue">)'),V=v('<div class="flex ai-center jc-between mb-06"><div class="flex ai-center w100-10"><button class="bn1 b-blue ml-10"><i class=icon-search></i></button></div><div class="search-c4 mr-16 w14rem ml-auto"><div><i class=icon-search></i></div><input class=w100 autocomplete=off type=text>'),K=v("<div>");function ae(){q();const[l]=H(),h=U.getFechaUnix(),x=h-7,[s,A]=p({fechaFin:h,fechaInicio:x,almacenID:0}),[P,w]=p([]);S(()=>{const e=(l().Almacenes||[])[0]?.ID;e&&e!==s().almacenID&&A({...s(),almacenID:e})});const m=new Map,d=new Map,I=O(B,"id"),M=async()=>{g.standard("Consultando registros...");let e;try{e=await E(s())}catch{g.remove();return}console.log("registros obtenidos: ",e);for(let t of e.Productos)d.set(t.ID,t);for(let t of e.Usuarios)m.set(t.id,t);w(e.Movimientos),g.remove()},[u,_]=p(""),b=(e,t)=>{if(!e)return"";const r=l().AlmacenesMap.get(e)?.Nombre||`Almacen-${e}`;return(()=>{var c=R(),i=c.firstChild,f=i.nextSibling,a=f.nextSibling;return o(i,r),o(a,t),c})()};return n(N,{title:"Almacén Stock",get children(){return[(()=>{var e=V(),t=e.firstChild,r=t.firstChild,c=t.nextSibling,i=c.firstChild,f=i.nextSibling;return t.style.setProperty("max-width","64rem"),o(t,n(T,{get saveOn(){return s()},save:"almacenID",css:"w-08x mb-02 mr-12",label:"Almacén",keys:"ID.Nombre",get options(){return l()?.Almacenes||[]},placeholder:"",required:!0,onChange:a=>{}}),r),o(t,n(C,{label:"Fecha Inicio",css:"w-045x",save:"fechaInicio",get saveOn(){return s()}}),r),o(t,n(C,{label:"Fecha Fin",css:"w-045x",save:"fechaFin",get saveOn(){return s()}}),r),r.$$click=a=>{a.stopPropagation(),M()},f.$$keyup=a=>{a.stopPropagation(),L(()=>{_((a.target.value||"").toLowerCase().trim())},150)},e})(),n(k,{get data(){return P()},css:"w100 w-page-t",tableCss:"w100",maxHeight:"calc(100vh - 8rem - 12px)",makeFilter:e=>{const t=d.get(e.ProductoID)?.Nombre||"",r=m.get(e.CreatedBy||1)?.usuario||"";return[t,r].join(" ")},get filterText(){return u()},columns:[{header:"Fecha Hora",css:"ff-mono",getValue:e=>j(e.Created,"d-M h:n")},{header:"Producto",css:"",render:e=>{const t=d.get(e.ProductoID)?.Nombre||`Producto-${e.ProductoID}`;return $(t,u())}},{header:"Lote",css:"c-purple t-c",getValue:e=>e.Lote},{header:"SKU",css:"c-purple t-c",getValue:e=>e.SKU},{header:"Movimiento",css:"t-c",render:e=>I.get(e.Tipo)?.name||"-"},{header:"Cantidad",css:"t-r ff-mono",render:e=>(()=>{var t=K();return o(t,()=>e.Cantidad),F(()=>D(t,"flex jc-end "+(e.Cantidad<0?"c-red":"c-blue"))),t})()},{header:"Almacén Origen",css:"",render:e=>b(e.AlmacenOrigenID,e.AlmacenOrigenCantidad)},{header:"Almacén Destino",css:"",render:e=>b(e.AlmacenID,e.AlmacenCantidad)},{header:"Usuario",cardColumn:[3,2],cardCss:"h5 c-steel",css:"t-c",render:e=>{const t=m.get(e.CreatedBy||1)?.usuario||`Usuario-${e.CreatedBy}`;return $(t,u())}}]})]}})}y(["click","keyup"]);export{ae as default};
