import"../chunks/DsnmJJEf.js";import{p as P,e as m,g as y,l as U,m as H,h as r,i as s,d as L,f as z,a as B,c as d,u as q,s as o,r as p,b as R}from"../chunks/CaHRSXkO.js";import{d as A}from"../chunks/EZdBy8tr.js";import{P as E}from"../chunks/Unhq163E.js";import{S as G}from"../chunks/DNFtqU53.js";import{D as F}from"../chunks/CzqP_zqU.js";import{V as J}from"../chunks/DkdBOKrn.js";import{t as K,f as Q,N as W,L as h}from"../chunks/Bt0GHlld.js";import{f as _}from"../chunks/BEo5_Va5.js";import{C as X,c as Y,g as Z}from"../chunks/Dnx4Hc19.js";var ee=z('<div class="flex items-center justify-between mb-12"><div class="flex items-center w-full" style="max-width: 64rem;"><!> <!> <!> <button class="px-16 py-8 bx-blue mt-8 h-44" aria-label="Consultar registros"><i class="icon-search"></i></button></div> <div class="flex items-center mr-16 w-224 ml-auto relative"><div class="absolute left-12 text-gray-400"><i class="icon-search"></i></div> <input class="w-full pl-36 pr-12 py-8 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" autocomplete="off" type="text" placeholder="Buscar..."/></div></div> <!>',1);function me(D,M){P(M,!0);const c=new X,v=new Map(Y.map(e=>[e.id,e])),g=Math.floor(Date.now()/(1e3*60*60*24)),T=g-7;let a=m(y({fechaFin:g,fechaInicio:T,CajaID:0})),C=m(y([])),x=m("");U(()=>{c?.Cajas?.length>0&&H(()=>{const e=(c.Cajas||[])[0]?.ID;r(a,{...s(a),CajaID:e},!0)})});const O=async()=>{if(!s(a).CajaID||!s(a).fechaInicio||!s(a).fechaFin){W.failure("Debe seleccionar una caja y un rango de fechas.");return}h.standard("Consultando registros...");let e;try{const i=s(a).fechaInicio*24*60*60+-18e3,n=(s(a).fechaFin+1)*24*60*60+-18e3;e=await Z({CajaID:s(a).CajaID,fechaInicio:i,fechaFin:n})}catch{h.remove();return}h.remove(),r(C,e||[],!0),console.log("movimientos obtenidos: ",e)},k=[{header:"Fecha Hora",headerCss:"w-140",cellCss:"ff-mono px-6",getValue:e=>Q(e.Created,"d-M h:n")},{header:"Tipo Mov.",headerCss:"w-160",cellCss:"px-6",getValue:e=>v.get(e.Tipo)?.name||""},{header:"Monto",headerCss:"w-120",cellCss:"ff-mono text-right px-6",render:e=>`<span class="${e.Monto<0?"text-red-500":""}">${_(e.Monto/100,2)}</span>`},{header:"Saldo Final",headerCss:"w-120",cellCss:"ff-mono text-right px-6",getValue:e=>_(e.SaldoFinal/100,2)},{header:"NÂº Documento",headerCss:"w-140",cellCss:"text-center px-6",getValue:e=>""},{header:"Usuario",headerCss:"w-120",cellCss:"text-center px-6",getValue:e=>e.Usuario?.usuario||""}];E(D,{title:"Cajas Movimientos",children:(e,l)=>{var i=ee(),n=B(i),u=d(n),w=d(u);{let t=q(()=>c?.Cajas||[]);G(w,{save:"CajaID",css:"w-240 mr-12",label:"Cajas & Bancos",keyId:"ID",keyName:"Nombre",get options(){return s(t)},placeholder:"",required:!0,get saveOn(){return s(a)},set saveOn(f){r(a,f,!0)}})}var b=o(w,2);F(b,{label:"Fecha Inicio",css:"w-140 mr-12",save:"fechaInicio",get saveOn(){return s(a)},set saveOn(t){r(a,t,!0)}});var j=o(b,2);F(j,{label:"Fecha Fin",css:"w-140 mr-12",save:"fechaFin",get saveOn(){return s(a)},set saveOn(t){r(a,t,!0)}});var V=o(j,2);V.__click=t=>{t.stopPropagation(),O()},p(u);var I=o(u,2),$=o(d(I),2);$.__keyup=t=>{t.stopPropagation(),K(()=>{r(x,(t.target.value||"").toLowerCase().trim(),!0)},150)},p(I),p(n);var N=o(n,2);J(N,{get data(){return s(C)},get columns(){return k},css:"w-full",tableCss:"w-full",maxHeight:"calc(100vh - 8rem - 12px)",get filterText(){return s(x)},getFilterContent:t=>{const f=v.get(t.Tipo)?.name||"",S=t.Usuario?.usuario||"";return[f,S].join(" ").toLowerCase()},useFilterCache:!0}),R(e,i)},$$slots:{default:!0}}),L()}A(["click","keyup"]);export{me as component};
